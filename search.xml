<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HarmonyAICamera</title>
      <link href="2021/07/harmonyaicamera/"/>
      <url>2021/07/harmonyaicamera/</url>
      
        <content type="html"><![CDATA[<h2 id="鸿蒙全场景万物互联整体概述"><a href="#鸿蒙全场景万物互联整体概述" class="headerlink" title="鸿蒙全场景万物互联整体概述"></a>鸿蒙全场景万物互联整体概述</h2><h3 id="鸿蒙是啥？和Android有什么区别？是套壳吗？"><a href="#鸿蒙是啥？和Android有什么区别？是套壳吗？" class="headerlink" title="鸿蒙是啥？和Android有什么区别？是套壳吗？"></a>鸿蒙是啥？和Android有什么区别？是套壳吗？</h3><h4 id="HarmonyOS是全场景分布式万物互联操作系统"><a href="#HarmonyOS是全场景分布式万物互联操作系统" class="headerlink" title="HarmonyOS是全场景分布式万物互联操作系统"></a>HarmonyOS是全场景分布式万物互联操作系统</h4><p>在传统的单设备系统能力基础上，HarmonyOS提出了基于同一套系统能力、适配多种终端形态的分布式理念，能够支持手机、平板、智能穿戴、智慧屏、车机等多种终端设备，提供全场景（移动办公、运动健康、社交通信、媒体娱乐等）业务能力。</p><p>对消费者而言，HarmonyOS能够将生活场景中的各类终端进行能力整合，实现不同终端设备之间的快速连接、能力互助、资源共享，匹配合适的设备、提供流畅的全场景体验。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/nMJIKvxSwFkoiXm.png" alt="img"></p><p>面向开发者，实现一次开发，多端部署；</p><p>对应用开发者而言，HarmonyOS采用了多种分布式技术，使应用开发与不同终端设备的形态差异无关，从而让开发者能够聚焦上层业务逻辑，更加便捷、高效地开发应用。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210723103159293.png" alt="image-20210723103159293"></p><p>HarmonyOS介绍视频</p><p>&lt;video id=”video” controls=””src=”<a href="https://mos-vod-drcn.dbankcdn.cn/P_VT/video_injection/7C1346286/v3/7C5879811130980925606204416/MP4Mix_H.264_1920x1080_6000_HEAAC1_PVC_NoCut.mp4&quot;" rel="external nofollow noreferrer">https://mos-vod-drcn.dbankcdn.cn/P_VT/video_injection/7C1346286/v3/7C5879811130980925606204416/MP4Mix_H.264_1920x1080_6000_HEAAC1_PVC_NoCut.mp4&quot;</a> preload=”none”&gt;</p><h4 id="Android生态"><a href="#Android生态" class="headerlink" title="Android生态"></a>Android生态</h4><p>安卓设备多用于带有图形化的智能应用终端，比如手机、平板、车载、电视等。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210723104811792.png" alt="image-20210723104811792"></p><h4 id="安卓和鸿蒙有什么区别呢？"><a href="#安卓和鸿蒙有什么区别呢？" class="headerlink" title="安卓和鸿蒙有什么区别呢？"></a>安卓和鸿蒙有什么区别呢？</h4><p>未来是万物互联的时代，想象一个智能化的场景，不仅仅有手机、电视、平板、电脑，还有手表、汽车、空调、冰箱、安防、家居控制等各种智能设备，如果使用安卓系统会怎么样呢？</p><p>1、虽然都是安卓系统，但是谁也不认识谁，数据不能互通；</p><p>2、这么多的智能设备，硬件能力得不到相互利用，发布不了最大价值；</p><p>3、安卓系统过于庞大，难于裁剪、对硬件要求过高，不适于所有的硬件设备；</p><p>鸿蒙解决了以上的两个痛点问题：</p><p><video class="" autoplay="" playsinline="true" x5-playsinline="true" webkit-playsinline="true" tabindex="2" mediatype="video" width="640" height="480" src="//v26-web.douyinvod.com/fbc68d26a190f986f86c1e8bc3f6d730/60fa4375/video/tos/cn/tos-cn-ve-15/7980a8f12d8441799d77ea24aad28288/?a=6383&amp;br=262&amp;bt=262&amp;cd=0%7C0%7C0&amp;ch=26&amp;cr=0&amp;cs=0&amp;cv=1&amp;dr=0&amp;ds=3&amp;er=&amp;ft=0J.120FFckag3&amp;l=021627010343497fdbddc0100fff0030ac21d8700000272886b84&amp;lr=all&amp;mime_type=video_mp4&amp;net=0&amp;pl=0&amp;qs=0&amp;rc=M3E3OXNyOjhvNjMzNGkzM0ApNGYzZzk1NmU4N2g7ZWk3OmdraDFhcDJvaS5gLS1kLS9zc2AvNjExMTQ2MTUwYmBfYS86Yw%3D%3D&amp;vl=&amp;vr="></video></p><p>为什么鸿蒙可以做到万物互联，多设备协同的全场景而安卓不行呢？我们需要查看两个生态系统的整体架构。</p><h4 id="安卓的系统架构"><a href="#安卓的系统架构" class="headerlink" title="安卓的系统架构"></a>安卓的系统架构</h4><p>在2007年的时候，是智能硬件开始发展的初期阶段，但是市场上缺少完整的操作系统框架，唯一开源免费的是QT，但是应用生态堪忧，后续被诺基亚收购后，变得落寞不堪。而这时候谷歌带领安卓杀入了智能终端市场，一时间引起全世界的关注。</p><p>但如今的万物互联时代，安卓却显得臃肿，很难在所有的设备上通用，我们来看一下它的架构。</p><p><img src="https://i.loli.net/2021/07/12/bqkAiULG8tRXd4V.png" alt="Android 系统架构概览"></p><h4 id="鸿蒙的系统架构"><a href="#鸿蒙的系统架构" class="headerlink" title="鸿蒙的系统架构"></a>鸿蒙的系统架构</h4><p>HarmonyOS整体遵从分层设计，从下向上依次为：内核层、系统服务层、框架层和应用层。系统功能按照“系统 &gt; 子系统 &gt; 功能/模块”逐级展开，在多设备部署场景下，支持根据实际需求裁剪某些非必要的子系统或功能/模块。HarmonyOS技术架构如下所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/0000000000011111111.20210702111614.70553161874564446284689605088019:50520704022932:2800:6E428D2126244A4A73E205359137986B8DBEB239711AFA5C580069442BEF7895.png" alt="img"></p><p>鸿蒙系统架构视频介绍</p><p>&lt;video id=”video” controls=””src=”<a href="https://mos-vod-drcn.dbankcdn.cn/P_VT/video_injection/D71346286/v3/2999FE4A1130980852826641152/MP4Mix_H.264_1920x1080_6000_HEAAC1_PVC_NoCut.mp4&quot;" rel="external nofollow noreferrer">https://mos-vod-drcn.dbankcdn.cn/P_VT/video_injection/D71346286/v3/2999FE4A1130980852826641152/MP4Mix_H.264_1920x1080_6000_HEAAC1_PVC_NoCut.mp4&quot;</a> preload=”none”&gt;</p><h4 id="鸿蒙是套壳的安卓吗？"><a href="#鸿蒙是套壳的安卓吗？" class="headerlink" title="鸿蒙是套壳的安卓吗？"></a>鸿蒙是套壳的安卓吗？</h4><p>说明白这个问题我们先来看安卓这个话题。安卓(Android)是一个开源项目，名字叫做AOSP(Android Open Source Projec)，是由谷歌发起的，面向移动智能终端的智能操作系统，是目前生态和苹果在移动终端上生态最好的两个操作系统。简单来说，开发人员开发的安卓应用，可以在基于AOSP的兼容性设备上运行，这就是<strong>应用生态</strong>。</p><p><strong>目前HarmonyOS其实是AOSP+OpenHarmonyOS的组合</strong>。鸿蒙也就是HarmonyOS，也就是完全和安卓没关系的是OpenHarmonyOS，目前已经开源开放。但是一个系统上面没有应用程序，用户买了一个操作系统就等于是买了块板砖，这就造成了目前HarmonyOS对AOSP做了兼容，等待OpenHarmonyOS生态趋向于完成的那一天，猜测HarmonyOS一定会去掉对AOSP安卓的支持。</p><h3 id="其他手机公司会用HarmonyOS吗？"><a href="#其他手机公司会用HarmonyOS吗？" class="headerlink" title="其他手机公司会用HarmonyOS吗？"></a>其他手机公司会用HarmonyOS吗？</h3><p>小米、Oppo等暂时不会，卖出去的荣耀、魅族会。</p><h4 id="HarmonOS和OpenHarmonyOS的区别"><a href="#HarmonOS和OpenHarmonyOS的区别" class="headerlink" title="HarmonOS和OpenHarmonyOS的区别"></a>HarmonOS和OpenHarmonyOS的区别</h4><p>因为HarmonyOS是华为开发的一套基于OpenHarmonyOS的操作系统。</p><p>对比安卓的话，就相当于谷歌开源了AOSP安卓框架，华为在此基础上开发了EMUI系统，小米在此基础上开发了MIUI系统。</p><p>HarmonyOS就像是安卓的EMUI，但它是基于OpenHarmonyOS的，而OpenHarmonyOS是开源开放的。</p><p>我们期待更多的企业和开发者能够使用基于OpenHarmonyOS创建出来类似安卓的EMUI、MIUI系统，让我们中国人有自己的操作系统应用生态。</p><h4 id="小米的难言之隐"><a href="#小米的难言之隐" class="headerlink" title="小米的难言之隐"></a>小米的难言之隐</h4><p>对于鸿蒙，卢伟冰微博下网友的一些的期待哈😂</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210723124850397.png" alt="image-20210723124850397"></p><p>首先OpenHarmonyOS是没有安卓生态的，小米转投鸿蒙，只是使用目前的OpenHarmonyOS系统，没有安卓生态支撑，必死。</p><p>其次小米有自己基于Nuttx的Vela物联网操作系统生态，也是围绕着万物互联生态展开，但量级和鸿蒙还无法相比，从整体架构上就不在一个量级，但是也是目前走上万物互联最稳妥的一条路线。</p><p>最后万物互联还有很多其他终端设备厂商可以支持鸿蒙或者Vela操作系统，这都是我们自己中国人的生态系统，希望中国人一定要支持起来。</p><h4 id="阿里和魅族的瓜"><a href="#阿里和魅族的瓜" class="headerlink" title="阿里和魅族的瓜"></a>阿里和魅族的瓜</h4><p>另外多说一点，阿里很早之前就基于Android做自己的操作系统了，之前大量入股了魅族，但是后来被谷歌各种告，导致阿里基于搞得一套JS引擎支撑的系统没有起来，后来魅族也没落了。在鸿蒙开源后，魅族宣布魅族智能家居产品将接入鸿蒙系统。</p><h3 id="HarmonyOS有哪些亮点？怎么实现的？"><a href="#HarmonyOS有哪些亮点？怎么实现的？" class="headerlink" title="HarmonyOS有哪些亮点？怎么实现的？"></a>HarmonyOS有哪些亮点？怎么实现的？</h3><p>超级终端、任务流转这种多设备协同工作的刚才已经看到了，咱们再来看一看其他特性。</p><h4 id="碰一碰"><a href="#碰一碰" class="headerlink" title="碰一碰"></a>碰一碰</h4><p>碰一碰功能待发布：</p><p><a href="https://device.harmonyos.com/cn/docs/start/overview/oem_start_guide-0000001054913231" rel="external nofollow noreferrer">https://device.harmonyos.com/cn/docs/start/overview/oem_start_guide-0000001054913231</a></p><p><img src="https://i.loli.net/2021/07/13/ayxWcImlephEQtH.png" alt="image-20210713155548407"></p><p>演示效果：</p><p><video class="" autoplay="" playsinline="true" x5-playsinline="true" webkit-playsinline="true" tabindex="2" mediatype="video" width="640" height="480" src="//v26-web.douyinvod.com/33b1cca521c6136db383c9966b80e1b6/60fa5df7/video/tos/cn/tos-cn-ve-15/2ed65c856d61439ea1d73a51bd608937/?a=6383&amp;br=683&amp;bt=683&amp;cd=0%7C0%7C0&amp;ch=26&amp;cr=0&amp;cs=0&amp;cv=1&amp;dr=0&amp;ds=3&amp;er=&amp;ft=0J.120FFckag3&amp;l=021627017154598fdbd400a040000000a70142b000000709ed2eb&amp;lr=all&amp;mime_type=video_mp4&amp;net=0&amp;pl=0&amp;qs=0&amp;rc=anFzPGRkdGdzNTMzNGkzM0ApZ2VkOTU1aDs8NzkzNzZnOGdkcV9qcHJyYG9gLS1kLS9zczQxMzZjMzNhNC4uXjZfNTY6Yw%3D%3D&amp;vl=&amp;vr="></video></p><h4 id="原子化服务"><a href="#原子化服务" class="headerlink" title="原子化服务"></a>原子化服务</h4><p>特点：免安装，无安装图标，可以显示为服务卡片，为用户提供统一的原子化服务查看、搜索、收藏和管理功能。以手机为例，示意如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210723130518430.png" alt="image-20210723130518430"></p><p>并且依托于鸿蒙系统的能力加持，支持多终端流转和协调</p><p>用户使用应用程序时，所处环境中存在使用体验更优的可选设备，则系统自动为用户推荐该设备，用户可确认是否启动流转。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/0000000000011111111.20210716112047.95666165145953245985039874431915:50520715065831:2800:2C7A3F3CEBA7F3C34E58BCAD16C018B0D1166712108DCB0E57BC7566246DA8B0.jpg" alt="img"></p><p>原子化服务分享</p><p>用户可在原子化服务内选择分享，打开“华为分享”开关后，将原子化服务分享给附近同样打开了“华为分享”开关的好友，好友点击确认后直接启动服务</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/0000000000011111111.20210716112048.94476766383802169374999786805376:50520715065832:2800:BC5CBD29189B0346CD60A482C3CBE1E99E5E5DFA28BA14876024C9DF2D16D8A8.png" alt="img"></p><h3 id="学习HarmonyOS有前途吗？"><a href="#学习HarmonyOS有前途吗？" class="headerlink" title="学习HarmonyOS有前途吗？"></a>学习HarmonyOS有前途吗？</h3><p>未来的操作系统和硬件设备一定也要国有化、想想咱们为什么能在上次的中美约谈中这么霸气，如果不是科技的进步、军事力量的支撑可能吗？</p><p>只要是中国目前在科技上有机会能够领先的，不被卡脖子的，都应该支持，因为如果都不支持就没有生态，没有生态就发展不起来，就还是被卡脖子，中国人的自己的生命安全也没有保障。</p><p>不仅HarmonyOS要支持，如果其他企业发展了一些可以对标超越美帝企业的产品，我们都可以尽自己的一份力量来支持。</p><p>不仅鸿蒙，我们还要看到目前的第四次工业革命，是继蒸汽技术革命（第一次工业革命），电力技术革命（第二次工业革命），计算机及信息技术革命（第三次工业革命）的又一次科技革命。 第四次工业革命，是以人工智能、新材料技术、分子工程、石墨烯、虚拟现实、量子信息技术、可控核聚变、清洁能源以及生物技术为技术突破口的工业革命，将导致社会生产方式、制造模式甚至生产组织方式等方面的重要变革，最终使人类进入生态和谐、绿色低碳、可持续发展的社会。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210723132239297.png" alt="生态绿色环保的大家庭"></p><h2 id="1-讯飞AI语音相机项目介绍"><a href="#1-讯飞AI语音相机项目介绍" class="headerlink" title="1.讯飞AI语音相机项目介绍"></a>1.讯飞AI语音相机项目介绍</h2><p>背景：</p><p>一对夫妻外出旅游，希望有人给他照相。拍好后，小两口如果想知道拍的怎么样，就需要取回拍照设备，不满意的话，还得重新回到位置点重新拍，这样子的拍照体验就比较差，最好是按下了快门后，被拍的人可以立即看到结果，根据拍摄的好坏再决定是否需要继续拍，而不用跑到拍摄者查看照片这么折腾了。</p><p><img src="https://i.loli.net/2021/07/12/dvqAYnHze7cKpTk.png" alt="拍照场景"></p><p>为了解决上述问题，我们可以基于HarmonyOS<strong>分布式文件系统</strong>和<strong>AI语音识别功能</strong>开发一款照相机，这款相机能将拍摄的照片实时共享到同一分布式网络下的不同设备中，这样大家都可以看到拍摄的照片，就不需要一窝蜂的跑到一台手机前，不满意也无需来回反复地传递手机，对于满意的照片还可以实时保存，避免后期反复挑选，高效的解决了上述例子中的痛点问题。</p><p>以下是这款应用的体验效果图</p><p><img src="https://i.loli.net/2021/07/16/423AWBho9Msz5wl.gif" alt="共享拍照"></p><h2 id="2-搭建HarmonyOS环境"><a href="#2-搭建HarmonyOS环境" class="headerlink" title="2. 搭建HarmonyOS环境"></a>2. 搭建HarmonyOS环境</h2><p><img src="https://i.loli.net/2021/07/12/URPLF7oYTZtEA36.png" alt="开发鸿蒙应用整体流程"></p><h3 id="2-1-开发环境安装配置"><a href="#2-1-开发环境安装配置" class="headerlink" title="2.1 开发环境安装配置"></a>2.1 开发环境安装配置</h3><p>我们首先需要完成HarmonyOS开发环境搭建，可参照如下步骤进行。</p><h4 id="2-1-1-安装DevEco-Studio"><a href="#2-1-1-安装DevEco-Studio" class="headerlink" title="2.1.1 安装DevEco Studio"></a>2.1.1 安装DevEco Studio</h4><p>详情请参考<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/software_install-0000001053582415" rel="external nofollow noreferrer">下载和安装软件</a>，如果拿到了培训的资源包，可以通过Tools目录下的devecostudio-windows-tool-2.1.0.501.zip解压后即可完成安装；</p><h4 id="2-1-2-配置DevEco-Studio开发环境"><a href="#2-1-2-配置DevEco-Studio开发环境" class="headerlink" title="2.1.2 配置DevEco Studio开发环境"></a>2.1.2 配置DevEco Studio开发环境</h4><p>DevEco Studio开发环境依赖于网络环境，需要连接上网络才能确保工具的正常使用，另外需要<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/environment_config-0000001052902427" rel="external nofollow noreferrer">下载HarmonyOS SDK</a>，如果拿到了培训的资源包，直接使用Tools目录下的HarmonySDK.zip，解压后，在下图中进行配置即可，节省大量的时间。</p><p><img src="https://i.loli.net/2021/07/12/yPSLhC8ATV1WKH6.png" alt="鸿蒙SDK配置"></p><p>如果网络不能直接访问Internet，需要通过代理服务器才可以访问，请参考<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/environment_config-0000001052902427" rel="external nofollow noreferrer">配置开发环境</a>。</p><h3 id="2-2-开发运行第一个鸿蒙应用"><a href="#2-2-开发运行第一个鸿蒙应用" class="headerlink" title="2.2 开发运行第一个鸿蒙应用"></a>2.2 开发运行第一个鸿蒙应用</h3><p>通过本章节的内容，能够熟悉HarmonyOS应用开发的基本流程。</p><p><img src="https://i.loli.net/2021/07/12/uCYSl98URV1ksWn.png" alt="鸿蒙应用开发流程"></p><h4 id="2-2-1-应用开发步骤"><a href="#2-2-1-应用开发步骤" class="headerlink" title="2.2.1 应用开发步骤"></a>2.2.1 应用开发步骤</h4><p><strong>Helloworld应用创建：</strong></p><ol><li><p>通过如下两种方式，打开工程创建向导界面。</p><ul><li>如果当前未打开任何工程，可以在DevEco Studio的欢迎页，选择<strong>Create HarmonyOS Project</strong>开始创建一个新工程。</li><li>如果已经打开了工程，可以在菜单栏选择<strong>File &gt; New &gt; New Project</strong>来创建一个新工程。</li></ul></li><li><p>根据工程创建向导，选择需要的Ability工程模板，然后点击Next。关于工程模板的介绍和支持的设备类型</p><p> <img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20210705103404.03165379434154449024302681074661:50520704061414:2800:A431A9FAE0FBC274ACC64B418A506C9006D3F08400F41C24C7F32617CDB6EB21.png?needInitFileName=true?needInitFileName=true" alt="img"></p></li><li><p>点击<strong>Next</strong>，进入到工程配置阶段，需要根据向导配置工程的基本信息。</p><ul><li><p><strong>Project Name</strong>：工程的名称，可以自定义。</p></li><li><p>Project Type：</p><p>  工程的类型，标识该工程是一个</p><p>  原子化服务（Atomic Service）</p><p>  或传统方式的需要安装的应用。</p><p>  说明</p><p>  如果是创建的原子化服务，则：</p><ul><li>原子化服务调试、运行时，在设备桌面上没有应用图标，请使用DevEco Studio的调试和运行功能，来启动原子化服务。</li><li>原子化服务是免安装的，config.json中自动添加<strong>installationFree</strong>字段，取值为“true”。</li><li>如果entry模块的<strong>installationFree</strong>字段为true，则其相关的所有hap模块的<strong>installationFree</strong>字段都默认为true；如果entry模块的<strong>installationFree</strong>字段为false，则其相关的所有hap模块可以配置为true或false。</li><li>编译构建App时，每个hap包大小不能超过10MB。</li></ul></li><li><p><strong>Package Name</strong>：软件包名称，默认情况下，应用ID也会使用该名称，应用发布时，应用ID需要唯一。</p></li><li><p><strong>Save Location</strong>：工程文件本地存储路径。</p></li><li><p><strong>Compatible API V**</strong>ersion**：兼容的SDK最低版本。</p></li><li><p><strong>Device Type：</strong>该工程模板支持的设备类型，支持多选。如果勾选多个设备，表示该原子化服务或传统方式的需要安装的应用支持部署在多个设备上。</p></li><li><p><strong>Show in Service Center：</strong>是否在服务中心露出。如果Project Type为Service，则会同步创建一个2<em>2的服务卡片模板，同时还会创建入口卡片；如果Project Type为Application，则只会创建一个2</em>2的服务卡片模板。</p><p><img src="https://i.loli.net/2021/07/12/Kb9XEIhLJQ1qWYw.png" alt="创建HelloWorld工程"></p></li></ul></li><li><p>点击<strong>Finish</strong>，工具会自动生成示例代码和相关资源，等待工程创建完成。</p></li></ol><p><strong>开发环境说明：</strong></p><p><img src="https://i.loli.net/2021/07/12/i5mbjV9Go6AgMRr.png" alt="DevEco IDE界面功能区域划分"></p><p><strong>模拟器运行：</strong></p><p><img src="https://i.loli.net/2021/07/12/Z5rP7SfdjlLGhkN.png" alt="使用模拟器运行程序"></p><p>在弹出的模拟器上方点击运行按钮，即可运行刚才的程序：</p><p><img src="https://i.loli.net/2021/07/12/gS1LX5R4e3hxbFV.png" alt="程序运行"></p><p>以上程序是怎么运行起来的呢，我们有必要从运行的应用和工程代码的两个方面，了解下他们之间的逻辑关系是怎么样的。</p><p><strong>运行一个Android应用的流程（简化版）：</strong></p><p><img src="https://i.loli.net/2021/07/12/KVpNoPAxti5JCl1.png" alt="Android应用基本组成"></p><p>开发运行一个鸿蒙应用的流程：</p><p><img src="https://i.loli.net/2021/07/12/sfzinZQ42K6lprj.png" alt="鸿蒙应用与代码逻辑关系"></p><p><img src="https://i.loli.net/2021/07/12/yHqciEzfwUOD6aK.png" alt="显示布局设计界面"></p><h4 id="2-2-2-应用编译构建"><a href="#2-2-2-应用编译构建" class="headerlink" title="2.2.2 应用编译构建"></a>2.2.2 应用编译构建</h4><p>编译构建是将HarmonyOS应用的源代码、资源、第三方库等打包生成HAP或者APP的过程。其中，HAP可以直接运行在真机设备或者模拟器中；APP则是用于应用上架到华为应用市场。</p><p>在进行HarmonyOS应用的编译构建前，需要对工程和编译构建的Module进行设置，请根据实际情况进行修改。</p><ul><li>build.gradle：HarmonyOS应用依赖gradle进行构建，需要通过build.gradle来对工程编译构建参数进行设置。build.gradle分为工程级和模块级两种类型，其中工程根目录下的工程级build.gradle用于工程的全局设置，各模块下的build.gradle只对本模块生效。</li><li>config.json：应用配置文件，用于描述应用的全局配置信息、在具体设备上的配置信息和HAP的配置信息。</li></ul><p><strong>工程级build.gradle</strong></p><ul><li><p>apply plugin：在工程级Gradle中引入打包app的插件，不需要修改。</p><pre><code>apply plugin: &#39;com.huawei.ohos.app&#39;</code></pre></li><li><p>ohos闭包：工程配置，包括如下配置项：</p><ul><li><p>compileSdkVersion：依赖的SDK版本。</p><pre class="line-numbers language-json"><code class="language-json">compileSdkVersion <span class="token number">5</span>    //应用编译构建的目标SDK版本     defaultConfig <span class="token punctuation">{</span>         compatibleSdkVersion <span class="token number">4</span>    //应用兼容的最低SDK版本     <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>signingConfigs：发布APP时的签名信息，在<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/publish_app-0000001053223745" rel="external nofollow noreferrer">应用发布</a>中进行设置后自动生成。</p></li></ul></li><li><p>buildscript闭包：Gradle脚本执行依赖，包括Maven仓地址和HarmonyOS编译构建插件。HarmonyOS编译构建插件是以Gradle插件为基础，在使用相应的HarmonyOS编译构建插件时，需要使用配套的Gradle插件，两者之间的配套关系如下表所示。</p><table><thead><tr><th>HarmonyOS编译构建插件版本</th><th>Gradle插件版本</th></tr></thead><tbody><tr><td>2.0.0.6</td><td>5.4.1</td></tr><tr><td>2.0.0.72.4.0.12.4.1.42.4.2.52.4.4.22.4.5.0</td><td>6.3</td></tr></tbody></table><pre class="line-numbers language-json"><code class="language-json">buildscript <span class="token punctuation">{</span>    repositories <span class="token punctuation">{</span>           maven <span class="token punctuation">{</span>            url 'https<span class="token operator">:</span>//mirrors.huaweicloud.com/repository/maven/'        <span class="token punctuation">}</span>        maven <span class="token punctuation">{</span>            url 'https<span class="token operator">:</span>//developer.huawei.com/repo/'        <span class="token punctuation">}</span>              jcenter(<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    dependencies <span class="token punctuation">{</span>         classpath 'com.huawei.ohos<span class="token operator">:</span>hap<span class="token operator">:</span><span class="token number">2.4</span>.<span class="token number">5.0</span>'         classpath 'com.huawei.ohos<span class="token operator">:</span>decctest<span class="token operator">:</span><span class="token number">1.2</span>.<span class="token number">4.1</span>'    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>allprojects闭包：工程自身所需要的依赖，比如引用第三方库的Maven仓库和依赖包。</p><pre class="line-numbers language-json"><code class="language-json">allprojects <span class="token punctuation">{</span>    repositories <span class="token punctuation">{</span>       maven <span class="token punctuation">{</span>            url 'https<span class="token operator">:</span>//mirrors.huaweicloud.com/repository/maven/'       <span class="token punctuation">}</span>       maven <span class="token punctuation">{</span>            url 'https<span class="token operator">:</span>//developer.huawei.com/repo/'       <span class="token punctuation">}</span>             jcenter(<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>模块级build.gradle</strong></p><ul><li><p>apply plugin：在模块级Gradle中引入打包hap和library的插件，无需修改。</p><pre class="line-numbers language-json"><code class="language-json">apply plugin<span class="token operator">:</span> 'com.huawei.ohos.hap'   //打包hap包的插件apply plugin<span class="token operator">:</span> 'com.huawei.ohos.library'    //将HarmonyOS Library打包为har的插件apply plugin<span class="token operator">:</span> 'java-library'    //将Java Library打包为jar的插件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ohos闭包：模块配置，包括如下配置项：</p><ul><li><p>compileSdkVersion：依赖的SDK版本。</p><pre class="line-numbers language-json"><code class="language-json">compileSdkVersion <span class="token number">5</span>    //应用编译构建的目标SDK版本     defaultConfig <span class="token punctuation">{</span>         compatibleSdkVersion <span class="token number">4</span>    //应用兼容的最低SDK版本     <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>showInServiceCenter：是否在服务中心露出，只有在创建工程时选择了“Show in Service Center”选项才会生成该字段。</p><pre><code>showInServiceCenter true</code></pre></li><li><p>buildTypes：Java代码混淆功能。</p><pre class="line-numbers language-json"><code class="language-json">buildTypes <span class="token punctuation">{</span>     //构建Release类型的hap包或APP时的混淆功能设置     release <span class="token punctuation">{</span>          proguardOpt<span class="token punctuation">{</span>               //开启代码混淆功能               proguardEnabled <span class="token boolean">true</span>               // 配置混淆规则文件相对路径               rulesFiles 'proguard-rules.pro'               // 配置打包混淆规则文件相对路径，仅在HarmonyOS Library模块中配置               consumerRulesFiles 'consumer-rules.pro'           <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>signingConfigs：在<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/build_hap-0000001053342418" rel="external nofollow noreferrer">编译构建生成HAP</a>中进行设置后自动生成。</p></li><li><p>externalNativeBuild：C/C++编译构建代码设置项。</p><pre class="line-numbers language-java"><code class="language-java">externalNativeBuild <span class="token punctuation">{</span>    path <span class="token string">"src/main/cpp/CMakeLists.txt"</span>   <span class="token comment" spellcheck="true">//CMake配置入口，提供CMake构建脚本的相对路径    arguments "-v"    //传递给CMake的可选编译参数    abiFilters "arm64-v8a"     //用于设置本机的ABI编译环境    cppFlags ""   //设置C++编译器的可选参数}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>entryModules：该Feature模块关联的Entry模块。</p><pre><code>entryModules &quot;entry&quot;    </code></pre></li><li><p>mergeJsSrc：跨设备的应用编译构建，是否需要合并JS代码。Wearable和Lite Wearable共用一个工程，如下图所示。当进行编译构建时，将wearable/liteWearable目录下的JS文件与pages目录（Wearable和Lite Wearable共用的源码）下的JS文件进行合并打包。</p><p>  <img src="https://i.loli.net/2021/07/17/cfSTrnlQHEuktwB.png" alt="img"></p><pre class="line-numbers language-json"><code class="language-json">mergeJsSrc <span class="token boolean">true</span>    //合并JS代码打包时，请在ohos闭包下手动添加，<span class="token boolean">true</span>表示需要合并JS代码，<span class="token boolean">false</span>表示不需要合并JS代码。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>annotationEnabled：支持数据库注释。</p><pre class="line-numbers language-json"><code class="language-json">compileOptions<span class="token punctuation">{</span>          annotationEnabled <span class="token boolean">true</span>   //<span class="token boolean">true</span>表示支持，<span class="token boolean">false</span>表示不支持<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>dependencies闭包：该模块所需的依赖项。</p><pre class="line-numbers language-json"><code class="language-json">dependencies <span class="token punctuation">{</span>    implementation fileTree(dir<span class="token operator">:</span> 'libs'<span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span>'*.jar'<span class="token punctuation">,</span>'*.har'<span class="token punctuation">]</span><span class="token punctuation">)</span>    //该模块依赖的本地库，支持jar和har包    testImplementation 'junit<span class="token operator">:</span>junit<span class="token operator">:</span><span class="token number">4.13</span>'    //测试用例框架，无需修改        ohosTestImplementation 'com.huawei.ohos.testkit<span class="token operator">:</span>runner<span class="token operator">:</span><span class="token number">1.0</span>.<span class="token number">0.200</span>'<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>config.json配置文件</strong></p><p>HarmonyOS应用的每个模块下包含一个config.json配置文件，在编译构建前，需要对照检查和修改<strong>config.json</strong>文件，详情请参考**<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/basic-config-file-elements-0000000000034463" rel="external nofollow noreferrer">config.json配置文件介绍</a>**。</p><h4 id="2-2-3-应用运行"><a href="#2-2-3-应用运行" class="headerlink" title="2.2.3 应用运行"></a>2.2.3 应用运行</h4><p>应用可以在模拟器及真机上运行。</p><p><strong>模拟机Remote Emulator运行流程</strong></p><ol><li>在DevEco Studio菜单栏，点击<strong>Tools &gt; Device Manager</strong>。</li><li>在<strong>Remote Emulator</strong>页签中，点击<strong>Login</strong>，在浏览器中弹出华为开发者联盟帐号登录界面，请输入<a href="https://developer.huawei.com/consumer/cn/doc/start/ibca-0000001062388135" rel="external nofollow noreferrer">已实名认证</a>的华为开发者联盟帐号的用户名和密码进行登录。</li><li>登录后，请点击界面的<strong>允许</strong>按钮进行授权</li></ol><p>以下分别展示了单设备和多设备的运行方式</p><p><img src="https://i.loli.net/2021/07/17/YkRjmo5h73WSfFi.png" alt="单设备运行"></p><p><img src="https://i.loli.net/2021/07/17/LePMmXBkSY7RWFZ.png" alt="多设备运行"></p><p><strong>在真机运行上运行</strong></p><p>除了模拟器的步骤之外，还需要验证身份</p><ul><li>已注册成为华为开发者，并完成华为开发者<a href="https://developer.huawei.com/consumer/cn/doc/start/ibca-0000001062388135" rel="external nofollow noreferrer">实名认证</a>。</li><li>已对应用进行签名，具体签名指导请参考<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/ide_debug_device-0000001053822404#section837891802519" rel="external nofollow noreferrer">对应用进行签名</a>。</li></ul><p>对于设备本身，也需要<strong>打开USB调试</strong></p><ul><li>在Phone或者Tablet中运行应用，需要提前根据<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/build_hap-0000001053342418#section7901222142216" rel="external nofollow noreferrer">构建带签名信息的HAP包</a>章节，打包带签名信息的HAP。</li><li>在Phone或者Tablet中，打开“开发者模式”，可在<strong>设置 &gt; 关于手机/关于平板</strong>中，连续多次点击“版本号”，直到提示“您正处于开发者模式”即可。然后在设置的<strong>系统与更新 &gt; 开发人员选项</strong>中，打开<strong>“USB调试”</strong>开关。</li></ul><p><img src="https://i.loli.net/2021/07/17/YaywcmkUdsKfJl2.png" alt="img"></p><h4 id="2-2-4-应用调试"><a href="#2-2-4-应用调试" class="headerlink" title="2.2.4 应用调试"></a>2.2.4 应用调试</h4><p>鸿蒙一般的调试手段为使用HiLog日志调试，和程序断点调试。</p><p>对于真机调试还需要身份验证，进入<strong>File &gt; Project Structure &gt; Project &gt; Signing Configs</strong>界面，点击“Sign In”按钮进行登录。</p><p><img src="https://i.loli.net/2021/07/17/pxTvRKJqGyzeOc6.png" alt="身份验证窗口"></p><p>在登录后，登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html#/myProject" rel="external nofollow noreferrer">AppGallery Connect</a>，创建一个项目，并添加一个应用，注意填写的应用包名必须与config.json文件中的“bundleName”取值保持一致。</p><p><img src="https://i.loli.net/2021/07/17/JN6aQXmdiM3l1K5.png" alt="img"></p><p>返回DevEco Studio的自动签名界面，点击<strong>Automatically generate signing</strong>，即可自动进行签名。</p><p><img src="https://i.loli.net/2021/07/17/3qj6R2uEd5Ct4MG.png" alt="image-20210717185423666"></p><p>在调试代码时，HiLog日志不打印的原因有以下两个：</p><p>1、Log窗口不显示任何内容，如下图。</p><p><img src="https://i.loli.net/2021/07/16/cmVRbXUs25FWwEu.png" alt="image-20210716182338103"></p><p>问题原因：日志系统被其他应用占用或者本地的5037日志服务没有打开导致的。</p><p>解决办法：</p><p>查看5037端口占用情况：</p><pre class="line-numbers language-shell"><code class="language-shell">netstat -ano | findstr "5037"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://i.loli.net/2021/07/16/1iPfQtK2voeRzB9.png" alt="5037端口占用情况"></p><p>查看是哪些程序占用的：</p><pre class="line-numbers language-shell"><code class="language-shell">C:\Users\aibit>tasklist | findstr "11804"hdc.exe                      11804 Console                    1     10,576 KC:\Users\aibit>tasklist | findstr "2344"devecostudio64.exe            2344 Console                    1  1,139,504 K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除占用的所有Task:</p><pre class="line-numbers language-shell"><code class="language-shell">taskkill /T /F /PID "11804"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2、系统有打印日志，但是自己的程序没有，如下图。</p><p><img src="https://i.loli.net/2021/07/16/pTIziNX8MRsncQh.png" alt="image-20210716182449005"></p><p>问题原因：</p><p>手机没有打开HiLog服务的原因。</p><p>解决办法：</p><p>进入拨号界面，输入：<code>*#*#2846579#*#*</code>，进入后台设置-&gt;APLOG设置（手机重启后可能默认关闭），选择打开，然后重启DevEco IDE工具，使得Hdc触发和HiLog服务的重新连接即可。</p><h2 id="3-画一个拍照界面"><a href="#3-画一个拍照界面" class="headerlink" title="3. 画一个拍照界面"></a>3. 画一个拍照界面</h2><h4 id="3-1-拍照预览的最终效果"><a href="#3-1-拍照预览的最终效果" class="headerlink" title="3.1 拍照预览的最终效果"></a>3.1 拍照预览的最终效果</h4><p><img src="https://i.loli.net/2021/07/17/Bsr3hoeLUEGXHYd.png" alt="image-20210717203629516"></p><h4 id="3-2-界面配置文件分析"><a href="#3-2-界面配置文件分析" class="headerlink" title="3.2 界面配置文件分析"></a>3.2 界面配置文件分析</h4><h4 id="3-2-1-布局文件窗口"><a href="#3-2-1-布局文件窗口" class="headerlink" title="3.2.1 布局文件窗口"></a>3.2.1 布局文件窗口</h4><p>通过布局文件可以简单直观。其中每一个组件Component和ComponentContainer对象属性大部分都能够支持在XML中设置。例如其中的Image组件有height和weight属性，Text文本组件有”text_color”属性，另外Component作为组件的基类，ID、布局参数是通用的，例如：<code>ohos:id=&quot;$+id:text&quot;</code></p><h4 id="3-2-2-预览窗口"><a href="#3-2-2-预览窗口" class="headerlink" title="3.2.2 预览窗口"></a>3.2.2 预览窗口</h4><p>布局XML设置好之后，就可以在预览窗口实时看到结果。</p><p>注意，目前的预览窗口仅仅是预览，还不支持类似Android的拖拽功能。</p><h4 id="3-2-3-组件树窗口"><a href="#3-2-3-组件树窗口" class="headerlink" title="3.2.3 组件树窗口"></a>3.2.3 组件树窗口</h4><p>组件树窗口主要的功能是能够更加直观的看到组件之间的布局方式，所属层级关系，对组件的属性可以更加方便的设置。</p><h4 id="3-3-界面与代码结合控制"><a href="#3-3-界面与代码结合控制" class="headerlink" title="3.3 界面与代码结合控制"></a>3.3 界面与代码结合控制</h4><h4 id="3-3-1-修改布局文件"><a href="#3-3-1-修改布局文件" class="headerlink" title="3.3.1 修改布局文件"></a>3.3.1 修改布局文件</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DirectionalLayout</span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>ohos</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.huawei.com/res/ohos<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>alignment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Image</span>        <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>image_src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$media:ic_camera_head<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>scale_mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stretch<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DirectionalLayout</span>        <span class="token attr-name"><span class="token namespace">ohos:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$+id:surface_container<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>background_element</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#000000<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>29<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Image</span>        <span class="token attr-name"><span class="token namespace">ohos:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$+id:foot<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>image_src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$media:ic_camera_foot<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>scale_mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stretch<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DirectionalLayout</span>        <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>background_element</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#000000<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>bottom_padding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>layout_alignment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertical_center<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>left_padding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>horizontal<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>right_padding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30vp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Image</span>            <span class="token attr-name"><span class="token namespace">ohos:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$+id:tack_photo_btn<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_content<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0vp<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>image_src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$media:ic_camera_photo<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>layout_alignment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>scale_mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zoom_center<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">ohos:</span>weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DirectionalLayout</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DirectionalLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>增加相关的图片，可以到Src的takePhoto中查找。</p><h4 id="3-3-2-增加按钮绑定事件"><a href="#3-3-2-增加按钮绑定事件" class="headerlink" title="3.3.2 增加按钮绑定事件"></a>3.3.2 增加按钮绑定事件</h4><p>在AbilitySlice.java中增加以下绑定，通过变量和XML中的ID进行findComponentById绑定。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> Image takePictureBtn<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span>Intent intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUIContent</span><span class="token punctuation">(</span>ResourceTable<span class="token punctuation">.</span>Layout_ability_main<span class="token punctuation">)</span><span class="token punctuation">;</span>    takePictureBtn <span class="token operator">=</span> <span class="token punctuation">(</span>Image<span class="token punctuation">)</span> <span class="token function">findComponentById</span><span class="token punctuation">(</span>ResourceTable<span class="token punctuation">.</span>Id_tack_photo_btn<span class="token punctuation">)</span><span class="token punctuation">;</span>    takePictureBtn<span class="token punctuation">.</span><span class="token function">setClickedListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span><span class="token operator">:</span>takePicture<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>setClickedListener方法是设置按钮的单击事件，触发单击时会执行takePicture方法，实现如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG_LOG <span class="token operator">=</span> <span class="token string">"MainAbilitySlice"</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> HiLogLabel LABEL_LOG <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HiLogLabel</span><span class="token punctuation">(</span>HiLog<span class="token punctuation">.</span>LOG_APP<span class="token punctuation">,</span> <span class="token number">0x00101</span><span class="token punctuation">,</span> TAG_LOG<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">takePicture</span><span class="token punctuation">(</span>Component component<span class="token punctuation">)</span> <span class="token punctuation">{</span>    HiLog<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>LABEL_LOG<span class="token punctuation">,</span> <span class="token string">"按钮被点击"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ToastDialog toastDialog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ToastDialog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    toastDialog<span class="token punctuation">.</span><span class="token function">setAutoClosable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    toastDialog<span class="token punctuation">.</span><span class="token function">setAlignment</span><span class="token punctuation">(</span>LayoutAlignment<span class="token punctuation">.</span>CENTER<span class="token punctuation">)</span><span class="token punctuation">;</span>    toastDialog<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"按钮被点击"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    toastDialog<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上使用了两种调试方式，一个是常规日志打印HiLog，一个是在界面上会弹出一个窗口ToastDialog。</p><h2 id="4-实现相机预览与拍照"><a href="#4-实现相机预览与拍照" class="headerlink" title="4. 实现相机预览与拍照"></a>4. 实现相机预览与拍照</h2><p>HarmonyOS相机模块支持相机业务的开发，相机模块主要工作是给相机应用开发者提供基本的相机API接口，用于使用相机系统的功能。开发者可以通过调用已开放的接口实现相机硬件的访问、操作和新功能开发，最常见的操作如：预览、拍照、连拍和录像等。您可以参考HarmonyOS开发者指导中<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/media-camera-guidelines-0000000000031782" rel="external nofollow noreferrer">相机开发指导</a>进行学习。</p><p>本章节实现的相机<strong>预览</strong>与<strong>拍照</strong>两个功能的效果如下，参考代码在<strong>Src/TakePhotoV1.0.zip</strong>工程中：</p><p><img src="https://i.loli.net/2021/07/16/jaJEXw5TiLhtgDv.gif" alt="预览拍照"></p><h3 id="4-1-相机预览和拍照的权限申请"><a href="#4-1-相机预览和拍照的权限申请" class="headerlink" title="4.1 相机预览和拍照的权限申请"></a>4.1 <strong>相机预览和拍照的权限申请</strong></h3><p>在使用相机之前，需要申请相机的相关权限，保证应用拥有相机硬件及其他功能权限，应用权限的介绍请参考<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/security-permissions-available-0000001051089272" rel="external nofollow noreferrer">权限</a>章节，本工程涉及权限如下表。<br>本章节需要用到的相机权限列表</p><table><thead><tr><th>权限名称</th><th>权限属性值</th><th>是否必选</th></tr></thead><tbody><tr><td>相机权限</td><td>ohos.permission.CAMERA</td><td>必选（照相机权限）</td></tr><tr><td>位置权限</td><td>ohos.permission.MEDIA_LOCATION</td><td>可选（需要保存图像及视频位置信息时申请）</td></tr><tr><td>存储权限</td><td>ohos.permission.WRITE_MEDIA</td><td>可选（需要保存图像及视频到设备的外部存储时申请）</td></tr></tbody></table><p>以上的权限需要在config.json中静态申明，配置如下：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token property">"reqPermissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.CAMERA"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.WRITE_MEDIA"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.MEDIA_LOCATION"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时，对于权限还需要代码中动态申请通知用户授权才可以使用，在MainAbility.java中动态申请权限的完成代码如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>kuili<span class="token punctuation">.</span>takephoto<span class="token punctuation">.</span>slice<span class="token punctuation">.</span>MainAbilitySlice<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>kuili<span class="token punctuation">.</span>takephoto<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>LogUtil<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>kuili<span class="token punctuation">.</span>takephoto<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>PermissionBridge<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>aafwk<span class="token punctuation">.</span>ability<span class="token punctuation">.</span>Ability<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>aafwk<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>security<span class="token punctuation">.</span>SystemPermission<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> com<span class="token punctuation">.</span>kuili<span class="token punctuation">.</span>takephoto<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>PermissionBridge<span class="token punctuation">.</span>EVENT_PERMISSION_DENIED<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> com<span class="token punctuation">.</span>kuili<span class="token punctuation">.</span>takephoto<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>PermissionBridge<span class="token punctuation">.</span>EVENT_PERMISSION_GRANTED<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> ohos<span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>IBundleManager<span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAbility</span> <span class="token keyword">extends</span> <span class="token class-name">Ability</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> MainAbility<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PERMISSION_REQUEST_CODE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span>Intent intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setMainRoute</span><span class="token punctuation">(</span>MainAbilitySlice<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 动态申请系统权限</span>        <span class="token function">requestCameraPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">requestCameraPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 定义一个数组，存放需要动态申请的权限</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span><span class="token punctuation">;</span>        permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>WRITE_MEDIA<span class="token punctuation">)</span><span class="token punctuation">;</span>        permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>MEDIA_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断哪些权限之前已经申请过了，通过removeIf把已经申请过的权限从数组中去掉</span>        permissions<span class="token punctuation">.</span><span class="token function">removeIf</span><span class="token punctuation">(</span>                permission <span class="token operator">-</span><span class="token operator">></span>                        <span class="token function">verifySelfPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span> <span class="token operator">==</span> PERMISSION_GRANTED <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">canRequestPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 如果需要申请的权限不为空，则使用requestPermissionsFromUser进行动态申请，否则发送Granted事件，通知MainAbilitySlice初始化摄像头预览</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>permissions<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">requestPermissionsFromUser</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>permissions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PERMISSION_REQUEST_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            PermissionBridge<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span>EVENT_PERMISSION_GRANTED<span class="token punctuation">)</span><span class="token punctuation">;</span>            LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"未发现需要授权的权限"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsFromUserResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">!=</span> PERMISSION_REQUEST_CODE<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"未知的权限请求码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> grantResult <span class="token operator">:</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResult <span class="token operator">!=</span> PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>                PermissionBridge<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span>EVENT_PERMISSION_DENIED<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">terminateAbility</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> permissions<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"的权限请求被拒绝"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>grantResult<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"权限请求成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PermissionBridge<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span>EVENT_PERMISSION_GRANTED<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>应用启动时，以上的代码动态申请的效果如下图：</p><p><img src="https://i.loli.net/2021/07/16/VGnBFQEHiJ4MOLX.png" alt="image-20210716151135711"></p><h3 id="4-2-相机设备创建"><a href="#4-2-相机设备创建" class="headerlink" title="4.2 相机设备创建"></a>4.2 <strong>相机设备创建</strong></h3><h4 id="4-2-1-相机开发流程"><a href="#4-2-1-相机开发流程" class="headerlink" title="4.2.1 相机开发流程"></a>4.2.1 相机开发流程</h4><p>相机模块主要工作是给相机应用开发者提供基本的相机API接口，用于使用相机系统的功能，进行相机硬件的访问、操作和新功能开发。相机的开发流程如图所示：<br><img src="https://i.loli.net/2021/07/16/uHELj1fCBlhc24D.png" alt="相机开发流程"></p><h4 id="4-2-2-相机接口说明"><a href="#4-2-2-相机接口说明" class="headerlink" title="4.2.2 相机接口说明"></a>4.2.2 相机接口说明</h4><p>相机模块为相机应用开发者提供了3个包的内容，包括方法、枚举、以及常量/变量，方便开发者更容易地实现相机功能。详情请查阅对应开发场景。</p><table><thead><tr><th>包名</th><th>功能</th></tr></thead><tbody><tr><td>ohos.media.camera.CameraKit</td><td>相机功能入口类。获取当前支持的相机列表及其静态能力信息，创建相机对象。</td></tr><tr><td>ohos.media.camera.device</td><td>相机设备操作类。提供相机能力查询、相机配置、相机帧捕获、相机状态回调等功能。</td></tr><tr><td>ohos.media.camera.params</td><td>相机参数类。提供相机属性、参数和操作结果的定义。</td></tr></tbody></table><h4 id="4-2-3-相机创建流程"><a href="#4-2-3-相机创建流程" class="headerlink" title="4.2.3 相机创建流程"></a>4.2.3 相机创建流程</h4><p>在实现一个相机应用之前必须先创建一个独立的相机设备，然后才能继续相机的其他操作。相机设备创建的建议步骤如下：</p><ol><li><p>通过CameraKit.getInstance(Context context)方法获取唯一的CameraKit对象。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">openCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取CameraKit对象    </span>    CameraKit cameraKit <span class="token operator">=</span> CameraKit<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cameraKit <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 处理cameraKit获取失败的情况     </span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 如果此步骤操作失败，相机可能被占用或无法使用。如果被占用，必须等到相机释放后才能重新获取CameraKit对象。</p></li><li><p>通过getCameraIds()方法，获取当前使用的设备支持的逻辑相机列表。逻辑相机列表中存储了当前设备拥有的所有逻辑相机ID，如果列表不为空，则列表中的每个ID都支持独立创建相机对象；否则，说明正在使用的设备无可用的相机，不能继续后续的操作。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取当前设备的逻辑相机列表    </span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> cameraIds <span class="token operator">=</span> cameraKit<span class="token punctuation">.</span><span class="token function">getCameraIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cameraIds<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"cameraIds size is 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 处理异常</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 还可以继续查询指定相机ID的静态信息：</p><p> 调用getDeviceLinkType(String physicalId)方法获取物理相机连接方式；</p><p> 调用getCameraInfo(String cameraId)方法查询相机硬件朝向等信息；</p><p> 调用getCameraAbility(String cameraId)方法查询相机能力信息（比如支持的分辨率列表等）。</p><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>getDeviceLinkType(String physicalId)</td><td>获取物理相机连接方式。</td></tr><tr><td>getFacingType()</td><td>获取相机朝向信息。</td></tr><tr><td>getLogicalId()</td><td>获取逻辑相机ID。</td></tr><tr><td>getPhysicalIdList()</td><td>获取对应的物理相机ID列表。</td></tr></tbody></table><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>getSupportedSizes(int format)</td><td>根据格式查询输出图像的分辨率列表。</td></tr><tr><td>getSupportedSizes(Class<T> clazz)</td><td>根据Class类型查询分辨率列表。</td></tr><tr><td>getParameterRange(ParameterKey.Key<T> parameter)</td><td>获取指定参数能够设置的值范围。</td></tr><tr><td>getPropertyValue(PropertyKey.Key<T> property)</td><td>获取指定属性对应的值。</td></tr><tr><td>getSupportedAeMode()</td><td>获取当前相机支持的自动曝光模式。</td></tr><tr><td>getSupportedAfMode()</td><td>获取当前相机支持的自动对焦模式。</td></tr><tr><td>getSupportedFaceDetection()</td><td>获取相机支持的人脸检测类型范围。</td></tr><tr><td>getSupportedFlashMode()</td><td>当前相机支持的闪光灯取值范围。</td></tr><tr><td>getSupportedParameters()</td><td>当前相机支持的参数设置。</td></tr><tr><td>getSupportedProperties()</td><td>获取当前相机的属性列表。</td></tr><tr><td>getSupportedResults()</td><td>获取当前相机支持的参数设置可返回的结果列表。</td></tr><tr><td>getSupportedZoom()</td><td>获取相机支持的变焦范围。</td></tr></tbody></table></li><li><p>通过createCamera(String cameraId, CameraStateCallback callback, EventHandler handler)方法，创建相机对象，此步骤执行成功意味着相机系统的硬件已经完成了上电。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 创建相机设备</span>cameraKit<span class="token punctuation">.</span><span class="token function">createCamera</span><span class="token punctuation">(</span>cameraIds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraStateCallback<span class="token punctuation">,</span> eventHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> 第一个参数cameraId可以是上一步获取的逻辑相机列表中的任何一个相机ID。</p><p> 第二和第三个参数负责相机创建和相机运行时的数据和状态检测，请务必保证在整个相机运行周期内有效。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CameraStateCallbackImpl</span> <span class="token keyword">extends</span> <span class="token class-name">CameraStateCallback</span> <span class="token punctuation">{</span>      <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreated</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 创建相机设备    </span>    <span class="token punctuation">}</span>         <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConfigured</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 配置相机设备    </span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPartialConfigured</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token comment" spellcheck="true">// 当使用了addDeferredSurfaceSize配置了相机，会接到此回调    </span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReleased</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 释放相机设备    </span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 相机创建和相机运行时的回调</span>CameraStateCallbackImpl cameraStateCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CameraStateCallbackImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>eventhandler<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>eventhandler<span class="token punctuation">.</span>EventRunner<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 执行回调的</span>EventHandlerEventHandler eventHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventHandler</span><span class="token punctuation">(</span>EventRunner<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"CameraCb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>至此，相机设备的创建已经完成。相机设备创建成功会在CameraStateCallback中触发onCreated(Camera camera)回调。在进入相机设备配置前，请确保相机设备已经创建成功。否则会触发相机设备创建失败的回调，并返回错误码，需要进行错误处理后，重新执行相机设备的创建。</p><h3 id="4-3-相机设备配置"><a href="#4-3-相机设备配置" class="headerlink" title="4.3 相机设备配置"></a>4.3 <strong>相机设备配置</strong></h3><p>创建相机设备成功后，在CameraStateCallback中会触发onCreated(Camera camera)回调，并且带回Camera对象，用于执行相机设备的操作。</p><p>当一个新的相机设备成功创建后，首先需要对相机进行配置，调用configure(CameraConfig)方法实现配置。相机配置主要是设置预览、拍照、录像用到的Surface(详见ohos.agp.graphics.Surface)，没有配置过Surface，相应的功能不能使用。</p><p>为了进行相机帧捕获结果的数据和状态检测，还需要在相机配置时调用setFrameStateCallback(FrameStateCallback, EventHandler)方法设置帧回调。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    surfaceProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SurfaceProvider</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    DirectionalLayout<span class="token punctuation">.</span>LayoutConfig params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectionalLayout<span class="token punctuation">.</span>LayoutConfig</span><span class="token punctuation">(</span>             ComponentContainer<span class="token punctuation">.</span>LayoutConfig<span class="token punctuation">.</span>MATCH_PARENT<span class="token punctuation">,</span> ComponentContainer<span class="token punctuation">.</span>LayoutConfig<span class="token punctuation">.</span>MATCH_PARENT<span class="token punctuation">)</span><span class="token punctuation">;</span>    surfaceProvider<span class="token punctuation">.</span><span class="token function">setLayoutConfig</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>        surfaceProvider<span class="token punctuation">.</span><span class="token function">pinToZTop</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    surfaceProvider<span class="token punctuation">.</span><span class="token function">getSurfaceOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SurfaceCallBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>ComponentContainer<span class="token punctuation">)</span>         <span class="token function">findComponentById</span><span class="token punctuation">(</span>ResourceTable<span class="token punctuation">.</span>Id_surface_container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addComponent</span><span class="token punctuation">(</span>surfaceProvider<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> FrameStateCallback frameStateCallbackImpl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FrameStateCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFrameStarted</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> FrameConfig frameConfig<span class="token punctuation">,</span> <span class="token keyword">long</span> frameNumber<span class="token punctuation">,</span> <span class="token keyword">long</span> timestamp<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFrameProgressed</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> FrameConfig frameConfig<span class="token punctuation">,</span> FrameResult frameResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFrameFinished</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> FrameConfig frameConfig<span class="token punctuation">,</span> FrameResult frameResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFrameError</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> FrameConfig frameConfig<span class="token punctuation">,</span> <span class="token keyword">int</span> errorCode<span class="token punctuation">,</span> FrameResult frameResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCaptureTriggerStarted</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> <span class="token keyword">int</span> captureTriggerId<span class="token punctuation">,</span> <span class="token keyword">long</span> firstFrameNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCaptureTriggerFinished</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> <span class="token keyword">int</span> captureTriggerId<span class="token punctuation">,</span> <span class="token keyword">long</span> lastFrameNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCaptureTriggerInterrupted</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">,</span> <span class="token keyword">int</span> captureTriggerId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CameraStateCallbackImpl</span> <span class="token keyword">extends</span> <span class="token class-name">CameraStateCallback</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreated</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">)</span> <span class="token punctuation">{</span>        cameraDevice <span class="token operator">=</span> camera<span class="token punctuation">;</span>        previewSurface <span class="token operator">=</span> surfaceProvider<span class="token punctuation">.</span><span class="token function">getSurfaceOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cameraConfigBuilder <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">getCameraConfigBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cameraConfigBuilder <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"onCreated cameraConfigBuilder is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 配置预览的Surface</span>        cameraConfigBuilder<span class="token punctuation">.</span><span class="token function">addSurface</span><span class="token punctuation">(</span>previewSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 配置拍照的Surface</span>        cameraConfigBuilder<span class="token punctuation">.</span><span class="token function">addSurface</span><span class="token punctuation">(</span>imageReceiver<span class="token punctuation">.</span><span class="token function">getRecevingSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 配置帧结果的回调</span>        cameraConfigBuilder<span class="token punctuation">.</span><span class="token function">setFrameStateCallback</span><span class="token punctuation">(</span>frameStateCallbackImpl<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 相机设备配置</span>            camera<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>cameraConfigBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"Argument Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"State Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相机配置成功后，在CameraStateCallback中会触发onConfigured(Camera camera)回调，然后才可以执行相机帧捕获相关的操作。</p><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>addSurface(Surface surface)</td><td>相机配置中增加Surface。</td></tr><tr><td>build()</td><td>相机配置的构建类。</td></tr><tr><td>removeSurface(Surface surface)</td><td>移除先前添加的Surface。</td></tr><tr><td>setFrameStateCallback(FrameStateCallback callback, EventHandler handler)</td><td>设置用于相机帧结果返回的FrameStateCallback和Handler。</td></tr><tr><td>addDeferredSurfaceSize(Size surfaceSize, Class<T> clazz)</td><td>添加延迟Surface的尺寸、类型。</td></tr><tr><td>addDeferredSurface(Surface surface)</td><td>设置延迟的Surface，此Surface的尺寸和类型必须和使用addDeferredSurfaceSize配置的一致。</td></tr></tbody></table><h3 id="4-4-相机帧捕获"><a href="#4-4-相机帧捕获" class="headerlink" title="4.4 相机帧捕获"></a>4.4 <strong>相机帧捕获</strong></h3><p>Camera操作类，包括相机预览、录像、拍照等功能接口。</p><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>triggerSingleCapture(FrameConfig frameConfig)</td><td>启动相机帧的单帧捕获。</td></tr><tr><td>triggerMultiCapture(List<FrameConfig> frameConfigs)</td><td>启动相机帧的多帧捕获。</td></tr><tr><td>configure(CameraConfig config)</td><td>配置相机。</td></tr><tr><td>flushCaptures()</td><td>停止并清除相机帧的捕获，包括循环帧/单帧/多帧捕获。</td></tr><tr><td>getCameraConfigBuilder()</td><td>获取相机配置构造器对象。</td></tr><tr><td>getCameraId()</td><td>获取当前相机的ID。</td></tr><tr><td>getFrameConfigBuilder(int type)</td><td>获取指定类型的相机帧配置构造器对象。</td></tr><tr><td>release()</td><td>释放相机对象及资源。</td></tr><tr><td>triggerLoopingCapture(FrameConfig frameConfig)</td><td>启动或者更新相机帧的循环捕获。</td></tr><tr><td>stopLoopingCapture()</td><td>停止当前相机帧的循环捕获。</td></tr></tbody></table><p><strong>启动预览（循环帧捕获）</strong></p><p>用户一般都是先看见预览画面才执行拍照或者其他功能，所以对于一个普通的相机应用，预览是必不可少的。启动预览的建议步骤如下：</p><ol><li><p>通过getFrameConfigBuilder(FRAME_CONFIG_PREVIEW)方法获取预览配置模板，常用帧配置项见下表，更多的帧配置项以及详细使用方法请参考API接口说明的FrameConfig.Builder部分。</p><table><thead><tr><th>接口名</th><th>描述</th><th>是否必选</th></tr></thead><tbody><tr><td>addSurface(Surface surface)</td><td>配置预览surface和帧的绑定。</td><td>是</td></tr><tr><td>setAfMode(int afMode, Rect rect)</td><td>配置对焦模式。</td><td>否</td></tr><tr><td>setAeMode(int aeMode, Rect rect)</td><td>配置曝光模式。</td><td>否</td></tr><tr><td>setZoom(float value)</td><td>配置变焦值。</td><td>否</td></tr><tr><td>setFlashMode(int flashMode)</td><td>配置闪光灯模式。</td><td>否</td></tr><tr><td>setFaceDetection(int type, boolean isEnable)</td><td>配置人脸检测或者笑脸检测。</td><td>否</td></tr><tr><td>setParameter(Key<T> key, T value)</td><td>配置其他属性（如自拍镜像等）。</td><td>否</td></tr><tr><td>setMark(Object mark)</td><td>配置一个标签，后续可以从FrameConfig中通过Object getMark()拿到标签，判断两个是否相等，相等就说明是同一个配置。</td><td>否</td></tr><tr><td>setCoordinateSurface(Surface surface)</td><td>配置坐标系基准Surface，后续计算Ae/Af等区域都会基于此Surface为基本的中心坐标系，不设置默认使用添加的第一个Surface。</td><td>否</td></tr></tbody></table></li><li><p>通过triggerLoopingCapture(FrameConfig)方法实现循环帧捕获(如预览/录像)。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CameraStateCallbackImpl</span> <span class="token keyword">extends</span> <span class="token class-name">CameraStateCallback</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConfigured</span><span class="token punctuation">(</span>Camera camera<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取预览配置模板</span>        frameConfigBuilder <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">getFrameConfigBuilder</span><span class="token punctuation">(</span>FRAME_CONFIG_PREVIEW<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 配置预览Surface</span>        frameConfigBuilder<span class="token punctuation">.</span><span class="token function">addSurface</span><span class="token punctuation">(</span>previewSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>        previewFrameConfig <span class="token operator">=</span> frameConfigBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 启动循环帧捕获</span>            <span class="token keyword">int</span> triggerId <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">triggerLoopingCapture</span><span class="token punctuation">(</span>previewFrameConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"Argument Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"State Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 经过以上的操作，相机应用已经可以正常进行实时预览了。在预览状态下，开发者还可以执行其他操作，比如：</p><p> 当预览帧配置更改时，可以通过triggerLoopingCapture(FrameConfig)方法实现预览帧配置的更新；</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 预览帧变焦值变更</span>frameConfigBuilder<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span><span class="token number">1.2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 调用triggerLoopingCapture方法实现预览帧配置更新</span><span class="token function">triggerLoopingCapture</span><span class="token punctuation">(</span>frameConfigBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p> 通过stopLoopingCapture()方法停止循环帧捕获(停止预览)。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 停止预览帧捕获</span>camera<span class="token punctuation">.</span><span class="token function">stopLoopingCapture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><p><strong>实现拍照（单帧捕获）</strong></p><p>拍照功能属于相机应用的最重要功能之一，而且照片质量对用户至关重要。相机模块基于相机复杂的逻辑，从应用接口层到器件驱动层都已经默认的做好了最适合用户的配置，这些默认配置尽可能地保证用户拍出的每张照片的质量。发起拍照的建议步骤如下：</p><ol><li>通过getFrameConfigBuilder(FRAME_CONFIG_PICTURE)方法获取拍照配置模板，并且设置拍照帧配置，如下表：</li></ol><pre><code>| 接口名                                      | 描述                           | 是否必选 || ------------------------------------------- | ------------------------------ | -------- || FrameConfig.Builder addSurface(Surface)     | 实现拍照Surface和帧的绑定。    | 必选     || FrameConfig.Builder setImageRotation(int)   | 设置图片旋转角度。             | 可选     || FrameConfig.Builder setLocation(Location)   | 设置图片地理位置信息。         | 可选     || FrameConfig.Builder setParameter(Key&lt;T&gt;, T) | 配置其他属性（如自拍镜像等）。 | 可选     |</code></pre><ol start="2"><li><p>拍照前准备图像帧数据的接收实现。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 图像帧数据接收处理对象       </span><span class="token keyword">private</span> ImageReceiver imageReceiver<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 执行回调的EventHandler</span><span class="token keyword">private</span> EventHandler eventHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventHandler</span><span class="token punctuation">(</span>EventRunner<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"CameraCb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 拍照支持分辨率</span><span class="token keyword">private</span> Size pictureSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 单帧捕获生成图像回调Listener</span><span class="token keyword">private</span> <span class="token keyword">final</span> ImageReceiver<span class="token punctuation">.</span>IImageArrivalListener imageArrivalListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageReceiver<span class="token punctuation">.</span>IImageArrivalListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onImageArrival</span><span class="token punctuation">(</span>ImageReceiver imageReceiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>        StringBuffer fileName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token string">"picture_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         fileName<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 定义生成图片文件名</span>        File myFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dirFile<span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 创建图片文件</span>        imageSaver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageSaver</span><span class="token punctuation">(</span>imageReceiver<span class="token punctuation">.</span><span class="token function">readNextImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> myFile<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 创建一个读写线程任务用于保存图片</span>        eventHandler<span class="token punctuation">.</span><span class="token function">postTask</span><span class="token punctuation">(</span>imageSaver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 执行读写线程任务生成图片</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 保存图片, 图片数据读写，及图像生成见run方法</span><span class="token keyword">class</span> <span class="token class-name">ImageSaver</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> Image myImage<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> File myFile<span class="token punctuation">;</span>    <span class="token function">ImageSaver</span><span class="token punctuation">(</span>Image image<span class="token punctuation">,</span> File file<span class="token punctuation">)</span> <span class="token punctuation">{</span>        myImage <span class="token operator">=</span> image<span class="token punctuation">;</span>        myFile <span class="token operator">=</span> file<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Image<span class="token punctuation">.</span>Component component <span class="token operator">=</span> myImage<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>ComponentType<span class="token punctuation">.</span>JPEG<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>component<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        component<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        FileOutputStream output <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>myFile<span class="token punctuation">)</span><span class="token punctuation">;</span>            output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 写图像数据</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"save picture occur exception!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>output <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 关闭流</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"image release occur exception!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            myImage<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">takePictureInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Size<span class="token operator">></span> pictureSizes <span class="token operator">=</span> cameraAbility<span class="token punctuation">.</span><span class="token function">getSupportedSizes</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>JPEG<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取拍照支持分辨率列表</span>    pictureSize <span class="token operator">=</span> <span class="token function">getpictureSize</span><span class="token punctuation">(</span>pictureSizes<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 根据拍照要求选择合适的分辨率</span>    imageReceiver <span class="token operator">=</span> ImageReceiver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>pictureSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> pictureSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>        Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>pictureSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> pictureSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>JPEG<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 创建ImageReceiver对象，注意create函数中宽度要大于高度；5为最大支持的图像数，请根据实际设置。</span>    imageReceiver<span class="token punctuation">.</span><span class="token function">setImageArrivalListener</span><span class="token punctuation">(</span>imageArrivalListener<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>通过triggerSingleCapture(FrameConfig)方法实现单帧捕获(如拍照)。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">capture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取拍照配置模板</span>    framePictureConfigBuilder <span class="token operator">=</span> cameraDevice<span class="token punctuation">.</span><span class="token function">getFrameConfigBuilder</span><span class="token punctuation">(</span>FRAME_CONFIG_PICTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 配置拍照Surface</span>    framePictureConfigBuilder<span class="token punctuation">.</span><span class="token function">addSurface</span><span class="token punctuation">(</span>imageReceiver<span class="token punctuation">.</span><span class="token function">getRecevingSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 配置拍照其他参数</span>    framePictureConfigBuilder<span class="token punctuation">.</span><span class="token function">setImageRotation</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 启动单帧捕获(拍照)</span>        cameraDevice<span class="token punctuation">.</span><span class="token function">triggerSingleCapture</span><span class="token punctuation">(</span>framePictureConfigBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"Argument Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        HiLog<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>LABEL<span class="token punctuation">,</span> <span class="token string">"State Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 为了捕获到质量更高和效果更好的图片，还可以在帧结果中实时监测自动对焦和自动曝光的状态，一般而言，在自动对焦完成，自动曝光收敛后的瞬间是发起单帧捕获的最佳时机。</p></li></ol><p><strong>实现连拍（多帧捕获）</strong></p><p>连拍功能方便用户一次拍照获取多张照片，用于捕捉精彩瞬间。同普通拍照的实现流程一致，但连拍需要使用triggerMultiCapture(List<FrameConfig> frameConfigs)方法。</p><p><strong>相机设备释放</strong></p><p>使用完相机后，必须通过release()来关闭相机和释放资源，否则可能导致其他相机应用无法启动。一旦相机被释放，它所提供的操作就不能再被调用，否则会导致不可预期的结果，或是会引发状态异常。相机设备释放的代码如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">releaseCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>cameraDevice <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>         cameraDevice<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         cameraDevice <span class="token operator">=</span> null<span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>imageReceiver <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>         imageReceiver<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         imageReceiver <span class="token operator">=</span> null<span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>creamEventHandler <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>         creamEventHandler<span class="token punctuation">.</span><span class="token function">removeAllEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         creamEventHandler <span class="token operator">=</span> null<span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-5-保存到图库"><a href="#4-5-保存到图库" class="headerlink" title="4.5 保存到图库"></a>4.5 保存到图库</h3><h4 id="4-5-1-保存到相册需要用到的权限"><a href="#4-5-1-保存到相册需要用到的权限" class="headerlink" title="4.5.1 保存到相册需要用到的权限"></a>4.5.1 保存到相册需要用到的权限</h4><p>config.json权限配置如下：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token property">"reqPermissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token punctuation">{</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.READ_USER_STORAGE"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.WRITE_USER_STORAGE"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>同样，需要动态申请这两个权限</strong>：</p><pre class="line-numbers language-java"><code class="language-java">String<span class="token punctuation">[</span><span class="token punctuation">]</span> permissions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"ohos.permission.READ_USER_STORAGE"</span><span class="token punctuation">,</span> <span class="token string">"ohos.permission.WRITE_USER_STORAGE"</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">requestPermissionsFromUser</span><span class="token punctuation">(</span>permissions<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-5-2-保存到相册"><a href="#4-5-2-保存到相册" class="headerlink" title="4.5.2 保存到相册"></a>4.5.2 保存到相册</h4><p>获取到权限之后，就可以通过代码保存图片到系统相册了，<strong>我们媒体数据库的增删改查都需要用到DataAbilityHelper和AVStorage</strong>：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">,</span> PixelMap pixelMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        ValuesBucket valuesBucket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ValuesBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        valuesBucket<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>AVStorage<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>DISPLAY_NAME<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        valuesBucket<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"relative_path"</span><span class="token punctuation">,</span> <span class="token string">"DCIM/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        valuesBucket<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>AVStorage<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>MIME_TYPE<span class="token punctuation">,</span> <span class="token string">"image/JPEG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//应用独占</span>        valuesBucket<span class="token punctuation">.</span><span class="token function">putInteger</span><span class="token punctuation">(</span><span class="token string">"is_pending"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        DataAbilityHelper helper <span class="token operator">=</span> DataAbilityHelper<span class="token punctuation">.</span><span class="token function">creator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> id <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>AVStorage<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>EXTERNAL_DATA_ABILITY_URI<span class="token punctuation">,</span> valuesBucket<span class="token punctuation">)</span><span class="token punctuation">;</span>        Uri uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">appendEncodedPathToUri</span><span class="token punctuation">(</span>AVStorage<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>EXTERNAL_DATA_ABILITY_URI<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//这里需要"w"写权限</span>        FileDescriptor fd <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">openFile</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ImagePacker imagePacker <span class="token operator">=</span> ImagePacker<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ImagePacker<span class="token punctuation">.</span>PackingOptions packingOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImagePacker<span class="token punctuation">.</span>PackingOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        OutputStream outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        packingOptions<span class="token punctuation">.</span>format <span class="token operator">=</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">;</span>        packingOptions<span class="token punctuation">.</span>quality <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> result <span class="token operator">=</span> imagePacker<span class="token punctuation">.</span><span class="token function">initializePacking</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">,</span> packingOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>            result <span class="token operator">=</span> imagePacker<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>pixelMap<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">long</span> dataSize <span class="token operator">=</span> imagePacker<span class="token punctuation">.</span><span class="token function">finalizePacking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        valuesBucket<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//解除独占</span>        valuesBucket<span class="token punctuation">.</span><span class="token function">putInteger</span><span class="token punctuation">(</span><span class="token string">"is_pending"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        helper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> valuesBucket<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5-3-图片bytes转pixelMap"><a href="#4-5-3-图片bytes转pixelMap" class="headerlink" title="4.5.3 图片bytes转pixelMap"></a>4.5.3 图片bytes转pixelMap</h4><p>我们在拍照环节获得了Image的bytes数据，需要转化未pixelMap格式，并调用saveImage才能保存到相册，因此，通过以下的代码实现图片bytes转pixelMap</p><pre class="line-numbers language-java"><code class="language-java">ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>Component component <span class="token operator">=</span> myImage<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>ComponentType<span class="token punctuation">.</span>JPEG<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>component<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            component<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>            FileOutputStream output <span class="token operator">=</span> null<span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>myFile<span class="token punctuation">)</span><span class="token punctuation">;</span>                output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 写图像数据</span>                LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"写入文件成功:"</span> <span class="token operator">+</span> myFile<span class="token punctuation">)</span><span class="token punctuation">;</span>                ImageSource<span class="token punctuation">.</span>SourceOptions sourceOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageSource<span class="token punctuation">.</span>SourceOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 指定图片格式</span>                sourceOptions<span class="token punctuation">.</span>formatHint <span class="token operator">=</span> <span class="token string">"image/jpg"</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 创建图片源</span>                ImageSource imageSource <span class="token operator">=</span> ImageSource<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> sourceOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 创建图像解码选项</span>                ImageSource<span class="token punctuation">.</span>DecodingOptions decodingOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageSource<span class="token punctuation">.</span>DecodingOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                decodingOptions<span class="token punctuation">.</span>desiredPixelFormat <span class="token operator">=</span> PixelFormat<span class="token punctuation">.</span>ARGB_8888<span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 通过图片源创建PixelMap</span>                PixelMap pixelMap <span class="token operator">=</span> imageSource<span class="token punctuation">.</span><span class="token function">createPixelmap</span><span class="token punctuation">(</span>decodingOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> pixelMap<span class="token punctuation">)</span><span class="token punctuation">;</span>                ToastUtil<span class="token punctuation">.</span><span class="token function">showTip</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"照片保存成功，到图库中查看"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                imageSource<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>pixelMap <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    pixelMap<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"save picture occur exception!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>output <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 关闭流</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"image release occur exception!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                myImage<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-实现分布式拍照分享"><a href="#5-实现分布式拍照分享" class="headerlink" title="5. 实现分布式拍照分享"></a>5. 实现分布式拍照分享</h2><h3 id="5-1-效果展示与分析"><a href="#5-1-效果展示与分析" class="headerlink" title="5.1 效果展示与分析"></a>5.1 效果展示与分析</h3><p>本章节所实现的效果如下：</p><p>想直接体验这部分的功能，可以通过提供的资料的<strong>Src/TakePhotoV2.0.zip</strong>解压获得源码。</p><p><img src="https://i.loli.net/2021/07/17/C4DK1ASqPjU6Qgn.gif" alt="共享拍照"></p><p>分析：<strong>设备A</strong>拍摄的<strong>照片X</strong>要能在<strong>B设备</strong>上立即显示出来</p><p>1、<strong>设备A</strong>要能够把照片分享到<strong>B设备</strong>；</p><p>2、<strong>设备A</strong>要能在<strong>B设备</strong>收到<strong>照片X副本</strong>后，远程通知B设备显示<strong>照片X副本</strong>；</p><p><strong>重要（鸿蒙核心能力）</strong>：以上第一条使用到了鸿蒙系统的<strong>分布式文件系统服务</strong></p><p><strong>重要（鸿蒙核心能力）</strong>：以上第二条使用到了鸿蒙系统的<strong>分布式调度启动远程FA</strong></p><h3 id="5-2-分布式调度启动远程FA"><a href="#5-2-分布式调度启动远程FA" class="headerlink" title="5.2 分布式调度启动远程FA"></a>5.2 分布式调度启动远程FA</h3><h4 id="5-2-1-分布式调度介绍"><a href="#5-2-1-分布式调度介绍" class="headerlink" title="5.2.1 分布式调度介绍"></a>5.2.1 分布式调度介绍</h4><p>开发者在应用中集成分布式调度能力，通过调用指定能力的分布式接口，实现跨设备能力调度。根据Ability模板及意图的不同，分布式任务调度向开发者提供六种能力：启动远程FA（Feature Ability）、启动远程PA（Particle Ability）、关闭远程PA、连接远程PA、断开连接远程PA和FA跨设备迁移。<br>实现远程启动FA，需要至少两个设备处于同一个分布式网络中，可以通过如下操作实现：</p><ol><li>所有设备接入<strong>同一网络</strong>；</li><li>所有设备登录相同<strong>华为用户帐号</strong>；</li><li>使用基于EMUI11以上版本升级的鸿蒙2.0以上系统，并且最好保证<strong>鸿蒙子系统版本相同</strong>；</li></ol><h4 id="5-2-2-分布式调度权限申请"><a href="#5-2-2-分布式调度权限申请" class="headerlink" title="5.2.2 分布式调度权限申请"></a>5.2.2 分布式调度权限申请</h4><p>在entry\src\main\config.json中申请以下4个权限：</p><ol><li>ohos.permission.DISTRIBUTED_DEVICE_STATE_CHANGE：用于允许监听分布式组网内的设备状态变化。</li><li>ohos.permission.GET_DISTRIBUTED_DEVICE_INFO：用于允许获取分布式组网内的设备列表和设备信息。</li><li>ohos.permission.GET_BUNDLE_INFO：用于查询其他应用的信息。</li><li>ohos.permission.DISTRIBUTED_DATASYNC：用于允许不同设备间的数据交换。<br> 示例代码如下：</li></ol><pre class="line-numbers language-json"><code class="language-json">module"<span class="token operator">:</span> <span class="token punctuation">{</span> ......    <span class="token property">"reqPermissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>     <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.DISTRIBUTED_DEVICE_STATE_CHANGE"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.GET_DISTRIBUTED_DEVICE_INFO"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.GET_BUNDLE_INFO"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ohos.permission.DISTRIBUTED_DATASYNC"</span>      <span class="token punctuation">}</span>   <span class="token punctuation">]</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此外，还需要在实现Ability的代码中显式声明需要使用多设备协同访问的权限，示例代码如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAbility</span> <span class="token keyword">extends</span> <span class="token class-name">Ability</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span>Intent intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token function">requestPermissionsFromUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">"ohos.permission.DISTRIBUTED_DATASYNC"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-2-3-分布式调度实现"><a href="#5-2-3-分布式调度实现" class="headerlink" title="5.2.3 分布式调度实现"></a>5.2.3 分布式调度实现</h4><p>在MainAbilitySlice.java中开发一个按钮，在onStart方法中增加Button相关代码如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUIContent</span><span class="token punctuation">(</span>ResourceTable<span class="token punctuation">.</span>Layout_ability_main<span class="token punctuation">)</span><span class="token punctuation">;</span>Button btn <span class="token operator">=</span> <span class="token punctuation">(</span>Button<span class="token punctuation">)</span> <span class="token function">findComponentById</span><span class="token punctuation">(</span>ResourceTable<span class="token punctuation">.</span>Id_button<span class="token punctuation">)</span><span class="token punctuation">;</span>btn<span class="token punctuation">.</span><span class="token function">setClickedListener</span><span class="token punctuation">(</span>component <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 启动远程FA</span>    RemoteFA<span class="token punctuation">.</span><span class="token function">startRemoteFA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getBundleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MainAbility<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在Layout_alibility_main中以上用到的按钮，注意按钮的id必须是button，这样就可以通过Id_button匹配到。</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DirectionalLayout</span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>ohos</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.huawei.com/res/ohos<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>alignment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">ohos:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">ohos:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$+id:button<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>background_element</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$graphic:background_ability_main<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>layout_alignment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>horizontal_center<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>启动远程FA<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">ohos:</span>text_size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>40vp<span class="token punctuation">"</span></span>        <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DirectionalLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在Utils目录下创建RemoteFA.java文件，内容如下：</p><p>实现远程启动FA的流程查看startRemoteFA方法的注释和实现部分即可。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>aafwk<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>aafwk<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Operation<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Context<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>AbilityInfo<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>distributedschedule<span class="token punctuation">.</span>interwork<span class="token punctuation">.</span>DeviceInfo<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>distributedschedule<span class="token punctuation">.</span>interwork<span class="token punctuation">.</span>DeviceManager<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>RemoteException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Iterator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RemoteFA</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> <span class="token string">"RemoteFA"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">RemoteFA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 启动一个程序内部的FA Page     * @param context       AbilitySlice Context句柄     * @param bundleName    应用的包名     * @param abilityName   Ability的名称     * @param params        intent传递参数     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startLocalFA</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String bundleName<span class="token punctuation">,</span> String abilityName<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Intent intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>params <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>params<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">>></span> iterator <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> entry <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                intent<span class="token punctuation">.</span><span class="token function">setParam</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        Operation operation <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">Intent<span class="token punctuation">.</span>OperationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">withBundleName</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">withAbilityName</span><span class="token punctuation">(</span>abilityName<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        intent<span class="token punctuation">.</span><span class="token function">setOperation</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 启动一个远程的FA Page     * @param context       AbilitySlice Context句柄     * @param bundleName    应用的包名     * @param abilityName   Ability的名称     * @param params        intent传递参数     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startRemoteFA</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String bundleName<span class="token punctuation">,</span> String abilityName<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//处理按钮响应，获取在线设备列表</span>        List<span class="token operator">&lt;</span>DeviceInfo<span class="token operator">></span> deviceInfoList <span class="token operator">=</span>                DeviceManager<span class="token punctuation">.</span><span class="token function">getDeviceList</span><span class="token punctuation">(</span>DeviceInfo<span class="token punctuation">.</span>FLAG_GET_ONLINE_DEVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>DeviceInfo deviceInfo <span class="token operator">:</span> deviceInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 远程启动FA</span>            Intent remoteIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>params <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>params<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">>></span> iterator <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> entry <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    remoteIntent<span class="token punctuation">.</span><span class="token function">setParam</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// 指定待启动FA的bundleName和abilityName</span>            <span class="token comment" spellcheck="true">// 例如：BUNDLE_NAME = "com.kuili.remotefa"</span>            <span class="token comment" spellcheck="true">//       ABILITY_NAME = "com.kuili.remotefa.MainAbility"</span>            <span class="token comment" spellcheck="true">// 设置分布式标记，表明当前涉及分布式能力</span>            Operation operation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent<span class="token punctuation">.</span>OperationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDeviceId</span><span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span><span class="token function">getDeviceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withBundleName</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withAbilityName</span><span class="token punctuation">(</span>abilityName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withFlags</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>FLAG_ABILITYSLICE_MULTI_DEVICE<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            remoteIntent<span class="token punctuation">.</span><span class="token function">setOperation</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 目标设备是否包含指定FA</span>                List<span class="token operator">&lt;</span>AbilityInfo<span class="token operator">></span> abilityInfoList <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBundleManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryAbilityByIntent</span><span class="token punctuation">(</span>remoteIntent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>abilityInfoList <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>abilityInfoList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>remoteIntent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 处理异常</span>                LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>完成以上步骤后，实现的效果如下：</p><p><img src="https://i.loli.net/2021/07/17/34wSNqiEyXkHAh5.gif" alt="RemoteFA效果图"></p><p>如果以上的代码有问题，请参考提供的资料代码，在Src/RemoteFA.zip，解压之后导入到自己的工程中使用模拟器运行。<strong>注意：使用真机运行由于需要账号并注册应用，应用包名不能重复的原因，需要把整个包名替换成唯一的才可以，不熟悉的情况下大概率调试会失败。</strong></p><p>模拟器开发分布式应用，需要启动两台模拟器设备，可以通过DevEco-&gt;Tools-&gt;Device Manager-&gt;Remote Emulator-&gt;Super device打开两个模拟器来调试，效果如下：</p><p><img src="https://i.loli.net/2021/07/15/wWx1HPjJMugmK6z.gif" alt="StartRemoteFADemo"></p><h3 id="5-3-分布式文件服务完成文件共享展示"><a href="#5-3-分布式文件服务完成文件共享展示" class="headerlink" title="5.3 分布式文件服务完成文件共享展示"></a>5.3 分布式文件服务完成文件共享展示</h3><h4 id="5-3-1-分布式文件服务概念"><a href="#5-3-1-分布式文件服务概念" class="headerlink" title="5.3.1 分布式文件服务概念"></a>5.3.1 分布式文件服务概念</h4><p>鸿蒙的<strong>分布式文件服务</strong>能可以提供多设备之间的文件共享，使得应用程序无感访问这些共享文件，就像在本地访问一样，只要在同一网络下。怎么做到的呢？</p><p><strong>分布式文件服务</strong>采用无中心节点的设计，每个设备都存储一份全量的文件<strong>元数据</strong>和本设备上产生的<strong>分布式文件</strong>，元数据在多台设备间互相同步，当应用需要访问分布式文件时，分布式文件服务首先查询本设备上的文件元数据，获取文件所在的存储设备，然后对存储设备上的分布式文件服务发起文件访问请求，将文件内容读取到本地。分布式文件服务运作示意图如下所示：<br><img src="https://developer.huawei.com/consumer/cn/codelab/HarmonyOS-DistributedCamera/img/dda695059909c314.png" alt="img"></p><h4 id="5-3-2-分布式文件服务开发流程"><a href="#5-3-2-分布式文件服务开发流程" class="headerlink" title="5.3.2 分布式文件服务开发流程"></a><strong>5.3.2 分布式文件服务开发流程</strong></h4><p>应用可以通过Context.getDistributedDir()接口获取属于自己的分布式目录，然后通过libc或JDK接口，在该目录下创建、删除、读写文件或目录。</p><ol><li><p>设备1上的应用A创建文件hello.txt，并写入内容”Hello World”。</p><pre class="line-numbers language-java"><code class="language-java">Context context<span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">// context初始化File </span>distDir <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getDistributedDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String filePath <span class="token operator">=</span> distDir <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">"hello.txt"</span><span class="token punctuation">;</span>FileWriter fileWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fileWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fileWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>设备2上的应用A通过Context.getDistributedDir()接口获取分布式目录。</p></li><li><p>设备2上的应用A读取文件 hello.txt。</p><pre class="line-numbers language-java"><code class="language-java">FileReader fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">char</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>fileReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>fileReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="5-4-分布式拍照界面功能实现"><a href="#5-4-分布式拍照界面功能实现" class="headerlink" title="5.4 分布式拍照界面功能实现"></a>5.4 分布式拍照界面功能实现</h3><p>实现本章节的内容，需要基于上一章节的基础上，结合本章节加上<strong>分布式调度启动远程FA</strong>和<strong>分布式文件服务</strong>即可完成，代码如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 把拍摄的照片放到分布式文件服务目录下</span>String pathName <span class="token operator">=</span> DistributeFileUtil<span class="token punctuation">.</span><span class="token function">copyPicToDistributedDir</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> targetFile<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 启动远程和本地的FA，展示拍照结果页面</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pathName<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"filePath"</span><span class="token punctuation">,</span> pathName<span class="token punctuation">)</span><span class="token punctuation">;</span>    RemoteFA<span class="token punctuation">.</span><span class="token function">startRemoteFA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getBundleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ImageAbility<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>    RemoteFA<span class="token punctuation">.</span><span class="token function">startLocalFA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getBundleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ImageAbility<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>DistributeFileUtil.java的实现如下，DistributeFileUtil.copyPicToDistributedDir负责把本地打开的文件targetFile，名称为fileName的文件拷贝到分布式目录下</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Context<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>ImageSource<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>PixelMap<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>SourceDataMalformedException<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>common<span class="token punctuation">.</span>PixelFormat<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>common<span class="token punctuation">.</span>Rect<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>media<span class="token punctuation">.</span>image<span class="token punctuation">.</span>common<span class="token punctuation">.</span>Size<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * DistributeFileUtil * */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DistributeFileUtil</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> DistributeFileUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> CACHE_SIZE <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> IO_END_LEN <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEGREES_90 <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> File <span class="token function">getDisFile</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        File distributedDir <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getDistributedDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        File distributedFile<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>distributedDir <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"分布式文件服务异常，目录为空！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            distributedFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>distributedDir<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> distributedFile<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Copying Images to the Distributed File Service Address     *     * @param context context     * @param sourceFile file     * @param fileName filename     * @return canonical pathname     * @throws IOException Signals that an I/O exception of some sort has occurred     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">copyPicToDistributedDir</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> File sourceFile<span class="token punctuation">,</span> String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String canonicalPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        InputStream in <span class="token operator">=</span> null<span class="token punctuation">;</span>        OutputStream out <span class="token operator">=</span> null<span class="token punctuation">;</span>        File disPath <span class="token operator">=</span> <span class="token function">getDisFile</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>disPath <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"获取分布式目录文件失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> canonicalPath<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>sourceFile<span class="token punctuation">)</span><span class="token punctuation">;</span>            out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>disPath<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>CACHE_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> len<span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> IO_END_LEN<span class="token punctuation">)</span> <span class="token punctuation">{</span>                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// 获取经典的分布式服务路径名</span>            canonicalPath <span class="token operator">=</span> disPath<span class="token punctuation">.</span><span class="token function">getCanonicalPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"分布式文件服务异常，拷贝异常！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"IO关闭异常！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"IO关闭异常！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> canonicalPath<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Reads the distributed file service address image.     *     * @param context context     * @param filePath filePath     * @return Provides images in forms of pixel matrices     * @throws SourceDataMalformedException Provides the exception for unsupported image format     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> PixelMap <span class="token function">readToDistributedDir</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>        File disPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>disPath <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            ImageSource<span class="token punctuation">.</span>SourceOptions srcOpts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageSource<span class="token punctuation">.</span>SourceOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ImageSource imageSource <span class="token operator">=</span> ImageSource<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>disPath<span class="token punctuation">,</span> srcOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>imageSource <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"imageSource != null ok ok ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ImageSource<span class="token punctuation">.</span>DecodingOptions decodingOpts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageSource<span class="token punctuation">.</span>DecodingOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                decodingOpts<span class="token punctuation">.</span>desiredSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                decodingOpts<span class="token punctuation">.</span>desiredRegion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                decodingOpts<span class="token punctuation">.</span>desiredPixelFormat <span class="token operator">=</span> PixelFormat<span class="token punctuation">.</span>ARGB_8888<span class="token punctuation">;</span>                decodingOpts<span class="token punctuation">.</span>rotateDegrees <span class="token operator">=</span> DEGREES_90<span class="token punctuation">;</span>                <span class="token keyword">return</span> imageSource<span class="token punctuation">.</span><span class="token function">createPixelmap</span><span class="token punctuation">(</span>decodingOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"imageSource == null error error error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SourceDataMalformedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"readToDistributedDir SourceDataMalformedException "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Deleting a Distributed File Service Address     *     * @param context context     * @param fileName fileName     */</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">deleteDistributedDir</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        File disPath <span class="token operator">=</span> <span class="token function">getDisFile</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>disPath <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> disPath<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> disPath<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">boolean</span> result <span class="token operator">=</span> disPath<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"delete :"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>result <span class="token operator">?</span> <span class="token string">"success"</span> <span class="token operator">:</span> <span class="token string">"fail"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"No pictures exists in the distributedDir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>RemoteFA.java实现如下，startRemoteFA方法负责拉起其他设备上的FA，参数bundleName是应用包名，通过config.json中可查看，abilityName是你要启动的FA名称。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>aafwk<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Intent<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>aafwk<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Operation<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Context<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>AbilityInfo<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>distributedschedule<span class="token punctuation">.</span>interwork<span class="token punctuation">.</span>DeviceInfo<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>distributedschedule<span class="token punctuation">.</span>interwork<span class="token punctuation">.</span>DeviceManager<span class="token punctuation">;</span><span class="token keyword">import</span> ohos<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>RemoteException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Iterator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RemoteFA</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> <span class="token string">"RemoteFA"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">RemoteFA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startLocalFA</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String bundleName<span class="token punctuation">,</span> String abilityName<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Intent intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>params <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>params<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">>></span> iterator <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> entry <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                intent<span class="token punctuation">.</span><span class="token function">setParam</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        Operation operation <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">Intent<span class="token punctuation">.</span>OperationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">withBundleName</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">withAbilityName</span><span class="token punctuation">(</span>abilityName<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        intent<span class="token punctuation">.</span><span class="token function">setOperation</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startRemoteFA</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> String bundleName<span class="token punctuation">,</span> String abilityName<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//处理按钮响应，获取在线设备列表</span>        List<span class="token operator">&lt;</span>DeviceInfo<span class="token operator">></span> deviceInfoList <span class="token operator">=</span>                DeviceManager<span class="token punctuation">.</span><span class="token function">getDeviceList</span><span class="token punctuation">(</span>DeviceInfo<span class="token punctuation">.</span>FLAG_GET_ONLINE_DEVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>DeviceInfo deviceInfo <span class="token operator">:</span> deviceInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 远程启动FA</span>            Intent remoteIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>params <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>params<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">>></span> iterator <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> entry <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    remoteIntent<span class="token punctuation">.</span><span class="token function">setParam</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// 指定待启动FA的bundleName和abilityName</span>            <span class="token comment" spellcheck="true">// 例如：BUNDLE_NAME = "com.kuili.remotefa"</span>            <span class="token comment" spellcheck="true">//       ABILITY_NAME = "com.kuili.remotefa.MainAbility"</span>            <span class="token comment" spellcheck="true">// 设置分布式标记，表明当前涉及分布式能力</span>            Operation operation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent<span class="token punctuation">.</span>OperationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDeviceId</span><span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span><span class="token function">getDeviceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withBundleName</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withAbilityName</span><span class="token punctuation">(</span>abilityName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withFlags</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>FLAG_ABILITYSLICE_MULTI_DEVICE<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            remoteIntent<span class="token punctuation">.</span><span class="token function">setOperation</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 目标设备是否包含指定FA</span>                List<span class="token operator">&lt;</span>AbilityInfo<span class="token operator">></span> abilityInfoList <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBundleManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryAbilityByIntent</span><span class="token punctuation">(</span>remoteIntent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>abilityInfoList <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>abilityInfoList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>remoteIntent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 处理异常</span>                LogUtil<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-实现语音拍照"><a href="#6-实现语音拍照" class="headerlink" title="6. 实现语音拍照"></a>6. 实现语音拍照</h2><h3 id="6-1-语音拍照概述"><a href="#6-1-语音拍照概述" class="headerlink" title="6.1 语音拍照概述"></a>6.1 语音拍照概述</h3><p>语音识别功能可以将语音文件、实时语音数据流转换为汉字序列。本相机语音识别的关键词为”拍照”、”茄子”，当有人说出这两个词的时候，相机就会调用拍照的功能，拍摄一张照片。</p><p>也称为自动语音识别（Automatic Speech Recognition, ASR），可以基于机器识别和理解，将语音信号转变为文本或命令。本例中初始化ASR服务的代码如下所示：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> COMMAND_STRING <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token punctuation">{</span>    COMMAND_STRING<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"拍照"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    COMMAND_STRING<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"茄子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>AsrClient<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> result <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>    LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 查找识别结果result字符串中是否包含识别关键字COMMAND_STRING</span>    <span class="token keyword">boolean</span> command <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> COMMAND_STRING<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>COMMAND_STRING<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            command <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 匹配到COMMAND_STRING中的关键字，开始执行拍照功能</span>        <span class="token function">takePicture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-语音拍照用例需求"><a href="#6-2-语音拍照用例需求" class="headerlink" title="6.2 语音拍照用例需求"></a>6.2 语音拍照用例需求</h3><p>1、用户通过以下<strong>说话</strong>模块，把人说的话录制下来，并且需要的是<strong>实时的录音数据</strong>；</p><p>2、<strong>语音识别</strong>模块，需要把<strong>实时的录音数据</strong>转化为<strong>文本</strong>；</p><p>3、<strong>文本</strong>通过<strong>识别结果匹配</strong>模块，识别是否获得了相同的识别结果关键字；</p><p>4、<strong>识别结果匹配</strong>成功，执行<strong>拍照</strong>模块，进行<strong>拍照</strong>；</p><p>5、<strong>拍照</strong>成功之后，拉起远程手机的FA界面，进行语音拍照的<strong>分布式分享</strong>；</p><p><img src="https://i.loli.net/2021/07/20/MUwHGJci6Fs1u2m.png" alt="image-20210720145321220"></p><h3 id="6-3-功能模块实现设计"><a href="#6-3-功能模块实现设计" class="headerlink" title="6.3 功能模块实现设计"></a>6.3 功能模块实现设计</h3><h4 id="6-3-1-说话模块"><a href="#6-3-1-说话模块" class="headerlink" title="6.3.1 说话模块"></a>6.3.1 说话模块</h4><p>实现手机录音的功能模块<code>AudioRecorder</code>，可以提供实时的录音功能，提供接口说明如下</p><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>void initRecord()</td><td>初始化录音模块，录音格式为16000 signed16bit MONO PCM数据</td></tr><tr><td>startRecord()</td><td>启动录音设备，开始接受用户的声音</td></tr><tr><td>stopRecord()</td><td>关闭录音设备，不再接受用户的声音</td></tr><tr><td>int read(byte[] buffer)</td><td>主动获取录音数据，buffer为保存到的数据，返回获取到的录音数据量</td></tr></tbody></table><p>代码执行的大概流程如下,初始化录音，开始录音，读取录音数据，最后关闭录音：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token function">initRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>stopRecord<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="6-3-2-语音识别模块"><a href="#6-3-2-语音识别模块" class="headerlink" title="6.3.2 语音识别模块"></a>6.3.2 语音识别模块</h4><p>语音识别模块<code>AsrClient</code>使用到了讯飞的<strong>实时语音转写</strong>，提供了语音的连续语音转文本的能力，提供接口说明如下</p><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>void start(Context context, AsrClientCallback callback)</td><td>开始识别，context是Ability的句柄，当有识别结果时，会通过callback获取到识别文本内容</td></tr><tr><td>void stop()</td><td>结束识别</td></tr></tbody></table><p>实现这个功能，需要登录讯飞开放平台，做以下操作：</p><ul><li>注册开发者账号：<a href="https://www.xfyun.cn/%EF%BC%9B" rel="external nofollow noreferrer">https://www.xfyun.cn/；</a></li><li>注册开发者应用程序，进入<a href="https://console.xfyun.cn/app/myapp%EF%BC%8C%E5%88%9B%E5%BB%BA%E6%96%B0%E5%BA%94%E7%94%A8%EF%BC%9B" rel="external nofollow noreferrer">https://console.xfyun.cn/app/myapp，创建新应用；</a></li><li>进行开发者实名认证；<a href="https://console.xfyun.cn/user/authentication%EF%BC%8C%E9%9C%80%E8%A6%81%E4%B8%8A%E4%BC%A0%E8%BA%AB%E4%BB%BD%E8%AF%81%EF%BC%8C%E6%88%90%E5%8A%9F%E5%90%8E%E4%B8%80%E8%88%AC%E7%AB%8B%E5%8D%B3%E5%BC%80%E9%80%9A%EF%BC%9B" rel="external nofollow noreferrer">https://console.xfyun.cn/user/authentication，需要上传身份证，成功后一般立即开通；</a></li><li>领取5小时的个人<strong>实时语音转写</strong>包，<a href="https://www.xfyun.cn/free%E6%89%BE%E5%88%B0%E5%AE%9E%E6%97%B6%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99%E9%A2%86%E5%8F%96%EF%BC%9B" rel="external nofollow noreferrer">https://www.xfyun.cn/free找到实时语音转写领取；</a></li><li>获取appid和apikey填写到代码中，替换RTASRClient.java中APPID和SECRET_KEY的值；登录成功后进入<a href="https://console.xfyun.cn/services/iat%EF%BC%8C%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E6%A0%8F%E9%80%89%E6%8B%A9%E5%AE%9E%E6%97%B6%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99%E6%9F%A5%E7%9C%8B%E5%89%A9%E4%BD%99%E8%BD%AC%E5%86%99%E6%97%B6%E9%95%BF%EF%BC%8C%E5%B9%B6%E6%8A%8AAPPID%E5%92%8CAPIKey%E8%8E%B7%E5%8F%96%E5%88%B0%E5%90%8E%E5%A1%AB%E5%86%99%E5%88%B0%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%9B" rel="external nofollow noreferrer">https://console.xfyun.cn/services/iat，左侧菜单栏选择实时语音转写查看剩余转写时长，并把APPID和APIKey获取到后填写到代码中；</a></li></ul><h4 id="6-3-3-识别结果匹配"><a href="#6-3-3-识别结果匹配" class="headerlink" title="6.3.3 识别结果匹配"></a>6.3.3 识别结果匹配</h4><p>识别结果采取关键字匹配的方式，这里不过多说明。</p><h4 id="6-3-4-拍照功能"><a href="#6-3-4-拍照功能" class="headerlink" title="6.3.4 拍照功能"></a>6.3.4 拍照功能</h4><p>拍照功能复用第4章节的<strong>相机拍照</strong>功能。</p><h4 id="6-3-5-分布式分享"><a href="#6-3-5-分布式分享" class="headerlink" title="6.3.5 分布式分享"></a>6.3.5 分布式分享</h4><p>分布式分享复用第5章节的<strong>分布式拍照分享</strong>的功能。</p><h3 id="6-4-功能模块实现流程"><a href="#6-4-功能模块实现流程" class="headerlink" title="6.4 功能模块实现流程"></a>6.4 功能模块实现流程</h3><p>语音识别拍照功能的整体正常流程图如下</p><p><img src="https://i.loli.net/2021/07/20/HNp7gevQ62rGydS.png" alt="语音识别拍照的正常流程"></p><p><strong>需要的静态权限如下</strong></p><table><thead><tr><th>接口名</th><th>描述</th></tr></thead><tbody><tr><td>ohos.permission.CAMERA</td><td>允许应用程序使用相机</td></tr><tr><td>ohos.permission.WRITE_USER_STORAGE</td><td>允许应用程序创建或删除文件，或将数据写入设备存储中的文件</td></tr><tr><td>ohos.permission.READ_USER_STORAGE</td><td>允许应用程序从设备的存储中读取文件</td></tr><tr><td>ohos.permission.DISTRIBUTED_DATASYNC</td><td>允许应用程序与其他设备交换用户数据（例如图像、音乐、视频和应用程序数据）</td></tr><tr><td>ohos.permission.DISTRIBUTED_DEVICE_STATE_CHANGE</td><td>分布式网络上的设备状态更改时通知应用程序的功能需要这个权限</td></tr><tr><td>ohos.permission.GET_DISTRIBUTED_DEVICE_INFO</td><td>获取分布式网络上所有远程设备的信息</td></tr><tr><td>ohos.permission.GET_BUNDLE_INFO</td><td>允许非系统应用程序查询其他应用程序的信息</td></tr><tr><td>ohos.permission.MICROPHONE</td><td>允许应用程序访问麦克风</td></tr><tr><td>ohos.permission.INTERNET</td><td>允许应用程序访问网络</td></tr><tr><td>ohos.permission.GET_NETWORK_INFO</td><td>允许应用程序获取网络信息</td></tr><tr><td>ohos.permission.SET_NETWORK_INFO</td><td>允许应用程序设置网络信息</td></tr><tr><td>ohos.permission.SET_WIFI_INFO</td><td>允许应用程序在设备上设置 Wi-Fi 信息</td></tr></tbody></table><p><strong>需要动态申请的权限如下</strong></p><pre class="line-numbers language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span><span class="token punctuation">;</span>permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>WRITE_USER_STORAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>READ_USER_STORAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>DISTRIBUTED_DATASYNC<span class="token punctuation">)</span><span class="token punctuation">;</span>permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>MICROPHONE<span class="token punctuation">)</span><span class="token punctuation">;</span>permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>SystemPermission<span class="token punctuation">.</span>INTERNET<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>涉及到的类如下</strong></p><table><thead><tr><th>类名</th><th>描述</th></tr></thead><tbody><tr><td>AsrClient.java</td><td>提供语音识别总开关，一条语句实现语音识别</td></tr><tr><td>AudioRecorder.java</td><td>提供录音功能，负责设备的录音功能</td></tr><tr><td>RTASRClient.java</td><td>提供讯飞语音识别能力，一个方法即可启动语音识别</td></tr><tr><td>PermissionBridge.java</td><td>权限请求管理类，负责权限请求管理</td></tr><tr><td>RemoteFA.java</td><td>分布式远程拉起FA类，实现分布式调度</td></tr><tr><td>DistributeFileUtil.java</td><td>分布式文件服务类，实现各手机间的文件共享</td></tr><tr><td>GalleryUtil.java</td><td>相册保存到图库类</td></tr><tr><td>CameraUtil.java</td><td>处理Camera保存成图片的工具类</td></tr><tr><td>LogUtil.java</td><td>提供统一的日志输出类</td></tr><tr><td>ToastUtil.java</td><td>提供统一的Dialog提醒通知类</td></tr><tr><td>EncryptUtil.java</td><td>提供语音识别过程中的加解密、编解码实现</td></tr><tr><td>DraftWithOrigin.java</td><td>使用Java Websocket库需要的Draft协议实现类</td></tr><tr><td>MainAbility.java</td><td>拍照界面FA</td></tr><tr><td>MainAbilitySlice.java</td><td>拍照界面Page Sclie</td></tr><tr><td>ImageAbility.java</td><td>分享界面FA</td></tr><tr><td>ImageAbilitySlice.java</td><td>分享界面Page Sclie</td></tr></tbody></table><p><strong>涉及到的lib库如下</strong></p><table><thead><tr><th>库名</th><th>描述</th></tr></thead><tbody><tr><td>commons-codec-1.9.jar</td><td>通用编解码库，提供Base64、Sha、MD5等加解密功能</td></tr><tr><td>fastjson-1.2.21.jar</td><td>提供Json数据格式的序列化和反序列化功能</td></tr><tr><td>Java-WebSocket-1.3.4.jar</td><td>提供WebSocket的功能</td></tr></tbody></table><p>以上的库放到entry/libs目录下，项目中的build.gradle文件中也自动包含了</p><pre class="line-numbers language-json"><code class="language-json">dependencies <span class="token punctuation">{</span>    implementation fileTree(dir<span class="token operator">:</span> 'libs'<span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span>'*.jar'<span class="token punctuation">,</span> '*.har'<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="6-5-语音拍照功能实现"><a href="#6-5-语音拍照功能实现" class="headerlink" title="6.5 语音拍照功能实现"></a>6.5 语音拍照功能实现</h4><p>由于涉及到的文件内容过多，现把实现的流程涉及到的文件、代码、描述说清楚，再结合Video中本章节的微视频可以基本掌握，如果需要完全掌握，需要对代码进行走读和理解。</p><p>关键代码路径如下：</p><table><thead><tr><th>文件名</th><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>MainAbility.java</td><td>requestCameraPermission()</td><td>申请录音、分布式、网络、读写文件的权限</td></tr><tr><td>MainAbilitySlice.java</td><td>onPermissionGranted()<br />     -&gt;initSurface()：初始化拍照预览窗口；<br />     -&gt;initControlComponents()：初始化拍照按钮事件；<br />     -&gt;initAsrClient()：初始化语音识别引擎；</td><td>当监听到所有权限都成功后</td></tr><tr><td>MainAbilitySlice.java</td><td>openCamera()<br />    -&gt;setImageArrivalListener(this::saveImage)</td><td>打开摄像头,并绑定数据到达时执行saveImage保存图片</td></tr><tr><td>当按下拍照按钮的流程：</td><td></td><td></td></tr><tr><td>MainAbilitySlice.java</td><td>takePictureBtn.setClickedListener(this::takePicture)</td><td>按钮按下，会执行takePicture()拍照方法</td></tr><tr><td>MainAbilitySlice.java</td><td>cameraDevice.triggerSingleCapture(pictureFrameConfig)</td><td>开始单帧捕获，在此前需要有连续帧捕获，并且配置中有surface界面用于显示</td></tr><tr><td>MainAbilitySlice.java</td><td>this::saveImage()</td><td>保存图片</td></tr><tr><td>MainAbilitySlice.java</td><td>DistributeFileUtil.copyPicToDistributedDir()</td><td>把图片放到分布式服务中</td></tr><tr><td>MainAbilitySlice.java</td><td>RemoteFA.startRemoteFA(this,ImageAbility.class.getName())</td><td>启动远程ImageAbility的FA界面</td></tr></tbody></table><p>语音识别的流程和以上类似，通过MainAblilitySlice.java中的以下代码实现：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initAsrClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    AsrClient<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> result <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>        LogUtil<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 查找识别结果result字符串中是否包含识别关键字COMMAND_STRING</span>        <span class="token keyword">boolean</span> command <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> COMMAND_STRING<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>COMMAND_STRING<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                command <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 匹配到COMMAND_STRING中的关键字，开始执行拍照功能</span>            <span class="token function">takePicture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本章节的完整代码在Src/takePhotoV3.0.zip中获取。</p><h2 id="7-回顾和总结"><a href="#7-回顾和总结" class="headerlink" title="7. 回顾和总结"></a>7. 回顾和总结</h2><p><strong>鸿蒙分布式讯飞语音相机</strong>从生活中好朋友之间互拍照片、拍摄集体照时的痛点问题出发，利用HarmonyOS分布式文件系统和讯飞AI语音识别功能开发了一款分布式语音照相机。使用该款相机应用，处于同一分布式网络下的不同设备可以实时看到主设备所拍摄的照片，这高效地解决了互拍照片时需要来回跑动传递手机的痛点问题，此外主设备还支持了语音控制的拍照功能，使您在远处就可以对相机进行控制。</p><p>我们在这个过程中也收到到了很多，技能如下：</p><p>鸿蒙系统架构</p><p>鸿蒙DevEco开发工具的使用</p><p>鸿蒙Java UI界面的开发</p><p>鸿蒙相机功能的开发</p><p>鸿蒙核心能力分布式系统功能的开发</p><p>讯飞核心能力语音识别功能的开发</p><p>同时我们也收获了一份努力的回报，get到了一个实用的应用技能，并可以把这份快乐和便捷分享给身边的人使用。</p><h2 id="8-参考"><a href="#8-参考" class="headerlink" title="8.参考"></a>8.参考</h2><p><strong>鸿蒙应用开发官方文档：</strong></p><p><a href="https://developer.harmonyos.com/cn/home/" rel="external nofollow noreferrer">https://developer.harmonyos.com/cn/home/</a></p><p><strong>鸿蒙设备开发官方文档：</strong></p><p><a href="https://device.harmonyos.com/cn/home/" rel="external nofollow noreferrer">https://device.harmonyos.com/cn/home/</a></p>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 鸿蒙 </tag>
            
            <tag> 讯飞语音识别 </tag>
            
            <tag> AI语音相机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Harmony设备开发-物联网点灯</title>
      <link href="2021/06/harmony-she-bei-kai-fa-wu-lian-wang-dian-deng/"/>
      <url>2021/06/harmony-she-bei-kai-fa-wu-lian-wang-dian-deng/</url>
      
        <content type="html"><![CDATA[<h2 id="开发板介绍"><a href="#开发板介绍" class="headerlink" title="开发板介绍"></a>开发板介绍</h2><p>硬件：小熊派BearPi-HM Nano开发板，是一块基于HarmonyOS设计的开发板，板载2.4GHz WLAN SoC芯片Hi3861，并板载NFC电路，可完成鸿蒙的碰一碰联网功能，通过提供的E53接口可扩展智慧农业、智能台灯、智能安防、智能烟感等物联网案例，用来学习鸿蒙的标准系统和设备端开发是一个不错的选择。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210620152802767.png" alt="小熊派开发板"></p><p>源码地址：<a href="https://gitee.com/bearpi/bearpi-hm_nano" rel="external nofollow noreferrer">https://gitee.com/bearpi/bearpi-hm_nano</a></p><p>由于官方已经提供了大量的学习资料，小白可以按照以上源代码提供的地址进行学习就可以啦。</p><p>那我这里还有啥用呢，当然是在过程中踩了一些坑，如果各位也有和我同样的问题和我一起往下看哦。</p><h2 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h2><p>先明确一下，开发环境小熊派需要两个系统，一个是windows用于烧录和源代码的编写查看比较方便，另外一个是编译目前只支持unbutu18以上的系统，而小熊派官方给的简单的搭建步骤也是比较麻烦的，可以参考提供的教程地址：<a href="https://gitee.com/bearpi/bearpi-hm_nano/blob/master/applications/BearPi/BearPi-HM_Nano/docs/quick-start/BearPi-HM_Nano%E5%BC%80%E5%8F%91%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83.md" rel="external nofollow noreferrer">https://gitee.com/bearpi/bearpi-hm_nano/blob/master/applications/BearPi/BearPi-HM_Nano/docs/quick-start/BearPi-HM_Nano%E5%BC%80%E5%8F%91%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83.md</a></p><p>开发过程可以分为三个过程：源码下载、编译、烧录。小熊派的源码编译目前只能在Linux平台，因此下载官方推荐的ubuntu18以上的版本用于源码<strong>下载和编译</strong>，然后使用windows系统来<strong>烧录</strong>及代码的编写即可。</p><p>由于涉及到两个系统，很多童鞋会想到使用在Windows下使用VMWare桌面虚拟化软件，然后编译好代码后，还需要把目录共享给Windows来对编译好的代码进行烧录及源代码的编写。这样太麻烦了有没有。</p><p>我们只是借助Ubuntu编译代码而已，可以使用Windows自带的WSL来安装Ubuntu就会方便很多，安装好的Ubuntu环境本身就会共享Windows的目录（注意Linux的软链接在Windows下不支持）。</p><p>因此整个开发环境过程为：</p><ol><li>使用WSL安装Ubuntu18以上版本的系统；</li><li>Ubuntu18安装编译环境；</li><li>Windows安装开发烧录环境；</li></ol><p>三个大步骤即可。</p><p>而以上三个步骤都是有官方文档的，强烈推荐以官方文档为先，因为一旦版本更新或者步骤更新，最快会反应在官方文档上，而其他网站上的内容可能已经陈旧，导致无法完成目标。</p><p>以上三个过程对应的官方文档为：</p><ol><li><a href="https://ubuntu.com/wsl" rel="external nofollow noreferrer">https://ubuntu.com/wsl</a></li><li><a href="https://device.harmonyos.com/cn/docs/ide/user-guides/install_ubuntu-0000001072959308" rel="external nofollow noreferrer">https://device.harmonyos.com/cn/docs/ide/user-guides/install_ubuntu-0000001072959308</a></li><li><a href="https://device.harmonyos.com/cn/docs/ide/user-guides/install_windows-0000001050164976" rel="external nofollow noreferrer">https://device.harmonyos.com/cn/docs/ide/user-guides/install_windows-0000001050164976</a></li></ol><p>好了，按照以上的步骤来就可以了，下面是一些需要注意的FAQ。</p><h3 id="问题：windows上通过wsl安装ubuntu子系统需要前往系统设置-应用-程序和功能-启用或关闭Windows功能，勾选上述目标项，确认即可。"><a href="#问题：windows上通过wsl安装ubuntu子系统需要前往系统设置-应用-程序和功能-启用或关闭Windows功能，勾选上述目标项，确认即可。" class="headerlink" title="问题：windows上通过wsl安装ubuntu子系统需要前往系统设置-应用-程序和功能-启用或关闭Windows功能，勾选上述目标项，确认即可。"></a><strong>问题：windows上通过wsl安装ubuntu子系统需要前往系统设置-应用-程序和功能-启用或关闭Windows功能，勾选上述目标项，确认即可。</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/375390-20200830220111165-1927601525.png" alt="开启Linux子系统"></p><h3 id="问题：在Microsoft-Store中选择哪个版本？"><a href="#问题：在Microsoft-Store中选择哪个版本？" class="headerlink" title="问题：在Microsoft Store中选择哪个版本？"></a><strong>问题：在Microsoft Store中选择哪个版本？</strong></h3><p>推荐选择Ubuntu 18.04 LTS的版本，目前在这个平台上能编译通过，其他的没有试过。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/375390-20200830221102876-229478018.png" alt="Ubuntu版本选择"></p><h3 id="问题：第二个步骤Ubuntu18安装编译环境需要完全按照官方的操作吗？"><a href="#问题：第二个步骤Ubuntu18安装编译环境需要完全按照官方的操作吗？" class="headerlink" title="问题：第二个步骤Ubuntu18安装编译环境需要完全按照官方的操作吗？"></a>问题：第二个步骤<strong>Ubuntu18安装编译环境</strong>需要完全按照官方的操作吗？</h3><p>因为使用Ubuntu18主要用来下载和编译代码的，而编译的整个过程都被鸿蒙整合到了Hpm工具中，因此只需要安装Hpm的依赖即可。以下针对使用的<a href="https://device.harmonyos.com/cn/docs/#ZH-CN_TOPIC_0000001057397722__section147361127134119" rel="external nofollow noreferrer">V2.2 Beta1（2021-06-02）</a>说明如下：</p><p>按照要求安装红框中的即可，VSCode IDE和DevEco插件都不需要安装，大量节省时间。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210620162720609.png" alt="依赖安装选项"></p><h3 id="问题：源码使用哪种方式下载？"><a href="#问题：源码使用哪种方式下载？" class="headerlink" title="问题：源码使用哪种方式下载？"></a>问题：源码使用哪种方式下载？</h3><p>如果有Hpm的下载方式，强烈推荐这种，成熟的版本会把依赖的编译环境也放进来，就无需再一个个的找工具下载配置了。</p><p>比如如果想开发小熊派的智能台灯，找到Hpm的地址，找到这个应用的Hpm地址：</p><p><a href="https://hpm.harmonyos.com/#/cn/distribution/@bearpi%2Fbearpi_hm_nano_light" rel="external nofollow noreferrer">https://hpm.harmonyos.com/#/cn/distribution/@bearpi%2Fbearpi_hm_nano_light</a></p><p>在终端中执行以下命令即可</p><p>创建一个新的发行版继承自本发行版</p><pre class="line-numbers language-shell"><code class="language-shell">hpm init -t disthpm i @bearpi/bearpi_hm_nano_light<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>执行发行命令</p><pre class="line-numbers language-shell"><code class="language-shell">hpm dist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当执行hpm dist的时候，可能会出现一些编译过程的问题，记录如下：</p><pre><code>1、../../third_party/iot_link/network/dtls/mbedtls/mbedtls_port/los_mbedtls_config_dtls.h:291:10: fatal error: mbedtls/check_config.h: No such file or directory #include &quot;mbedtls/check_config.h&quot;解决：cp vendor/hisi/hi3861/hi3861/third_party/mbedtls/ third_party/ -rf2、scons command not found解决：没有安装scons，命令行执行pip3 install scons安装3、遇到ImportError: cannot import name ‘_counter‘ from ‘Crypto.Util的错误解决：这个是由于crypto包没有安装的愿意你，通过以下命令下载：pip3 install setuptools kconfiglib pycryptodome ecdsa</code></pre><p>编译完成后，看到以下的信息表示编译成功。</p><p><img src="C:/Users/aibit/AppData/Roaming/Typora/typora-user-images/image-20210620163434468.png" alt="编译成功界面"></p><h2 id="物联网点灯案例演示"><a href="#物联网点灯案例演示" class="headerlink" title="物联网点灯案例演示"></a>物联网点灯案例演示</h2><p>以上的代码就是物联网点灯案例的代码，编译好后，需要放到Windows平台下烧录。可以看到/mnt/e这个是共享Windows下的E盘，因此可以在windows下直接使用（虽然方便，但要小心Linux的软链接在Windows是识别不了的）。</p><p>根据以上的步骤，在Windows上已经装好了VSCode和DevEco device Tool的插件了，按照官方的文档，配置好相关的烧录功能即可：<a href="https://device.harmonyos.com/cn/docs/ide/user-guides/bearpi-hm-nano-upload-0000001115604076" rel="external nofollow noreferrer">https://device.harmonyos.com/cn/docs/ide/user-guides/bearpi-hm-nano-upload-0000001115604076</a></p><p>配置好后，就可以烧录了，成功烧录的终端信息如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210620164413262.png" alt="烧录成功的信息"></p><p>以上已经可以烧录代码了，接下来就是修改代码，然后通过远程控制设备了，这个案例小熊派的官方提供的文档如下：</p><p><a href="https://gitee.com/bearpi/bearpi-hm_nano/blob/master/applications/BearPi/BearPi-HM_Nano/sample/D9_iot_cloud_oc_light/README.md" rel="external nofollow noreferrer">https://gitee.com/bearpi/bearpi-hm_nano/blob/master/applications/BearPi/BearPi-HM_Nano/sample/D9_iot_cloud_oc_light/README.md</a></p><p>按照文档操作即可，还是很详细的，很轻松就可以接入华为IoT云服务，通过远程界面控制设备开关了。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210620165020618.png" alt="设备在线状态"></p><p>可以使用文档中提供的命令，下方对应的指令，打开设备的灯开关：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210620165142918.png" alt="物联网控制设备智能点灯"></p>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Harmony </tag>
            
            <tag> Bearpi </tag>
            
            <tag> 物联网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派USB音频设备录音播放验证</title>
      <link href="2021/05/shu-mei-pai-usb-yin-pin-she-bei-lu-yin-bo-fang-yan-zheng/"/>
      <url>2021/05/shu-mei-pai-usb-yin-pin-she-bei-lu-yin-bo-fang-yan-zheng/</url>
      
        <content type="html"><![CDATA[<h2 id="USB麦克风验证"><a href="#USB麦克风验证" class="headerlink" title="USB麦克风验证"></a>USB麦克风验证</h2><p>有条件可以使用麦克风阵列：<a href="https://wiki.seeedstudio.com/cn/ReSpeaker-USB-Mic-Array/" rel="external nofollow noreferrer">https://wiki.seeedstudio.com/cn/ReSpeaker-USB-Mic-Array/</a></p><h3 id="查看麦克风设备"><a href="#查看麦克风设备" class="headerlink" title="查看麦克风设备"></a>查看麦克风设备</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cat</span> /proc/asound/cards<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>显示内容如下：</p><pre class="line-numbers language-bash"><code class="language-bash">pi@raspberrypi:~ $ <span class="token function">cat</span> /proc/asound/cards 0 <span class="token punctuation">[</span>Headphones     <span class="token punctuation">]</span>: bcm2835_headphonbcm2835 Headphones - bcm2835 Headphones                      bcm2835 Headphones 1 <span class="token punctuation">[</span>Camera         <span class="token punctuation">]</span>: USB-Audio - FHD Camera                      Sunplus IT Co FHD Camera at usb-3f980000.usb-1.4, high speed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到显示USB-Audio设备说明已经有USB的音频设备了</p><h3 id="录音录制"><a href="#录音录制" class="headerlink" title="录音录制"></a>录音录制</h3><pre class="line-numbers language-bash"><code class="language-bash">arecord -D <span class="token string">"plughw:1,0"</span> -f S16_LE -r 16000 -d 5 record.wav<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>-D &quot;plughw:1,0&quot;</code>表示选择设备，外部设备就是plughw:1,0，内部设备就是plughw:0,0；</p><p><code>-f S16_LE</code>表示使用录音采样率是有符号16bit小端，16000HZ采样率；</p><p><code>-d 5</code>表示录音的时间；</p><p><code>record.wav</code>表示录音保存的名字；</p><h3 id="录音验证"><a href="#录音验证" class="headerlink" title="录音验证"></a>录音验证</h3><p>如果有扬声器或者3.5mm的耳机，可以通过如下命令：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装播放器</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> omxplayer<span class="token comment" spellcheck="true"># 播放本地音频</span>omxplayer -o local record.wav<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>也可以通过alsamixer调整声音的大小，TAB按键用于切换，按键上下键用于调整音量，ESC退出。</p>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 树莓派录音 </tag>
            
            <tag> 树莓派播放音频 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>唤醒词自定义snowboy</title>
      <link href="2021/04/snowboy-hotword-detect/"/>
      <url>2021/04/snowboy-hotword-detect/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是snowboy"><a href="#什么是snowboy" class="headerlink" title="什么是snowboy"></a>什么是snowboy</h2><p>snowboy是一个基于DNN深度神经网络的热词检测，常用于做语音唤醒，比如小爱音箱，小度小度等之类的唤醒设备应用场景。</p><p>snowboy支持训练自己的唤醒词，在2021年之后，snowboy关闭了在线训练自定义唤醒词，但是提供了另一个本地离线训练的模型，一起来验证一下吧。</p><p>目前支持的平台：</p><ul><li>all versions of Raspberry Pi (with Raspbian based on Debian Jessie 8.0)</li><li>64bit Mac OS X</li><li>64bit Ubuntu 14.04</li><li>iOS</li><li>Android</li><li>ARM64 (aarch64, Ubuntu 16.04)</li></ul><h2 id="验证环境"><a href="#验证环境" class="headerlink" title="验证环境"></a>验证环境</h2><p>系统：ubuntu16.04</p><p>通过<a href="https://github.com/Kitt-AI/snowboy%E5%8E%9F%E6%9C%AC%E7%9A%84%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%88%91%E4%BB%AC%E6%89%BE%E5%88%B0%E5%AE%83%E6%8F%90%E4%BE%9B%E7%9A%84%E7%A6%BB%E7%BA%BF%E8%AE%AD%E7%BB%83%E5%94%A4%E9%86%92%E8%AF%8D%E6%94%AF%E6%8C%81%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%9Ahttps://github.com/seasalt-ai/snowboy" rel="external nofollow noreferrer">https://github.com/Kitt-AI/snowboy原本的开源地址，我们找到它提供的离线训练唤醒词支持的版本：https://github.com/seasalt-ai/snowboy</a></p><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="修改python环境为国内源"><a href="#修改python环境为国内源" class="headerlink" title="修改python环境为国内源"></a>修改python环境为国内源</h3><p><code>pip config set global.index-url</code>表示配置下载源，以下选择一个执行，选下载速度快的，我这里的阿里的源会快一点。</p><pre><code># 清华源pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple# 阿里源pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/# 腾讯源pip config set global.index-url http://mirrors.cloud.tencent.com/pypi/simple# 豆瓣源pip config set global.index-url http://pypi.douban.com/simple/</code></pre><h3 id="创建python的虚拟环境"><a href="#创建python的虚拟环境" class="headerlink" title="创建python的虚拟环境"></a>创建python的虚拟环境</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> pip <span class="token function">install</span> virtualenv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="初始化虚拟环境目录"><a href="#初始化虚拟环境目录" class="headerlink" title="初始化虚拟环境目录"></a>初始化虚拟环境目录</h3><pre class="line-numbers language-bash"><code class="language-bash">virtualenv -p python2 venv/snowboy<span class="token function">source</span> venv/snowboy/bin/activate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="进入虚拟环境"><a href="#进入虚拟环境" class="headerlink" title="进入虚拟环境"></a>进入虚拟环境</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">source</span> venv/snowboy/bin/activate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="下载源代码"><a href="#下载源代码" class="headerlink" title="下载源代码"></a>下载源代码</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/seasalt-ai/snowboy.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="下载依赖项"><a href="#下载依赖项" class="headerlink" title="下载依赖项"></a>下载依赖项</h3><pre><code>cd snowboy-master/examples/Pythonpip install -r requirements.txt</code></pre><p>以上安装依赖pyaudio时，会提示<code>pyaudio出现&quot;portaudio.h&quot;:No such file or directory</code>错误，缺少portaudio库的支持，</p><p>可以使用以下两种安装方式：</p><ol><li>使用apt方式安装</li></ol><pre><code>sudo apt-get install portaudio19-dev python-all-dev python3-all-dev</code></pre><ol start="2"><li><p>使用源代码安装</p><p> 下载源代码：<code>wget http://files.portaudio.com/archives/pa_stable_v190600_20161030.tgz</code></p><p> 解压源代码：<code>tar -xzvf pa_stable_v190600_20161030.tgz</code></p><p> 进入源代码：<code>cd portaudio</code></p><p> 编译源代码：make</p><p> 安装源代码：<code>sudo make install</code></p></li></ol><h3 id="安装swig和音频库"><a href="#安装swig和音频库" class="headerlink" title="安装swig和音频库"></a>安装swig和音频库</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> swig3.0 sox<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libatlas-base-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="swig编译环境"><a href="#swig编译环境" class="headerlink" title="swig编译环境"></a>swig编译环境</h3><p>进入snowboy源代码的swig/Python目录下</p><pre><code>cd snowboy-master/swig/Python</code></pre><p>执行</p><pre><code>make &amp;&amp; sudo make install</code></pre><p>生成snowboydetect.py和_snowboydetect.so文件。</p><h2 id="snowboy唤醒词验证"><a href="#snowboy唤醒词验证" class="headerlink" title="snowboy唤醒词验证"></a>snowboy唤醒词验证</h2><h4 id="唤醒词录制"><a href="#唤醒词录制" class="headerlink" title="唤醒词录制"></a>唤醒词录制</h4><pre class="line-numbers language-bash"><code class="language-bash">rec -r 16000 -c 1 -b 16 -e signed-integer -t wav record1.wavrec -r 16000 -c 1 -b 16 -e signed-integer -t wav record2.wavrec -r 16000 -c 1 -b 16 -e signed-integer -t wav record3.wav<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>通过以上<code>rec</code>命令录制三段唤醒词，比如叫”芝麻开门”</p><h4 id="离线唤醒词训练"><a href="#离线唤醒词训练" class="headerlink" title="离线唤醒词训练"></a>离线唤醒词训练</h4><p>进入snowboy-master/examples/Python目录</p><pre class="line-numbers language-bash"><code class="language-bash">python generate_pmdl.py -r1<span class="token operator">=</span>record1.wav -r2<span class="token operator">=</span>record2.wav -r3<span class="token operator">=</span>record3.wav -lang<span class="token operator">=</span>zh -n<span class="token operator">=</span>hotword.pmdl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成模型文件hotword.pmdl</p><h4 id="验证唤醒词"><a href="#验证唤醒词" class="headerlink" title="验证唤醒词"></a>验证唤醒词</h4><pre><code>python demo.py hotword.pmdl</code></pre><p>启动程序后，对着麦克风喊唤醒词”芝麻开门”，成功唤醒会有”ding”的一声和一条唤醒成功的打印语句，如下：</p><pre class="line-numbers language-bash"><code class="language-bash">Listening<span class="token punctuation">..</span>. Press Ctrl+C to <span class="token keyword">exit</span>INFO:snowboy:Keyword 1 detected at time: 2021-04-11 20:49:35<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>快来自定义一个唤醒词试试吧</p>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snowboy </tag>
            
            <tag> 人工智能 </tag>
            
            <tag> 语音唤醒 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小白零基础7天学会Python Scrapy爬虫之旅</title>
      <link href="2021/03/pythonspider/"/>
      <url>2021/03/pythonspider/</url>
      
        <content type="html"><![CDATA[<h2 id="小白零基础7天学会Python-Scrapy爬虫之旅"><a href="#小白零基础7天学会Python-Scrapy爬虫之旅" class="headerlink" title="小白零基础7天学会Python Scrapy爬虫之旅"></a>小白零基础7天学会Python Scrapy爬虫之旅</h2><p>赏花赏月赏秋香，爬影爬花爬职场</p><p>7天之旅带你爬取<strong>最受欢迎的电影、各大高校的校花、量身打造求职信息</strong>；</p><p>本教程源码参考链接：<a href="https://github.com/aibittek/PythonSpider" rel="external nofollow noreferrer">https://github.com/aibittek/PythonSpider</a></p><h2 id="一、2天学会Python语法之路"><a href="#一、2天学会Python语法之路" class="headerlink" title="一、2天学会Python语法之路"></a>一、2天学会Python语法之路</h2><h3 id="1-1-环境搭建"><a href="#1-1-环境搭建" class="headerlink" title="1.1 环境搭建"></a>1.1 环境搭建</h3><h4 id="1-1-1-下载"><a href="#1-1-1-下载" class="headerlink" title="1.1.1 下载"></a>1.1.1 下载</h4><p><strong>Anaconda+Pycharm？</strong>合理的搭配，安装包全，兼容性好，开发界面友好</p><p>缺点：因为全，安装包太大，还要去下载两款软件再安装，再配置。</p><p>有没有拎包入住的版本？有的，以下提供了VSCode的Python便携版本，大小只有180MB多。解压双击Code.bat即可享用，不用安装、便携小巧、方便携带，可以放在U盘中，随时插入到任何电脑运行，而你要做的只是双击Code.bat运行即可。</p><p>下载地址：</p><pre><code>链接：https://pan.baidu.com/s/1AfiX7OJe120Ytg4V__hEFQ提取码：1234</code></pre><p>压缩包名称：VSCode32_Python_Portable.zip</p><p>顺便提一下，Anaconda安装包带的Jupyter Notebook也非常好用，使用Anaconda环境的崭新小伙伴不要错过😄。</p><h4 id="1-1-2-运行"><a href="#1-1-2-运行" class="headerlink" title="1.1.2 运行"></a>1.1.2 运行</h4><p>解压后，进入VSCode32_Python_Portable目录，找到<strong>双击我运行.bat</strong>并运行，可以看到如下界面</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210308104054991.png" alt="VSCode界面"></p><h4 id="1-1-3-验证"><a href="#1-1-3-验证" class="headerlink" title="1.1.3 验证"></a>1.1.3 验证</h4><p>为了验证环境是否能够进行Python的开发，咱们创建第一个Python程序，步骤如下：</p><p>1、在无特殊符号无中文的目录下，创建一个用于存放Python源代码的目录；</p><p>2、在刚打开的界面中选择打开文件夹，并选择这个目录；</p><p>3、在这个目录下创建一个Python源代码文件，并输入以下内容；</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210308104804271.png" alt="第一个Python程序"></p><p>以上黄色的BASE是打开的源代码目录名称，黄色箭头指向的是这个目录存放的位置；</p><p>first.py是在base目录下创建的python代码文件，红色箭头指向的是first.py的代码，里面有两行内容：</p><pre><code># coding=utf-8表示这个文件的编码方式是utf-8格式的print是一个打印函数，会向终端中打印数据，打印的数据内容由()中的内容指定，这里咱们提供的是hello world字符串</code></pre><h4 id="1-1-4-运行第一个代码"><a href="#1-1-4-运行第一个代码" class="headerlink" title="1.1.4 运行第一个代码"></a>1.1.4 运行第一个代码</h4><p>点击first.py文件，点击F5快捷按键，选择Python文件选项，开始运行咱们的第一个Python代码，看到终端显示hello world代表环境成功。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210308105511590.png" alt="第一个Python程序运行结果"></p><h3 id="1-2-Python基础语法"><a href="#1-2-Python基础语法" class="headerlink" title="1.2 Python基础语法"></a>1.2 Python基础语法</h3><h4 id="1-2-1-编码"><a href="#1-2-1-编码" class="headerlink" title="1.2.1 编码"></a>1.2.1 编码</h4><p>有时候我们打开的文件会乱码，这是什么问题呢？</p><p>这是因为在计算机中保存的数据都是通过不同的编码保存的，如果打开的软件不知道这个文件是通过什么编码保存的，就不能以正确的方式打开，显示的内容就会错误啦。</p><p>因此，我们可以通过在文件中指定文件的编码方式来解决，Python文件通过以下两种方式指定文件的编码方式：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中utf-8代表的是一种编码方式，也是Python默认的编码方式。</p><p>关于编码的问题渊远流长，可以参考<a href="https://www.jianshu.com/p/36d20de2a1ee" rel="external nofollow noreferrer">这篇文章</a>了解来龙去脉。</p><h4 id="1-2-2-标识符"><a href="#1-2-2-标识符" class="headerlink" title="1.2.2 标识符"></a>1.2.2 标识符</h4><p>在Python3中已经可以使用中文作为变量名称了</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>字符串<span class="token operator">=</span><span class="token string">'hello'</span><span class="token keyword">print</span><span class="token punctuation">(</span>字符串<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出的结果是hello，其中的<strong>字符串</strong>是一个变量名称。</p><p>其他的标识符约束：</p><ul><li>  第一个字符必须是字母表中字母或下划线 <strong>_</strong> 。</li><li>  标识符的其他的部分由字母、数字和下划线组成。</li><li>  标识符对大小写敏感。</li></ul><h4 id="1-2-3-Python保留字"><a href="#1-2-3-Python保留字" class="headerlink" title="1.2.3 Python保留字"></a>1.2.3 Python保留字</h4><p>Python语言有自己的语法规则，而这些语法规则使用了一些文字，比如<strong>if</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>以上的代码含义是，如果条件为真，则输出hello，其中的if就是Python语言中用于判断真假的语法关键字，已经被占用了，咱们就不能再使用了。像这样的还有很多，我们称之为保留字。</p><p>Python的保留字可以通过以下方式获取</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">import</span> keyword<span class="token keyword">print</span><span class="token punctuation">(</span>keyword<span class="token punctuation">.</span>kwlist<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出的保留关键字结果如下：</p><pre><code>[&#39;False&#39;, &#39;None&#39;, &#39;True&#39;, &#39;and&#39;, &#39;as&#39;, &#39;assert&#39;, &#39;async&#39;, &#39;await&#39;, &#39;break&#39;, &#39;class&#39;, &#39;continue&#39;, &#39;def&#39;, &#39;del&#39;, &#39;elif&#39;, &#39;else&#39;, &#39;except&#39;, &#39;finally&#39;, &#39;for&#39;, &#39;from&#39;, &#39;global&#39;, &#39;if&#39;, &#39;import&#39;, &#39;in&#39;, &#39;is&#39;, &#39;lambda&#39;, &#39;nonlocal&#39;, &#39;not&#39;, &#39;or&#39;, &#39;pass&#39;, &#39;raise&#39;, &#39;return&#39;, &#39;try&#39;, &#39;while&#39;, &#39;with&#39;, &#39;yield&#39;]</code></pre><h4 id="1-2-4-注释"><a href="#1-2-4-注释" class="headerlink" title="1.2.4 注释"></a>1.2.4 注释</h4><p>Python中的注释一般是#开头，多行使用’’’或者”””</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token triple-quoted-string string">'''这是一条注释'''</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Hello, Python!'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-5-行与缩进"><a href="#1-2-5-行与缩进" class="headerlink" title="1.2.5 行与缩进"></a>1.2.5 行与缩进</h4><p>Python的缩进需要特别注意，同一级别的代码块的缩进要保持相同，否则会出现逻辑或异常，例如：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">if</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'True'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Really True'</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"False"</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'why false'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上的代码由于第8行缩进的问题，会执行异常，尝试使用相同的缩进，使得代码运行正常，并猜测打印出的结果。</p><h4 id="1-2-6-多行语句"><a href="#1-2-6-多行语句" class="headerlink" title="1.2.6 多行语句"></a>1.2.6 多行语句</h4><p>如果一条语句很长的时候，我们需要使用续行符来表示他们是属于同一行的，要注意续航符后面不能有字符哦。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>totalString <span class="token operator">=</span> <span class="token string">'Hello'</span> <span class="token operator">+</span> \        <span class="token string">', '</span> <span class="token operator">+</span> \        <span class="token string">'Python!'</span><span class="token keyword">print</span><span class="token punctuation">(</span>totalString<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出的结果为：</p><pre><code>Hello, Python!</code></pre><h4 id="1-2-7-数字Number类型"><a href="#1-2-7-数字Number类型" class="headerlink" title="1.2.7 数字Number类型"></a>1.2.7 数字Number类型</h4><p>python中数字有四种类型：整数、布尔型、浮点数和复数。</p><ul><li>  <strong>int</strong> (整数), 如 1, 只有一种整数类型 int，表示为长整型，没有 python2 中的 Long。</li><li>  <strong>bool</strong> (布尔), 如 True。</li><li>  <strong>float</strong> (浮点数), 如 1.23、3E-2</li><li>  <strong>complex</strong> (复数), 如 1 + 2j、 1.1 + 2.2j</li></ul><h4 id="1-2-8-字符串"><a href="#1-2-8-字符串" class="headerlink" title="1.2.8 字符串"></a>1.2.8 字符串</h4><ul><li>  python中单引号和双引号使用完全相同。</li><li>  使用三引号(‘’’或”””)可以指定一个多行字符串。</li><li>  转义符 ‘&#39;</li><li>  反斜杠可以用来转义，使用r可以让反斜杠不发生转义。。 如 r”this is a line with \n” 则\n会显示，并不是换行。</li><li>  按字面意义级联字符串，如”this “ “is “ “string”会被自动转换为this is string。</li><li>  字符串可以用 + 运算符连接在一起，用 * 运算符重复。</li><li>  Python 中的字符串有两种索引方式，从左往右以 0 开始，从右往左以 -1 开始。</li><li>  Python中的字符串不能改变。</li><li>  Python 没有单独的字符类型，一个字符就是长度为 1 的字符串。</li><li>  字符串的截取的语法格式如下：<strong>变量[头下标:尾下标:步长]</strong></li></ul><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>word <span class="token operator">=</span> <span class="token string">'字符串'</span>sentence <span class="token operator">=</span> <span class="token string">"这是一个句子。"</span>paragraph <span class="token operator">=</span> <span class="token triple-quoted-string string">"""这是一个段落，可以由多行组成"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实例</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>str<span class="token operator">=</span><span class="token string">'Hello!'</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true"># 输出字符串</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true"># 输出第一个到倒数第二个的所有字符</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>              <span class="token comment" spellcheck="true"># 输出字符串第一个字符</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 输出从第三个开始到第五个的字符</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 输出从第三个开始后的所有字符</span><span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true"># 输出从第二个开始到第五个且每隔两个的字符</span><span class="token keyword">print</span><span class="token punctuation">(</span>str <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 输出字符串两次</span><span class="token keyword">print</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token string">'你好'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 连接字符串</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------------------------------'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello\nworld'</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 使用反斜杠(\)+n转义特殊字符</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token string">'hello\nworld'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 在字符串前面添加一个 r，表示原始字符串，不会发生转义</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的 r 指 raw，即 raw string，会自动将反斜杠转义，例如：</p><pre><code>&gt;&gt;&gt; print(&#39;\n&#39;)       # 输出空行&gt;&gt;&gt; print(r&#39;\n&#39;)      # 输出 \n\n&gt;&gt;&gt;</code></pre><p>以上实例输出结果：</p><pre><code>Hello!HelloHllollo!elHello!Hello!Hello!你好------------------------------helloworldhello\nworld</code></pre><h4 id="1-2-9-空行"><a href="#1-2-9-空行" class="headerlink" title="1.2.9 空行"></a>1.2.9 空行</h4><p>函数之间或类的方法之间用空行分隔，表示一段新的代码的开始。类和函数入口之间也用一行空行分隔，以突出函数入口的开始。</p><p>空行与代码缩进不同，空行并不是Python语法的一部分。书写时不插入空行，Python解释器运行也不会出错。但是空行的作用在于分隔两段不同功能或含义的代码，便于日后代码的维护或重构。</p><p><strong>记住：</strong>空行也是程序代码的一部分。</p><h4 id="1-2-10-用户输入"><a href="#1-2-10-用户输入" class="headerlink" title="1.2.10 用户输入"></a>1.2.10 用户输入</h4><p>执行下面的程序在按回车键后就会等待用户输入：</p><pre class="line-numbers language-python"><code class="language-python">input<span class="token punctuation">(</span><span class="token string">"\n\n按下 enter 键后退出。"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-2-11-一行多条语句"><a href="#1-2-11-一行多条语句" class="headerlink" title="1.2.11 一行多条语句"></a>1.2.11 一行多条语句</h4><p>Python可以在同一行中使用多条语句，语句之间使用分号(;)分割，以下是一个简单的实例：</p><pre class="line-numbers language-python"><code class="language-python">content <span class="token operator">=</span> <span class="token string">'python'</span><span class="token punctuation">;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-2-12-import与from-import"><a href="#1-2-12-import与from-import" class="headerlink" title="1.2.12 import与from import"></a>1.2.12 import与from import</h4><p>在 python 用 <strong>import</strong> 或者 <strong>from…import</strong> 来导入相应的模块。</p><p>将整个模块(somemodule)导入，格式为： <strong>import somemodule</strong></p><p>从某个模块中导入某个函数,格式为： <strong>from somemodule import somefunction</strong></p><p>从某个模块中导入多个函数,格式为： <strong>from somemodule import firstfunc, secondfunc, thirdfunc</strong></p><p>将某个模块中的全部函数导入，格式为： <strong>from somemodule import *</strong></p><p>导入sys模块</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'================Python import mode=========================='</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'命令行参数为:'</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">:</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'\n python 路径为'</span><span class="token punctuation">,</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>导入sys模块的argv, path # 导入特定的成员</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> sys <span class="token keyword">import</span> argv<span class="token punctuation">,</span>path  <span class="token comment" spellcheck="true">#  导入特定的成员</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'================python from import==================================='</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'path:'</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 因为已经导入path成员，所以此处引用时不需要加sys.path</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-13-命令行参数"><a href="#1-2-13-命令行参数" class="headerlink" title="1.2.13 命令行参数"></a>1.2.13 命令行参数</h4><pre class="line-numbers language-bash"><code class="language-bash">python first.py arg1 arg2 arg3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Python 中也可以所用 <strong>sys</strong> 的 <strong>sys.argv</strong> 来获取命令行参数：</p><ul><li>  <strong>sys.argv</strong> 是命令行参数列表。</li><li>  <strong>len(sys.argv)</strong> 计算命令行参数个数。</li></ul><p><strong>注：**</strong>sys.argv[0]** 表示脚本名。</p><p>示例：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'参数个数为:'</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'个参数。'</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'参数列表:'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'脚本名:'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行以上代码，输出结果为：</p><pre class="line-numbers language-bash"><code class="language-bash">$ python3 first.py arg1 arg2 arg3参数个数为: 4 个参数。参数列表: <span class="token punctuation">[</span><span class="token string">'first.py'</span>, <span class="token string">'arg1'</span>, <span class="token string">'arg2'</span>, <span class="token string">'arg3'</span><span class="token punctuation">]</span>脚本名: first.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Python 提供了 <strong>getopt</strong> 模块来获取命令行参数。</p><h4 id="1-2-14-算术运算符"><a href="#1-2-14-算术运算符" class="headerlink" title="1.2.14 算术运算符"></a>1.2.14 算术运算符</h4><p>以下假设变量a为10，变量b为21：</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">+</td><td align="left">加 - 两个对象相加</td><td align="left">a + b 输出结果 31</td></tr><tr><td align="left">-</td><td align="left">减 - 得到负数或是一个数减去另一个数</td><td align="left">a - b 输出结果 -11</td></tr><tr><td align="left">*</td><td align="left">乘 - 两个数相乘或是返回一个被重复若干次的字符串</td><td align="left">a * b 输出结果 210</td></tr><tr><td align="left">/</td><td align="left">除 - x 除以 y</td><td align="left">b / a 输出结果 2.1</td></tr><tr><td align="left">%</td><td align="left">取模 - 返回除法的余数</td><td align="left">b % a 输出结果 1</td></tr><tr><td align="left">**</td><td align="left">幂 - 返回x的y次幂</td><td align="left">a**b 为10的21次方</td></tr><tr><td align="left">//</td><td align="left">取整除 - 向下取接近商的整数</td><td align="left"><code>&gt;&gt;&gt; 9//2 4 &gt;&gt;&gt; -9//2 -5</code></td></tr></tbody></table><p>以下实例演示了Python所有算术运算符的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">21</span>b <span class="token operator">=</span> <span class="token number">10</span>c <span class="token operator">=</span> <span class="token number">0</span>c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">-</span> b<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">/</span> b<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">%</span> b<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 修改变量 a 、b 、c</span>a <span class="token operator">=</span> <span class="token number">2</span>b <span class="token operator">=</span> <span class="token number">3</span>c <span class="token operator">=</span> a<span class="token operator">**</span>b <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token number">10</span>b <span class="token operator">=</span> <span class="token number">5</span>c <span class="token operator">=</span> a<span class="token operator">//</span>b <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"7 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre class="line-numbers language-bash"><code class="language-bash">1 - c 的值为： 312 - c 的值为： 113 - c 的值为： 2104 - c 的值为： 2.15 - c 的值为： 16 - c 的值为： 87 - c 的值为： 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-15-比较运算符"><a href="#1-2-15-比较运算符" class="headerlink" title="1.2.15 比较运算符"></a>1.2.15 比较运算符</h4><p>以下假设变量a为10，变量b为20：</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">==</td><td align="left">等于 - 比较对象是否相等</td><td align="left">(a == b) 返回 False。</td></tr><tr><td align="left">!=</td><td align="left">不等于 - 比较两个对象是否不相等</td><td align="left">(a != b) 返回 True。</td></tr><tr><td align="left">&gt;</td><td align="left">大于 - 返回x是否大于y</td><td align="left">(a &gt; b) 返回 False。</td></tr><tr><td align="left">&lt;</td><td align="left">小于 - 返回x是否小于y。所有比较运算符返回1表示真，返回0表示假。这分别与特殊的变量True和False等价。注意，这些变量名的大写。</td><td align="left">(a &lt; b) 返回 True。</td></tr><tr><td align="left">&gt;=</td><td align="left">大于等于 - 返回x是否大于等于y。</td><td align="left">(a &gt;= b) 返回 False。</td></tr><tr><td align="left">&lt;=</td><td align="left">小于等于 - 返回x是否小于等于y。</td><td align="left">(a &lt;= b) 返回 True。</td></tr></tbody></table><p>以下实例演示了Python所有比较运算符的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">21</span>b <span class="token operator">=</span> <span class="token number">10</span>c <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">==</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 等于 b"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 不等于 b"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">!=</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 不等于 b"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 等于 b"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 小于 b"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 大于等于 b"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">></span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 大于 b"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 小于等于 b"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 修改变量 a 和 b 的值</span>a <span class="token operator">=</span> <span class="token number">5</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;=</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - a 小于等于 b"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - a 大于  b"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">>=</span> a <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - b 大于等于 a"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - b 小于 a"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：</p><pre class="line-numbers language-bash"><code class="language-bash">1 - a 不等于 b2 - a 不等于 b3 - a 大于等于 b4 - a 大于 b5 - a 小于等于 b6 - b 大于等于 a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-16-赋值运算符"><a href="#1-2-16-赋值运算符" class="headerlink" title="1.2.16 赋值运算符"></a>1.2.16 赋值运算符</h4><p>以下假设变量a为10，变量b为20：</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">=</td><td align="left">简单的赋值运算符</td><td align="left">c = a + b 将 a + b 的运算结果赋值为 c</td></tr><tr><td align="left">+=</td><td align="left">加法赋值运算符</td><td align="left">c += a 等效于 c = c + a</td></tr><tr><td align="left">-=</td><td align="left">减法赋值运算符</td><td align="left">c -= a 等效于 c = c - a</td></tr><tr><td align="left">*=</td><td align="left">乘法赋值运算符</td><td align="left">c *= a 等效于 c = c * a</td></tr><tr><td align="left">/=</td><td align="left">除法赋值运算符</td><td align="left">c /= a 等效于 c = c / a</td></tr><tr><td align="left">%=</td><td align="left">取模赋值运算符</td><td align="left">c %= a 等效于 c = c % a</td></tr><tr><td align="left">**=</td><td align="left">幂赋值运算符</td><td align="left">c **= a 等效于 c = c ** a</td></tr><tr><td align="left">//=</td><td align="left">取整除赋值运算符</td><td align="left">c //= a 等效于 c = c // a</td></tr><tr><td align="left">:=</td><td align="left">海象运算符，可在表达式内部为变量赋值。<strong>Python3.8 版本新增运算符</strong>。</td><td align="left">在这个示例中，赋值表达式可以避免调用 len() 两次:<code>if (n := len(a)) &gt; 10:    print(f&quot;List is too long (&#123;n&#125; elements, expected &lt;= 10)&quot;)</code></td></tr></tbody></table><p>以下实例演示了Python所有赋值运算符的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">21</span>b <span class="token operator">=</span> <span class="token number">10</span>c <span class="token operator">=</span> <span class="token number">0</span>c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">+=</span> a<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">*=</span> a<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">/=</span> a <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token number">2</span>c <span class="token operator">%=</span> a<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">**=</span> a<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">//=</span> a<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"7 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上示例输出结果：</p><pre class="line-numbers language-bash"><code class="language-bash">1 - c 的值为： 312 - c 的值为： 523 - c 的值为： 10924 - c 的值为： 52.05 - c 的值为： 26 - c 的值为： 20971527 - c 的值为： 99864<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-17-位运算符"><a href="#1-2-17-位运算符" class="headerlink" title="1.2.17 位运算符"></a>1.2.17 位运算符</h4><p>按位运算符是把数字看作二进制来进行计算的。Python中的按位运算法则如下：</p><p>下表中变量 a 为 60，b 为 13二进制格式如下：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">0011</span> <span class="token number">1100</span>b <span class="token operator">=</span> <span class="token number">0000</span> <span class="token number">1101</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>a<span class="token operator">&amp;</span>b <span class="token operator">=</span> <span class="token number">0000</span> <span class="token number">1100</span>a<span class="token operator">|</span>b <span class="token operator">=</span> <span class="token number">0011</span> <span class="token number">1101</span>a<span class="token operator">^</span>b <span class="token operator">=</span> <span class="token number">0011</span> <span class="token number">0001</span><span class="token operator">~</span>a  <span class="token operator">=</span> <span class="token number">1100</span> <span class="token number">0011</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">&amp;</td><td align="left">按位与运算符：参与运算的两个值,如果两个相应位都为1,则该位的结果为1,否则为0</td><td align="left">(a &amp; b) 输出结果 12 ，二进制解释： 0000 1100</td></tr><tr><td align="left">|</td><td align="left">按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</td><td align="left">(a | b) 输出结果 61 ，二进制解释： 0011 1101</td></tr><tr><td align="left">^</td><td align="left">按位异或运算符：当两对应的二进位相异时，结果为1</td><td align="left">(a ^ b) 输出结果 49 ，二进制解释： 0011 0001</td></tr><tr><td align="left">~</td><td align="left">按位取反运算符：对数据的每个二进制位取反,即把1变为0,把0变为1。**~x** 类似于 <strong>-x-1</strong></td><td align="left">(~a ) 输出结果 -61 ，二进制解释： 1100 0011， 在一个有符号二进制数的补码形式。</td></tr><tr><td align="left">&lt;&lt;</td><td align="left">左移动运算符：运算数的各二进位全部左移若干位，由”&lt;&lt;”右边的数指定移动的位数，高位丢弃，低位补0。</td><td align="left">a &lt;&lt; 2 输出结果 240 ，二进制解释： 1111 0000</td></tr><tr><td align="left">&gt;&gt;</td><td align="left">右移动运算符：把”&gt;&gt;”左边的运算数的各二进位全部右移若干位，”&gt;&gt;”右边的数指定移动的位数</td><td align="left">a &gt;&gt; 2 输出结果 15 ，二进制解释： 0000 1111</td></tr></tbody></table><p>以下实例演示了Python所有位运算符的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">60</span>            <span class="token comment" spellcheck="true"># 60 = 0011 1100 </span>b <span class="token operator">=</span> <span class="token number">13</span>            <span class="token comment" spellcheck="true"># 13 = 0000 1101 </span>c <span class="token operator">=</span> <span class="token number">0</span>c <span class="token operator">=</span> a <span class="token operator">&amp;</span> b        <span class="token comment" spellcheck="true"># 12 = 0000 1100</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">|</span> b        <span class="token comment" spellcheck="true"># 61 = 0011 1101 </span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">^</span> b        <span class="token comment" spellcheck="true"># 49 = 0011 0001</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token operator">~</span>a           <span class="token comment" spellcheck="true"># -61 = 1100 0011</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">&lt;&lt;</span> <span class="token number">2</span>       <span class="token comment" spellcheck="true"># 240 = 1111 0000</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>c <span class="token operator">=</span> a <span class="token operator">>></span> <span class="token number">2</span>       <span class="token comment" spellcheck="true"># 15 = 0000 1111</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：</p><pre class="line-numbers language-bash"><code class="language-bash">1 - c 的值为： 122 - c 的值为： 613 - c 的值为： 494 - c 的值为： -615 - c 的值为： 2406 - c 的值为： 15<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-18-逻辑运算符"><a href="#1-2-18-逻辑运算符" class="headerlink" title="1.2.18 逻辑运算符"></a>1.2.18 逻辑运算符</h4><p>Python语言支持逻辑运算符，以下假设变量 a 为 10, b为 20:</p><table><thead><tr><th align="left">运算符</th><th align="left">逻辑表达式</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">and</td><td align="left">x and y</td><td align="left">布尔”与” - 如果 x 为 False，x and y 返回 x 的值，否则返回 y 的计算值。</td><td align="left">(a and b) 返回 20。</td></tr><tr><td align="left">or</td><td align="left">x or y</td><td align="left">布尔”或” - 如果 x 是 True，它返回 x 的值，否则它返回 y 的计算值。</td><td align="left">(a or b) 返回 10。</td></tr><tr><td align="left">not</td><td align="left">not x</td><td align="left">布尔”非” - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。</td><td align="left">not(a and b) 返回 False</td></tr></tbody></table><p>示例：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">10</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">and</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 和 b 都为 true"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 和 b 有一个不为 true"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">or</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 a 和 b 都为 true，或其中一个变量为 true"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 a 和 b 都不为 true"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 修改变量 a 的值</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">and</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 和 b 都为 true"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 和 b 有一个不为 true"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">or</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - 变量 a 和 b 都为 true，或其中一个变量为 true"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - 变量 a 和 b 都不为 true"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token operator">not</span><span class="token punctuation">(</span> a <span class="token operator">and</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - 变量 a 和 b 都为 false，或其中一个变量为 false"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - 变量 a 和 b 都为 true"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token number">1</span> <span class="token operator">-</span> 变量 a 和 b 都为 true<span class="token number">2</span> <span class="token operator">-</span> 变量 a 和 b 都为 true，或其中一个变量为 true<span class="token number">3</span> <span class="token operator">-</span> 变量 a 和 b 有一个不为 true<span class="token number">4</span> <span class="token operator">-</span> 变量 a 和 b 都为 true，或其中一个变量为 true<span class="token number">5</span> <span class="token operator">-</span> 变量 a 和 b 都为 false，或其中一个变量为 false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-19-成员运算符"><a href="#1-2-19-成员运算符" class="headerlink" title="1.2.19 成员运算符"></a>1.2.19 成员运算符</h4><p>除了以上的一些运算符之外，Python还支持成员运算符，测试实例中包含了一系列的成员，包括字符串，列表或元组。</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">in</td><td align="left">如果在指定的序列中找到值返回 True，否则返回 False。</td><td align="left">x 在 y 序列中 , 如果 x 在 y 序列中返回 True。</td></tr><tr><td align="left">not in</td><td align="left">如果在指定的序列中没有找到值返回 True，否则返回 False。</td><td align="left">x 不在 y 序列中 , 如果 x 不在 y 序列中返回 True。</td></tr></tbody></table><p>以下实例演示了Python所有成员运算符的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">10</span>b <span class="token operator">=</span> <span class="token number">20</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">in</span> list <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 在给定的列表中 list 中"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 不在给定的列表中 list 中"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">not</span> <span class="token keyword">in</span> list <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 b 不在给定的列表中 list 中"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 b 在给定的列表中 list 中"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 修改变量 a 的值</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">in</span> list <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 在给定的列表中 list 中"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 不在给定的列表中 list 中"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：</p><pre class="line-numbers language-bash"><code class="language-bash">1 - 变量 a 不在给定的列表中 list 中2 - 变量 b 不在给定的列表中 list 中3 - 变量 a 在给定的列表中 list 中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="1-2-20-身份运算符"><a href="#1-2-20-身份运算符" class="headerlink" title="1.2.20 身份运算符"></a>1.2.20 身份运算符</h4><p>身份运算符用于比较两个对象的存储单元</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">is</td><td align="left">is 是判断两个标识符是不是引用自一个对象</td><td align="left"><strong>x is y</strong>, 类似 <strong>id(x) == id(y)</strong> , 如果引用的是同一个对象则返回 True，否则返回 False</td></tr><tr><td align="left">is not</td><td align="left">is not 是判断两个标识符是不是引用自不同对象</td><td align="left"><strong>x is not y</strong> ， 类似 **id(a) != id(b)**。如果引用的不是同一个对象则返回结果 True，否则返回 False。</td></tr></tbody></table><p><strong>注：</strong> <a href="https://www.runoob.com/python/python-func-id.html" rel="external nofollow noreferrer">id()</a> 函数用于获取对象内存地址。</p><p>以下实例演示了Python所有身份运算符的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">20</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">is</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> id<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 修改变量 b 的值</span>b <span class="token operator">=</span> <span class="token number">30</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">is</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">is</span> <span class="token operator">not</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：</p><pre class="line-numbers language-bash"><code class="language-bash">1 - a 和 b 有相同的标识2 - a 和 b 有相同的标识3 - a 和 b 没有相同的标识4 - a 和 b 没有相同的标识<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>is 与 == 区别：</p><p>is 用于判断两个变量引用对象是否为同一个， == 用于判断引用变量的值是否相等。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span>a <span class="token operator">=</span> <span class="token punctuation">[</span>1, 2, 3<span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a<span class="token operator">>></span><span class="token operator">></span> b is a True<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">==</span> aTrue<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a<span class="token punctuation">[</span>:<span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> b is aFalse<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">==</span> aTrue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-21-运算符优先级"><a href="#1-2-21-运算符优先级" class="headerlink" title="1.2.21 运算符优先级"></a>1.2.21 运算符优先级</h4><p>以下表格列出了从最高到最低优先级的所有运算符：</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">**</td><td align="left">指数 (最高优先级)</td></tr><tr><td align="left">~ + -</td><td align="left">按位翻转, 一元加号和减号 (最后两个的方法名为 +@ 和 -@)</td></tr><tr><td align="left">* / % //</td><td align="left">乘，除，求余数和取整除</td></tr><tr><td align="left">+ -</td><td align="left">加法减法</td></tr><tr><td align="left">&gt;&gt; &lt;&lt;</td><td align="left">右移，左移运算符</td></tr><tr><td align="left">&amp;</td><td align="left">位 ‘AND’</td></tr><tr><td align="left">^ |</td><td align="left">位运算符</td></tr><tr><td align="left">&lt;= &lt; &gt; &gt;=</td><td align="left">比较运算符</td></tr><tr><td align="left">== !=</td><td align="left">等于运算符</td></tr><tr><td align="left">= %= /= //= -= += *= **=</td><td align="left">赋值运算符</td></tr><tr><td align="left">is is not</td><td align="left">身份运算符</td></tr><tr><td align="left">in not in</td><td align="left">成员运算符</td></tr><tr><td align="left">not and or</td><td align="left">逻辑运算符</td></tr></tbody></table><p>以下实例演示了Python所有运算符优先级的操作：</p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">20</span>b <span class="token operator">=</span> <span class="token number">10</span>c <span class="token operator">=</span> <span class="token number">15</span>d <span class="token operator">=</span> <span class="token number">5</span>e <span class="token operator">=</span> <span class="token number">0</span>e <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> c <span class="token operator">/</span> d       <span class="token comment" spellcheck="true">#( 30 * 15 ) / 5</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"(a + b) * c / d 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span>e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> d     <span class="token comment" spellcheck="true"># (30 * 15 ) / 5</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"((a + b) * c) / d 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span>e <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>c <span class="token operator">/</span> d<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># (30) * (15/5)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"(a + b) * (c / d) 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span>e <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> d      <span class="token comment" spellcheck="true">#  20 + (150/5)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"a + (b * c) / d 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">(</span>a + b<span class="token punctuation">)</span> * c / d 运算结果为： 90.0<span class="token punctuation">((</span>a + b<span class="token punctuation">)</span> * c<span class="token punctuation">)</span> / d 运算结果为： 90.0<span class="token punctuation">(</span>a + b<span class="token punctuation">)</span> * <span class="token punctuation">(</span>c / d<span class="token punctuation">)</span> 运算结果为： 90.0a + <span class="token punctuation">(</span>b * c<span class="token punctuation">)</span> / d 运算结果为： 50.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>and 拥有更高优先级:</p><pre class="line-numbers language-python"><code class="language-python">x <span class="token operator">=</span> <span class="token boolean">True</span>y <span class="token operator">=</span> <span class="token boolean">False</span>z <span class="token operator">=</span> <span class="token boolean">False</span><span class="token keyword">if</span> x <span class="token operator">or</span> y <span class="token operator">and</span> z<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上实例输出结果：yes</p><p><strong>注意：</strong>Pyhton3 已不支持 &lt;&gt; 运算符，可以使用 != 代替</p><h4 id="练习1：实现数学公式的计算"><a href="#练习1：实现数学公式的计算" class="headerlink" title="练习1：实现数学公式的计算"></a>练习1：实现数学公式的计算</h4><ol><li> 分别求5和2之间的和、差、积、商（带小数）、商（取整）、余数，并将结果打印出来</li><li> 求半径为2.5的圆的面积，将结果打印出来</li></ol><p>参考框架</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#定义变量用于保存数字5和2</span>    <span class="token comment" spellcheck="true">#求得这两个变量的和、差、积、商、余数，并将结果打印</span>    <span class="token comment" spellcheck="true">#定义半径的变量</span>    <span class="token comment" spellcheck="true">#求圆的面积，将结果打印出来</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="练习2：学生管理系统1-0"><a href="#练习2：学生管理系统1-0" class="headerlink" title="练习2：学生管理系统1.0"></a>练习2：学生管理系统1.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，首先我们实现学生管理系统的1.0版本，主要功能有：1.定义变量，保存三个学生的学号、姓名、年龄、身高2.打印三个学生的信息3.求三个学生年龄和身高的平均值,且年龄精确到整数，身高精确到小数点两位数4.动态输入一个学生信息，使用变量保存，并打印</code></pre><p>​    </p><h3 id="1-3-Python控制语句"><a href="#1-3-Python控制语句" class="headerlink" title="1.3 Python控制语句"></a>1.3 Python控制语句</h3><h4 id="1-3-1-if语句"><a href="#1-3-1-if语句" class="headerlink" title="1.3.1 if语句"></a>1.3.1 if语句</h4><p><strong>简单if语法举例：</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>执行以上代码，会打印hello</p><p><strong>语法说明</strong></p><p><strong>if</strong>表示判断，而if后面冒号之前是判断的条件，如果为真则执行冒号后面的代码，否则不执行。</p><p><strong>if else语法举例：</strong></p><pre class="line-numbers language-python"><code class="language-python">var <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入1个数字: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> var<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件为真'</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件为假'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上使用input输入一个int类型的整数赋值给var，当var不为0时执行if后面的语句，否则执行else后面的语句，把以上代码拷贝到python源代码文件中，查看执行结果。</p><p><strong>if elif else语法举例：</strong></p><pre class="line-numbers language-python"><code class="language-python">score <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入1个分数: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> score <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'你要上天吗'</span><span class="token punctuation">)</span><span class="token keyword">elif</span> score <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'你是不是考了个寂寞'</span><span class="token punctuation">)</span><span class="token keyword">elif</span> score <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'一个鸭蛋？就很棒~'</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'你考了%d分'</span> <span class="token operator">%</span> score<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上使用input输入一个int类型的整数赋值给score，先执行if判断，分数如果大于100分，执行if后面的语句，否则再次进行下面的elif判断，如果满足则执行，否则继续elif判断，最后如果都不满足条件，会执行else中的代码。</p><p>试试拷贝以上的代码，放到源代码中执行，分析结果和你想象的是否一致。</p><p>*<em>练习：狗的年龄和对应人的年龄，公式为22+(age-2)<em>5，其中age为狗子的年龄</em></em></p><p>参考代码如下：</p><pre class="line-numbers language-python"><code class="language-python">age <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入你家狗子的年龄: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> age <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Are you kidding me!"</span><span class="token punctuation">)</span><span class="token keyword">elif</span> age <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"相当于 14 岁的人。"</span><span class="token punctuation">)</span><span class="token keyword">else</span> age <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>    human <span class="token operator">=</span> <span class="token number">22</span> <span class="token operator">+</span> <span class="token punctuation">(</span>age <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"相当于 % 岁的人。"</span><span class="token punctuation">,</span> human<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-3-2-while循环"><a href="#1-3-2-while循环" class="headerlink" title="1.3.2 while循环"></a>1.3.2 while循环</h4><p>语法规则</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">while</span> 判断条件：    执行语句<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>简单示例，计算1到10的加和：</p><pre class="line-numbers language-python"><code class="language-python">n <span class="token operator">=</span> <span class="token number">100</span>sum <span class="token operator">=</span> <span class="token number">0</span>counter <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">while</span> counter <span class="token operator">&lt;=</span> n<span class="token punctuation">:</span>    sum <span class="token operator">=</span> sum <span class="token operator">+</span> counter    counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1 到 %d 之和为: %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>练习，输入一个数字，直到猜到它为止</strong></p><p>以下是参考代码</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 该实例演示了数字猜谜游戏</span>number <span class="token operator">=</span> <span class="token number">7</span>guess <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数字猜谜游戏!"</span><span class="token punctuation">)</span><span class="token keyword">while</span> guess <span class="token operator">!=</span> number<span class="token punctuation">:</span>    guess <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入你猜的数字："</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> guess <span class="token operator">==</span> number<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"恭喜，你猜对了！"</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token keyword">elif</span> guess <span class="token operator">&lt;</span> number<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"猜的数字小了..."</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> guess <span class="token operator">></span> number<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"猜的数字大了..."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-3-3-for循环"><a href="#1-3-3-for循环" class="headerlink" title="1.3.3 for循环"></a>1.3.3 for循环</h4><p>语法：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> <span class="token operator">&lt;</span>variable<span class="token operator">></span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>sequence<span class="token operator">></span><span class="token punctuation">:</span>    <span class="token operator">&lt;</span>statements<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>语法：遍历列表sequence，并把每一次遍历的值赋值给variable，并执行statements语句</p><p>举例：</p><pre class="line-numbers language-python"><code class="language-python">fourKing <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"马斯克"</span><span class="token punctuation">,</span> <span class="token string">"巴菲特"</span><span class="token punctuation">,</span> <span class="token string">"马云"</span><span class="token punctuation">,</span> <span class="token string">"我"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> person <span class="token keyword">in</span> fourKing<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'四位的财富加起来已经超过了2万亿人民币'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="练习1：完成BMI指数"><a href="#练习1：完成BMI指数" class="headerlink" title="练习1：完成BMI指数"></a>练习1：完成BMI指数</h4><p>1、看看自己身体是否达标，并提示相关建议；</p><p>2、给定一组列表，完成对BMI的判断和建议提醒；</p><p>BMI指数：英文为Body Mass Index，简称BMI，是用体重千克数除以身高米数的平方得出的数字，以下是数据参考。</p><table><thead><tr><th>BMI 分类</th><th>WHO标准</th><th>亚洲标准</th><th>中国参考标准</th><th>相关疾病发病的危险性</th></tr></thead><tbody><tr><td>体重过低</td><td>BMI&lt;18.5</td><td>BMI&lt;18.5</td><td>BMI&lt;18.5</td><td>低（但其它疾病危险性增加）</td></tr><tr><td>正常范围</td><td>18.5≤BMI&lt;25</td><td>18.5≤BMI&lt;23</td><td>18.5≤BMI&lt;24</td><td>平均水平</td></tr><tr><td>超重</td><td>BMI≥25</td><td>BMI≥23</td><td>BMI≥24</td><td>增加</td></tr><tr><td>肥胖前期</td><td>25≤BMI&lt;30</td><td>23≤BMI&lt;25</td><td>24≤BMI&lt;28</td><td>增加</td></tr><tr><td>I度肥胖</td><td>30≤BMI&lt;35</td><td>25≤BMI&lt;30</td><td>28≤BMI&lt;30</td><td>中度增加</td></tr><tr><td>II度肥胖</td><td>35≤BMI&lt;40</td><td>30≤BMI&lt;40</td><td>30≤BMI&lt;40</td><td>严重增加</td></tr><tr><td>Ⅲ度肥胖</td><td>BMI≥40.0</td><td>BMI≥40.0</td><td>BMI≥40.0</td><td>非常严重增加</td></tr></tbody></table><p>亚洲人士体型对照表，上下10%均为正常。</p><p><strong>男子标准体重对照表（千克，厘米）</strong></p><table><thead><tr><th>年龄|身高</th><th>152</th><th>156</th><th>160</th><th>164</th><th>168</th><th>172</th><th>176</th><th>180</th><th>184</th><th>188</th></tr></thead><tbody><tr><td>19</td><td>51</td><td>53</td><td>54</td><td>55</td><td>57</td><td>60</td><td>62</td><td>65</td><td>69</td><td>72</td></tr><tr><td>21</td><td>51</td><td>53</td><td>54</td><td>55</td><td>57</td><td>60</td><td>62</td><td>65</td><td>69</td><td>72</td></tr><tr><td>23</td><td>52</td><td>53</td><td>55</td><td>56</td><td>58</td><td>60</td><td>63</td><td>66</td><td>70</td><td>73</td></tr><tr><td>25</td><td>52</td><td>54</td><td>55</td><td>57</td><td>59</td><td>61</td><td>63</td><td>67</td><td>70</td><td>74</td></tr><tr><td>27</td><td>52</td><td>54</td><td>55</td><td>57</td><td>59</td><td>61</td><td>64</td><td>67</td><td>70</td><td>74</td></tr><tr><td>29</td><td>53</td><td>55</td><td>56</td><td>57</td><td>59</td><td>61</td><td>64</td><td>67</td><td>70</td><td>74</td></tr><tr><td>31</td><td>53</td><td>55</td><td>56</td><td>58</td><td>60</td><td>62</td><td>65</td><td>68</td><td>72</td><td>75</td></tr><tr><td>33</td><td>54</td><td>56</td><td>57</td><td>58</td><td>60</td><td>63</td><td>65</td><td>68</td><td>72</td><td>75</td></tr><tr><td>35</td><td>54</td><td>56</td><td>57</td><td>59</td><td>61</td><td>63</td><td>66</td><td>69</td><td>72</td><td>76</td></tr><tr><td>37</td><td>55</td><td>56</td><td>58</td><td>59</td><td>61</td><td>63</td><td>66</td><td>69</td><td>73</td><td>76</td></tr><tr><td>39</td><td>55</td><td>57</td><td>58</td><td>60</td><td>61</td><td>64</td><td>66</td><td>70</td><td>74</td><td>77</td></tr><tr><td>41</td><td>55</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>43</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>45</td><td>56</td><td>57</td><td>59</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>47</td><td>56</td><td>58</td><td>59</td><td>61</td><td>63</td><td>65</td><td>67</td><td>71</td><td>75</td><td>78</td></tr><tr><td>49</td><td>56</td><td>58</td><td>59</td><td>61</td><td>63</td><td>65</td><td>68</td><td>71</td><td>75</td><td>78</td></tr><tr><td>51</td><td>57</td><td>58</td><td>59</td><td>61</td><td>63</td><td>65</td><td>68</td><td>71</td><td>75</td><td>78</td></tr><tr><td>53</td><td>57</td><td>58</td><td>59</td><td>61</td><td>63</td><td>65</td><td>68</td><td>71</td><td>75</td><td>78</td></tr><tr><td>55</td><td>56</td><td>58</td><td>59</td><td>61</td><td>63</td><td>65</td><td>68</td><td>71</td><td>75</td><td>78</td></tr><tr><td>57</td><td>56</td><td>57</td><td>59</td><td>60</td><td>62</td><td>65</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>59</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>61</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>63</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>65</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>67</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>69</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>64</td><td>67</td><td>70</td><td>74</td><td>77</td></tr><tr><td>年龄|身高cm</td><td>152</td><td>156</td><td>160</td><td>164</td><td>168</td><td>172</td><td>176</td><td>180</td><td>184</td><td>188</td></tr></tbody></table><p><strong>女子标准体重对照表 千克，厘米（参考）</strong></p><table><thead><tr><th>年龄|身高</th><th>152</th><th>156</th><th>160</th><th>162</th><th>164</th><th>166</th><th>168</th><th>170</th><th>172</th><th>176</th></tr></thead><tbody><tr><td>19</td><td>46</td><td>47</td><td>49</td><td>50</td><td>51</td><td>52</td><td>54</td><td>56</td><td>58</td><td>60</td></tr><tr><td>21</td><td>46</td><td>47</td><td>49</td><td>50</td><td>51</td><td>52</td><td>54</td><td>56</td><td>58</td><td>60</td></tr><tr><td>23</td><td>46</td><td>47</td><td>49</td><td>50</td><td>51</td><td>52</td><td>54</td><td>56</td><td>58</td><td>60</td></tr><tr><td>25</td><td>46</td><td>48</td><td>49</td><td>50</td><td>51</td><td>53</td><td>55</td><td>56</td><td>59</td><td>61</td></tr><tr><td>27</td><td>47</td><td>48</td><td>50</td><td>51</td><td>52</td><td>53</td><td>55</td><td>56</td><td>59</td><td>61</td></tr><tr><td>29</td><td>47</td><td>49</td><td>51</td><td>52</td><td>53</td><td>54</td><td>56</td><td>58</td><td>59</td><td>62</td></tr><tr><td>31</td><td>48</td><td>49</td><td>51</td><td>52</td><td>53</td><td>54</td><td>56</td><td>58</td><td>60</td><td>62</td></tr><tr><td>33</td><td>48</td><td>50</td><td>51</td><td>52</td><td>53</td><td>55</td><td>57</td><td>58</td><td>60</td><td>63</td></tr><tr><td>35</td><td>49</td><td>50</td><td>52</td><td>52</td><td>53</td><td>55</td><td>57</td><td>59</td><td>61</td><td>63</td></tr><tr><td>37</td><td>49</td><td>51</td><td>53</td><td>53</td><td>54</td><td>56</td><td>59</td><td>60</td><td>61</td><td>64</td></tr><tr><td>39</td><td>50</td><td>52</td><td>53</td><td>53</td><td>55</td><td>57</td><td>59</td><td>60</td><td>62</td><td>65</td></tr><tr><td>41</td><td>51</td><td>52</td><td>54</td><td>54</td><td>55</td><td>57</td><td>59</td><td>61</td><td>62</td><td>65</td></tr><tr><td>43</td><td>51</td><td>53</td><td>55</td><td>55</td><td>56</td><td>58</td><td>60</td><td>62</td><td>63</td><td>66</td></tr><tr><td>45</td><td>52</td><td>53</td><td>55</td><td>55</td><td>57</td><td>58</td><td>60</td><td>62</td><td>63</td><td>66</td></tr><tr><td>47</td><td>52</td><td>53</td><td>55</td><td>56</td><td>57</td><td>58</td><td>60</td><td>62</td><td>63</td><td>67</td></tr><tr><td>49</td><td>52</td><td>53</td><td>56</td><td>56</td><td>57</td><td>59</td><td>60</td><td>62</td><td>63</td><td>67</td></tr><tr><td>51</td><td>52</td><td>54</td><td>56</td><td>56</td><td>57</td><td>59</td><td>61</td><td>62</td><td>63</td><td>67</td></tr><tr><td>53</td><td>53</td><td>54</td><td>56</td><td>56</td><td>58</td><td>59</td><td>61</td><td>62</td><td>64</td><td>67</td></tr><tr><td>55</td><td>53</td><td>54</td><td>56</td><td>57</td><td>58</td><td>60</td><td>61</td><td>63</td><td>64</td><td>67</td></tr><tr><td>57</td><td>53</td><td>55</td><td>56</td><td>57</td><td>58</td><td>60</td><td>61</td><td>63</td><td>64</td><td>68</td></tr><tr><td>59</td><td>53</td><td>55</td><td>56</td><td>57</td><td>58</td><td>60</td><td>61</td><td>63</td><td>64</td><td>68</td></tr><tr><td>61</td><td>53</td><td>54</td><td>56</td><td>56</td><td>57</td><td>59</td><td>61</td><td>63</td><td>64</td><td>67</td></tr><tr><td>63</td><td>52</td><td>54</td><td>55</td><td>56</td><td>57</td><td>59</td><td>61</td><td>62</td><td>63</td><td>67</td></tr><tr><td>65</td><td>52</td><td>54</td><td>55</td><td>56</td><td>57</td><td>59</td><td>61</td><td>62</td><td>63</td><td>66</td></tr><tr><td>67</td><td>52</td><td>54</td><td>55</td><td>56</td><td>57</td><td>59</td><td>61</td><td>62</td><td>63</td><td>66</td></tr><tr><td>69</td><td>52</td><td>54</td><td>55</td><td>56</td><td>57</td><td>59</td><td>61</td><td>62</td><td>63</td><td>66</td></tr><tr><td>年龄|身高</td><td>152</td><td>156</td><td>160</td><td>162</td><td>164</td><td>166</td><td>168</td><td>170</td><td>172</td><td>176</td></tr></tbody></table><h4 id="练习2：学生管理系统2-0"><a href="#练习2：学生管理系统2-0" class="headerlink" title="练习2：学生管理系统2.0"></a>练习2：学生管理系统2.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在1.0的基础上，现在实现学生管理系统的2.0版本，主要功能有：1.计算三名同学身高的最大值、最小值2.动态输入N名学生的信息，并打印3.已知班级有50个学生，学号从100依次增加，即100~149，现要求:学号能被5整除的周一打扫卫生能被4整除的周二打扫（不包括周一打扫的）第一个能被5整除且能被3整除的学生为劳动委员请分别打印出周一打扫、周二打扫、劳动委员的学生学号</code></pre><h3 id="1-4-Python数据类型"><a href="#1-4-Python数据类型" class="headerlink" title="1.4 Python数据类型"></a>1.4 Python数据类型</h3><h4 id="1-4-1-标准数据类型"><a href="#1-4-1-标准数据类型" class="headerlink" title="1.4.1 标准数据类型"></a>1.4.1 标准数据类型</h4><p>Python3 中有六个标准的数据类型：</p><ul><li>  Number（数字）</li><li>  String（字符串）</li><li>  List（列表）</li><li>  Tuple（元组）</li><li>  Set（集合）</li><li>  Dictionary（字典）</li></ul><p>Python3 的六个标准数据类型中：</p><ul><li><p><strong>不可变数据（3 个）：</strong>Number（数字）、String（字符串）、Tuple（元组）；</p></li><li><p><strong>可变数据（3 个）：</strong>List（列表）、Dictionary（字典）、Set（集合）。</p></li></ul><h4 id="1-4-2-Number（数字）"><a href="#1-4-2-Number（数字）" class="headerlink" title="1.4.2 Number（数字）"></a>1.4.2 Number（数字）</h4><p>Python3 支持 <strong>int、float、bool、complex（复数）</strong>。</p><p>在Python 3里，只有一种整数类型 int，表示为长整型，没有 python2 中的 Long。</p><p>像大多数语言一样，数值类型的赋值和计算都是很直观的。</p><p>内置的 type() 函数可以用来查询变量所指的对象类型。</p><h4 id="1-4-3-String（字符串）"><a href="#1-4-3-String（字符串）" class="headerlink" title="1.4.3 String（字符串）"></a>1.4.3 String（字符串）</h4><p>字符串的基本可以参考上一节的Python基础语法部分，以下是字符串的内建函数：</p><table><thead><tr><th align="left">序号</th><th align="left">方法及描述</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-capitalize.html" rel="external nofollow noreferrer">capitalize()</a> 将字符串的第一个字符转换为大写</td></tr><tr><td align="left">2</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-center.html" rel="external nofollow noreferrer">center(width, fillchar)</a> 返回一个指定的宽度 width 居中的字符串，fillchar 为填充的字符，默认为空格。</td></tr><tr><td align="left">3</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-count.html" rel="external nofollow noreferrer">count(str, beg= 0,end=len(string))</a> 返回 str 在 string 里面出现的次数，如果 beg 或者 end 指定则返回指定范围内 str 出现的次数</td></tr><tr><td align="left">4</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-decode.html" rel="external nofollow noreferrer">bytes.decode(encoding=”utf-8”, errors=”strict”)</a> Python3 中没有 decode 方法，但我们可以使用 bytes 对象的 decode() 方法来解码给定的 bytes 对象，这个 bytes 对象可以由 str.encode() 来编码返回。</td></tr><tr><td align="left">5</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-encode.html" rel="external nofollow noreferrer">encode(encoding=’UTF-8’,errors=’strict’)</a> 以 encoding 指定的编码格式编码字符串，如果出错默认报一个ValueError 的异常，除非 errors 指定的是’ignore’或者’replace’</td></tr><tr><td align="left">6</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-endswith.html" rel="external nofollow noreferrer">endswith(suffix, beg=0, end=len(string))</a> 检查字符串是否以 obj 结束，如果beg 或者 end 指定则检查指定的范围内是否以 obj 结束，如果是，返回 True,否则返回 False.</td></tr><tr><td align="left">7</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-expandtabs.html" rel="external nofollow noreferrer">expandtabs(tabsize=8)</a> 把字符串 string 中的 tab 符号转为空格，tab 符号默认的空格数是 8 。</td></tr><tr><td align="left">8</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-find.html" rel="external nofollow noreferrer">find(str, beg=0, end=len(string))</a> 检测 str 是否包含在字符串中，如果指定范围 beg 和 end ，则检查是否包含在指定范围内，如果包含返回开始的索引值，否则返回-1</td></tr><tr><td align="left">9</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-index.html" rel="external nofollow noreferrer">index(str, beg=0, end=len(string))</a> 跟find()方法一样，只不过如果str不在字符串中会报一个异常。</td></tr><tr><td align="left">10</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isalnum.html" rel="external nofollow noreferrer">isalnum()</a> 如果字符串至少有一个字符并且所有字符都是字母或数字则返 回 True，否则返回 False</td></tr><tr><td align="left">11</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isalpha.html" rel="external nofollow noreferrer">isalpha()</a> 如果字符串至少有一个字符并且所有字符都是字母或中文字则返回 True, 否则返回 False</td></tr><tr><td align="left">12</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isdigit.html" rel="external nofollow noreferrer">isdigit()</a> 如果字符串只包含数字则返回 True 否则返回 False</td></tr><tr><td align="left">13</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-islower.html" rel="external nofollow noreferrer">islower()</a> 如果字符串中包含至少一个区分大小写的字符，并且所有这些(区分大小写的)字符都是小写，则返回 True，否则返回 False</td></tr><tr><td align="left">14</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isnumeric.html" rel="external nofollow noreferrer">isnumeric()</a> 如果字符串中只包含数字字符，则返回 True，否则返回 False</td></tr><tr><td align="left">15</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isspace.html" rel="external nofollow noreferrer">isspace()</a> 如果字符串中只包含空白，则返回 True，否则返回 False.</td></tr><tr><td align="left">16</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-istitle.html" rel="external nofollow noreferrer">istitle()</a> 如果字符串是标题化的(见 title())则返回 True，否则返回 False</td></tr><tr><td align="left">17</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isupper.html" rel="external nofollow noreferrer">isupper()</a> 如果字符串中包含至少一个区分大小写的字符，并且所有这些(区分大小写的)字符都是大写，则返回 True，否则返回 False</td></tr><tr><td align="left">18</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-join.html" rel="external nofollow noreferrer">join(seq)</a> 以指定字符串作为分隔符，将 seq 中所有的元素(的字符串表示)合并为一个新的字符串</td></tr><tr><td align="left">19</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-len.html" rel="external nofollow noreferrer">len(string)</a> 返回字符串长度</td></tr><tr><td align="left">20</td><td align="left">[ljust(width<a href="https://www.runoob.com/python3/python3-string-ljust.html" rel="external nofollow noreferrer">, fillchar])</a> 返回一个原字符串左对齐,并使用 fillchar 填充至长度 width 的新字符串，fillchar 默认为空格。</td></tr><tr><td align="left">21</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-lower.html" rel="external nofollow noreferrer">lower()</a> 转换字符串中所有大写字符为小写.</td></tr><tr><td align="left">22</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-lstrip.html" rel="external nofollow noreferrer">lstrip()</a> 截掉字符串左边的空格或指定字符。</td></tr><tr><td align="left">23</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-maketrans.html" rel="external nofollow noreferrer">maketrans()</a> 创建字符映射的转换表，对于接受两个参数的最简单的调用方式，第一个参数是字符串，表示需要转换的字符，第二个参数也是字符串表示转换的目标。</td></tr><tr><td align="left">24</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-max.html" rel="external nofollow noreferrer">max(str)</a> 返回字符串 str 中最大的字母。</td></tr><tr><td align="left">25</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-min.html" rel="external nofollow noreferrer">min(str)</a> 返回字符串 str 中最小的字母。</td></tr><tr><td align="left">26</td><td align="left">[replace(old, new <a href="https://www.runoob.com/python3/python3-string-replace.html" rel="external nofollow noreferrer">, max])</a> 把 将字符串中的 old 替换成 new,如果 max 指定，则替换不超过 max 次。</td></tr><tr><td align="left">27</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-rfind.html" rel="external nofollow noreferrer">rfind(str, beg=0,end=len(string))</a> 类似于 find()函数，不过是从右边开始查找.</td></tr><tr><td align="left">28</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-rindex.html" rel="external nofollow noreferrer">rindex( str, beg=0, end=len(string))</a> 类似于 index()，不过是从右边开始.</td></tr><tr><td align="left">29</td><td align="left">[rjust(width,<a href="https://www.runoob.com/python3/python3-string-rjust.html" rel="external nofollow noreferrer">, fillchar])</a> 返回一个原字符串右对齐,并使用fillchar(默认空格）填充至长度 width 的新字符串</td></tr><tr><td align="left">30</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-rstrip.html" rel="external nofollow noreferrer">rstrip()</a> 删除字符串字符串末尾的空格.</td></tr><tr><td align="left">31</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-split.html" rel="external nofollow noreferrer">split(str=””, num=string.count(str))</a> 以 str 为分隔符截取字符串，如果 num 有指定值，则仅截取 num+1 个子字符串</td></tr><tr><td align="left">32</td><td align="left">[splitlines(<a href="https://www.runoob.com/python3/python3-string-splitlines.html" rel="external nofollow noreferrer">keepends])</a> 按照行(‘\r’, ‘\r\n’, \n’)分隔，返回一个包含各行作为元素的列表，如果参数 keepends 为 False，不包含换行符，如果为 True，则保留换行符。</td></tr><tr><td align="left">33</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-startswith.html" rel="external nofollow noreferrer">startswith(substr, beg=0,end=len(string))</a> 检查字符串是否是以指定子字符串 substr 开头，是则返回 True，否则返回 False。如果beg 和 end 指定值，则在指定范围内检查。</td></tr><tr><td align="left">34</td><td align="left">[strip(<a href="https://www.runoob.com/python3/python3-string-strip.html" rel="external nofollow noreferrer">chars])</a> 在字符串上执行 lstrip()和 rstrip()</td></tr><tr><td align="left">35</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-swapcase.html" rel="external nofollow noreferrer">swapcase()</a> 将字符串中大写转换为小写，小写转换为大写</td></tr><tr><td align="left">36</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-title.html" rel="external nofollow noreferrer">title()</a> 返回”标题化”的字符串,就是说所有单词都是以大写开始，其余字母均为小写(见 istitle())</td></tr><tr><td align="left">37</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-translate.html" rel="external nofollow noreferrer">translate(table, deletechars=””)</a> 根据 str 给出的表(包含 256 个字符)转换 string 的字符, 要过滤掉的字符放到 deletechars 参数中</td></tr><tr><td align="left">38</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-upper.html" rel="external nofollow noreferrer">upper()</a> 转换字符串中的小写字母为大写</td></tr><tr><td align="left">39</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-zfill.html" rel="external nofollow noreferrer">zfill (width)</a> 返回长度为 width 的字符串，原字符串右对齐，前面填充0</td></tr><tr><td align="left">40</td><td align="left"><a href="https://www.runoob.com/python3/python3-string-isdecimal.html" rel="external nofollow noreferrer">isdecimal()</a> 检查字符串是否只包含十进制字符，如果是返回 true，否则返回 false。</td></tr></tbody></table><h4 id="1-4-4-List（列表）"><a href="#1-4-4-List（列表）" class="headerlink" title="1.4.4 List（列表）"></a>1.4.4 List（列表）</h4><p>例子：</p><pre class="line-numbers language-python"><code class="language-python">list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">]</span>list2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span>list3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上的值中括号开始，中括号结束，其中有多个元素，以逗号隔开，其中的数据可以是任意类型，</p><p>访问方式可以使用数据下标的方式，比如print(list3[1])打印的是list3中下标为1的数据green，试着打印一下list1中第二个数据Python</p><p>列表元素的增删改查</p><table><thead><tr><th>方法</th><th>示例</th><th>结果</th></tr></thead><tbody><tr><td>append增加元素</td><td>lists = [‘Hello’, ‘Python’]<br/>lists.append(100)<br/>print(lists)</td><td>[‘Hello’, ‘Python’, 100]</td></tr><tr><td>del删除元素</td><td>lists = [‘Hello’, ‘Python’]<br/>del lists[1]<br/>print(lists)</td><td>[‘Hello’]</td></tr><tr><td>insert插入修改元素</td><td>lists = [‘Hello’, ‘Python’]<br/>del lists[1]<br/>print(lists)</td><td>[‘Hello’, 100, ‘Python’]</td></tr><tr><td>index查找元素</td><td>lists = [‘Hello’, ‘Python’]<br/>index = lists.index(‘Python’)<br/>print(index)</td><td>1</td></tr></tbody></table><p>列表常用函数</p><table><thead><tr><th align="left">序号</th><th align="left">函数</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-len.html" rel="external nofollow noreferrer">len(list)</a> 列表元素个数</td></tr><tr><td align="left">2</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-max.html" rel="external nofollow noreferrer">max(list)</a> 返回列表元素最大值</td></tr><tr><td align="left">3</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-min.html" rel="external nofollow noreferrer">min(list)</a> 返回列表元素最小值</td></tr><tr><td align="left">4</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-list.html" rel="external nofollow noreferrer">list(seq)</a> 将元组转换为列表</td></tr></tbody></table><p>列表常用方法</p><table><thead><tr><th align="left">序号</th><th align="left">方法</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-append.html" rel="external nofollow noreferrer">list.append(obj)</a> 在列表末尾添加新的对象</td></tr><tr><td align="left">2</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-count.html" rel="external nofollow noreferrer">list.count(obj)</a> 统计某个元素在列表中出现的次数</td></tr><tr><td align="left">3</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-extend.html" rel="external nofollow noreferrer">list.extend(seq)</a> 在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）</td></tr><tr><td align="left">4</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-index.html" rel="external nofollow noreferrer">list.index(obj)</a> 从列表中找出某个值第一个匹配项的索引位置</td></tr><tr><td align="left">5</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-insert.html" rel="external nofollow noreferrer">list.insert(index, obj)</a> 将对象插入列表</td></tr><tr><td align="left">6</td><td align="left">[list.pop(<a href="https://www.runoob.com/python3/python3-att-list-pop.html" rel="external nofollow noreferrer">index=-1])</a> 移除列表中的一个元素（默认最后一个元素），并且返回该元素的值</td></tr><tr><td align="left">7</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-remove.html" rel="external nofollow noreferrer">list.remove(obj)</a> 移除列表中某个值的第一个匹配项</td></tr><tr><td align="left">8</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-reverse.html" rel="external nofollow noreferrer">list.reverse()</a> 反向列表中元素</td></tr><tr><td align="left">9</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-sort.html" rel="external nofollow noreferrer">list.sort( key=None, reverse=False)</a> 对原列表进行排序</td></tr><tr><td align="left">10</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-clear.html" rel="external nofollow noreferrer">list.clear()</a> 清空列表</td></tr><tr><td align="left">11</td><td align="left"><a href="https://www.runoob.com/python3/python3-att-list-copy.html" rel="external nofollow noreferrer">list.copy()</a> 复制列表</td></tr></tbody></table><h4 id="1-4-5-Tuple（元组）"><a href="#1-4-5-Tuple（元组）" class="headerlink" title="1.4.5 Tuple（元组）"></a>1.4.5 Tuple（元组）</h4><p>Python 的元组与列表类似，不同之处在于元组的元素不能修改，并且元组使用小括号 ( )，列表使用方括号 [ ]。</p><p>把以上列表的[]改成()就被当作元组了</p><pre class="line-numbers language-python"><code class="language-python">list1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>list2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>list3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>元组中的数据不可改变，因此尝试下list1[2] = 1000，看看会不会有问题，再把list1改成列表试试。</p><h4 id="1-4-6-Set（集合）"><a href="#1-4-6-Set（集合）" class="headerlink" title="1.4.6 Set（集合）"></a>1.4.6 Set（集合）</h4><p>集合（set）是一个无序的不重复元素序列。</p><p>可以使用大括号 <strong>{ }</strong> 或者 <strong>set()</strong> 函数创建集合，注意：创建一个空集合使用 <strong>set()</strong> 而不是 <strong>{ }**， **{ }</strong> 用来创建一个空的字典。</p><pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出结果</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">{</span><span class="token string">'h'</span>, <span class="token string">'l'</span>, <span class="token string">'o'</span>, <span class="token string">'e'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>需要注意的是，输出的结果每次并不相同，并且’l’字符只打印了一次。这也证明了set集合是一个无需不重复的元素序列。</p><p><strong>集合的运算</strong></p><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'abracadabra'</span><span class="token punctuation">)</span>b <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'alacazam'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># 输出{'a', 'r', 'b', 'c', 'd'}</span><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 集合a中包含而集合b中不包含的元素, 输出{'r', 'd', 'b'}</span><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 集合a或b中包含的所有元素, {'a', 'c', 'r', 'd', 'b', 'm', 'z', 'l'}</span><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 集合a和b中都包含了的元素, {'a', 'c'}</span><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 不同时包含于a和b的元素, {'r', 'd', 'b', 'm', 'z', 'l'}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>集合的方法</strong></p><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-add.html" rel="external nofollow noreferrer">add()</a></td><td align="left">为集合添加元素</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-clear.html" rel="external nofollow noreferrer">clear()</a></td><td align="left">移除集合中的所有元素</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-copy.html" rel="external nofollow noreferrer">copy()</a></td><td align="left">拷贝一个集合</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-difference.html" rel="external nofollow noreferrer">difference()</a></td><td align="left">返回多个集合的差集</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-difference_update.html" rel="external nofollow noreferrer">difference_update()</a></td><td align="left">移除集合中的元素，该元素在指定的集合也存在。</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-discard.html" rel="external nofollow noreferrer">discard()</a></td><td align="left">删除集合中指定的元素</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-intersection.html" rel="external nofollow noreferrer">intersection()</a></td><td align="left">返回集合的交集</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-intersection_update.html" rel="external nofollow noreferrer">intersection_update()</a></td><td align="left">返回集合的交集。</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-isdisjoint.html" rel="external nofollow noreferrer">isdisjoint()</a></td><td align="left">判断两个集合是否包含相同的元素，如果没有返回 True，否则返回 False。</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-issubset.html" rel="external nofollow noreferrer">issubset()</a></td><td align="left">判断指定集合是否为该方法参数集合的子集。</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-issuperset.html" rel="external nofollow noreferrer">issuperset()</a></td><td align="left">判断该方法的参数集合是否为指定集合的子集</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-pop.html" rel="external nofollow noreferrer">pop()</a></td><td align="left">随机移除元素</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-remove.html" rel="external nofollow noreferrer">remove()</a></td><td align="left">移除指定元素</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-symmetric_difference.html" rel="external nofollow noreferrer">symmetric_difference()</a></td><td align="left">返回两个集合中不重复的元素集合。</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-symmetric_difference_update.html" rel="external nofollow noreferrer">symmetric_difference_update()</a></td><td align="left">移除当前集合中在另外一个指定集合相同的元素，并将另外一个指定集合中不同的元素插入到当前集合中。</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-union.html" rel="external nofollow noreferrer">union()</a></td><td align="left">返回两个集合的并集</td></tr><tr><td align="left"><a href="https://www.runoob.com/python3/ref-set-update.html" rel="external nofollow noreferrer">update()</a></td><td align="left">给集合添加元素</td></tr></tbody></table><p><strong>使用举例</strong></p><p>add添加元素</p><pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'Language'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出为{‘Language’, ‘Hello’, ‘Python’}</p><p>remove删除元素</p><pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'Python'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出为{‘Hello’}</p><p>计算集合长度</p><pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出为2</p><p>判断元素是否在集合中</p><pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Python'</span> <span class="token keyword">in</span> s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出为True</p><h4 id="1-4-7-Dictionary（字典）"><a href="#1-4-7-Dictionary（字典）" class="headerlink" title="1.4.7 Dictionary（字典）"></a>1.4.7 Dictionary（字典）</h4><p>字典是key和value的成对数据类型，可以理解为每一个值value都有一个名字key，使用方法如下：</p><pre class="line-numbers language-python"><code class="language-python">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span> <span class="token punctuation">:</span> <span class="token string">'黄飞鸿'</span><span class="token punctuation">,</span> <span class="token string">'技能'</span> <span class="token punctuation">:</span> <span class="token string">'无影脚'</span><span class="token punctuation">,</span> <span class="token string">'武力值'</span> <span class="token punctuation">:</span> <span class="token number">99</span> <span class="token punctuation">}</span><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>d是一个字典，使用{}，其中的元素以逗号作为分割，逗号分隔的就是key:value键值对，key必须是<strong>不重复不可改变的类型</strong>，而值可以是Python支持的任意数据类型。</p><p>也可以使用关键的key访问，比如访问name,可以写为d[‘name’]，得到的结果是’黄飞鸿’，尝试使用这种方法打印其他的值。</p><p>Python字典包含了以下内置函数：</p><table><thead><tr><th align="left">序号</th><th align="left">函数及描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">len(dict) 计算字典元素个数，即键的总数。</td><td align="left"><code>&gt;&gt;&gt; dict = &#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Age&#39;: 7, &#39;Class&#39;: &#39;First&#39;&#125; &gt;&gt;&gt; len(dict) 3</code></td></tr><tr><td align="left">2</td><td align="left">str(dict) 输出字典，以可打印的字符串表示。</td><td align="left"><code>&gt;&gt;&gt; dict = &#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Age&#39;: 7, &#39;Class&#39;: &#39;First&#39;&#125; &gt;&gt;&gt; str(dict) &quot;&#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Class&#39;: &#39;First&#39;, &#39;Age&#39;: 7&#125;&quot;</code></td></tr><tr><td align="left">3</td><td align="left">type(variable) 返回输入的变量类型，如果变量是字典就返回字典类型。</td><td align="left"><code>&gt;&gt;&gt; dict = &#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Age&#39;: 7, &#39;Class&#39;: &#39;First&#39;&#125; &gt;&gt;&gt; type(dict) &lt;class &#39;dict&#39;&gt;</code></td></tr></tbody></table><p>Python字典包含了以下内置方法：</p><table><thead><tr><th align="left">序号</th><th align="left">函数及描述</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">radiansdict.clear()删除字典内所有元素</td></tr><tr><td align="left">2</td><td align="left">radiansdict.copy()返回一个字典的浅复制</td></tr><tr><td align="left">3</td><td align="left">radiansdict.fromkeys()创建一个新字典，以序列seq中元素做字典的键，val为字典所有键对应的初始值</td></tr><tr><td align="left">4</td><td align="left">radiansdict.get(key, default=None) 返回指定键的值，如果键不在字典中返回 default 设置的默认值</td></tr><tr><td align="left">5</td><td align="left">key in dict 如果键在字典dict里返回true，否则返回false</td></tr><tr><td align="left">6</td><td align="left">radiansdict.items() 以列表返回可遍历的(键, 值) 元组数组</td></tr><tr><td align="left">7</td><td align="left">radiansdict.keys() 返回一个迭代器，可以使用 list() 来转换为列表</td></tr><tr><td align="left">8</td><td align="left">radiansdict.setdefault(key, default=None) 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default</td></tr><tr><td align="left">9</td><td align="left">radiansdict.update(dict2) 把字典dict2的键/值对更新到dict里</td></tr><tr><td align="left">10</td><td align="left">radiansdict.values() 返回一个迭代器，可以使用 list() 来转换为列表</td></tr><tr><td align="left">11</td><td align="left">[pop(key[,default]) 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</td></tr><tr><td align="left">12</td><td align="left">popitem() 随机返回并删除字典中的最后一对键和值。</td></tr></tbody></table><h4 id="练习：学生管理系统3-0"><a href="#练习：学生管理系统3-0" class="headerlink" title="练习：学生管理系统3.0"></a>练习：学生管理系统3.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在2.0的基础上，现在实现学生管理系统的3.0版本，主要功能有：1.以列表的形式存储三位同学的信息，并打印2.对同学“tom”进行增删改查操作3.将所有同学信息存储与列表中,并打印所有学生信息4.新增一个同学到学生列表中5.修改学生列表中的数据6.从学生列表中删除某个同学信息7.根据条件查找所有符合条件的同学信息8.改用字典保存一个同学的信息，将所有同学的信息保存于列表中,并打印</code></pre><h3 id="1-5-Python模块化设计"><a href="#1-5-Python模块化设计" class="headerlink" title="1.5 Python模块化设计"></a>1.5 Python模块化设计</h3><h4 id="1-5-1-函数"><a href="#1-5-1-函数" class="headerlink" title="1.5.1 函数"></a>1.5.1 函数</h4><p>函数可看作一个工具，你告诉它要干什么，它会听话的帮你把事情办好，得到你要的结果。</p><p>你告诉它可以表示成<strong>输入</strong>，把事情办好是<strong>功能模块</strong>，得到结果表示为<strong>输出</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210315222343.jpg" alt="img"></p><p>例如，我们希望有这么一个工具，告诉它两个数，希望得到他们的乘积，那么使用python可以这么写：</p><pre class="line-numbers language-python"><code class="language-python">result <span class="token operator">=</span> multip<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>result = multip(10, 20)表示<strong>输入</strong>10, 20两个数给multip这个<strong>功能模块</strong>，然后功能模块的输出结果赋值给result。在开发语言中这个过程叫做<strong>函数的调用</strong>。</p><p>函数的调用即是指通过传递给函数输入参数，比如以上传递的输入参数是10和20，完成函数代码执行的过程。</p><p>由于我们希望提供的两个输入完成的是<strong>乘积的功能</strong>，因此函数multip的功能模块代码可以如下定义：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">multip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> a<span class="token operator">*</span>b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>以上是一个函数的功能模块的定义语法，def为关键字，multip为函数的名字，()中表示传递进来的输入参数，冒号后面的是函数要执行的代码，a*b表示对两个输入参数做了乘积，return表示返回乘积的结果。</p><p>完整的代码如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 定义函数</span><span class="token keyword">def</span> <span class="token function">multip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> a<span class="token operator">*</span>b<span class="token comment" spellcheck="true"># 调用函数并输出结果</span>result <span class="token operator">=</span> multip<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码会从<code>result = multip(10, 20)</code>这一行开始执行，然后通过multip(10, 20)这个函数调用，执行到第一行和第二行的代码，最后通过return把结果返回给result，并通过print(result)打印出最终的结果。</p><p>通过multip这个函数，我们可以提供任意的两个数值给它，让它帮我们完成两个数的乘积。</p><p>使用函数和习惯函数方式的编程是一个好的开始，因为我们并不希望为了做一些事情，还要把事情所依赖的基础也重新做一遍，而函数的好处在于同类的事情只要实现一次即可，下次再遇到同类的问题，就可以通过调用函数来解决，这就好比现实中的工具一样，给我们带来了编程的方便。</p><h4 id="1-5-2-函数默认参数"><a href="#1-5-2-函数默认参数" class="headerlink" title="1.5.2 函数默认参数"></a>1.5.2 函数默认参数</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">printInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"你好%s,年龄为：%d岁"</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    printInfo<span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>    printInfo<span class="token punctuation">(</span><span class="token string">"terry"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到printInfo需要两个参数，但第二个参数age有一个默认的赋值为30，这个表示当函数调用没有提供第二个参数的时候，age的值默认为0，如printInfo(“terry”)，打印的结果为你好terry,年龄为：<strong>30</strong>岁</p><h4 id="1-5-3-函数不定参数"><a href="#1-5-3-函数不定参数" class="headerlink" title="1.5.3 函数不定参数"></a>1.5.3 函数不定参数</h4><p>有这么一种情况，输入的参数可能不是固定的，比如说计算一天内花了多少笔钱，3顿饭，水果，饮料，打车等等，每天都不一样，怎么定义这样一个函数呢？</p><p>我们假设</p><p>第一天早饭10块钱，午饭20块钱，晚饭10块钱，苹果3块钱，纸巾3块钱；</p><p>第二天早饭8块钱，午饭12块钱，晚饭8块钱，香蕉2块钱，打车20块钱，饮料10块钱；</p><p>那么第一天是5个参数，第二天则多了一个是6个参数，使用函数的代码实现如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 不定参数的函数定义，在参数前面的*表示输入的参数都存放在money中</span><span class="token keyword">def</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token operator">*</span>money<span class="token punctuation">)</span><span class="token punctuation">:</span>    all <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> one <span class="token keyword">in</span> money<span class="token punctuation">:</span>        all<span class="token operator">+=</span>one    <span class="token keyword">return</span> allday1Spend <span class="token operator">=</span> cost<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 5个参数</span>day2Spend <span class="token operator">=</span> cost<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 6个参数</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第一天花费了%d'</span> <span class="token operator">%</span> day1Spend<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第二天花费了%d'</span> <span class="token operator">%</span> day2Spend<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="练习：学生管理系统4-0"><a href="#练习：学生管理系统4-0" class="headerlink" title="练习：学生管理系统4.0"></a>练习：学生管理系统4.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在3.0的基础上，现在实现学生管理系统的4.0版本，主要功能有：实现学生管理系统的增删改查功能，每个功能使用函数封装(1)显示所有学生信息(2)新增一个学生信息(3)修改学生的年龄(4)根据学号删除学生(5)按照姓名查找(6)按照学号进行升序和降序排列(7)功能菜单：该功能菜单供用户选择相应功能，调用上述不同功能模块(8)数据从文件中读取（选做）(9)将数据保存到文件中（选做）</code></pre><h4 id="1-5-4-类"><a href="#1-5-4-类" class="headerlink" title="1.5.4 类"></a>1.5.4 类</h4><p>之前学习的函数只负责某个功能模块，而人类的习惯中总是以类别来区分。比如说看到一个人，可能只看一眼，就能大概描绘出这个人的身高、体型、穿着打扮、年龄性别等信息。</p><p>函数是为了完成某个功能而设计，而为了完成这些同类信息的整体描述，在计算机中定义了类这个概念，以下是这个类定义大概的样子：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age        self<span class="token punctuation">.</span>sex <span class="token operator">=</span> sex    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 定义info函数，类中的函数称为方法</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这个人大概是%s,年龄差不多%d"</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中class是类的修饰符，Person是类的名字，在类中有一个构造函数<code>__init__</code>，info是这个类中定义的函数，一般在类中叫做类的方法。</p><p>构造函数<code>__init__</code>是干嘛的呢，我们要先想下这个类Person能干嘛呢，Person看名字就是为了定义人的，只不过每一个人都不一样，因此可以借助这个Person模板，传递不同的参数来达到对不同人描述的效果。</p><p>那怎么描述不同的人呢，通过上一节的学习我们知道可以通过传递参数来获取不同的参数，类也是这样，通过定义这么一个特殊的函数<code>__init__</code>，并允许用户传递自己的参数，从而实现不同信息人的描述的。</p><p>比如上面的代码中<code>__init__</code>可以传递age和sex，表示不同人的年龄和性别。</p><p>那<code>self</code>又是干嘛的呢？self代表自己，我们已经直到Person只是个模板，当描述不同人的时候，每一个人都会有一个age和sex，那么这个self就指代的是他自己的age和sex变量了。</p><p>其中info表示类Person中的方法，可以通过这种方式完善Person这个功能模板。</p><h4 id="1-5-5-对象"><a href="#1-5-5-对象" class="headerlink" title="1.5.5 对象"></a>1.5.5 对象</h4><p>对象是对类的实例化。Person只是个模板，为了描述不同的人，就需要把模板实例化为对象，从而对不同的人进行描述。怎么实例化呢？如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age        self<span class="token punctuation">.</span>sex <span class="token operator">=</span> sex        self<span class="token punctuation">.</span>status <span class="token operator">=</span> status    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 定义info函数，类中的函数称为方法</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这个人大概是%s, 年龄差不多%d, 目前%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">,</span> self<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token string">'已婚'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 实例化</span>    xiaohong <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">,</span> <span class="token string">'单身'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 实例化</span>    zhangsan<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment" spellcheck="true"># 调用方法</span>    xiaohong<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment" spellcheck="true"># 调用方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>10行和11行实例化了两个Person对象，分别叫zhangsan和xiaohong，并传递了三个参数，这个调用过程默认调用了参数匹配的<code>__init__</code>构造函数，这样这两个对象都拥有了自己的age,sex和status。</p><p>12行和13行分别通过对象名称调用其中的方法info，打印除了属于自己的age、sex、status属性。</p><h4 id="1-5-6-对象的私有属性和私有方法"><a href="#1-5-6-对象的私有属性和私有方法" class="headerlink" title="1.5.6 对象的私有属性和私有方法"></a>1.5.6 对象的私有属性和私有方法</h4><p>以上的zhangsan是一个对象，我们可以通过访问其中的属性sex来改变他zhangsan的性别，如：</p><pre class="line-numbers language-python"><code class="language-python">zhangsan<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'女'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样，zhangsan的性别就被随意更改了，有时候并不希望数据被意外更改，</p><p>因此<strong>Python规定属性和方法前面增加两个下划线，以防止被意外更改，从而变成了私有的属性和方法</strong>。</p><p>那怎么访问呢？不能通过zhangsan后面加点的方式访问了，私有的也只能通过共有的方法访问了，保证了数据安全。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>    <span class="token keyword">def</span> <span class="token function">__info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                   <span class="token comment" spellcheck="true"># __info为私有方法，不可以通过对象直接访问</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是一个私有的方法'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问方法如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>    <span class="token keyword">def</span> <span class="token function">__info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                   <span class="token comment" spellcheck="true"># __info为私有方法，不可以通过对象直接访问</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是一个私有的方法'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 实例化</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>_Person__age<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 访问对象的私有属性</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>_Person__info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 访问对象的私有方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-5-7-类的静态属性"><a href="#1-5-7-类的静态属性" class="headerlink" title="1.5.7 类的静态属性"></a>1.5.7 类的静态属性</h4><p>类的静态属性是在<code>__init__</code>构造函数之外定义的，如以下参考代码第二行total静态属性的定义。</p><p>静态属性访问规则：</p><ul><li>使用对象只读访问；</li><li>使用类名读写访问；</li><li>所有类的对象共享同一个静态属性；</li></ul><p>参考代码</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    total <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 实例化</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>total<span class="token punctuation">)</span>               <span class="token comment" spellcheck="true"># 对象可以访问类的静态变量total</span>    zhangsan<span class="token punctuation">.</span>total <span class="token operator">=</span> <span class="token number">1</span>                  <span class="token comment" spellcheck="true"># 对象不可以修改类的静态变量total</span>    Person<span class="token punctuation">.</span>total <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>total<span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true"># 类可以修改类的静态变量total</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>total<span class="token punctuation">)</span>               <span class="token comment" spellcheck="true"># 对象访问到修改后的静态变量，说明访问的是同一个total，是共享的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第9行输出0，第10行是有错误的，说明对象访问静态属性是只读的；</p><p>第11行通过类名对静态属性做了修改，第12行输出了修改后的值，说明类访问静态属性total是读写的权限；</p><p>第13行通过对象访问total是1，说明对象可以看到类修改后的静态属性total，使用的是同一个total，说明静态属性是共享的；</p><h4 id="1-5-8-类的静态方法"><a href="#1-5-8-类的静态方法" class="headerlink" title="1.5.8 类的静态方法"></a>1.5.8 类的静态方法</h4><p>通过对静态属性的了解，不难发现静态属性是属于类的，所有对象也都可以使用，只不过是只读的，这也是针对某些特殊需求是有帮助的。</p><p>那么<strong>类的静态方法</strong>又是个啥呢？没错和静态属性类似，也可以认为是属于类的，所有对象都可以调用，只不过静态方法既然属于类，就只能访问静态属性，而不能访问对象的私有属性了。</p><p>使用方法：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    total <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>    @staticmethod                       <span class="token comment" spellcheck="true"># 静态方法的申明</span>    <span class="token keyword">def</span> <span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> Person<span class="token punctuation">.</span>total<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 实例化</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>getTotal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true"># 对象静态方法的访问</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>getTotal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 类静态方法的访问</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上通过第6行把getTotal定义成了一个类的静态方法，这个静态方法返回一个静态属性total；</p><p>12行是通过对象访问静态方法的例子；</p><p>13行是通过类访问静态方法的例子；</p><h4 id="1-5-9-类的构造函数和析构函数"><a href="#1-5-9-类的构造函数和析构函数" class="headerlink" title="1.5.9 类的构造函数和析构函数"></a>1.5.9 类的构造函数和析构函数</h4><p>构造函数：<code>__init__()</code>是用于初始对象的，为对象的属性设置默认值；</p><p>析构函数：<code>__del__()</code>是释放对象占用的资源的，Python默认会有析构函数，程序中也可以主动提供；</p><p>语法如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment" spellcheck="true">#构造函数，建立对象时自动调用</span>    self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    self<span class="token punctuation">.</span>sex <span class="token operator">=</span> sex       <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>              <span class="token comment" spellcheck="true">#析构函数，释放对象时自动调用</span>    self<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">""</span>    self<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-5-10-继承"><a href="#1-5-10-继承" class="headerlink" title="1.5.10 继承"></a>1.5.10 继承</h4><p>继承的意思是我写了一个新的<strong>类B</strong>，发现和之前的一个<strong>类A</strong>很像，并发现<strong>类A</strong>可以是<strong>类B</strong>的一部分，那就可以省点心，编写类B时，和类A一样的部分直接继承类A的，不用再写了。</p><p>语法如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token operator">&lt;</span>statement<span class="token number">-1</span><span class="token operator">></span>    <span class="token punctuation">.</span>    <span class="token punctuation">.</span>    <span class="token punctuation">.</span>    <span class="token operator">&lt;</span>statement<span class="token operator">-</span>N<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Person类定义</span><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'my age: %d'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Student子类继承父类Person</span><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>grade<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade        <span class="token comment" spellcheck="true">#调用父类的构函</span>        Person<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    stu <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    stu<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上定义了一个<strong>父类Person</strong>，<strong>子类Student</strong>继承了Person类；</p><p>18行调用时可以直接调用父类中的方法，并输出父类的属性age。</p><h4 id="1-5-11-类的方法重写"><a href="#1-5-11-类的方法重写" class="headerlink" title="1.5.11 类的方法重写"></a>1.5.11 类的方法重写</h4><p>我们发现上一个案例中，在子类中定义了一个grade，但是父类是肯定不知道的，那怎么在调用info方法不变的情况下，也输出grade属性呢？可以重写父类的info方法，代码如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Person类定义</span><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'my age: %d'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Student子类继承基类Person</span><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>grade<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade        <span class="token comment" spellcheck="true">#调用父类的构函</span>        Person<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'我今年%d, 上%d年级了'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>age<span class="token punctuation">,</span> self<span class="token punctuation">.</span>grade<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    stu <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    stu<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上代码在Student中重新实现了父类的info方法，这样<code>stu.info()</code>代码调用的时候，执行的就是子类的info了。</p><h4 id="1-5-12-类的多重继承"><a href="#1-5-12-类的多重继承" class="headerlink" title="1.5.12 类的多重继承"></a>1.5.12 类的多重继承</h4><p>多重继承就是可以继承多个的意思，这又可以省写好多代码了😄。</p><p>语法如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A1<span class="token punctuation">,</span> A2<span class="token punctuation">,</span> A3<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token operator">&lt;</span>statement<span class="token number">-1</span><span class="token operator">></span>    <span class="token punctuation">.</span>    <span class="token punctuation">.</span>    <span class="token punctuation">.</span>    <span class="token operator">&lt;</span>statement<span class="token operator">-</span>N<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>示例代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Person类定义</span><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name    @property    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_name<span class="token comment" spellcheck="true"># Interest兴趣类定义</span><span class="token keyword">class</span> <span class="token class-name">Interest</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_hobby <span class="token operator">=</span> hobby    @property    <span class="token keyword">def</span> <span class="token function">hobby</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hobby<span class="token comment" spellcheck="true"># Student子类继承基类Person</span><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> Interest<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#调用父类的构函</span>        Person<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span>        Interest<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s喜欢%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>stu<span class="token punctuation">.</span>name<span class="token punctuation">,</span> stu<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    stu <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token string">'踢足球'</span><span class="token punctuation">)</span>    stu<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上输出的结果是：<strong>张三喜欢踢足球</strong></p><p><strong>代码解释：</strong>以上代码定义了两个父类，一个是Person，一个是Interest，并分别使用@property设置了两个属性name和hobby，Student继承这两个父类；</p><p>通过27代码构造子类Student后，28行调用<code>info()</code>方法获得了父类的name和hobby属性，并输出结果；</p><h4 id="1-5-13-python中property和setter装饰器用法"><a href="#1-5-13-python中property和setter装饰器用法" class="headerlink" title="1.5.13 python中property和setter装饰器用法"></a>1.5.13 python中property和setter装饰器用法</h4><p><strong>作用：</strong>调用方法改为调用对象， 比如 ： p.set_name() 改为 p.set_name</p><p><strong>区别：</strong>前者改变get方法，后者改变set方法</p><p>效果图：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418110553.jpeg" alt="img"></p><p>代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name  <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>_name  <span class="token keyword">def</span> <span class="token function">set_name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> namep <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'小黑'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>set_name<span class="token punctuation">(</span><span class="token string">'小灰'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>标准写法：</strong></p><p>效果图：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418110633.jpeg" alt="img"></p><p>代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># property装饰器</span><span class="token comment" spellcheck="true"># 作用： 将一个get方法转换为对象的属性。 就是 调用方法改为调用对象</span><span class="token comment" spellcheck="true"># 使用条件： 必须和属性名一样</span><span class="token comment" spellcheck="true"># setter方法的装饰器：</span><span class="token comment" spellcheck="true"># 作用：将一个set方法转换为对象的属性。 就是 a调用方法改为调用对象</span><span class="token comment" spellcheck="true"># 使用方法：@属性名.setter</span><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name  <span class="token comment" spellcheck="true"># 利用property装饰器将获取name方法转换为获取对象的属性</span>  @property  <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>_name  <span class="token comment" spellcheck="true"># 利用property装饰器将设置name方法转换为获取对象的属性</span>  @name<span class="token punctuation">.</span>setter  <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> namep <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'小黑'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 原获取 p.name() , 现 p.name</span>p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'小灰'</span> <span class="token comment" spellcheck="true"># 原设置 p.name('小灰') ,现 p.name = '小灰'</span><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="练习：学生管理系统5-0"><a href="#练习：学生管理系统5-0" class="headerlink" title="练习：学生管理系统5.0"></a>练习：学生管理系统5.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在4.0的基础上，现在实现学生管理系统的5.0版本，主要功能有：1.学生类：存储学生个人信息2.管理类：对学生的各种管理 (1)显示所有学生信息 (2)新增一个学生信息 (3)修改学生的年龄 (4)根据学号删除学生 (5)按照姓名查找 (6)按照学号进行升序和降序排列 (7)功能菜单：该功能菜单供用户选择相应功能，调用上述不同功能模块 (8)数据从文件中读取 (9)将数据保存到文件中</code></pre><h2 id="二、1天学会爬虫基本原理"><a href="#二、1天学会爬虫基本原理" class="headerlink" title="二、1天学会爬虫基本原理"></a>二、1天学会爬虫基本原理</h2><h3 id="2-1-网络爬虫概念"><a href="#2-1-网络爬虫概念" class="headerlink" title="2.1 网络爬虫概念"></a>2.1 网络爬虫概念</h3><p>网络爬虫的英文为Web Spider，又称作网络蜘蛛或网络机器人。如果把互联网比喻成一张大的蜘蛛网，数据便是存放于蜘蛛网的各个节点。爬虫就是网中爬行的蜘蛛，沿着网络抓取自己的猎物（数据）。</p><p>网络爬虫，简单来说，就是一种按照一定规则，自动地抓取互联网中信息的程序或脚本。</p><p>我们常用的搜索网站，可以看成就是通过网络爬虫爬取互联网中符合要求的信息，显示给用户的。</p><h3 id="2-2-HTTP基本原理"><a href="#2-2-HTTP基本原理" class="headerlink" title="2.2 HTTP基本原理"></a>2.2 HTTP基本原理</h3><p>在本节中，我们会详细了解HTTP的基本原理，了解在浏览器中敲入URL到获取网页内容之间发生了什么。了解了这些内容，有助于我们进一步了解爬虫的基本原理。</p><p>我们把在浏览器的地址栏里输入的网址叫做URL。URL全称<strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator，即<a href="https://baike.baidu.com/item/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6" rel="external nofollow noreferrer">统一资源定位符</a>。URL用于确定分散在互联网中各种资源的位置和访问方式。例如，摄图网中故宫博物馆的图片地址为：<a href="http://seopic.699pic.com/photo/50088/2824.jpg_wh1200.jpg%E3%80%82%E5%AE%83%E5%8C%85%E5%90%AB%E4%BA%86%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%A7%8D%E4%BF%A1%E6%81%AF%E3%80%82" rel="external nofollow noreferrer">http://seopic.699pic.com/photo/50088/2824.jpg_wh1200.jpg。它包含了以下几种信息。</a></p><p>访问协议：  http，用于确定数据传输的方式。</p><p>服务器名称：seopic.699pic.com，图片所在的网站地址。</p><p>访问路径：  photo/50088，图片目录。</p><p>资源名：   2824.jpg_wh1200.jpg，图片名称。</p><h3 id="2-3-网页基础"><a href="#2-3-网页基础" class="headerlink" title="2.3 网页基础"></a>2.3 网页基础</h3><p>我们访问的网页多种多样，展现形式各不相同，对于网络爬虫来说，弄清楚网页所展示的技术是十分重要的，因为我们所需要的数据就散落在网页当中，只有了解了网页的基本组成、结构和节点等内容，才能分析网页、解析网页，从中获取我们想要的数据。</p><h4 id="2-3-1-网页的组成基础"><a href="#2-3-1-网页的组成基础" class="headerlink" title="2.3.1 网页的组成基础"></a>2.3.1 网页的组成基础</h4><p>网页可以分为三大部分——HTML、CSS和JavaScript。如果把网页比作一个人的话，HTML相当于骨架，JavaScript相当于肌肉，CSS相当于皮肤，三者结合起来才能形成一个完善的网页。下面我们分别来介绍一下这三部分的功能。 </p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406112916.jpeg" alt="img"></p><h4 id="2-3-2-网页的组成HTML"><a href="#2-3-2-网页的组成HTML" class="headerlink" title="2.3.2 网页的组成HTML"></a>2.3.2 网页的组成HTML</h4><p><strong>HTML</strong>是用来描述网页的一种语言，全称叫做Hyper Text Markup Language，即超文本标记性语言。网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是HTML。不同类型的内容通过不同类型的标签来表示，如图片用img标签表示，视频用video标签表示，段落用p标签表示，它们之间的布局又常通过布局标签div嵌套组合而成，各种标签通过不同的排列和嵌套才形成了网页的框架。</p><p>在Chrome浏览器中打开百度，按F12键，打开开发者工具，按照下图所示的顺序执行，在Response选项中就可以查看百度HTML代码了。 </p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210318100540.jpeg" alt="Chrome浏览器网页HTML信息查询"></p><p>这就是HTML，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。</p><p>HTML定义了网页的结构，但是只有HTML页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里借助了CSS。</p><p>一个HTML的例子</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>这是一个标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>这是一个段落。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>网页效果</p><pre><code>  ![image-20210406114004103](https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210416090036.png)</code></pre><h4 id="2-3-3-网页的组成CSS"><a href="#2-3-3-网页的组成CSS" class="headerlink" title="2.3.3 网页的组成CSS"></a>2.3.3 网页的组成CSS</h4><p>CSS，全称叫做Cascading Style Sheets，即层叠样式表。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等格式。</p><p>CSS是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。</p><p>在Chrome浏览器中打开百度，按F12键，打开开发者工具，按照下图所示的顺序执行，在Preview选项中就可以查看百度需要用到的CSS代码了。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210318100559.jpeg" alt="Chrome浏览器查看CSS代码"></p><p>基于HTML增加CSS的例子</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">body </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">h1 </span><span class="token punctuation">{</span>  <span class="token property">color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>这是一个标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>这是一个段落。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>增加上CSS的网页效果</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406114130.png" alt="image-20210406114129925"></p><h4 id="2-3-4-网页的组成JavaScript"><a href="#2-3-4-网页的组成JavaScript" class="headerlink" title="2.3.4 网页的组成JavaScript"></a>2.3.4 网页的组成JavaScript</h4><p><strong>JavaScript</strong>，简称JS，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是JavaScript的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种实时、动态、交互的页面功能。</p><p>在Chrome浏览器中打开百度，按F12键，打开开发者工具，按照下图所示的顺序执行，在Preview选项中就可以查看百度需要用到的JavaScript代码了。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps4.jpg" alt="img"></p><p>基于HTML和CSS的Javascript网页代码</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>这是一个Javascript示例<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">body </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">h1 </span><span class="token punctuation">{</span>  <span class="token property">color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">function</span> <span class="token function">displayDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token operator">=</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>这是一个标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是一个段落。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>displayDate()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>显示日期<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>网页显示</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406114632.png" alt="image-20210406114632789"></p><p>点击后显示</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406114645.png" alt="image-20210406114645589"></p><p><strong>HTML基础教程参考：</strong></p><p><a href="https://www.runoob.com/html/html-tutorial.html" rel="external nofollow noreferrer">https://www.runoob.com/html/html-tutorial.html</a></p><p><a href="https://www.w3school.com.cn/html5/index.asp" rel="external nofollow noreferrer">https://www.w3school.com.cn/html5/index.asp</a></p><p><strong>CSS基础教程参考：</strong></p><p><a href="https://www.runoob.com/css/css-tutorial.html" rel="external nofollow noreferrer">https://www.runoob.com/css/css-tutorial.html</a></p><p><a href="https://www.w3school.com.cn/css/index.asp" rel="external nofollow noreferrer">https://www.w3school.com.cn/css/index.asp</a></p><p><strong>Javascript基础教程参考：</strong></p><p><a href="https://www.runoob.com/js/js-tutorial.html" rel="external nofollow noreferrer">https://www.runoob.com/js/js-tutorial.html</a></p><p><a href="https://www.w3school.com.cn/js/index.asp" rel="external nofollow noreferrer">https://www.w3school.com.cn/js/index.asp</a></p><h4 id="2-3-5-网页案例解析"><a href="#2-3-5-网页案例解析" class="headerlink" title="2.3.5 网页案例解析"></a>2.3.5 网页案例解析</h4><p>先看一个简单的电影排行的HTML的例子。代码可以在记事本中编写，保存后将后缀改为html（movies.html）。也可以在代码中新建一个HTML文档。推荐后一种方式，层次分明、可读性强。下面是实现的HTML代码：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>电影排行<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>电影排行榜单<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m_list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>1.肖申克的救赎<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>2.霸王别姬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用浏览器打开movies.html，网页效果如图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps5.jpg" alt="img"> </p><p>下面来分析一下这个HTML代码。</p><p>第一行用DOCTYPE定义了文档类型。</p><p>使用尖括号定义标签，如<code>&lt;html&gt;</code>、<code>&lt;head&gt;</code>、<code>&lt;body&gt;</code>、<code>&lt;div&gt;</code>。</p><p>标签是成对出现的，如<code>&lt;html&gt;</code>是起始标签，<code>&lt;/html&gt;</code>是终止标签。</p><p>最外层的是html标签，表示HTML代码的范围。内部包含head和body标签，分别表示网页头和网页体。</p><p>head标签内定义了网页的属性和引用。如<code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code>指明了网页的编码方式为UTF-8；<code>&lt;title&gt;</code>电影排行<code>&lt;/title&gt;</code>定义了网页的标题。</p><p>body标签内是浏览器显示的正文内容，也是爬虫获取数据的来源。</p><p>div标签类似于一个容器，它将内部所有的内容看成一个整体，主要用于页面的布局。</p><p>标签h1代表一级标题；p代表段落，会自动换行。</p><p>标签内可以定义自己的属性。如<code>&lt;div id=&quot;content&quot;&gt;</code>它的属性id值为content。这是一个非常有用的属性，因为整个网页中，id的值是唯一的，可以通过它快速定位到这个标签。<code>&lt;div class=&quot;m_list&quot;&gt;</code>中，属性class的值为m_list，这也是一个非常有用的属性，通过它可以定位到所有相同样式的标签。</p><h4 id="2-3-6-节点树及节点之间的关系"><a href="#2-3-6-节点树及节点之间的关系" class="headerlink" title="2.3.6 节点树及节点之间的关系"></a>2.3.6 节点树及节点之间的关系</h4><p>即使你了解了HTML代码，对爬虫来说也是无法从中爬取数据的，因为我们还是不知道HTML究竟是什么结构，只有了解了其结构特点，才可以在HTML中编写程序抽取出数据。</p><p>在HTML中，所有标签定义的内容都是节点，它们构成了一个HTML DOM树。</p><p>我们先看下什么是DOM，DOM是W3C（万维网联盟）的标准，其英文全称Document Object Model，即文档对象模型。它定义了访问HTML和XML文档的标准：</p><p><strong>W3C文档对象模型（DOM）是中立于平台和语言的接口，它允许程序和脚本动态地访问和更新文档的内容、结构和样式。</strong></p><p>W3C DOM标准被分为3个不同的部分。</p><p>核心DOM： 针对任何结构化文档的标准模型。</p><p>XML DOM：针对XML文档的标准模型。</p><p>HTML DOM：针对HTML文档的标准模型。</p><p>根据W3C的HTML DOM标准，HTML文档中的所有内容都是节点。</p><p>整个文档是一个文档节点；</p><p>每个HTML元素是元素节点；</p><p>HTML元素内的文本是文本节点；</p><p>每个HTML属性是属性节点；</p><p>注释是注释节点。</p><p>HTML DOM将HTML文档视作树结构，这种结构被称为节点树，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps7.png" alt="img"></p><p>通过HTML DOM，树中的所有节点均可通过JavaScript访问，所有HTML节点元素均可被修改，也可以被创建或删除。</p><p>节点树中的节点彼此拥有层级关系。我们常用父（parent）、子（child）和兄弟（sibling）等术语描述这些关系。父节点拥有子节点，同级的子节点被称为兄弟节点。</p><p>在节点树中，顶端节点称为根（root）。除了根节点之外，每个节点都有父节点，同时可拥有任意数量的子节点或兄弟节点。下图展示了节点树以及节点之间的关系。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps7.png" alt="img"></p><p>本段参考W3SCHOOL，链接：<a href="http://www.w3school.com.cn/htmldom/dom_nodes.asp%E3%80%82" rel="external nofollow noreferrer">http://www.w3school.com.cn/htmldom/dom_nodes.asp。</a></p><p>本章主要介绍了网络爬虫相关基础知识，包括网络爬虫的概念、HTTP基本原理和网页基础。</p><p>在网络爬虫概念一节中，了解了什么是网络爬虫，网络爬虫能用来干什么。</p><p>在HTTP基本原理一节中，介绍了URL、超文本、HTTP和HTTPS、HTTP请求和HTTP响应。这些都是后续实现网络爬虫的理论基础，理解了HTTP基本原理，能够更好地理解网络爬虫的原理。</p><p>在网页基础一节中，介绍了HTML、CSS、JS、网页结构以及节点树。这为网络爬虫实现数据的提取提供了解决方案，只有充分理解了HTML的树形结构，爬虫才可以根据其编写程序，实现最终的功能。</p><h3 id="2-4-网页请求requests库"><a href="#2-4-网页请求requests库" class="headerlink" title="2.4 网页请求requests库"></a>2.4 网页请求requests库</h3><h4 id="2-4-1-示例"><a href="#2-4-1-示例" class="headerlink" title="2.4.1 示例"></a>2.4.1 示例</h4><p>以下是一个使用requests模块模仿浏览器访问网页的代码，输入以下代码查看res.text的网页输出结果。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token comment" spellcheck="true"># 通过get方法获取网页的返回结果保存到res变量中</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://kui.ge'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 通过text获取返回的网页内容</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-4-2-请求方法"><a href="#2-4-2-请求方法" class="headerlink" title="2.4.2 请求方法"></a>2.4.2 请求方法</h4><p>除了以上的get方法外，还有一些其他的请求方法如下：</p><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">delete(url, args)</td><td align="left">向指定的 URL 发送 DELETE 请求。</td></tr><tr><td align="left">get(url, params, args)</td><td align="left">向指定的 URL 发送 GET 请求，params为dict，post请求时带入参数。</td></tr><tr><td align="left">head(url, args)</td><td align="left">向指定的 URL 发送 HEAD 请求，格式为dict。</td></tr><tr><td align="left">patch(url, data, args)</td><td align="left">向指定的 URL 发送 PATCH 请求。</td></tr><tr><td align="left">post(url, data, json, args)</td><td align="left">向指定的 URL 发送 POST 请求。</td></tr><tr><td align="left">put(url, data, args)</td><td align="left">向指定的 URL 发送 PUT 请求。</td></tr><tr><td align="left">request(method, url, args)</td><td align="left">将指定方法的请求发送到指定的 URL。</td></tr></tbody></table><h4 id="2-4-3-返回方法"><a href="#2-4-3-返回方法" class="headerlink" title="2.4.3 返回方法"></a>2.4.3 返回方法</h4><table><thead><tr><th align="left">属性或方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">encoding</td><td align="left">查看返回数据的编码方式，使用示例：r.encoding，结果示例：utf-8</td></tr><tr><td align="left">status_code</td><td align="left">查看返回的状态码，示例：r.status_code</td></tr><tr><td align="left">text</td><td align="left">查看返回的数据内容</td></tr><tr><td align="left">headers</td><td align="left">查看返回的头部数据</td></tr><tr><td align="left">content</td><td align="left">查看返回数据的二进制内容</td></tr><tr><td align="left">url</td><td align="left">查看访问的实际URL</td></tr><tr><td align="left">cookies</td><td align="left">查看cookies内容，使用示例：r.cookies[‘ts’]</td></tr><tr><td align="left">json()</td><td align="left">返回结果如果是json，可以通过这个方法直接获取json对象</td></tr><tr><td align="left"></td><td align="left"></td></tr></tbody></table><h4 id="2-4-4-安装"><a href="#2-4-4-安装" class="headerlink" title="2.4.4 安装"></a>2.4.4 安装</h4><p>如果import requests显示没有这个模块，可以使用以下的方式安装。</p><pre class="line-numbers language-bash"><code class="language-bash">pip <span class="token function">install</span> requests<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-4-5-header请求"><a href="#2-4-5-header请求" class="headerlink" title="2.4.5 header请求"></a>2.4.5 header请求</h4><pre class="line-numbers language-python"><code class="language-python">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.douban.com/'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-4-6-上传数据"><a href="#2-4-6-上传数据" class="headerlink" title="2.4.6 上传数据"></a>2.4.6 上传数据</h4><p>发送POST对比GET请求，需要增加data参数，例如：</p><pre class="line-numbers language-python"><code class="language-python">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://search.douban.com/movie/subject_search'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'search_text'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">:</span> <span class="token string">'1002'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>url <span class="token comment" spellcheck="true">#实际请求的URL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>通过以上提交data参数，获取到相关的搜索结果信息</p><h4 id="2-4-7-上传json数据"><a href="#2-4-7-上传json数据" class="headerlink" title="2.4.7 上传json数据"></a>2.4.7 上传json数据</h4><p>使用json=params，内部会转化为json格式，例如：</p><pre class="line-numbers language-python"><code class="language-python">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token string">'value'</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>params<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-4-8-上传文件"><a href="#2-4-8-上传文件" class="headerlink" title="2.4.8 上传文件"></a>2.4.8 上传文件</h4><p>注意读取文件使用rb，否则获取的文件长度信息会不正确</p><pre class="line-numbers language-python"><code class="language-python">upload_files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> open<span class="token punctuation">(</span><span class="token string">'report.xls'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span>upload_files<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-5-正则表达式"><a href="#2-5-正则表达式" class="headerlink" title="2.5 正则表达式"></a>2.5 正则表达式</h3><h4 id="2-5-1-查找和替换"><a href="#2-5-1-查找和替换" class="headerlink" title="2.5.1 查找和替换"></a>2.5.1 查找和替换</h4><p>通过以上的requests模块，获取到了网页的信息，当信息多的时候，就需要检索，平时用的比较多的是搜索和替换，例如：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210317101004.png" alt="image-20210317101004414"></p><p>查找和替换是对文档用的最多的功能，那么在Python程序中，怎么实现查找替换的功能呢？</p><p>我们可以把打开的文档看作字符串，那么我们只要学会查找字符串就可以了。比如要在以下字符串中查找<code>o</code>这个字符，可以：</p><pre class="line-numbers language-python"><code class="language-python">count <span class="token operator">=</span> <span class="token number">0</span>var <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token keyword">for</span> c <span class="token keyword">in</span> var<span class="token punctuation">:</span>    <span class="token keyword">if</span> c <span class="token operator">==</span> <span class="token string">'o'</span><span class="token punctuation">:</span>        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'查找到%d次'</span> <span class="token operator">%</span> count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果：</p><pre><code>查找到2次</code></pre><p>以上通过for循环对字符串var进行了遍历，并找到两个o，输出了找到的次数，这是查找和替换的简单场景，通过简单的代码也能够实现。</p><h4 id="2-5-2-search正则表达式"><a href="#2-5-2-search正则表达式" class="headerlink" title="2.5.2 search正则表达式"></a>2.5.2 search正则表达式</h4><p>有时候我们还会遇到一些复杂的情况，比如查找纯数字的内容、查找小写字母、甚至对查找到的数据做一些运算等等，这些功能虽然咱们自己也能够实现，还是很花时间和精力的。Python已经为我们提供了相关的工具类，而咱们要做的就是学会使用它们就可以完成字符串的查找和替换了。</p><p>一个简单的案例，在以下提供的字符串line中查找关键字梦想</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">import</span> reline <span class="token operator">=</span> <span class="token triple-quoted-string string">'''每个人都拥有自己的梦想，设计自己的梦想，追求自己的梦想，实现自己的梦想。\        梦想是生命的灵魂，是心灵的灯塔，是引导人走向成功的信仰。\        有了崇高的梦想，只要矢志不渝地追求，梦想就会成为现实，奋斗就会变成壮举，生命就会创造奇迹。'''</span>match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'梦想'</span><span class="token punctuation">,</span> line<span class="token punctuation">,</span> re<span class="token punctuation">.</span>M<span class="token operator">|</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上代码的输出结果是</p><pre><code>&lt;re.Match object; span=(9, 11), match=&#39;梦想&#39;&gt;</code></pre><p>结果说明：从结果中已经告诉我们在line列表中找到了<strong>梦想</strong>关键字，在第九到第11个字符。</p><p>代码解析：以上代码中，使用了re类，是Regular Expression的简写，有时候也简写成regex，中文含义是正则表达式，通过import的方式引入外部类，如第3行import re；</p><p>第8行<code>re.search(pattern, string, flag)</code>的search是re类的一个方法，三个参数在刚才的例子中表示为在string（第二个参数）中查找pattern（第一个参数）字符串第一次出现的地方，满足一定的flag（要求，比如大小写敏感等）。</p><p><strong>re.search的使用说明如下</strong></p><p>re.search 扫描整个字符串并返回第一个成功的匹配。</p><p>函数语法：</p><pre class="line-numbers language-python"><code class="language-python">re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string<span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>函数参数说明：</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">pattern</td><td align="left">匹配的正则表达式</td></tr><tr><td align="left">string</td><td align="left">要匹配的字符串</td></tr><tr><td align="left">flags</td><td align="left">标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等</td></tr></tbody></table><p>匹配成功re.search方法返回一个匹配的对象，否则返回None。</p><p>我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</p><table><thead><tr><th align="left">匹配对象方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">group(num=0)</td><td align="left">匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</td></tr><tr><td align="left">groups()</td><td align="left">返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。</td></tr></tbody></table><h4 id="2-5-3-findall正则表达式"><a href="#2-5-3-findall正则表达式" class="headerlink" title="2.5.3 findall正则表达式"></a>2.5.3 findall正则表达式</h4><p>通过re.search咱们发现，它只能找到字符串第一次出现的地方，而如果需要找所有出现的地方就需要使用findall了。</p><p>在字符串中找到正则表达式所匹配的所有子串，并返回一个列表，如果没有找到匹配的，则返回空列表。</p><p><strong>注意：</strong> match 和 search 是匹配一次 findall 匹配所有。</p><p>语法格式为：</p><pre class="line-numbers language-python"><code class="language-python">findall<span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token punctuation">,</span> endpos<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参数：</p><ul><li><strong>string</strong> : 待匹配的字符串。</li><li><strong>pos</strong> : 可选参数，指定字符串的起始位置，默认为 0。</li><li><strong>endpos</strong> : 可选参数，指定字符串的结束位置，默认为字符串的长度。</li></ul><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">import</span> reline <span class="token operator">=</span> <span class="token triple-quoted-string string">'''每个人都拥有自己的梦想，设计自己的梦想，追求自己的梦想，实现自己的梦想。\        梦想是生命的灵魂，是心灵的灯塔，是引导人走向成功的信仰。\        有了崇高的梦想，只要矢志不渝地追求，梦想就会成为现实，奋斗就会变成壮举，生命就会创造奇迹。'''</span>pattern <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'梦想'</span><span class="token punctuation">)</span>result <span class="token operator">=</span> pattern<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果：</p><pre><code>[&#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;]</code></pre><p>可以看到找到了7次匹配的内容,re.compile通过提供的正则表达式生成了正则表达式对象pattern，再通过pattern.findall获取到要匹配的文本进行规则的匹配，并找到符合正则表达式的所有内容。</p><h4 id="2-5-4-sub正则表达式"><a href="#2-5-4-sub正则表达式" class="headerlink" title="2.5.4 sub正则表达式"></a>2.5.4 sub正则表达式</h4><p>通过search和findall已经可以完成对字符串的查找了，怎么替换呢？使用sub正则表达式。</p><p>语法：</p><pre><code>re.sub(pattern, repl, string, count=0, flags=0)</code></pre><p>参数：</p><ul><li>pattern : 正则中的模式字符串。</li><li>repl : 替换的字符串，也可为一个函数。</li><li>string : 要被查找替换的原始字符串。</li><li>count : 模式匹配后替换的最大次数，默认 0 表示替换所有的匹配。</li></ul><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">import</span> reline <span class="token operator">=</span> <span class="token string">"每个人的身上都有毛毛，我要为你唱毛毛"</span>result <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'毛毛'</span><span class="token punctuation">,</span> r<span class="token string">"猫猫"</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果：</p><pre><code>每个人的身上都有猫猫，我要为你唱猫猫</code></pre><p>咱们发现字符串里所有的毛毛变成了猫猫，这个是sub的替换功能实现的。</p><h4 id="2-5-5-正则表达式常用匹配符"><a href="#2-5-5-正则表达式常用匹配符" class="headerlink" title="2.5.5 正则表达式常用匹配符"></a>2.5.5 正则表达式常用匹配符</h4><p>构造正则表达式的方法和创建数学表达式的方法一样。正则表达式的组件可以是单个的字符、字符集合、字符范围、字符间的选择或者所有这些组件的任意组合。下表为正则表达式的重要符号：</p><table><thead><tr><th><strong><em>\</em>符号**</strong></th><th><strong><em>\</em>描述**</strong></th><th><strong><em>\</em>符号**</strong></th><th><strong><em>\</em>描述**</strong></th></tr></thead><tbody><tr><td>\w</td><td>匹配字母、数字、下划线</td><td>.</td><td>匹配任意字符，包括汉字</td></tr><tr><td>\W</td><td>匹配不是字母、数字、下划线的字符</td><td>[m]</td><td>匹配单个字符串</td></tr><tr><td>\s</td><td>匹配空白字符</td><td>[m1m2…n]</td><td>匹配多个字符串</td></tr><tr><td>\S</td><td>匹配不是空白的字符</td><td>[m-n]</td><td>匹配m到n区间内的数字、字母</td></tr><tr><td>\d</td><td>匹配数字</td><td>[^m]</td><td>匹配除m以外的字符串</td></tr><tr><td>\D</td><td>匹配非数字的字符</td><td>()</td><td>对正则表达式进行分组，一对圆括号表示一组</td></tr><tr><td>*</td><td>重复0或N次</td><td>{m}</td><td>重复m次</td></tr><tr><td>+</td><td>重复1或N次</td><td>{m,n}</td><td>该限定符的意思是至少有 m 个重复，至多到 n 个重复</td></tr><tr><td>?</td><td>重复0或1次</td><td></td><td></td></tr></tbody></table><p>正则表达式的规则比较多，但是对于爬虫而言，我们只要掌握几个重要的规则就可以了。</p><ul><li>. ：匹配任意1个字符，换行\n除外</li><li>*：匹配前一个字符0次或无限次</li><li>？：匹配前一个字符0次或一次</li><li>.* ：贪心算法，匹配除换行符之外的所有字符</li><li>.*?：非贪心算法，只匹配符合条件的字符</li><li>（.*?）：非贪心算法，只匹配符合条件的最少字符</li></ul><h4 id="举例说明-匹配符"><a href="#举例说明-匹配符" class="headerlink" title="举例说明.匹配符"></a>举例说明.匹配符</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaaabab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果：</p><pre><code>[&#39;aab&#39;, &#39;aab&#39;]</code></pre><p>可以看到a和b中间有字符且不是换行的都被匹配了出来</p><h4 id="举例说明-匹配符-1"><a href="#举例说明-匹配符-1" class="headerlink" title="举例说明*匹配符"></a>举例说明*匹配符</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaaabab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a*b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre><code>[&#39;aab&#39;, &#39;ab&#39;, &#39;aaab&#39;, &#39;ab&#39;]</code></pre><p>可以看到不管a重复了几次都被匹配了出来</p><h4 id="举例说明-匹配符，非贪婪算法"><a href="#举例说明-匹配符，非贪婪算法" class="headerlink" title="举例说明?匹配符，非贪婪算法"></a>举例说明?匹配符，非贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaaabab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre><code>[&#39;ab&#39;, &#39;ab&#39;, &#39;ab&#39;, &#39;ab&#39;]</code></pre><h4 id="举例说明-贪婪算法"><a href="#举例说明-贪婪算法" class="headerlink" title="举例说明.*贪婪算法"></a>举例说明.*贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaaabab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre><code>[&#39;aababaaabab&#39;]</code></pre><p>只要满足从a开始的，就开始截取，然后找到所有的b，并找到最长的那个作为截止。</p><h4 id="举例说明-非贪婪算法"><a href="#举例说明-非贪婪算法" class="headerlink" title="举例说明.*?非贪婪算法"></a>举例说明.*?非贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaaabab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre><code>[&#39;aab&#39;, &#39;ab&#39;, &#39;aaab&#39;, &#39;ab&#39;]</code></pre><p>从左到右只要满足从a开始到b结束的就截取出来，ab中间没有字符也会被截取</p><h4 id="举例说明-非贪婪算法-1"><a href="#举例说明-非贪婪算法-1" class="headerlink" title="举例说明(.*?)非贪婪算法"></a>举例说明(.*?)非贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaaabab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a(.*?)b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre><code>[&#39;a&#39;, &#39;&#39;, &#39;aa&#39;, &#39;&#39;]</code></pre><p>相比于.*?的结果()表示只保留了中间的部分，两边匹配的去除掉</p><p>另外如果字符串中有回车换行<code>\n</code>存在，需要使用<code>re.S</code>，这样就不会中断执行了。</p><h4 id="举例说明修饰符标志的用法"><a href="#举例说明修饰符标志的用法" class="headerlink" title="举例说明修饰符标志的用法"></a>举例说明修饰符标志的用法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> revar <span class="token operator">=</span> <span class="token string">'aababaa \n abab'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果为</p><pre><code>[&#39;aab&#39;, &#39;ab&#39;, &#39;ab&#39;, &#39;ab&#39;][&#39;aab&#39;, &#39;ab&#39;, &#39;aa \n ab&#39;, &#39;ab&#39;]</code></pre><p>可以看到带有re.S的把回车换行符<code>\n</code>也当作普通字符处理了，而没有re.S，则换行后，匹配会重新计算。</p><h4 id="可选的修饰符标志"><a href="#可选的修饰符标志" class="headerlink" title="可选的修饰符标志"></a>可选的修饰符标志</h4><table><thead><tr><th align="left">修饰符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">re.I</td><td align="left">使匹配对大小写不敏感</td></tr><tr><td align="left">re.L</td><td align="left">做本地化识别（locale-aware）匹配</td></tr><tr><td align="left">re.M</td><td align="left">多行匹配，影响 ^ 和 $</td></tr><tr><td align="left">re.S</td><td align="left">使 . 匹配包括换行在内的所有字符</td></tr><tr><td align="left">re.U</td><td align="left">根据Unicode字符集解析字符。这个标志影响 \w, \W, \b, \B.</td></tr><tr><td align="left">re.X</td><td align="left">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解。</td></tr></tbody></table><h3 id="2-6-XPath的HTML解析"><a href="#2-6-XPath的HTML解析" class="headerlink" title="2.6 XPath的HTML解析"></a>2.6 XPath的HTML解析</h3><h4 id="2-6-1-案例"><a href="#2-6-1-案例" class="headerlink" title="2.6.1 案例"></a>2.6.1 案例</h4><p>一个简单的HTML，使用XPath解析的案例</p><p>现有一个网址导航的HTML文档link.html，代码如下所示：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>网址导航<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m_list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.baidu.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.sina.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>新浪<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面我们使用Xpath提取该页面的中的数据。</p><p><strong>1. 准备工作：加载link.html页面。</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree<span class="token comment" spellcheck="true">#解析movies.html文件，返回一个节点树的对象</span>html_selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">"link.html"</span><span class="token punctuation">,</span>etree<span class="token punctuation">.</span>HTMLParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>2. 使用斜杠（/）从根节点开始获取html元素。</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取根节点html的元素</span>root <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"/html"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><p><code>[&lt;Element html at 0x28c42b74dc8&gt;]</code></p><p>由结果可知，返回一个html元素的对象。</p><p><strong>3. 使用斜杠（/）从根节点开始逐层查找元素的子节点。</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#斜杠（/）获取节点title</span>title <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"/html/head/title"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><p><code>[&lt;Element title at 0x24931025ec8&gt;]</code></p><p>由结果可知，返回一个title元素的对象。</p><p><strong>4. 使用text()获取节点title中的文本。</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#斜杠（/）获取节点title</span>title <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"/html/head/title/text()"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><p><code>[&#39;Title&#39;]</code></p><p><strong>5. 获取所有链接名称。</strong></p><pre class="line-numbers language-python"><code class="language-python">link_name <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//a/text()"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>link_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出结果为：</p><p><code>[&#39;百度&#39;, &#39;新浪&#39;]</code></p><p><strong>6. 获取所有链接地址。</strong></p><pre class="line-numbers language-python"><code class="language-python">link <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//a/@href"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出结果：</p><p><code>[&#39;https://www.baidu.com&#39;, &#39;http://www.sina.com&#39;]</code></p><h4 id="2-6-2-原理"><a href="#2-6-2-原理" class="headerlink" title="2.6.2 原理"></a>2.6.2 原理</h4><p>网络爬虫最核心、最重要的工作是从HTML文档中将想要的数据提取出来，而使用XPath就可以很轻松地解析HTML文档信息。下面来看一下什么是XPath。</p><p>XPath全称<strong>X</strong>ML <strong>Path</strong> Language，即XML路径语言。它是一门在XML文档中查找信息的语言。HTML与XML结构类似，也可以在HTML中查找信息。</p><p>XPath 使用路径表达式来选取HTML文档中的节点或者节点集。这些路径表达式和我们在常规的电脑文件系统中看到的表达式非常相似。</p><p>例如，Windows系统中，要指明桌面上的文件hello.py的路径，通常可以写成：C:\Users\aibit\Desktop\hello.py。从C盘开始，使用反斜杠（\）逐级往下找，直到最终的目标</p><h4 id="2-6-3-路径表达式"><a href="#2-6-3-路径表达式" class="headerlink" title="2.6.3 路径表达式"></a>2.6.3 路径表达式</h4><p>XPath 使用路径表达式来选取HTML文档中的节点或者节点集。</p><p>常用的XPath路径表达式如下表所示：</p><table><thead><tr><th><strong>表达式</strong></th><th><strong>描述</strong></th><th><strong>示例</strong></th></tr></thead><tbody><tr><td>nodename</td><td>选取此节点的所有子节点</td><td>div,p,h1</td></tr><tr><td>/</td><td>从根节点选取（描述绝对路径）</td><td>/html</td></tr><tr><td>//</td><td>不考虑位置，选取页面中所有子孙节点</td><td>//div</td></tr><tr><td>.</td><td>选取当前节点（描述相对路径）</td><td>./div</td></tr><tr><td>..</td><td>选取当前节点的父节点（描述相对路径）</td><td>h1/../</td></tr><tr><td>@属性名</td><td>选取属性的值</td><td>@href,@id</td></tr><tr><td>text()</td><td>获取元素中的文本节点</td><td>//h1/text()</td></tr></tbody></table><p>大家对诸如：斜杠（/）、点（.）、两点（..）的用法一定不会陌生。即使不熟悉也没关系，因为XPath的语法实在太简单了。下面通过一个实例来加深对XPath用法的理解。</p><h3 id="2-7-BeautifulSoup的HTML解析"><a href="#2-7-BeautifulSoup的HTML解析" class="headerlink" title="2.7 BeautifulSoup的HTML解析"></a>2.7 BeautifulSoup的HTML解析</h3><p>除了XPath，另一个非常流行、功能强大的数据解析工具就是BeautifulSoup了，它借助网页的结构和属性等特性来解析网页，只需要简单的几条语句，就可以完成网页中某个元素的提取。接下来就来感受一下Beautiful Soup的强大之处吧。</p><p>简单来说，Beautiful Soup就是Python的一个HTML或XML的解析库，可以用它来方便地从网页中提取数据。官方解释如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329120725.png" alt="Beautiful Soup官方解释"></p><p>Beautiful Soup已成为和lxml、html6lib一样出色的Python解释器，为用户灵活地提供不同的解析策略或强劲的速度。</p><h4 id="2-7-1-安装BeautifulSoup"><a href="#2-7-1-安装BeautifulSoup" class="headerlink" title="2.7.1 安装BeautifulSoup"></a>2.7.1 安装BeautifulSoup</h4><p>首先，我们需要安装BeautifulSoup。可以使用pip命令安装：</p><p>pip install beautifulsoup4</p><p>这个包兼容Python2和Python3。</p><h4 id="2-7-2-解析器"><a href="#2-7-2-解析器" class="headerlink" title="2.7.2 解析器"></a>2.7.2 解析器</h4><p>Beautiful Soup支持Python标准库中的HTML解析器,还支持一些第三方的解析器，如lxml。上一节我们已经安装了lxml。</p><p>下表列出了主要的解析器,以及它们的优缺点:</p><table><thead><tr><th><strong><em>\</em>解析器**</strong></th><th><strong><em>\</em>使用方法**</strong></th><th><strong><em>\</em>优势**</strong></th><th><strong><em>\</em>劣势**</strong></th></tr></thead><tbody><tr><td>Python标准库</td><td>BeautifulSoup(markup, “html.parser”)</td><td>ü Python的内置标准库ü 执行速度适中ü 文档容错能力强</td><td>Python 2.7.3 or 3.2.2)前 的版本中文档容错能力差</td></tr><tr><td>lxml HTML 解析器</td><td>BeautifulSoup(markup, “lxml”)</td><td>ü 速度快ü 文档容错能力强</td><td>需要安装C语言库</td></tr><tr><td>lxml XML 解析器</td><td>BeautifulSoup(markup, [“lxml”, “xml”])BeautifulSoup(markup, “xml”)</td><td>ü 速度快ü 唯一支持XML的解析器</td><td>需要安装C语言库</td></tr><tr><td>html5lib</td><td>BeautifulSoup(markup, “html5lib”)</td><td>ü 最好的容错性ü 以浏览器的方式解析文档ü 生成HTML5格式的文档</td><td>速度慢不依赖外部扩展</td></tr></tbody></table><p>推荐使用lxml作为解析器,因为效率更高。本课程默认使用的也是lxml。</p><h4 id="2-7-3-案例"><a href="#2-7-3-案例" class="headerlink" title="2.7.3 案例"></a>2.7.3 案例</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request<span class="token keyword">import</span> bs4res <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">"https://www.douban.com/tag/%E5%B0%8F%E8%AF%B4/?focus=book"</span><span class="token punctuation">)</span>soup <span class="token operator">=</span> bs4<span class="token punctuation">.</span>BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>book_div <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token string">"book"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>book_a <span class="token operator">=</span> book_div<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"class"</span><span class="token punctuation">:</span><span class="token string">"title"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">for</span> book <span class="token keyword">in</span> book_a<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-7-4-CSS选择器"><a href="#2-7-4-CSS选择器" class="headerlink" title="2.7.4 CSS选择器"></a>2.7.4 CSS选择器</h4><p>Beautiful Soup还提供了另外一种选择器，那就是CSS选择器。如果对Web开发熟悉的话，那么对CSS选择器肯定也不陌生。如果不熟悉的话，可以参考<a href="http://www.w3school.com.cn/cssref/css_selectors.asp%E4%BA%86%E8%A7%A3%E3%80%82" rel="external nofollow noreferrer">http://www.w3school.com.cn/cssref/css_selectors.asp了解。</a></p><p>使用CSS选择器时，只需要调用select()方法，传入相应的CSS选择器即可。</p><h3 id="2-8-多线程爬虫"><a href="#2-8-多线程爬虫" class="headerlink" title="2.8 多线程爬虫"></a>2.8 多线程爬虫</h3><p>到目前为止，我们实现的爬虫都是串行爬虫，即只有当前请求执行完后（爬取完成），才能执行下一个请求，就像排队一样，只能一个接一个的执行。很显然，这种方式效率比较低，当一个请求需要消耗较长时间时（如网络较慢、下载数据量较多、服务器问题等），爬虫就只能等待，直到运行完毕，才可以执行下一个请求。</p><p>为了解决以上问题，我们可以考虑使用多线程爬虫，即为爬虫开辟多个线程，每个线程负责处理一个页面的请求，当一个线程在等待时，进程就会切换执行另一个线程，提高了处理器运行的效率。</p><p>Python中内置了threading模块，用于实现多线程功能。</p><h4 id="2-8-1-线程方法"><a href="#2-8-1-线程方法" class="headerlink" title="2.8.1 线程方法"></a>2.8.1 线程方法</h4><table><thead><tr><th></th><th>方法</th><th>功能</th></tr></thead><tbody><tr><td>1</td><td>Thread(target,args)</td><td>新建线程对象</td></tr><tr><td>2</td><td>setDaemon()</td><td>守护线程。<br />True: 主线程执行完毕后会将子线程回收掉<br />False: 主进程执行结束时不会回收子线程</td></tr><tr><td>3</td><td>join()</td><td>等待至线程终止</td></tr><tr><td>4</td><td>start()</td><td>启动线程活动</td></tr><tr><td>5</td><td>isAlive()</td><td>判断线程是否活动</td></tr><tr><td>6</td><td>remove()</td><td>删除线程</td></tr></tbody></table><h4 id="2-8-2-线程创建"><a href="#2-8-2-线程创建" class="headerlink" title="2.8.2 线程创建"></a>2.8.2 线程创建</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=UTF-8</span><span class="token keyword">import</span> threading<span class="token comment" spellcheck="true"># 自定义线程类</span><span class="token keyword">class</span> <span class="token class-name">myThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 重写run方法</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>counter <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s called %d times'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 创建新线程</span>thread1 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread1"</span><span class="token punctuation">)</span>thread2 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread2"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 启动线程</span>thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Main thread called'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上的代码自定义一个线程类，继承于threading.Thread，并重写了<code>__init__</code>和<code>run</code>方法。</p><p>当创建新线程thread1和thread2之后，就可以通过调用start方法来自动调用线程的<strong>run</strong>执行方法了，run方法就是线程的主要执行函数。</p><p>在重载的<strong>run</strong>线程方法里，我们可以为不同的线程对象执行不同的代码来并行执行代码了。</p><p>以上的代码打印结果如下：</p><pre><code>Thread1 called 1 timesThread1 called 2 timesThread1 called 3 timesThread2 called 1 timesMain thread calledThread2 called 2 timesThread2 called 3 times</code></pre><h4 id="2-8-3-线程同步"><a href="#2-8-3-线程同步" class="headerlink" title="2.8.3 线程同步"></a>2.8.3 线程同步</h4><p>既然代码有多条不同的执行路径，代码的编写和调试就变得非常麻烦，因为可能一个变量会同时在多个线程中运行的情况，或者一段代码在未执行完的情况下，其中的值可能会受到其他执行线程的意外修改，导致实际执行结果与预期不符。</p><p>怎么解决这类问题呢？可以通过线程同步来解决，让一部分代码被保护起来，不允许并行执行。</p><p>使用Thread对象的Lock和Rlock可以实现简单的线程同步，这两个对象都有acquire方法和release方法，对于那些需要每次只允许一个线程操作的数据，可以将其操作放到acquire和release方法之间。如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=UTF-8</span><span class="token keyword">import</span> threading<span class="token comment" spellcheck="true"># 自定义线程类</span><span class="token keyword">class</span> <span class="token class-name">myThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 重写run方法</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        threadLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>counter <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s called %d times'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>        threadLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#创建线程锁</span>threadLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 创建新线程</span>thread1 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread1"</span><span class="token punctuation">)</span>thread2 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread2"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 启动线程</span>thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 等待线程退出</span>thread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>thread2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Main thread called'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过以上代码通过创建threadLock，在<code>run</code>语句中加入acquire和release保护打印语句，这样只有在release被执行后，其他的线程才能通过acquire获取到代码的执行权限。执行的结果如下：</p><pre><code>Thread1 called 1 timesThread1 called 2 timesThread1 called 3 timesThread2 called 1 timesThread2 called 2 timesThread2 called 3 timesMain thread called</code></pre><h4 id="2-8-4-线程队列"><a href="#2-8-4-线程队列" class="headerlink" title="2.8.4 线程队列"></a>2.8.4 线程队列</h4><p>以上的方式已经可以保护需要同步的数据了，而在实际代码编写中，数据可能会被不同的线程间共享处理，有没有一套比较好用的方法提供呢，今天它来了。</p><p>Python的Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先入先出)队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue。这些队列都实现了锁原语，能够在多线程中直接使用。可以使用队列来实现线程间的同步。</p><p>Queue模块中的常用方法:</p><ul><li>Queue.qsize() 返回队列的大小</li><li>Queue.empty() 如果队列为空，返回True,反之False</li><li>Queue.full() 如果队列满了，返回True,反之False</li><li>Queue.full 与 maxsize 大小对应</li><li>Queue.get([block[, timeout]])获取队列，timeout等待时间</li><li>Queue.get_nowait() 相当Queue.get(False)</li><li>Queue.put(item) 写入队列，timeout等待时间</li><li>Queue.put_nowait(item) 相当Queue.put(item, False)</li><li>Queue.task_done() 在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号</li><li>Queue.join() 实际上意味着等到队列为空，再执行别的操作</li></ul><p>参考代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue<span class="token keyword">import</span> threading<span class="token comment" spellcheck="true"># 输入数据的线程类</span><span class="token keyword">class</span> <span class="token class-name">inputThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>q <span class="token operator">=</span> q    <span class="token comment" spellcheck="true"># 重写run方法</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        dataList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"One"</span><span class="token punctuation">,</span> <span class="token string">"Two"</span><span class="token punctuation">,</span> <span class="token string">"Three"</span><span class="token punctuation">,</span> <span class="token string">"Four"</span><span class="token punctuation">,</span> <span class="token string">"Five"</span><span class="token punctuation">,</span> <span class="token string">'Exit'</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> data <span class="token keyword">in</span> dataList<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 输出数据的线程类</span><span class="token keyword">class</span> <span class="token class-name">outputThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>q <span class="token operator">=</span> q    <span class="token comment" spellcheck="true"># 重写run方法</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token string">'Exit'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s get data:%s'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 创建队列</span>q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 创建1个输入线程和两个输出线程</span>inputThread1 <span class="token operator">=</span> inputThread<span class="token punctuation">(</span><span class="token string">"inputThread1"</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>outputThread1 <span class="token operator">=</span> outputThread<span class="token punctuation">(</span><span class="token string">"outputThread1"</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 启动线程</span>inputThread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>outputThread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 等待线程退出</span>inputThread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>outputThread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Main thread called'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行结果</p><pre><code>outputThread1 get data:OneoutputThread1 get data:TwooutputThread1 get data:ThreeoutputThread1 get data:FouroutputThread1 get data:FiveMain thread called</code></pre><p>通过以上代码可以看到，一个生产和消费数据的典型案例，也符合很多的业务场景的使用。</p><h2 id="三、1天学会爬虫数据持久化保存"><a href="#三、1天学会爬虫数据持久化保存" class="headerlink" title="三、1天学会爬虫数据持久化保存"></a>三、1天学会爬虫数据持久化保存</h2><h3 id="3-1-Docker服务环境搭建"><a href="#3-1-Docker服务环境搭建" class="headerlink" title="3.1 Docker服务环境搭建"></a>3.1 Docker服务环境搭建</h3><p>docker 是通过 <code>yum install docker</code>安装的，搜了一把，原来是因为linux与docker版本的兼容性问题。那就卸载旧版本安装最新版试试。</p><h4 id="3-1-1-安装docker"><a href="#3-1-1-安装docker" class="headerlink" title="3.1.1 安装docker"></a>3.1.1 安装docker</h4><p>0.通过uname -r命令查看你当前的内核版本</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">uname</span> -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>1.使用 <code>root</code> 权限登录 CentOS。确保 yum 包更新到最新。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.卸载旧版本(如果安装过旧版本的话)</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum remove docker  docker-common docker-selinux docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3.安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.设置yum源</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5.可以查看所有仓库中所有docker版本，并选择特定版本安装</p><pre class="line-numbers language-bash"><code class="language-bash">yum list docker-ce --showduplicates <span class="token operator">|</span> <span class="token function">sort</span> -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>6.安装docker</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>7.启动并加入开机启动</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start docker<span class="token function">sudo</span> systemctl <span class="token function">enable</span> docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>8.验证安装是否成功(有client和service两部分表示docker安装启动都成功了)</p><pre class="line-numbers language-bash"><code class="language-bash">docker version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>经过以上一通操作，pull 一下镜像再执行docker run命令，问题解决。</p><p>官网地址:<a href="https://docs.docker.com/compose/install/" rel="external nofollow noreferrer">https://docs.docker.com/compose/install/</a></p><h4 id="3-1-2-安装Docker-Compose"><a href="#3-1-2-安装Docker-Compose" class="headerlink" title="3.1.2 安装Docker Compose"></a>3.1.2 安装Docker Compose</h4><p>1、运行此命令以下载Docker Compose的当前稳定版本</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L <span class="token string">"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以上运行过慢，换成国内的</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L <span class="token string">"https://get.daocloud.io/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2、对二进制文件应用可执行权限：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 3、参考官网如下</p><p>安装完成后，可通过测试命令查看版本</p><pre class="line-numbers language-bash"><code class="language-bash">docker-compose --version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-1-3-docker-compose-yml配置"><a href="#3-1-3-docker-compose-yml配置" class="headerlink" title="3.1.3 docker-compose.yml配置"></a>3.1.3 docker-compose.yml配置</h4><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2.0'</span><span class="token comment" spellcheck="true">#mysql mongo redis</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mongo    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"27017:27017"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/mongo/db<span class="token punctuation">:</span>/data/db    <span class="token comment" spellcheck="true">#数据挂载本地</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net      <span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 最好设置，因为数据库的日志占很大的内存，定期清理比较好</span>        <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"json-file"</span>   <span class="token comment" spellcheck="true"># 设置日志格式</span>        <span class="token key atrule">options</span><span class="token punctuation">:</span>           <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>  <span class="token comment" spellcheck="true"># 单个日志文件的最大内存</span>           <span class="token key atrule">max-file</span><span class="token punctuation">:</span> <span class="token string">"3"</span>   <span class="token comment" spellcheck="true">#最多保留几个文件，如果超多三个文件，会自动删除最早的一个</span>  <span class="token key atrule">mongo-express</span><span class="token punctuation">:</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mongo    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mongo<span class="token punctuation">-</span>express    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">-</span>express    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8081:8081"</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"6379:6379"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/redis<span class="token punctuation">:</span>/data    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/mysql<span class="token punctuation">:</span>/var/lib/mysql    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net    <span class="token key atrule">environment</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=123456  <span class="token comment" spellcheck="true">#设置root 用户密码</span>        <span class="token punctuation">-</span> MYSQL_DATABASE=testDB        <span class="token punctuation">-</span> MYSQL_USER=userName        <span class="token punctuation">-</span> MYSQL_PASSWORD=xxxxx  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> adminer    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8080:8080"</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net  <span class="token key atrule">phpredisadmin</span><span class="token punctuation">:</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> redis    <span class="token key atrule">image</span><span class="token punctuation">:</span> erikdubbelboer/phpredisadmin    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> phpredisadmin    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ADMIN_USER=admin      <span class="token punctuation">-</span> ADMIN_PASS=pass      <span class="token punctuation">-</span> REDIS_1_HOST=redis      <span class="token punctuation">-</span> REDIS_1_PORT=6379    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8082:80"</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net<span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true">#  设置网络，使当前配置中的container都处在同一个网络环境</span>  <span class="token key atrule">app-net</span><span class="token punctuation">:</span>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上的脚本会使用自创的app-net网络，让这些应用都在同一个网路下，通过以下命令创建app-net网络：</p><pre class="line-numbers language-bash"><code class="language-bash">docker network create app-net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在这个文件目录下执行<code>docker-compose up -d</code>会自动下载相关镜像。</p><p>第一次会自动下载相关的docker镜像，</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@aliyunhost docker<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker-compose up -d</span>Removing mongoRemoving redisRemoving mysqlRemoving adminerPulling mongo <span class="token punctuation">(</span>mongo:<span class="token punctuation">)</span><span class="token punctuation">..</span>.latest: Pulling from library/mongo6e0aa5e7af40: Pull completed47239a868b3: Pull complete49cbb10cca85: Pull complete9729d7ec22de: Pull complete7b7fd72268d8: Pull complete5e2934dacaf5: Pull completebf9da24d4b2c: Pull completed2f8c3715616: Pull completedac42b84e850: Pull complete0724cb122c25: Pull completef0fe10b8b0c1: Pull complete28e025c87f29: Pull completeDigest: sha256:75a5f624bd6d14254e0d84c2833f576109672750aaf2bf01d61cb5ead44f4505Status: Downloaded newer image <span class="token keyword">for</span> mongo:latestPulling mongo-express <span class="token punctuation">(</span>mongo-express:<span class="token punctuation">)</span><span class="token punctuation">..</span>.latest: Pulling from library/mongo-express839b45e0263a: Pull complete4e998bcc33c0: Pull completec22cf2090e91: Pull complete878525310d1a: Pull completedb887bbaed1c: Pull completed3a58ba86626: Pull completed6c8e5cc21ae: Pull complete38edb5da73d5: Pull completeDigest: sha256:15744add870beddeab3235fc6b32c45817d73cc035fa7a51cfc0137ff99c6ee2Status: Downloaded newer image <span class="token keyword">for</span> mongo-express:latestPulling redis <span class="token punctuation">(</span>redis:<span class="token punctuation">)</span><span class="token punctuation">..</span>.latest: Pulling from library/redisac2522cc7269: Pull completeb388ed2d8c47: Pull completebbeb7f306246: Pull complete0274447d4995: Pull complete599fc96d5a95: Pull complete7acf02fb3b33: Pull completeDigest: sha256:2d17fb90c268b1c7799234216c875490a35fe8fa13fbc5495b7247d93e77255eStatus: Downloaded newer image <span class="token keyword">for</span> redis:latestPulling mysql <span class="token punctuation">(</span>mysql:<span class="token punctuation">)</span><span class="token punctuation">..</span>.latest: Pulling from library/mysqlac2522cc7269: Already exists3ff4d5966d00: Pull completec8a8e9739c9e: Pull complete8fd773bacd12: Pull completeadbceeecb7f3: Pull complete6b53011e5d04: Pull complete32ae8cea62cb: Pull completecf09f068015c: Pull complete41d80f48621d: Pull completefa9d48194f31: Pull complete8ea01c86a52b: Pull complete69e9db22376c: Pull completeDigest: sha256:00b627abbd6e91d5d0e4be786869930497b9759bf40db3f15408bb894daf5263Status: Downloaded newer image <span class="token keyword">for</span> mysql:latestPulling adminer <span class="token punctuation">(</span>adminer:<span class="token punctuation">)</span><span class="token punctuation">..</span>.latest: Pulling from library/adminer9aae54b2144e: Pull complete0552190813ec: Pull completed6abf49ad7ff: Pull complete4a7b791901cf: Pull completef2ba0fadefcb: Pull complete636a54b61db2: Pull complete2e4910bcf8e6: Pull complete916259daac19: Pull complete964bb1b3446a: Pull complete8412ac9f0551: Pull complete801b463cfa6c: Pull complete830dcd0791af: Pull completeffd662d4e755: Pull completef636d4cf2f7f: Pull complete924162d16142: Pull completeDigest: sha256:1bf211fe728494901bba5461024fa8011182a97f8d5fbd121a19e58043e41e9eStatus: Downloaded newer image <span class="token keyword">for</span> adminer:latestPulling phpredisadmin <span class="token punctuation">(</span>erikdubbelboer/phpredisadmin:<span class="token punctuation">)</span><span class="token punctuation">..</span>.latest: Pulling from erikdubbelboer/phpredisadminDigest: sha256:a50ff6e3ec659a9f6a5b76952e1d3bc0547caf5c63a509092a0c6ab72a2c58caStatus: Downloaded newer image <span class="token keyword">for</span> erikdubbelboer/phpredisadmin:latestRecreating 184e4c8c516b_mysql   <span class="token punctuation">..</span>. <span class="token keyword">done</span>Recreating 9e802b5c3a7b_redis   <span class="token punctuation">..</span>. <span class="token keyword">done</span>Recreating e6584843b316_adminer <span class="token punctuation">..</span>. <span class="token keyword">done</span>Recreating 5a633dfe60eb_mongo   <span class="token punctuation">..</span>. <span class="token keyword">done</span>Creating mongo-express          <span class="token punctuation">..</span>. <span class="token keyword">done</span>Creating phpredisadmin          <span class="token punctuation">..</span>. <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看容器运行状态</p><pre><code>docker ps</code></pre><p>显示内容如下：</p><pre><code>CONTAINER ID   IMAGE                          COMMAND                  CREATED         STATUS         PORTS                               NAMESd15264f725ab   erikdubbelboer/phpredisadmin   &quot;tini -- php -S 0.0.…&quot;   2 minutes ago   Up 2 minutes   0.0.0.0:8082-&gt;80/tcp                phpredisadmineb74afe91d88   mongo-express                  &quot;tini -- /docker-ent…&quot;   2 minutes ago   Up 2 minutes   0.0.0.0:8081-&gt;8081/tcp              mongo-expresscf9bc31fa915   redis                          &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 2 minutes   6379/tcp, 0.0.0.0:8379-&gt;8379/tcp    redis608b3a3fcabe   mysql                          &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 2 minutes   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql4b78e3790fb2   adminer                        &quot;entrypoint.sh docke…&quot;   3 minutes ago   Up 2 minutes   0.0.0.0:8080-&gt;8080/tcp              adminer3591a2841870   mongo                          &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 2 minutes   0.0.0.0:27017-&gt;27017/tcp            mongo</code></pre><h4 id="3-1-4-各服务安装验证"><a href="#3-1-4-各服务安装验证" class="headerlink" title="3.1.4 各服务安装验证"></a>3.1.4 各服务安装验证</h4><p>以上说明相关的服务已经启动了，端口分别是，adminer（8888），mongo-express（8081），phpredisadmin（8082），确保你的服务器对应的端口是可以访问的，如果不能访问，需要去服务器的控制台设置入站规则。如果本地启动的话直接访问就可以了。</p><p>mongo-express界面</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329183456.png" alt="image-20210329183456045"></p><p>adminer界面,登录的服务器就是在docker-compose.yml中设置的 mysql，用户是root用户，密码是MYSQL_ROOT_PASSWORD对应的密码</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329183721.png" alt="mysql配置服务名称和登录密码"></p><p>通过端口8080登录mysql服务：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329183840.png" alt="登录mysql"></p><p>登录成功后，可对mysql数据库进行增删改查，界面如下：<img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329184012.png" alt="image-20210329184012060"></p><p>Redis登录界面</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329184647.png" alt="Redis登录界面"></p><p>用户名密码参考docker-compose.yml配置文件：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329184747.png" alt="Redis账号密码配置文件"></p><p>是不是很简单，只要有这个配置文件，不管在哪，只要装好docker ，一个启动指令，一切就都搞定了。</p><h3 id="3-2-文件保存"><a href="#3-2-文件保存" class="headerlink" title="3.2 文件保存"></a>3.2 文件保存</h3><h4 id="3-2-1-普通文件"><a href="#3-2-1-普通文件" class="headerlink" title="3.2.1 普通文件"></a>3.2.1 普通文件</h4><p>具体步骤</p><table><thead><tr><th>操作方式</th><th>伪代码</th></tr></thead><tbody><tr><td>打开文件</td><td>&lt;变量名&gt; = open(&lt;文件名&gt;,&lt;打开模式&gt;)</td></tr><tr><td>关闭文件</td><td>&lt;变量名&gt; = close()</td></tr><tr><td>文件操作</td><td>读写：&lt;变量名&gt;.read() / &lt;变量名&gt;.write()</td></tr></tbody></table><p>代码如下：</p><p>第一行：<code>./</code>表示打开当前目录下的<code>file.txt</code>，以<code>w</code>写方式打开，文件的编码方式为<code>&#39;utf-8&#39;</code></p><p>第二行：向已经打开的<code>f</code>这个文件中<code>write</code>写入一个字符串<code>&quot;test&quot;</code></p><p>第三行：把缓存中的数据写入file.txt中并<code>close</code>关闭文件</p><pre class="line-numbers language-python"><code class="language-python">f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'./file.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 打开文件</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 文件操作</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 关闭文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或上下文管理器with语句</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> open <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'./file.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf=8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>文件打开模式</p><table><thead><tr><th>文件打开模式</th><th>描述</th></tr></thead><tbody><tr><td>‘r’</td><td>只读模式，默认，若文件不存在，返回FileNotFoundError</td></tr><tr><td>‘w’</td><td>覆盖写，若不存在则创建文件，存在则覆盖原文</td></tr><tr><td>‘x’</td><td>创建写，若不存在则创建文件，存在则返回FileExistsError</td></tr><tr><td>‘a’</td><td>追加写，若不存在则创建文件，存在则在文件内容后追加写</td></tr><tr><td>‘b’</td><td>二进制模式</td></tr><tr><td>‘t’</td><td>文本模式，默认值</td></tr><tr><td>‘+’</td><td>与r/w/x/a/一同使用，在原功能基础上增加同时读写功能</td></tr></tbody></table><p>文件读取操作函数</p><table><thead><tr><th>函数名</th><th>描述</th></tr></thead><tbody><tr><td>.read(size=-1)</td><td>读入全部内容并返回，若有参数读入前size长度</td></tr><tr><td>.readline(size=-1)</td><td>读入一行内容并返回，若有参数，读入该行前size长度</td></tr><tr><td>.readlines(hint=-1)</td><td>读入所有行并返回一个列表，若有参数，读入前hint行</td></tr></tbody></table><p>文件写入操作函数</p><table><thead><tr><th>函数名</th><th>描述</th></tr></thead><tbody><tr><td>.write(s)</td><td>写入一个字符串或字节流</td></tr><tr><td>.writelines(lines)</td><td>将一个元素全为字符串的列表拼接后，写入文件</td></tr><tr><td>.seek(offset)</td><td>改变当前文件操作指针的位置，offset含义如下:<br/>0 - 文件开头；<br/>1 - 当前位置；<br/>2 - 文件结尾。</td></tr></tbody></table><h4 id="3-2-2-csv文件"><a href="#3-2-2-csv文件" class="headerlink" title="3.2.2 csv文件"></a>3.2.2 csv文件</h4><p>CSV（逗号分隔值）是在电子表格和数据库中使用的非常流行的导入和导出数据格式。 CSV 文件中的每一行都是一个数据记录。 每个记录由一个或多个字段组成，用逗号分隔。 CSV 是一种非常简单的数据格式，但是可以有很多差异，例如不同的定界符，换行或引号字符。</p><p><strong>Python CSV 模块</strong></p><p><code>csv</code>模块实现用于以 CSV 格式读取和写入表格数据的类。 <code>csv</code>模块的<code>reader</code>和<code>writer</code>对象读取和写入序列。 程序员还可以使用<code>DictReader</code>和<code>DictWriter</code>类以字典形式读取和写入数据。</p><p><strong>Python CSV 方法</strong></p><p>下表显示了Python csv方法：</p><table><thead><tr><th align="center">方法</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center"><code>csv.reader</code></td><td align="center">返回一个遍历 CSV 文件各行的读取器对象</td></tr><tr><td align="center"><code>csv.writer</code></td><td align="center">返回将数据写入 CSV 文件的写入器对象</td></tr><tr><td align="center"><code>csv.register_dialect</code></td><td align="center">注册 CSV 方言</td></tr><tr><td align="center"><code>csv.unregister_dialect</code></td><td align="center">注销 CSV 方言</td></tr><tr><td align="center"><code>csv.get_dialect</code></td><td align="center">返回具有给定名称的方言</td></tr><tr><td align="center"><code>csv.list_dialects</code></td><td align="center">返回所有已注册的方言</td></tr><tr><td align="center"><code>csv.field_size_limit</code></td><td align="center">返回解析器允许的当前最大字段大小</td></tr></tbody></table><p>使用 Python <code>csv</code>模块</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>要使用 Python CSV 模块，我们导入<code>csv</code>。</p><p><strong>Python CSV 读取器</strong></p><p><code>csv.reader()</code>方法返回一个读取器对象，该对象遍历给定 CSV 文件中的行。</p><pre class="line-numbers language-python"><code class="language-python">$ cat numbers<span class="token punctuation">.</span>csv <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>numbers.csv</code>文件包含数字。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csvf <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'numbers.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>        <span class="token keyword">for</span> e <span class="token keyword">in</span> row<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在代码示例中，我们打开<code>numbers.csv</code>进行读取并读取其内容。</p><pre class="line-numbers language-python"><code class="language-python">reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们得到<code>reader</code>对象。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>    <span class="token keyword">for</span> e <span class="token keyword">in</span> row<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>通过两个 for 循环，我们遍历数据。</p><pre class="line-numbers language-bash"><code class="language-bash">$ ./read_csv.py 166412816716<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是示例的输出。</p><p><strong>具有不同分隔符的 Python CSV 读取器</strong></p><p><code>csv.reader()</code>方法允许使用带有<code>delimiter</code>属性的不同定界符。</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">cat</span> items.csv pen<span class="token operator">|</span>cup<span class="token operator">|</span>bottlechair<span class="token operator">|</span>book<span class="token operator">|</span>tablet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>items.csv</code>包含用“ |”分隔的值 字符。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csvf <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'items.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">"|"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>        <span class="token keyword">for</span> e <span class="token keyword">in</span> row<span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该代码示例从使用’|’的 CSV 文件读取并显示数据。 定界符。</p><pre class="line-numbers language-bash"><code class="language-bash">$ ./read_csv2.py pencupbottlechairbooktablet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是示例的输出。</p><p><strong>Python CSV <code>DictReader</code></strong></p><p><code>csv.DictReader</code>类的操作类似于常规读取器，但会将读取的信息映射到字典中。 字典的键可以使用<code>fieldnames</code>参数传入，也可以从 CSV 文件的第一行推断出来。</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">cat</span> values.csv min,avg,max1, 5.5, 102, 3.5, 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>文件的第一行包含字典键。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csvf <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'values.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'avg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该示例使用<code>csv.DictReader</code>从<code>values.csv</code>文件中读取值。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'avg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>该行是 Python 字典，我们使用键引用数据。</p><p><strong>Python CSV 编写器</strong></p><p><code>csv.writer()</code>方法返回一个 writer 对象，该对象将用户数据转换为给定文件状对象上的定界字符串。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csvnms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'numbers2.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> nms<span class="token punctuation">:</span>        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该脚本将数字写入<code>numbers2.csv</code>文件。 <code>writerow()</code>方法将一行数据写入指定的文件。</p><pre class="line-numbers language-python"><code class="language-python">$ cat numbers2<span class="token punctuation">.</span>csv <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>一次写入所有数据是可能的。 <code>writerows()</code>方法将所有给定的行写入 CSV 文件。</p><pre class="line-numbers language-python"><code class="language-python">write_csv2<span class="token punctuation">.</span>py<span class="token comment" spellcheck="true">#!/usr/bin/python3</span><span class="token keyword">import</span> csvnms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'numbers3.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span>nms<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该代码示例使用<code>writerows()</code>方法将三行数字写入文件。</p><p><strong>Python CSV <code>DictWriter</code></strong></p><p><code>csv.DictWriter</code>类的操作类似于常规编写器，但将 Python 词典映射到 CSV 行。 <code>fieldnames</code>参数是一系列键，这些键标识传递给<code>writerow()</code>方法的字典中的值写入 CSV 文件的顺序。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csvf <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'names.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">]</span>    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>fnames<span class="token punctuation">)</span>        writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Smith'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'Robert'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Brown'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'Julia'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Griffin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该示例使用<code>csv.DictWriter</code>将 Python 词典中的值写入 CSV 文件。</p><pre class="line-numbers language-python"><code class="language-python">writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>fnames<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建了新的<code>csv.DictWriter</code>。 标头名称将传递给<code>fieldnames</code>参数。</p><pre class="line-numbers language-python"><code class="language-python">writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>writeheader()</code>方法将标头写入 CSV 文件。</p><pre class="line-numbers language-python"><code class="language-python">writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Smith'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Python 字典被写入 CSV 文件中的一行。</p><pre class="line-numbers language-python"><code class="language-python">$ cat names<span class="token punctuation">.</span>csv first_name<span class="token punctuation">,</span>last_nameJohn<span class="token punctuation">,</span>SmithRobert<span class="token punctuation">,</span>BrownJulia<span class="token punctuation">,</span>Griffin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是输出。</p><p><strong>Python CSV 自定义方言</strong></p><p>使用<code>csv.register_dialect()</code>方法创建自定义方言。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csvcsv<span class="token punctuation">.</span>register_dialect<span class="token punctuation">(</span><span class="token string">"hashes"</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">"#"</span><span class="token punctuation">)</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'items3.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token keyword">with</span> f<span class="token punctuation">:</span>    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dialect<span class="token operator">=</span><span class="token string">"hashes"</span><span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"pens"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"plates"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"bottles"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"cups"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该程序使用（# ）字符作为分隔符。 使用<code>csv.writer()</code>方法中的<code>dialect</code>选项指定方言。</p><pre class="line-numbers language-python"><code class="language-python">$ cat items3<span class="token punctuation">.</span>csv pens<span class="token comment" spellcheck="true">#4</span>plates<span class="token comment" spellcheck="true">#2</span>bottles<span class="token comment" spellcheck="true">#4</span>cups<span class="token comment" spellcheck="true">#1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是输出。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv<span class="token comment" spellcheck="true"># 创建CSV文件</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'./favorite_movies.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'电影名'</span><span class="token punctuation">,</span> <span class="token string">'得分'</span><span class="token punctuation">,</span> <span class="token string">'演员'</span><span class="token punctuation">,</span> <span class="token string">'链接地址'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'机器人总动员'</span><span class="token punctuation">,</span> <span class="token number">9.3</span><span class="token punctuation">,</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'kui.ge'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-Mysql数据库存储"><a href="#3-3-Mysql数据库存储" class="headerlink" title="3.3 Mysql数据库存储"></a>3.3 Mysql数据库存储</h3><h4 id="3-3-1-数据库安装"><a href="#3-3-1-数据库安装" class="headerlink" title="3.3.1 数据库安装"></a>3.3.1 数据库安装</h4><p><strong>pip安装方式</strong></p><pre><code>pip3 install PyMySQL</code></pre><p><strong>git安装</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/PyMySQL/PyMySQL<span class="token function">cd</span> PyMySQL/python3 setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>curl命令安装</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># X.X 为 PyMySQL 的版本号</span>curl -L https://github.com/PyMySQL/PyMySQL/tarball/pymysql-X.X <span class="token operator">|</span> <span class="token function">tar</span> xz<span class="token function">cd</span> PyMySQL*python3 setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意：</strong>请确保您有root权限来安装上述模块。</p><p>安装的过程中可能会出现”ImportError: No module named setuptools”的错误提示，意思是你没有安装setuptools，你可以访问<a href="https://pypi.python.org/pypi/setuptools" rel="external nofollow noreferrer">https://pypi.python.org/pypi/setuptools</a> 找到各个系统的安装方法。</p><p>Linux 系统安装实例：</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">wget</span> https://bootstrap.pypa.io/ez_setup.py$ python3 ez_setup.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3-3-2-数据库连接"><a href="#3-3-2-数据库连接" class="headerlink" title="3.3.2 数据库连接"></a>3.3.2 数据库连接</h4><p>连接数据库前，请先确认以下事项：</p><ul><li>您已经创建了数据库 TESTDB.</li><li>在TESTDB数据库中您已经创建了表 EMPLOYEE</li><li>EMPLOYEE表字段为 FIRST_NAME, LAST_NAME, AGE, SEX 和 INCOME。</li><li>连接数据库TESTDB使用的用户名为 “root” ，密码为 “123456”,你可以自己设定，Mysql数据库用户授权请使用Grant命令。</li><li>在你的机子上已经安装了 Python PyMySQL模块。</li><li>如果您对sql语句不熟悉，可以参考本文正在使用的参考教程<a href="https://www.runoob.com/sql/sql-tutorial.html" rel="external nofollow noreferrer">SQL基础教程</a></li></ul><p>连接数据库方法原型：</p><pre class="line-numbers language-python"><code class="language-python">pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">,</span>    host<span class="token operator">=</span>None<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 要连接的主机地址</span>    user<span class="token operator">=</span>None<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 用于登录的数据库用户</span>    password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 密码</span>    database<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># 要连接的数据库</span>    port<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># 端口，一般为 3306</span>    unix_socket<span class="token operator">=</span>None<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 选择是否要用unix_socket而不是TCP/IP</span>    charset<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>         <span class="token comment" spellcheck="true"># 字符编码</span>    sql_mode<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># Default SQL_MODE to use.</span>    read_default_file<span class="token operator">=</span>None<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 从默认配置文件(my.ini或my.cnf)中读取参数</span>    conv<span class="token operator">=</span>None<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 转换字典</span>    use_unicode<span class="token operator">=</span>None<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 是否使用 unicode 编码</span>    client_flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># Custom flags to send to MySQL. Find potential values in constants.CLIENT.</span>    cursorclass<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pymysql.cursors.Cursor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 选择 Cursor 类型</span>    init_command<span class="token operator">=</span>None<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 连接建立时运行的初始语句 </span>    connect_timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 连接超时时间，(default: 10, min: 1, max: 31536000)</span>    ssl<span class="token operator">=</span>None<span class="token punctuation">,</span>           <span class="token comment" spellcheck="true"># A dict of arguments similar to mysql_ssl_set()'s parameters.For now the capath and cipher arguments are not supported. </span>    read_default_group<span class="token operator">=</span>None<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># Group to read from in the configuration file.</span>    compress<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># 不支持</span>    named_pipe<span class="token operator">=</span>None<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 不支持</span>    no_delay<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># </span>    autocommit<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 是否自动提交事务</span>    db<span class="token operator">=</span>None<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 同 database，为了兼容 MySQLdb</span>    passwd<span class="token operator">=</span>None<span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 同 password，为了兼容 MySQLdb</span>    local_infile<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 是否允许载入本地文件</span>    max_allowed_packet<span class="token operator">=</span><span class="token number">16777216</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 限制 `LOCAL DATA INFILE` 大小</span>    defer_connect<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># Don't explicitly connect on contruction - wait for connect call.</span>    auth_plugin_map<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#</span>    read_timeout<span class="token operator">=</span>None<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># </span>    write_timeout<span class="token operator">=</span>None<span class="token punctuation">,</span>     bind_address<span class="token operator">=</span>None   <span class="token comment" spellcheck="true"># 当客户有多个网络接口，指定一个连接到主机</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以下实例链接 Mysql 的 TESTDB 数据库：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用 cursor() 方法创建一个游标对象 cursor</span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用 execute()  方法执行 SQL 查询 </span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT VERSION()"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用 fetchone() 方法获取单条数据.</span>data <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Database version : %s "</span> <span class="token operator">%</span> data<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭数据库连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行以上脚本输出结果如下：</p><pre><code>Database version : 5.5.20-log</code></pre><h4 id="3-3-3-创建数据库表"><a href="#3-3-3-创建数据库表" class="headerlink" title="3.3.3 创建数据库表"></a>3.3.3 创建数据库表</h4><p>如果数据库连接存在我们可以使用execute()方法来为数据库创建表，如下所示创建表EMPLOYEE：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用 cursor() 方法创建一个游标对象 cursor</span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用 execute() 方法执行 SQL，如果表存在则删除</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"DROP TABLE IF EXISTS EMPLOYEE"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用预处理语句创建表</span>sql <span class="token operator">=</span> <span class="token triple-quoted-string string">"""CREATE TABLE EMPLOYEE (         FIRST_NAME  CHAR(20) NOT NULL,         LAST_NAME  CHAR(20),         AGE INT,           SEX CHAR(1),         INCOME FLOAT )"""</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭数据库连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-4-数据库插入"><a href="#3-3-4-数据库插入" class="headerlink" title="3.3.4 数据库插入"></a>3.3.4 数据库插入</h4><p>以下实例使用执行 SQL INSERT 语句向表 EMPLOYEE 插入记录：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># SQL 插入语句</span>sql <span class="token operator">=</span> <span class="token triple-quoted-string string">"""INSERT INTO EMPLOYEE(FIRST_NAME,         LAST_NAME, AGE, SEX, INCOME)         VALUES ('Mac', 'Mohan', 20, 'M', 2000)"""</span><span class="token keyword">try</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 执行sql语句</span>   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 提交到数据库执行</span>   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 如果发生错误则回滚</span>   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭数据库连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上例子也可以写成如下形式：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># SQL 插入语句</span>sql <span class="token operator">=</span> "INSERT INTO EMPLOYEE<span class="token punctuation">(</span>FIRST_NAME<span class="token punctuation">,</span> \       LAST_NAME<span class="token punctuation">,</span> AGE<span class="token punctuation">,</span> SEX<span class="token punctuation">,</span> INCOME<span class="token punctuation">)</span> \       VALUES <span class="token punctuation">(</span><span class="token string">'%s'</span><span class="token punctuation">,</span> <span class="token string">'%s'</span><span class="token punctuation">,</span>  <span class="token operator">%</span>s<span class="token punctuation">,</span>  <span class="token string">'%s'</span><span class="token punctuation">,</span>  <span class="token operator">%</span>s<span class="token punctuation">)</span>" <span class="token operator">%</span> \       <span class="token punctuation">(</span><span class="token string">'Mac'</span><span class="token punctuation">,</span> <span class="token string">'Mohan'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 执行sql语句</span>   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 执行sql语句</span>   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭数据库连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以下代码使用变量向SQL语句中传递参数:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>user_id <span class="token operator">=</span> <span class="token string">"username"</span>password <span class="token operator">=</span> <span class="token string">"password"</span>con<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into Login values( %s,  %s)'</span> <span class="token operator">%</span> \             <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-5-数据库查询"><a href="#3-3-5-数据库查询" class="headerlink" title="3.3.5 数据库查询"></a>3.3.5 数据库查询</h4><p>Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。</p><ul><li><strong>fetchone():</strong> 该方法获取下一个查询结果集。结果集是一个对象</li><li><strong>fetchall():</strong> 接收全部的返回结果行.</li><li><strong>rowcount:</strong> 这是一个只读属性，并返回执行execute()方法后影响的行数。</li></ul><p>查询EMPLOYEE表中salary（工资）字段大于1000的所有数据：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># SQL 查询语句</span>sql <span class="token operator">=</span> "SELECT <span class="token operator">*</span> FROM EMPLOYEE \       WHERE INCOME <span class="token operator">></span> <span class="token operator">%</span>s" <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 执行SQL语句</span>   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 获取所有记录列表</span>   results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">:</span>      fname <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      lname <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      age <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>      sex <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>      income <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>       <span class="token comment" spellcheck="true"># 打印结果</span>      <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"fname=%s,lname=%s,age=%s,sex=%s,income=%s"</span> <span class="token operator">%</span> \             <span class="token punctuation">(</span>fname<span class="token punctuation">,</span> lname<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> income <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Error: unable to fetch data"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭数据库连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上脚本执行结果如下：</p><pre><code>fname=Mac, lname=Mohan, age=20, sex=M, income=2000</code></pre><h4 id="3-3-6-数据库更新"><a href="#3-3-6-数据库更新" class="headerlink" title="3.3.6 数据库更新"></a>3.3.6 数据库更新</h4><p>更新操作用于更新数据表的的数据，以下实例将 TESTDB 表中 SEX 为 ‘M’ 的 AGE 字段递增 1：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># SQL 更新语句</span>sql <span class="token operator">=</span> <span class="token string">"UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = '%c'"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 执行SQL语句</span>   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 提交到数据库执行</span>   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭数据库连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-7-数据库删除"><a href="#3-3-7-数据库删除" class="headerlink" title="3.3.7 数据库删除"></a>3.3.7 数据库删除</h4><p>删除操作用于删除数据表中的数据，以下实例演示了删除数据表 EMPLOYEE 中 AGE 大于 20 的所有数据：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token comment" spellcheck="true"># 打开数据库连接</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># SQL 删除语句</span>sql <span class="token operator">=</span> <span class="token string">"DELETE FROM EMPLOYEE WHERE AGE > %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 执行SQL语句</span>   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 提交修改</span>   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 关闭连接</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-8-执行事务"><a href="#3-3-8-执行事务" class="headerlink" title="3.3.8 执行事务"></a>3.3.8 执行事务</h4><p>事务机制可以确保数据一致性。</p><p>事务应该具有4个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。</p><ul><li>原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。</li><li>一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。</li><li>隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</li><li>持久性（durability）。持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。</li></ul><p>Python DB API 2.0 的事务提供了两个方法 commit 或 rollback。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># SQL删除记录语句</span>sql <span class="token operator">=</span> <span class="token string">"DELETE FROM EMPLOYEE WHERE AGE > %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 执行SQL语句</span>   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 向数据库提交</span>   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于支持事务的数据库， 在Python数据库编程中，当游标建立之时，就自动开始了一个隐形的数据库事务。</p><p>commit()方法游标的所有更新操作，rollback（）方法回滚当前游标的所有操作。每一个方法都开始了一个新的事务。</p><h4 id="3-3-9-错误处理"><a href="#3-3-9-错误处理" class="headerlink" title="3.3.9 错误处理"></a>3.3.9 错误处理</h4><p>DB API中定义了一些数据库操作的错误及异常，下表列出了这些错误和异常:</p><table><thead><tr><th align="left">异常</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">Warning</td><td align="left">当有严重警告时触发，例如插入数据是被截断等等。必须是 StandardError 的子类。</td></tr><tr><td align="left">Error</td><td align="left">警告以外所有其他错误类。必须是 StandardError 的子类。</td></tr><tr><td align="left">InterfaceError</td><td align="left">当有数据库接口模块本身的错误（而不是数据库的错误）发生时触发。 必须是Error的子类。</td></tr><tr><td align="left">DatabaseError</td><td align="left">和数据库有关的错误发生时触发。 必须是Error的子类。</td></tr><tr><td align="left">DataError</td><td align="left">当有数据处理时的错误发生时触发，例如：除零错误，数据超范围等等。 必须是DatabaseError的子类。</td></tr><tr><td align="left">OperationalError</td><td align="left">指非用户控制的，而是操作数据库时发生的错误。例如：连接意外断开、 数据库名未找到、事务处理失败、内存分配错误等等操作数据库是发生的错误。 必须是DatabaseError的子类。</td></tr><tr><td align="left">IntegrityError</td><td align="left">完整性相关的错误，例如外键检查失败等。必须是DatabaseError子类。</td></tr><tr><td align="left">InternalError</td><td align="left">数据库的内部错误，例如游标（cursor）失效了、事务同步失败等等。 必须是DatabaseError子类。</td></tr><tr><td align="left">ProgrammingError</td><td align="left">程序错误，例如数据表（table）没找到或已存在、SQL语句语法错误、 参数数量错误等等。必须是DatabaseError的子类。</td></tr><tr><td align="left">NotSupportedError</td><td align="left">不支持错误，指使用了数据库不支持的函数或API等。例如在连接对象上 使用.rollback()函数，然而数据库并不支持事务或者事务已关闭。 必须是DatabaseError的子类。</td></tr></tbody></table><h3 id="3-4-MongoDB数据库存储"><a href="#3-4-MongoDB数据库存储" class="headerlink" title="3.4 MongoDB数据库存储"></a>3.4 MongoDB数据库存储</h3><p>MongoDB 是目前最流行的 NoSQL 数据库之一，使用的数据类型 BSON（类似 JSON）。</p><p>MongoDB 官网地址：<a href="https://www.mongodb.com/" rel="external nofollow noreferrer">https://www.mongodb.com/</a></p><p>MongoDB 官方英文文档：<a href="https://docs.mongodb.com/manual/" rel="external nofollow noreferrer">https://docs.mongodb.com/manual/</a></p><p>MongoDB 各平台下载地址：<a href="https://www.mongodb.com/download-center#community" rel="external nofollow noreferrer">https://www.mongodb.com/download-center#community</a></p><h4 id="3-4-1-创建数据库"><a href="#3-4-1-创建数据库" class="headerlink" title="3.4.1 创建数据库"></a>3.4.1 创建数据库</h4><p>可以通过以下的方式创建数据库，并创建出数据库中的集合。需要注意的是，只有增加数据后，数据库才会真正的创建。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 创建数据库</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置数据库名</span><span class="token comment" spellcheck="true"># 创建集合</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-2-数据库添加数据"><a href="#3-4-2-数据库添加数据" class="headerlink" title="3.4.2 数据库添加数据"></a>3.4.2 数据库添加数据</h4><p>MongoDB 中的一个文档类似 SQL 表中的一条记录。</p><p><strong>插入集合</strong></p><p>集合中插入文档使用 <strong>insert_one()</strong> 方法，该方法的第一参数是字典 <strong>name =&gt; value</strong> 对。</p><p>以下实例向 <strong>sets</strong> 集合中插入文档：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>dict <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mongdb插入测试"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://kui.ge"</span> <span class="token punctuation">}</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span>dict<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行输出结果如下，返回的是一个_id字段，<strong>insert_one()</strong> 方法返回 <strong>InsertOneResult</strong> 对象，该对象包含 <strong>inserted_id</strong> 属性，它是插入文档的 <strong>id</strong> 值。</p><pre><code>&lt;pymongo.results.InsertOneResult object at 0x04862F58&gt;</code></pre><p><strong>插入多个文档</strong></p><p>集合中插入多个文档使用 <strong>insert_many()</strong> 方法，该方法的第一参数是字典列表。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>list <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Taobao"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.taobao.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"QQ"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"101"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.qq.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Facebook"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.facebook.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"知乎"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"103"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.zhihu.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Github"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"109"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.github.com"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>insert_many<span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 输出插入的所有文档对应的 _id 值</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>inserted_ids<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果类似如下：</p><pre><code>[ObjectId(&#39;607c3705e4a349efbcb257cc&#39;), ObjectId(&#39;607c3705e4a349efbcb257cd&#39;), ObjectId(&#39;607c3705e4a349efbcb257ce&#39;), ObjectId(&#39;607c3705e4a349efbcb257cf&#39;), ObjectId(&#39;607c3705e4a349efbcb257d0&#39;)]</code></pre><p><strong>insert_many()</strong> 方法返回 <strong>InsertManyResult</strong> 对象，该对象包含 <strong>inserted_ids</strong> 属性，该属性保存着所有插入文档的 <strong>id</strong> 值。</p><p><strong>插入指定 _id 的多个文档</strong></p><p>我们也可以自己指定 id插入，以下实例我们在 sets 集合中插入数据，<strong>_id</strong> 为我们指定的：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>list <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"马斯克"</span><span class="token punctuation">,</span> <span class="token string">"company"</span><span class="token punctuation">:</span> <span class="token string">"spaceX"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"乔布斯"</span><span class="token punctuation">,</span> <span class="token string">"company"</span><span class="token punctuation">:</span> <span class="token string">"苹果"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"瓦力"</span><span class="token punctuation">,</span> <span class="token string">"company"</span><span class="token punctuation">:</span> <span class="token string">"机器人总动员"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>insert_many<span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 输出插入的所有文档对应的 _id 值</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>inserted_ids<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开mongodb数据库查看内容如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418215151.png" alt="image-20210418215151528"></p><h4 id="3-4-3-查询数据"><a href="#3-4-3-查询数据" class="headerlink" title="3.4.3 查询数据"></a>3.4.3 查询数据</h4><p>MongoDB 中使用了 find 和 find_one 方法来查询集合中的数据，它类似于 SQL 中的 SELECT 语句。</p><p><strong>查询一条数据</strong></p><p>我们可以使用 <strong>find_one()</strong> 方法来查询集合中的一条数据。</p><p>查询 <strong>sets</strong> 文档中的第一条数据：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>查询集合中所有数据</strong></p><p><strong>find()</strong> 方法可以查询集合中的所有数据，类似 SQL 中的 <strong>SELECT *</strong> 操作。</p><p>以下实例查找 <strong>sets</strong> 集合中的所有数据：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span><span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257ce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'103'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257d0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'109'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'spaceX'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'苹果'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>查询指定字段的数据</strong></p><p>除了 _id 之外，不能同时在find中的一个对象中指定 0 和 1，如果你设置了一个字段为 0，则其他都为 1，反之亦然。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span><span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输入结果如下，可以看到只显示name和url字段，其他字段不会显示。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>根据指定条件查询</strong></p><p>我们可以在 <strong>find()</strong> 中设置参数来过滤数据。</p><p>以下实例查找 name 字段为 “瓦力” 的数据：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"瓦力"</span> <span class="token punctuation">}</span>doc <span class="token operator">=</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token keyword">for</span> x <span class="token keyword">in</span> doc<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示结果如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-4-4-修改数据"><a href="#3-4-4-修改数据" class="headerlink" title="3.4.4 修改数据"></a>3.4.4 修改数据</h4><p>在 MongoDB 中使用 <strong>update_one()</strong> 方法修改文档中的记录。该方法第一个参数为查询的条件，第二个参数为要修改的字段。如果查找到的匹配数据多于一条，则只会修改第一条。</p><p>测试数据内容：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257ce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'103'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257d0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'109'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'spaceX'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'苹果'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以下示例将 alexa 字段的值 100 改为 99:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"100"</span> <span class="token punctuation">}</span>new <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"$set"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"99"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>sets<span class="token punctuation">.</span>update_one<span class="token punctuation">(</span>query<span class="token punctuation">,</span> new<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 输出修改后的  "sets"  集合</span><span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"99"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示结果为：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'99'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>update_one()</strong> 方法只能修匹配到的第一条记录，如果要修改所有匹配到的记录，可以使用 **update_many()**。</p><p>以下实例将查找所有以 <strong>F</strong> 开头的 <strong>name</strong> 字段，并将匹配到所有记录的 <strong>alexa</strong> 字段修改为 <strong>123</strong>：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"$regex"</span><span class="token punctuation">:</span> <span class="token string">"^F"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>new <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"$set"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>update_many<span class="token punctuation">(</span>query<span class="token punctuation">,</span> new<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>modified_count<span class="token punctuation">,</span> <span class="token string">"文档已修改"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示结果为：</p><pre><code>1 文档已修改</code></pre><h4 id="3-4-5-排序数据"><a href="#3-4-5-排序数据" class="headerlink" title="3.4.5 排序数据"></a>3.4.5 排序数据</h4><p><strong>sort()</strong> 方法可以指定升序或降序排序。</p><p><strong>sort()</strong> 方法第一个参数为要排序的字段，第二个字段指定排序规则，<strong>1</strong> 为升序，**-1** 为降序，默认为升序。</p><p>对字段 alexa 按升序排序：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 升序排列</span>doc <span class="token operator">=</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">"alexa"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 降序排列</span><span class="token comment" spellcheck="true"># doc = sets.find().sort("alexa", -1)</span><span class="token keyword">for</span> x <span class="token keyword">in</span> doc<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-6-删除数据"><a href="#3-4-6-删除数据" class="headerlink" title="3.4.6 删除数据"></a>3.4.6 删除数据</h4><p>我们可以使用 <strong>delete_one()</strong> 方法来删除一个文档，该方法第一个参数为查询对象，指定要删除哪些数据。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Taobao"</span> <span class="token punctuation">}</span>sets<span class="token punctuation">.</span>delete_one<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 删除后输出</span><span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示结果为：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257ce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'103'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257d0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'109'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'spaceX'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'苹果'</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>删除多个文档</strong></p><p>我们可以使用 <strong>delete_many()</strong> 方法来删除多个文档，该方法第一个参数为查询对象，指定要删除哪些数据。</p><p>删除所有 name 字段中以 F 开头的文档:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"$regex"</span><span class="token punctuation">:</span> <span class="token string">"^F"</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>delete_many<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>deleted_count<span class="token punctuation">,</span> <span class="token string">"个文档已删除"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><pre><code>1 个文档已删除</code></pre><p>删除集合中的所有文档</p><p><strong>delete_many()</strong> 方法如果传入的是一个空的查询对象，则会删除集合中的所有文档：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>x <span class="token operator">=</span> sets<span class="token punctuation">.</span>delete_many<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>deleted_count<span class="token punctuation">,</span> <span class="token string">"个文档已删除"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><pre><code>7 个文档已删除</code></pre><hr><p><strong>删除集合</strong></p><p>我们可以使用 <strong>drop()</strong> 方法来删除一个集合。</p><p>以下实例删除了<strong>sets</strong>集合：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongoclient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span><span class="token keyword">if</span> sets<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'删除失败'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-Redis键值对数据存储"><a href="#3-5-Redis键值对数据存储" class="headerlink" title="3.5 Redis键值对数据存储"></a>3.5 Redis键值对数据存储</h3><p>redis 是一个 Key-Value 数据库，Value 支持 string(字符串)，list(列表)，set(集合)，zset(有序集合)，hash(哈希类型)等类型。</p><h4 id="3-5-1-redis连接"><a href="#3-5-1-redis连接" class="headerlink" title="3.5.1 redis连接"></a>3.5.1 redis连接</h4><blockquote><p>redis提供两个类Redis和StrictRedis用于实现Redis的命令，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py。</p></blockquote><blockquote><p>redis连接实例是线程安全的，可以直接将redis连接实例设置为一个全局变量，直接使用。如果需要另一个Redis实例（or Redis数据库）时，就需要重新创建redis连接实例来获取一个新的连接。同理，python的redis没有实现select命令。</p></blockquote><p>安装redis</p><pre class="line-numbers language-undefined"><code class="language-undefined">pip install redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>连接redis，加上decode_responses=True，写入的键值对中的value为str类型，不加这个参数写入的则为字节类型。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis   <span class="token comment" spellcheck="true"># 导入redis模块，通过python操作redis 也可以直接在redis主机的服务端操作缓存数据库</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># host是redis主机，需要redis服务端和客户端都启动 redis默认端口是6379</span>r<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'junxi'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># key是"foo" value是"bar" 将键值对存入redis缓存</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 取出键name对应的值</span><span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-5-2-连接池"><a href="#3-5-2-连接池" class="headerlink" title="3.5.2 连接池"></a>3.5.2 连接池</h4><blockquote><p>redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。<br> 可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池</p></blockquote><p>连接池</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis    <span class="token comment" spellcheck="true"># 导入redis模块，通过python操作redis 也可以直接在redis主机的服务端操作缓存数据库</span>pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># host是redis主机，需要redis服务端和客户端都起着 redis默认端口是6379</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># key是"gender" value是"male" 将键值对存入redis缓存</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># gender 取出键male对应的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-5-3-redis基本命令-String"><a href="#3-5-3-redis基本命令-String" class="headerlink" title="3.5.3 redis基本命令 String"></a>3.5.3 redis基本命令 String</h4><p>在Redis中设置值，默认，不存在则创建，存在则修改</p><pre class="line-numbers language-python"><code class="language-python">set<span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> ex<span class="token operator">=</span>None<span class="token punctuation">,</span> px<span class="token operator">=</span>None<span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> xx<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参数：</p><pre><code>ex，过期时间（秒）px，过期时间（毫秒）nx，如果设置为True，则只有name不存在时，当前set操作才执行xx，如果设置为True，则只有name存在时，当前set操作才执行</code></pre><ol><li>ex，过期时间（秒） 这里过期时间是3秒，3秒后p，键food的值就变成None</li></ol><pre class="line-numbers language-dart"><code class="language-dart"><span class="token keyword">import</span> redispool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">,</span> <span class="token string">'mutton'</span><span class="token punctuation">,</span> ex<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>    # key是<span class="token string">"food"</span> value是<span class="token string">"mutton"</span> 将键值对存入redis缓存<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # mutton 取出键food对应的值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>px，过期时间（豪秒） 这里过期时间是3豪秒，3毫秒后，键foo的值就变成None</li></ol><pre class="line-numbers language-dart"><code class="language-dart"><span class="token keyword">import</span> redispool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">,</span> <span class="token string">'beef'</span><span class="token punctuation">,</span> px<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>nx，如果设置为True，则只有name不存在时，当前set操作才执行 （新建）</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redispool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">,</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># True--不存在</span><span class="token comment" spellcheck="true"># 如果键fruit不存在，那么输出是True；如果键fruit已经存在，输出是None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>xx，如果设置为True，则只有name存在时，当前set操作才执行 （修改）</li></ol><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">,</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> xx<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token shell-comment comment"># True--已经存在</span><span class="token shell-comment comment"># 如果键fruit已经存在，那么输出是True；如果键fruit不存在，输出是None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="5"><li><p>setnx(name, value)</p><p> 设置值，只有name不存在时，执行设置操作（添加）</p></li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.setnx<span class="token punctuation">(</span><span class="token string">'fruit1'</span>, <span class="token string">'banana'</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># fruit1不存在，输出为True</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>setex(name, time, value)<br>  设置值，参数：<br>  time，过期时间（数字秒 或 timedelta对象）</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis<span class="token keyword">import</span> timepool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span>setex<span class="token punctuation">(</span><span class="token string">"fruit2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'fruit2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 5秒后，取值就从orange变成None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="7"><li>psetex(name, time_ms, value)<br>  设置值，参数：<br>  time_ms，过期时间（数字毫秒 或 timedelta对象）</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.psetex<span class="token punctuation">(</span><span class="token string">"fruit3"</span>, 5000, <span class="token string">"apple"</span><span class="token punctuation">)</span>time.sleep<span class="token punctuation">(</span>5<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">'fruit3'</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 5000毫秒后，取值就从apple变成None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="8"><li>mset(*args, **kwargs)<br>  批量设置值，如：</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.mget<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'k1'</span><span class="token keyword">:</span> <span class="token string">'v1'</span>, <span class="token string">'k2'</span><span class="token keyword">:</span> <span class="token string">'v2'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>r.mset<span class="token punctuation">(</span>k1<span class="token operator">=</span><span class="token string">"v1"</span>, k2<span class="token operator">=</span><span class="token string">"v2"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 这里k1 和k2 不能带引号 一次设置对个键值对</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"k1"</span>, <span class="token string">"k2"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 一次取出多个键对应的值</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="9"><li>mget(keys, *args)<br>  批量获取，如：</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">'k1'</span>, <span class="token string">'k2'</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'k1'</span>, <span class="token string">'k2'</span><span class="token punctuation">]</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"fruit"</span>, <span class="token string">"fruit1"</span>, <span class="token string">"fruit2"</span>, <span class="token string">"k1"</span>, <span class="token string">"k2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 将目前redis缓存中的键对应的值批量取出来</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="10"><li><p>getset(name, value)</p><p>设置新值并获取原来的值</p></li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.getset<span class="token punctuation">(</span><span class="token string">"food"</span>, <span class="token string">"barbecue"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 设置的新值是barbecue 设置前的值是beef</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="11"><li>getrange(key, start, end)<br> 获取子序列（根据字节获取，非字符）<br> 参数：<br> name，Redis 的 name<br> start，起始位置（字节）<br> end，结束位置（字节）<br> 如： “君惜大大” ，0-3表示 “君”</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.set<span class="token punctuation">(</span><span class="token string">"cn_name"</span>, <span class="token string">"君惜大大"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 汉字</span>print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"cn_name"</span>, 0, 2<span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 取索引号是0-2 前3位的字节 君 切片操作 （一个汉字3个字节 1个字母一个字节 每个字节8bit）</span>print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"cn_name"</span>, 0, -1<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 取所有的字节 君惜大大 切片操作</span>r.set<span class="token punctuation">(</span><span class="token string">"en_name"</span>,<span class="token string">"junxi"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 字母</span>print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"en_name"</span>, 0, 2<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 取索引号是0-2 前3位的字节 jun 切片操作 （一个汉字3个字节 1个字母一个字节 每个字节8bit）</span>print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"en_name"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取所有的字节 junxi 切片操作</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="12"><li>setrange(name, offset, value)<br> 修改字符串内容，从指定字符串索引开始向后替换（新值太长时，则向后添加）<br> 参数：<br> offset，字符串的索引，字节（一个汉字三个字节）<br> value，要设置的值</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.setrange<span class="token punctuation">(</span><span class="token string">"en_name"</span>, 1, <span class="token string">"ccc"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">"en_name"</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># jccci 原始值是junxi 从索引号是1开始替换成ccc 变成 jccci</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="13"><li>setbit(name, offset, value)<br> 对name对应值的二进制表示的位进行操作<br> 参数：<br> name，redis的name<br> offset，位的索引（将值变换成二进制后再进行索引）<br> value，值只能是 1 或 0</li></ol><pre class="line-numbers language-bash"><code class="language-bash">注：如果在Redis中有一个对应： n1 <span class="token operator">=</span> <span class="token string">"foo"</span>，那么字符串foo的二进制表示为：01100110 01101111 01101111所以，如果执行 setbit<span class="token punctuation">(</span><span class="token string">'n1'</span>, 7, 1<span class="token punctuation">)</span>，则就会将第7位设置为1，那么最终二进制则变成 01100111 01101111 01101111，即：<span class="token string">"goo"</span>扩展，转换二进制表示：<span class="token function">source</span> <span class="token operator">=</span> <span class="token string">"陈思维"</span><span class="token function">source</span> <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> source:num <span class="token operator">=</span> ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span>print bin<span class="token punctuation">(</span>num<span class="token punctuation">)</span>.replace<span class="token punctuation">(</span><span class="token string">'b'</span>,<span class="token string">''</span><span class="token punctuation">)</span>特别的，如果source是汉字 <span class="token string">"陈思维"</span>怎么办？答：对于utf-8，每一个汉字占 3 个字节，那么 <span class="token string">"陈思维"</span> 则有 9个字节对于汉字，for循环时候会按照 字节 迭代，那么在迭代时，将每一个字节转换 十进制数，然后再将十进制数转换成二进制11100110 10101101 10100110 11100110 10110010 10011011 11101001 10111101 10010000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="14"><li>getbit(name, offset)<br> 获取name对应的值的二进制表示中的某位的值 （0或1）</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.getbit<span class="token punctuation">(</span><span class="token string">"foo1"</span>, 0<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 0 foo1 对应的二进制 4个字节 32位 第0位是0还是1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="15"><li>bitcount(key, start=None, end=None)<br> 获取name对应的值的二进制表示中 1 的个数<br> 参数：<br> key，Redis的name<br> start 字节起始位置<br> end，字节结束位置</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># goo1 01100111</span>print<span class="token punctuation">(</span>r.bitcount<span class="token punctuation">(</span><span class="token string">"foo"</span>,0,1<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 11 表示前2个字节中，1出现的个数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="16"><li><p>bitop(operation, dest, *keys)<br> 获取多个值，并将值做位运算，将最后的结果保存至新的name对应的值</p><p>参数：<br> operation,AND（并） 、 OR（或） 、 NOT（非） 、 XOR（异或）<br> dest, 新的Redis的name<br> *keys,要查找的Redis的name</p></li></ol><p>如：</p><pre class="line-numbers language-bash"><code class="language-bash">bitop<span class="token punctuation">(</span><span class="token string">"AND"</span>, <span class="token string">'new_name'</span>, <span class="token string">'n1'</span>, <span class="token string">'n2'</span>, <span class="token string">'n3'</span><span class="token punctuation">)</span>获取Redis中n1,n2,n3对应的值，然后讲所有的值做位运算（求并集），然后将结果保存 new_name 对应的值中r.set<span class="token punctuation">(</span><span class="token string">"foo"</span>,<span class="token string">"1"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0110001</span>r.set<span class="token punctuation">(</span><span class="token string">"foo1"</span>,<span class="token string">"2"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0110010</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"foo"</span>,<span class="token string">"foo1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># ['goo1', 'baaanew']</span>print<span class="token punctuation">(</span>r.bitop<span class="token punctuation">(</span><span class="token string">"AND"</span>,<span class="token string">"new"</span>,<span class="token string">"foo"</span>,<span class="token string">"foo1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># "new" 0 0110000</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"foo"</span>,<span class="token string">"foo1"</span>,<span class="token string">"new"</span><span class="token punctuation">))</span><span class="token function">source</span> <span class="token operator">=</span> <span class="token string">"12"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> source:num <span class="token operator">=</span> ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span>print<span class="token punctuation">(</span>num<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 打印每个字母字符或者汉字字符对应的ascii码值 f-102-0b100111-01100111</span>print<span class="token punctuation">(</span>bin<span class="token punctuation">(</span>num<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 打印每个10进制ascii码值转换成二进制的值 0b1100110（0b表示二进制）</span>print bin<span class="token punctuation">(</span>num<span class="token punctuation">)</span>.replace<span class="token punctuation">(</span><span class="token string">'b'</span>,<span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 将二进制0b1100110替换成01100110</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="17"><li>strlen(name)<br> 返回name对应值的字节长度（一个汉字3个字节）</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.strlen<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 4 'goo1'的长度是4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="18"><li>incr(self, name, amount=1)<br> 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。<br> 参数：<br> name,Redis的name<br> amount,自增数（必须是整数）<br> 注：同incrby</li></ol><pre class="line-numbers language-dart"><code class="language-dart">r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>应用场景 – 页面点击数<br> 假定我们对一系列页面需要记录点击次数。例如论坛的每个帖子都要记录点击次数，而点击次数比回帖的次数的多得多。如果使用关系数据库来存储点击，可能存在大量的行级锁争用。所以，点击数的增加使用redis的INCR命令最好不过了。<br> 当redis服务器启动时，可以从关系数据库读入点击数的初始值（12306这个页面被访问了34634次）</p><pre class="line-numbers language-css"><code class="language-css">r<span class="token number">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span>, <span class="token number">34634</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token number">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>每当有一个页面点击，则使用INCR增加点击数即可。</p><pre class="line-numbers language-css"><code class="language-css">r<span class="token number">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span>r<span class="token number">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>页面载入的时候则可直接获取这个值</p><pre class="line-numbers language-css"><code class="language-css"><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token number">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="19"><li>incrbyfloat(self, name, amount=1.0)<br> 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。<br> 参数：<br> name,Redis的name<br> amount,自增数（浮点型）</li></ol><pre class="line-numbers language-dart"><code class="language-dart">r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"123.0"</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"foo2"</span><span class="token punctuation">,</span> <span class="token string">"221.0"</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">incrbyfloat</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">incrbyfloat</span><span class="token punctuation">(</span><span class="token string">"foo2"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">3.0</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="20"><li>decr(self, name, amount=1)<br> 自减 name对应的值，当name不存在时，则创建name＝amount，否则，则自减。<br> 参数：<br> name,Redis的name<br> amount,自减数（整数)</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.decr<span class="token punctuation">(</span><span class="token string">"foo4"</span>, amount<span class="token operator">=</span>3<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 递减3</span>r.decr<span class="token punctuation">(</span><span class="token string">"foo1"</span>, amount<span class="token operator">=</span>1<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 递减1</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"foo1"</span>, <span class="token string">"foo4"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="21"><li>append(key, value)<br> 在redis name对应的值后面追加内容<br> 参数：<br> key, redis的name<br> value, 要追加的字符串</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.append<span class="token punctuation">(</span><span class="token string">"name"</span>, <span class="token string">"haha"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 在name对应的值junxi后面追加字符串haha</span>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3-5-4-redis基本命令-hash"><a href="#3-5-4-redis基本命令-hash" class="headerlink" title="3.5.4 redis基本命令 hash"></a>3.5.4 redis基本命令 hash</h4><ol><li>单个增加–修改(单个取出)–没有就新增，有的话就修改<br>  hset(name, key, value)<br>  name对应的hash中设置一个键值对（不存在，则创建；否则，修改）<br>  参数：<br>  name，redis的name<br>  key，name对应的hash中的key<br>  value，name对应的hash中的value<br>  注：<br>  hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis<span class="token keyword">import</span> timepool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"v1"</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">,</span> <span class="token string">"v2"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hkeys<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 取hash中所有的key</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 单个取hash的key对应的值</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hmget<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 多个取hash的key对应的值</span>r<span class="token punctuation">.</span>hsetnx<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">,</span> <span class="token string">"v3"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 只能新建</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>批量增加（取出）<br>  hmset(name, mapping)<br>  在name对应的hash中批量设置键值对<br>  参数：<br>  name，redis的name<br>  mapping，字典，如：{‘k1’:’v1’, ‘k2’: ‘v2’}<br>  如：</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.hmset<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token punctuation">{</span><span class="token string">"k2"</span><span class="token keyword">:</span> <span class="token string">"v2"</span>, <span class="token string">"k3"</span><span class="token keyword">:</span> <span class="token string">"v3"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li><p>获取结果</p><p> hget(name,key)<br>  在name对应的hash中获取根据key获取value<br>  hmget(name, keys, *args)<br>  在name对应的hash中获取多个key的值<br>  参数：<br>  name，reids对应的name<br>  keys，要获取key集合，如：[‘k1’, ‘k2’, ‘k3’]<br>  *args，要获取的key，如：k1,k2,k3<br>  如：</p></li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hget<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token string">"k2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 单个取出"hash2"的key-k2对应的value</span>print<span class="token punctuation">(</span>r.hmget<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token string">"k2"</span>, <span class="token string">"k3"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 批量取出"hash2"的key-k2 k3对应的value --方式1</span>print<span class="token punctuation">(</span>r.hmget<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token punctuation">[</span><span class="token string">"k2"</span>, <span class="token string">"k3"</span><span class="token punctuation">]</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 批量取出"hash2"的key-k2 k3对应的value --方式2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="4"><li>取出所有的键值对<br>  hgetall(name)<br>  获取name对应hash的所有键值</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>得到所有键值对的格式 hash长度<br>  hlen(name)<br>  获取name对应的hash中键值对的个数</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hlen<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>得到所有的keys（类似字典的取所有keys）<br>  hkeys(name)<br>  获取name对应的hash中所有的key的值</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hkeys<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li>得到所有的value（类似字典的取所有value）<br>  hvals(name)<br>  获取name对应的hash中所有的value的值</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hvals<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="8"><li>判断成员是否存在（类似字典的in）<br>  hexists(name, key)<br>  检查name对应的hash是否存在当前传入的key</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hexists<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k4"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># False 不存在</span>print<span class="token punctuation">(</span>r.hexists<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># True 存在</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="9"><li>删除键值对<br>  hdel(name,*keys)<br>  将name对应的hash中指定key的键值对删除</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k2"</span>, <span class="token string">"v222"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 修改已有的key k2</span>r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k11"</span>, <span class="token string">"v1"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 新增键值对 k11</span>r.hdel<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k1"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除一个键值对</span>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="10"><li>自增自减整数(将key对应的value–整数 自增1或者2，或者别的整数 负数就是自减)<br> hincrby(name, key, amount=1)<br> 自增name对应的hash中的指定key的值，不存在则创建key=amount<br> 参数：<br> name，redis中的name<br> key， hash对应的key<br> amount，自增数（整数）</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k3"</span>, 123<span class="token punctuation">)</span>r.hincrby<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k3"</span>, amount<span class="token operator">=</span>-1<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>r.hincrby<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k4"</span>, amount<span class="token operator">=</span>1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 不存在的话，value默认就是1</span>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="11"><li>自增自减浮点数(将key对应的value–浮点数 自增1.0或者2.0，或者别的浮点数 负数就是自减)<br> hincrbyfloat(name, key, amount=1.0)<br> 自增name对应的hash中的指定key的值，不存在则创建key=amount<br> 参数：<br> name，redis中的name<br> key， hash对应的key<br> amount，自增数（浮点数）<br> 自增name对应的hash中的指定key的值，不存在则创建key=amount</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k5"</span>, <span class="token string">"1.0"</span><span class="token punctuation">)</span>r.hincrbyfloat<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k5"</span>, amount<span class="token operator">=</span>-1.0<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 已经存在，递减-1.0</span>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>r.hincrbyfloat<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k6"</span>, amount<span class="token operator">=</span>-1.0<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 不存在，value初始值是-1.0 每次递减1.0</span>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="12"><li>取值查看–分片读取<br> hscan(name, cursor=0, match=None, count=None)<br> 增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而放置内存被撑爆<br> 参数：<br> name，redis的name<br> cursor，游标（基于游标分批取获取数据）<br> match，匹配指定key，默认None 表示所有的key<br> count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数<br> 如：<br> 第一次：cursor1, data1 = r.hscan(‘xx’, cursor=0, match=None, count=None)<br> 第二次：cursor2, data1 = r.hscan(‘xx’, cursor=cursor1, match=None, count=None)<br> …<br> 直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hscan<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="13"><li>hscan_iter(name, match=None, count=None)<br> 利用yield封装hscan创建生成器，实现分批去redis中获取数据<br> 参数：<br> match，匹配指定key，默认None 表示所有的key<br> count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数<br> 如：</li></ol><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> item <span class="token keyword">in</span> r.hscan_iter<span class="token punctuation">(</span><span class="token string">'hash1'</span><span class="token punctuation">)</span>:    print<span class="token punctuation">(</span>item<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.hscan_iter<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># 生成器内存地址</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="3-5-5-redis基本命令-list"><a href="#3-5-5-redis基本命令-list" class="headerlink" title="3.5.5 redis基本命令 list"></a>3.5.5 redis基本命令 list</h4><ol><li>增加（类似于list的append，只是这里是从左边新增加）–没有就新建<br>  lpush(name,values)<br>  在name对应的list中添加元素，每个新的元素都添加到列表的最左边<br>  如：</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis<span class="token keyword">import</span> timepool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span>lpush<span class="token punctuation">(</span><span class="token string">"list1"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>lrange<span class="token punctuation">(</span><span class="token string">'list1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>保存顺序为: 33,22,11</p><p>扩展：</p><pre class="line-numbers language-bash"><code class="language-bash">r.rpush<span class="token punctuation">(</span><span class="token string">"list2"</span>, 11, 22, 33<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 表示从右向左操作</span>print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, 3<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0-3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>增加（从右边增加）–没有就新建</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.rpush<span class="token punctuation">(</span><span class="token string">"list2"</span>, 44, 55, 66<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 在列表的右边，依次添加44,55,66</span>print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0到-1(最后一个元素)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>往已经有的name的列表的左边添加元素，没有的话无法创建<br>  lpushx(name,value)<br>  在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边<br>  更多：</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.lpushx<span class="token punctuation">(</span><span class="token string">"list10"</span>, 10<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 这里list10不存在</span>print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list10"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 0</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list10"</span>, 0, -1<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># []</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash">r.lpushx<span class="token punctuation">(</span><span class="token string">"list2"</span>, 77<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 这里"list2"之前已经存在，往列表最左边添加一个元素，一次只能添加一个</span>print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0到-1(最后一个元素</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="4"><li>往已经有的name的列表的右边添加元素，没有的话无法创建</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.rpushx<span class="token punctuation">(</span><span class="token string">"list2"</span>, 99<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 这里"foo_list1"之前已经存在，往列表最右边添加一个元素，一次只能添加一个</span>print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0到-1(最后一个元素)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="5"><li>新增（固定索引号位置插入元素）<br>  linsert(name, where, refvalue, value))<br>  在name对应的列表的某一个值前或后插入一个新值<br>  参数：<br>  name，redis的name<br>  where，BEFORE或AFTER<br>  refvalue，标杆值，即：在它前后插入数据<br>  value，要插入的数据</li></ol><pre class="line-numbers language-objectivec"><code class="language-objectivec">r<span class="token punctuation">.</span><span class="token function">linsert</span><span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">,</span> <span class="token string">"before"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">,</span> <span class="token string">"00"</span><span class="token punctuation">)</span>   # 往列表中左边第一个出现的元素<span class="token string">"11"</span>前插入元素<span class="token string">"00"</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   # 切片取出值，范围是索引号<span class="token number">0</span><span class="token operator">-</span>最后一个元素<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li>修改（指定索引号进行修改）<br>  r.lset(name, index, value)<br>  对name对应的list中的某一个索引位置重新赋值<br>  参数：<br>  name，redis的name<br>  index，list的索引位置<br>  value，要设置的值</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.lset<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -11<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 把索引号是0的元素修改成-11</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li>删除（指定值进行删除）<br>  r.lrem(name, value, num)<br>  在name对应的list中删除指定的值<br>  参数：<br>  name，redis的name<br>  value，要删除的值<br>  num， num=0，删除列表中所有的指定值；<br>  num=2,从前到后，删除2个； num=1,从前到后，删除左边第1个<br>  num=-2,从后向前，删除2个</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.lrem<span class="token punctuation">(</span><span class="token string">"list2"</span>, <span class="token string">"11"</span>, 1<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将列表中左边第一次出现的"11"删除</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>r.lrem<span class="token punctuation">(</span><span class="token string">"list2"</span>, <span class="token string">"99"</span>, -1<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将列表中右边第一次出现的"99"删除</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>r.lrem<span class="token punctuation">(</span><span class="token string">"list2"</span>, <span class="token string">"22"</span>, 0<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将列表中所有的"22"删除</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>删除并返回<br>  lpop(name)<br>  在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素<br>  更多：<br>  rpop(name) 表示从右向左操作</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.lpop<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除列表最左边的元素，并且返回删除的元素</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>r.rpop<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除列表最右边的元素，并且返回删除的元素</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="9"><li>删除索引之外的值<br>  ltrim(name, start, end)<br>  在name对应的列表中移除没有在start-end索引之间的值<br>  参数：<br>  name，redis的name<br>  start，索引的起始位置<br>  end，索引结束位置</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.ltrim<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, 2<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除索引号是0-2之外的元素，值保留索引号是0-2的元素</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="10"><li>取值（根据索引号取值）<br> lindex(name, index)<br> 在name对应的列表中根据索引获取列表元素</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.lindex<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 取出索引号是0的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="11"><li>移动  元素从一个列表移动到另外一个列表<br> rpoplpush(src, dst)<br> 从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边<br> 参数：<br> src，要取数据的列表的name<br> dst，要添加数据的列表的name</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.rpoplpush<span class="token punctuation">(</span><span class="token string">"list1"</span>, <span class="token string">"list2"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="12"><li>移动  元素从一个列表移动到另外一个列表 可以设置超时<br> brpoplpush(src, dst, timeout=0)<br> 从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧<br> 参数：<br> src，取出并要移除元素的列表对应的name<br> dst，要插入元素的列表对应的name<br> timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.brpoplpush<span class="token punctuation">(</span><span class="token string">"list1"</span>, <span class="token string">"list2"</span>, timeout<span class="token operator">=</span>2<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="13"><li>一次移除多个列表<br> blpop(keys, timeout)<br> 将多个列表排列，按照从左到右去pop对应列表的元素<br> 参数：<br> keys，redis的name的集合<br> timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞<br> 更多：<br> r.brpop(keys, timeout)  同blpop，将多个列表排列,按照从右像左去移除各个列表内的元素</li></ol><pre class="line-numbers language-php"><code class="language-php">r<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"list10"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"list11"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">while</span> True<span class="token punctuation">:</span>    r<span class="token punctuation">.</span><span class="token function">blpop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"list10"</span><span class="token punctuation">,</span> <span class="token string">"list11"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"list10"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"list11"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="14"><li><p>自定义增量迭代<br> 由于redis类库中没有提供对列表元素的增量迭代，如果想要循环name对应的列表的所有元素，那么就需要：</p></li><li><p>获取name对应的所有列表</p></li><li><p>循环列表</p></li></ol><p>但是，如果列表非常大，那么就有可能在第一步时就将程序的内容撑爆，所有有必要自定义一个增量迭代的功能：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">list_iter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    自定义redis列表增量迭代    :param name: redis中的name，即：迭代name对应的列表    :return: yield 返回 列表元素    """</span>    list_count <span class="token operator">=</span> r<span class="token punctuation">.</span>llen<span class="token punctuation">(</span>name<span class="token punctuation">)</span>    <span class="token keyword">for</span> index <span class="token keyword">in</span> range<span class="token punctuation">(</span>list_count<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">yield</span> r<span class="token punctuation">.</span>lindex<span class="token punctuation">(</span>name<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 使用</span><span class="token keyword">for</span> item <span class="token keyword">in</span> list_iter<span class="token punctuation">(</span><span class="token string">'list2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 遍历这个列表</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-5-6-redis基本命令-set"><a href="#3-5-6-redis基本命令-set" class="headerlink" title="3.5.6 redis基本命令 set"></a>3.5.6 redis基本命令 set</h4><ol><li>sadd方法：新增一个集合的功能</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># name对应的集合中添加元素</span>sadd<span class="token punctuation">(</span>name<span class="token punctuation">,</span>values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-bash"><code class="language-bash">r.sadd<span class="token punctuation">(</span><span class="token string">"set1"</span>, 33, 44, 55, 66<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 往集合中添加元素</span>print<span class="token punctuation">(</span>r.scard<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 集合的长度是4</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合中所有的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>scard方法：获取元素个数，类似于len</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取name对应的集合中元素个数</span>scard<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> 示例：</p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.scard<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 集合的长度是4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>smembers：获取集合中所有的成员</li></ol><pre class="line-numbers language-python"><code class="language-python">获取name对应的集合的所有成员smembers<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> 示例：</p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合中所有的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取集合中所有的成员--元组形式</span>sscan<span class="token punctuation">(</span>name<span class="token punctuation">,</span> cursor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> match<span class="token operator">=</span>None<span class="token punctuation">,</span> count<span class="token operator">=</span>None<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>示例：</p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sscan<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python"><code class="language-python">sscan_iter<span class="token punctuation">(</span>name<span class="token punctuation">,</span> match<span class="token operator">=</span>None<span class="token punctuation">,</span> count<span class="token operator">=</span>None<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> i <span class="token keyword">in</span> r.sscan_iter<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">)</span>:    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>差集<br>  sdiff(keys, *args)<br>  在第一个name对应的集合中且不在其他name对应的集合的元素集合</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.sadd<span class="token punctuation">(</span><span class="token string">"set2"</span>, 11, 22, 33<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合中所有的成员</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.sdiff<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 在集合set1但是不在集合set2中</span>print<span class="token punctuation">(</span>r.sdiff<span class="token punctuation">(</span><span class="token string">"set2"</span>, <span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 在集合set2但是不在集合set1中</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>差集–差集存在一个新的集合中<br>  sdiffstore(dest, keys, *args)<br>  获取第一个name对应的集合中且不在其他name对应的集合，再将其新加入到dest对应的集合中</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.sdiffstore<span class="token punctuation">(</span><span class="token string">"set3"</span>, <span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 在集合set1但是不在集合set2中</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合3中所有的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li>交集<br>  sinter(keys, *args)<br>  获取多一个name对应集合的交集</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sinter<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的交集</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li>交集–交集存在一个新的集合中<br>  sinterstore(dest, keys, *args)<br>  获取多一个name对应集合的并集，再将其加入到dest对应的集合中</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sinterstore<span class="token punctuation">(</span><span class="token string">"set3"</span>, <span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的交集</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>并集<br> sunion(keys, *args)<br> 获取多个name对应的集合的并集</p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sunion<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的并集</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>并集–并集存在一个新的集合<br> sunionstore(dest,keys, *args)<br> 获取多一个name对应的集合的并集，并将结果保存到dest对应的集合中</p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sunionstore<span class="token punctuation">(</span><span class="token string">"set3"</span>, <span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的并集</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="8"><li>判断是否是集合的成员 类似in<br>  sismember(name, value)<br>  检查value是否是name对应的集合的成员，结果为True和False</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sismember<span class="token punctuation">(</span><span class="token string">"set1"</span>, 33<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 33是集合的成员</span>print<span class="token punctuation">(</span>r.sismember<span class="token punctuation">(</span><span class="token string">"set1"</span>, 23<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 23不是集合的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="9"><li>移动<br>  smove(src, dst, value)<br>  将某个成员从一个集合中移动到另外一个集合</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.smove<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span>, 44<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="10"><li>删除–随机删除并且返回被删除值<br> spop(name)<br> 从集合移除一个成员，并将其返回,说明一下，集合是无序的，所有是随机删除的</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.spop<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 这个删除的值是随机删除的，集合是无序的</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="11"><li>删除–指定值删除<br> srem(name, values)<br> 在name对应的集合中删除某些值</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.srem<span class="token punctuation">(</span><span class="token string">"set2"</span>, 11<span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 从集合中删除指定值 11</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3-5-7-redis基本命令-有序set"><a href="#3-5-7-redis基本命令-有序set" class="headerlink" title="3.5.7 redis基本命令 有序set"></a>3.5.7 redis基本命令 有序set</h4><p>Set操作，Set集合就是不允许重复的列表，本身是无序的<br> 有序集合，在集合的基础上，为每元素排序；元素的排序需要根据另外一个值来进行比较，<br> 所以，对于有序集合，每一个元素有两个值，即：值和分数，分数专门用来做排序。</p><ol><li>新增<br>  zadd(name, *args, **kwargs)<br>  在name对应的有序集合中添加元素<br>  如：</li></ol><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis<span class="token keyword">import</span> timepool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>r<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> n1<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> n2<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">,</span> <span class="token string">'m1'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'m2'</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 集合长度</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 集合长度</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zrange<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 获取有序集合中所有元素</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zrange<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 获取有序集合中所有元素和分数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>获取有序集合元素个数 类似于len<br>  zcard(name)<br>  获取name对应的有序集合元素的数量</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zcard<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 集合长度</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>获取有序集合的所有元素<br>  r.zrange( name, start, end, desc=False, withscores=False, score_cast_func=float)<br>  按照索引范围获取name对应的有序集合的元素<br>  参数：<br>  name，redis的name<br>  start，有序集合索引起始位置（非分数）<br>  end，有序集合索引结束位置（非分数）<br>  desc，排序规则，默认按照分数从小到大排序<br>  withscores，是否获取元素的分数，默认只获取元素的值<br>  score_cast_func，对分数进行数据转换的函数</li></ol><p>3-1 从大到小排序(同zrange，集合是从大到小排序的)<br> zrevrange(name, start, end, withscores=False, score_cast_func=float)</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 只获取元素，不显示分数</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># 获取有序集合中所有元素和分数,分数倒序</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3-2 按照分数范围获取name对应的有序集合的元素<br> zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   element <span class="token operator">=</span> <span class="token string">'n'</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>   r<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrangebyscore</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># # 在分数是15-25之间，取出符合条件的元素</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrangebyscore</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 在分数是12-22之间，取出符合条件的元素（带分数）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3-3 按照分数范围获取有序集合的元素并排序（默认从大到小排序）<br> zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrangebyscore</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># 在分数是22-11之间，取出符合条件的元素 按照分数倒序</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3-4 获取所有元素–默认按照分数顺序排序<br> zscan(name, cursor=0, match=None, count=None, score_cast_func=float)</p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zscan<span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3-5 获取所有元素–迭代器<br> zscan_iter(name, match=None, count=None,score_cast_func=float)</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> i <span class="token keyword">in</span> r.zscan_iter<span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">)</span>: <span class="token comment" spellcheck="true"># 遍历迭代器</span>    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>zcount(name, min, max)<br>  获取name对应的有序集合中分数 在 [min,max] 之间的个数</li></ol><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zcount</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="5"><li>自增<br>  zincrby(name, value, amount)<br>  自增name对应的有序集合的 name 对应的分数</li></ol><pre class="line-numbers language-php"><code class="language-php">r<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token string">"n2"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 每次将n2的分数自增2</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li>获取值的索引号<br>  zrank(name, value)<br>  获取某个值在 name对应的有序集合中的索引（从 0 开始）<br>  更多：<br>  zrevrank(name, value)，从大到小排序</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># n1的索引号是0 这里按照分数顺序（从小到大）</span>print<span class="token punctuation">(</span>r.zrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n6"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># n6的索引号是1</span>print<span class="token punctuation">(</span>r.zrevrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n1"</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># n1的索引号是29 这里安照分数倒序（从大到小）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="7"><li>删除–指定值删除<br>  zrem(name, values)<br>  删除name对应的有序集合中值是values的成员</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.zrem<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n3"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 删除有序集合中的元素n3 删除单个</span>print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="8"><li>删除–根据排行范围删除，按照索引号来删除<br>  zremrangebyrank(name, min, max)<br>  根据排行范围删除</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.zremrangebyrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, 1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 删除有序集合中的索引号是0, 1的元素</span>print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="9"><li>删除–根据分数范围删除<br>  zremrangebyscore(name, min, max)<br>  根据分数范围删除</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.zremrangebyscore<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 11, 22<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 删除有序集合中的分数是11-22的元素</span>print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="10"><li>获取值对应的分数<br> zscore(name, value)<br> 获取name对应有序集合中 value 对应的分数</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zscore<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n27"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取元素n27对应的分数27</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-5-8-其他常用操作"><a href="#3-5-8-其他常用操作" class="headerlink" title="3.5.8 其他常用操作"></a>3.5.8 其他常用操作</h4><ol><li>删除<br>  delete(*names)<br>  根据删除redis中的任意数据类型（string、hash、list、set、有序set）</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.delete<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 删除key为gender的键值对</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>检查名字是否存在<br>  exists(name)<br>  检测redis的name是否存在，存在就是True，False 不存在</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.exists<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>模糊匹配<br>  keys(pattern=’<em>‘)<br>  根据模型获取redis的name<br>  更多：<br>  KEYS \</em> 匹配数据库中所有 key 。<br>  KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。<br>  KEYS h*llo 匹配 hllo 和 heeeeello 等。<br>  KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.keys<span class="token punctuation">(</span><span class="token string">"foo*"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>设置超时时间<br>  expire(name ,time)<br>  为某个redis的某个name设置超时时间</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.lpush<span class="token punctuation">(</span><span class="token string">"list5"</span>, 11, 22<span class="token punctuation">)</span>r.expire<span class="token punctuation">(</span><span class="token string">"list5"</span>, time<span class="token operator">=</span>3<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list5"</span>, 0, -1<span class="token punctuation">))</span>time.sleep<span class="token punctuation">(</span>3<span class="token punctuation">)</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list5"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>重命名<br>  rename(src, dst)<br>  对redis的name重命名</li></ol><pre class="line-numbers language-bash"><code class="language-bash">r.lpush<span class="token punctuation">(</span><span class="token string">"list5"</span>, 11, 22<span class="token punctuation">)</span>r.rename<span class="token punctuation">(</span><span class="token string">"list5"</span>, <span class="token string">"list5-1"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li>随机获取name<br>  randomkey()<br>  随机获取一个redis的name（不删除）</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.randomkey<span class="token punctuation">(</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li>获取类型<br>  type(name)<br>  获取name对应值的类型</li></ol><pre class="line-numbers language-go"><code class="language-go"><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">(</span><span class="token string">"hash2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="8"><li>查看所有元素<br>  scan(cursor=0, match=None, count=None)</li></ol><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hscan<span class="token punctuation">(</span><span class="token string">"hash2"</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.sscan<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.zscan<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"foo1"</span>, 0, -1<span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="9"><li>查看所有元素–迭代器<br>  scan_iter(match=None, count=None)</li></ol><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> i <span class="token keyword">in</span> r.hscan_iter<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">)</span>:    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> r.sscan_iter<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">)</span>:    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> r.zscan_iter<span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">)</span>:    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>other 方法</strong></p><pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># 查询key为name的值</span>r.delete<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 删除key为gender的键值对</span>print<span class="token punctuation">(</span>r.keys<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 查询所有的Key</span>print<span class="token punctuation">(</span>r.dbsize<span class="token punctuation">(</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 当前redis包含多少条数据</span>r.save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 执行"检查点"操作，将数据写回磁盘。保存时阻塞</span><span class="token comment" spellcheck="true"># r.flushdb()        # 清空r中的所有数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>管道（pipeline）</strong><br> redis默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，<br> 如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline 是原子性操作。</p><p>管道（pipeline）是redis在提供单个请求中缓冲多条服务器命令的基类的子类。它通过减少服务器-客户端之间反复的TCP数据库包，从而大大提高了执行批量命令的功能。</p><pre class="line-numbers language-dart"><code class="language-dart"><span class="token keyword">import</span> redis<span class="token keyword">import</span> timepool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span># pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>False<span class="token punctuation">)</span>    # 默认的情况下，管道里执行的命令可以保证执行的原子性，执行pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>False<span class="token punctuation">)</span>可以禁用这一特性。# pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>True<span class="token punctuation">)</span>pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> # 创建一个管道pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'jack'</span><span class="token punctuation">)</span>pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'sb'</span><span class="token punctuation">)</span>pipe<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'faz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span>pipe<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">)</span>    # 如果num不存在则vaule为<span class="token number">1</span>，如果存在，则value自增<span class="token number">1</span>pipe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>管道的命令可以写在一起，如：</p><pre class="line-numbers language-dart"><code class="language-dart">pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'faz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>参考：<a href="https://www.jianshu.com/p/2639549bedc8" rel="external nofollow noreferrer">https://www.jianshu.com/p/2639549bedc8</a></p><h2 id="四、1天学会反爬虫"><a href="#四、1天学会反爬虫" class="headerlink" title="四、1天学会反爬虫"></a>四、1天学会反爬虫</h2><h3 id="4-1-cookie"><a href="#4-1-cookie" class="headerlink" title="4.1 cookie"></a>4.1 cookie</h3><p><strong>cookie的概念</strong></p><p>在浏览网站的过程中，我们经常会遇到需要登录的情况，有些页面只有登录之后才可以访问，而且登录之后可以连续访问很多次网站，但是有时候过一段时间就需要重新登录。还有一些网站，在打开浏览器时就自动登录了，而且很长时间都不会失效。这都是Cookie在起作用。</p><p>Cookie 是由 Web 服务器保存在用户浏览器（客户端）上的小文本文件，它可以包含有关用户的信息。</p><p>无论何时，用户链接到服务器，Web 站点都可以访问 Cookie 信息。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123553.jpg" alt="cookie运行原理"> </p><p>也就是说，当我们输入用户名和密码，提交给网站服务器后，网站服务器验证信息正确后会把对应的“身份信息”返回给浏览器，浏览器保存于本地，之后对该网站发送的其他HTTP请求都会带上这个“身份信息”，服务器通过这个“身份信息”识别用户，将相应页面发送给浏览器，而无需再次登录。</p><p><strong>获取Cookie</strong></p><p>要是我们能获取到登录后的“身份信息”，那所有问题不都解决了吗？因为如果获取了“身份信息”，就可以通过爬虫发送给网站服务器，这样网站服务器不就可以确认身份，就能获取到相应需要登录的页面了吗？</p><p>如何获取保存于Cookie中的“身份信息”呢？以登录豆瓣网，获取个人信息为例，获取Cookie信息的步骤如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123611.jpg" alt="豆瓣cookie获取流程"></p><h3 id="4-2-网站模拟登录"><a href="#4-2-网站模拟登录" class="headerlink" title="4.2 网站模拟登录"></a>4.2 网站模拟登录</h3><h4 id="4-2-1-获取网站cookie"><a href="#4-2-1-获取网站cookie" class="headerlink" title="4.2.1 获取网站cookie"></a>4.2.1 获取网站cookie</h4><p>用python做网络爬虫时，有时需要登录某些网站。例如使用requests请求登录豆瓣网的时候需要输入用户密码，可能还需要输入验证码，比较麻烦。那有没有办法能够自动登录呢？</p><p>当然是可以的，先请求豆瓣网<a href="http://www.douban.com的时候,使用post加上cookies,可以不用输入账号和密码就可以直接登录了./" rel="external nofollow noreferrer">www.douban.com的时候，使用post加上cookies，可以不用输入账号和密码就可以直接登录了。</a></p><p>怎么获取cookie呢？有一个简单的方式，通过打开浏览器，再输入豆瓣主页，按下键盘上的F12键（打开浏览器的开发者工具），此时输入账号和密码登录豆瓣网。查看开发者工具中请求登录时的cookies信息，如图：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210417205117.png" alt="网站cookie信息获取"></p><h4 id="4-2-2-使用cookie模拟登录"><a href="#4-2-2-使用cookie模拟登录" class="headerlink" title="4.2.2 使用cookie模拟登录"></a>4.2.2 使用cookie模拟登录</h4><p>通过以上保存的cooike，然后通过执行以下的代码完成模拟登录吧。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsheaders <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.128 Safari/537.36'</span><span class="token punctuation">}</span>cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">'通过浏览器获取到的cookie'</span><span class="token punctuation">}</span>url <span class="token operator">=</span> <span class="token string">'https://www.douban.com/'</span><span class="token comment" spellcheck="true"># 使用cookie登录</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies <span class="token operator">=</span> cookies<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 上面已经登录了,下面继续登录首页,看看我们是否登录了</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>html <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies <span class="token operator">=</span> cookies<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token comment" spellcheck="true"># L的账号是我的豆瓣昵称,登录之后会显示出来</span><span class="token keyword">if</span> <span class="token string">"L的帐号"</span> <span class="token keyword">in</span> html<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"已经登录"</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"未登录"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#把登陆主页后返回的数据保存到文件中</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'douban.txt'</span><span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>r.content是登录后的网页信息，保存后打开douban.txt文件，查找是否能看到自己的用户名，可以的话就代表模拟登录成功了。</p><p>联网有困难，或者豆瓣登录地址后期变化导致以上代码失效后，本地也可以验证，可以通过启动jupyter Notebook服务后，通过cookie模拟localhost:8888进入主界面，代码如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsheaders <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'</span><span class="token punctuation">}</span>cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">'在网页中找到对应的cookie访问记录，粘贴进来'</span><span class="token punctuation">}</span>url <span class="token operator">=</span> <span class="token string">'http://localhost:8888/tree'</span><span class="token comment" spellcheck="true"># 使用cookie登录</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies <span class="token operator">=</span> cookies<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#把登陆主页后返回的数据保存到文件中</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'jupyter_home.html'</span><span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上访问后网址后，会保存网页到jupyter_home.html中，打开网页查看是否已经登录，去掉cookie之后看看网页发生了什么变化。</p><h3 id="4-3-Ajax动态网页"><a href="#4-3-Ajax动态网页" class="headerlink" title="4.3 Ajax动态网页"></a>4.3 Ajax动态网页</h3><p>前几章，我们成功爬取了一些网站的信息，但很快你会发现，在爬取诸如：QQ音乐、今日头条、知乎、美团网时，即使浏览器中能完美展现页面，代码也毫无漏洞，怎么都获取不到想要的数据。这是因为我们获取的仅仅是原始的HTML文档，而浏览器中的页面则是经过JavaScript处理数据后生成的结果，这些数据的来源有多种，可能是通过Ajax加载的，可能是包含在HTML文档中的，也可能是经过JavaScript和特定算法计算后生成的，这种页面就叫做动态页面。</p><p>本章将会实现Ajax数据的爬取。主要内容包括：</p><ol><li>Ajax介绍</li></ol><p>介绍Ajax的概念，用法。</p><ol start="2"><li>Ajax分析方法</li></ol><p>使用Chrome浏览器查看Ajax请求，获取Ajax请求等。</p><ol start="3"><li>Selenium实现动态页面的爬取</li></ol><p>使用Web应用程序测试的工具实现动态页面的爬取。</p><ol start="4"><li>Selenium案例实现</li></ol><p>实现一个Selenium综合案例。</p><p>本章的学习路径如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123754.jpg" alt="Ajax数据爬虫分析路径"></p><p><strong>问题</strong></p><p>学到这里，很多人可能会跃跃欲试，到各大网站爬取自己想要的数据了。但是，现实是你可能会乘兴而来败兴而归。因为更大的难题还在等着我们，例如，看下面的例子。</p><p>下图是豆瓣电影的影视页，网址为：<a href="https://movie.douban.com/tag/#/%E3%80%82" rel="external nofollow noreferrer">https://movie.douban.com/tag/#/。</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123900.jpg" alt="img"> </p><p>现要获取该页面的影视信息。方法步骤如下：</p><p>通过Chrome浏览器的“开发者工具”获取HTML页面并解析代码，然后使用XPath获取电影的各个字段，最后保存起来。</p><p>但得到的结果却是：什么数据都没有，不要怀疑你的代码，因为你获取的HTML代码就是没有数据，来看一下证据，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123854.jpg" alt="img"> </p><p>但事实是我们看到的页面确实有数据，这些数据从哪来的，又到哪去了呢?如何获取这些数据呢？我们接着往下看。</p><p><strong>Ajax引入</strong></p><p>传统的网页，如果想要更新内容，必须刷新整个页面，重新加载所有内容。有了Ajax，便可以在页面不被全部刷新的情况下，只更新局部内容。相对传统页面，使用Ajax的好处显而易见。</p><p>（1） 更好的用户体验</p><p>无需频繁手动重新刷新整个页面，，减少了页面加载的等待时间，大大提升了用户体验，增加用户粘性。</p><p>（2） 节省流量</p><p>由于只更新了局部页面的数据，相对加载整个页面来说，大大节省了流量，减轻了服务器的负担。</p><p>现在绝大部分的网站，其实都用到了Ajax技术。</p><p>例如，豆瓣电影的影视页面，如下图所示，通过筛选栏筛选影视内容，我们会发现，页面并未重新刷新，仅仅是更新了影视内容。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123928.jpg" alt="img"> </p><p>再例如，我们访问京东首页时（如下图所示），内容只加载了部分，当鼠标往下滑动时，就会出现一个京东的吉祥物正在奔跑的图标，说明内容正在加载，不一会下方就会显示新的内容了。如果鼠标继续下滑，就会不断加载新内容。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123928.jpg" alt="img"> </p><p>我们注意到页面其实并没有整个刷新，也就意味着页面的链接没有变化，但是网页中却多了新内容，也就是后面刷出来的内容。这就是通过Ajax获取新数据并呈现的过程。</p><p>对爬虫来说，当我们爬取数据失败时，就需要考虑网站可能是通过Ajax获取数据，再经过页面的解析和渲染显示在浏览器中，因此，分析了Ajax获取的数据的来源，爬虫也就能获取到这些数据了。</p><h4 id="4-3-1-Ajax介绍"><a href="#4-3-1-Ajax介绍" class="headerlink" title="4.3.1 Ajax介绍"></a>4.3.1 Ajax介绍</h4><ol><li><strong>Ajax概念</strong></li></ol><p>Ajax，全称<strong>A</strong>synchronous <strong>J</strong>avaScript <strong>a</strong>nd <strong>X</strong>ML，即异步的JavaScript和XML。它不是新的编程语言，而是利用JavaScript在不重新加载整个页面的情况下，与服务器交换数据并更新部分网页内容的技术。</p><ol start="2"><li><strong>基本原理</strong></li></ol><p>来看一下Ajax实现的基本原理，发送Ajax请求到网页更新的过程简单分为三个步骤：</p><p>（1） 发送请求</p><p>当页面的某个地方需要更新数据时，会向服务器发送Ajax请求，请求的最底层是通过JavaScript实现的。</p><p>（2） 解析内容</p><p>服务器发送响应内容，可能是HTML代码或者JSON数据。使用JavaScript处理响应数据。</p><p>（3） 渲染网页</p><p>JavaScript有改变网页内容的能力，解析完响应内容之后，就可以调用JavaScript来针对解析完的内容对网页进行下一步处理了。</p><p>我们观察到，这3个步骤其实都是由JavaScript完成的，它完成了整个请求、解析和渲染的过程。</p><p>对于爬虫开发者来说，在爬取网页时，只要能够分析页面使用的是Ajax技术，对Ajax原理有个初步的认识即可。下面我们通过Chrome浏览器的“开发者工具”，来分析一下Ajax。</p><h4 id="4-3-2-Ajax分析方法"><a href="#4-3-2-Ajax分析方法" class="headerlink" title="4.3.2 Ajax分析方法"></a>4.3.2 Ajax分析方法</h4><p>对爬虫来说，我们不关心Ajax的实现原理，只要获取到通过Ajax请求的数据就大功告成了。那么，如何获取通过Ajax获取的数据呢？答案是：使用Chrome浏览器的“开发者工具”。</p><p>还是豆瓣电影的影视页面为例（<a href="https://movie.douban.com/tag/#/%EF%BC%89%E3%80%82%E6%89%93%E5%BC%80%E9%A1%B5%E9%9D%A2%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8%E2%80%9C%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7%E2%80%9D%EF%BC%8C%E6%8C%89%E7%85%A7%E4%B8%8B%E5%9B%BE%E7%9A%84%E9%A1%BA%E5%BA%8F%E7%82%B9%E5%87%BB%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BC%9A%E5%8F%91%E7%8E%B0%EF%BC%8C%E5%BD%B1%E8%A7%86%E4%BF%A1%E6%81%AF%E7%9A%84%E6%95%B0%E6%8D%AE%E9%83%BD%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%AC%AC5%E6%AD%A5%E4%B8%AD%E4%BA%86%E3%80%82" rel="external nofollow noreferrer">https://movie.douban.com/tag/#/）。打开页面后，使用“开发者工具”，按照下图的顺序点击，我们会发现，影视信息的数据都显示在第5步中了。</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329124035.jpg" alt="img"></p><p>原来，”开发者工具”将通过Ajax请求响应的数据保存于“XHR”栏中了（下图第2步），在“Name”栏中（第3步），罗列了所有通过Ajax请求的响应接口，接口地址为：<a href="https://movie.douban.com/j/new_search_subjects?sort=U&amp;range=0,10&amp;tags=&amp;start=0" rel="external nofollow noreferrer">https://movie.douban.com/j/new_search_subjects?sort=U&amp;range=0,10&amp;tags=&amp;start=0</a></p><p>对爬虫来说，要想获取Ajax请求的数据，只要得到接口地址，通过接口地址向服务器发送请求，数据不就能获取到了吗？</p><p>下面一起来看一下实现过程：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">import</span> time<span class="token keyword">import</span> csv <span class="token comment" spellcheck="true"># 创建CSV文件</span>fp <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'ajax_douban_movies.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'电影名'</span><span class="token punctuation">,</span> <span class="token string">'得分'</span><span class="token punctuation">,</span> <span class="token string">'演员'</span><span class="token punctuation">,</span> <span class="token string">'链接地址'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 访问前三页，每页显示20</span><span class="token keyword">for</span> a <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.157 Safari/537.36'</span><span class="token punctuation">}</span>    url <span class="token operator">=</span> <span class="token string">'https://movie.douban.com/j/new_search_subjects?sort=T&amp;range=0,10&amp;tags=&amp;start={}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>a<span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    file <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#这里跟之前的不一样，因为返回的是 json 文件</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 显示20行的电影名，得分，演员，链接地址</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dict<span class="token operator">=</span>file<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>   <span class="token comment" spellcheck="true">#取出字典中 'data' 下第 [i] 部电影的信息</span>        urlname<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>        title<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>        rate<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span>        cast<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'casts'</span><span class="token punctuation">]</span>        result <span class="token operator">=</span> <span class="token string">'{},{},{},{}\n'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>title<span class="token punctuation">,</span>rate<span class="token punctuation">,</span><span class="token string">'  '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">,</span>urlname<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 写入CSV文件,  使用' '.json(cast)把多名演员名字用空格分开</span>        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> rate<span class="token punctuation">,</span> <span class="token string">'  '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">,</span> urlname<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行之后，打开ajax_douban_movies.csv文件，获得的内容部分信息如下：</p><table><thead><tr><th>标题</th><th>得分</th><th>演员</th><th>链接地址</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>我不是药神</td><td>9</td><td>徐峥 王传君 周一围 谭卓 章宇</td><td><a href="https://movie.douban.com/subject/26752088/" rel="external nofollow noreferrer">https://movie.douban.com/subject/26752088/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>肖申克的救赎</td><td>9.7</td><td>蒂姆·罗宾斯 摩根·弗里曼 鲍勃·冈顿 威廉姆·赛德勒 克兰西·布朗</td><td><a href="https://movie.douban.com/subject/1292052/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1292052/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>这个杀手不太冷</td><td>9.4</td><td>让·雷诺 娜塔莉·波特曼 加里·奥德曼 丹尼·爱罗 彼得·阿佩尔</td><td><a href="https://movie.douban.com/subject/1295644/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1295644/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>流浪地球</td><td>7.9</td><td>屈楚萧 吴京 李光洁 吴孟达 赵今麦</td><td><a href="https://movie.douban.com/subject/26266893/" rel="external nofollow noreferrer">https://movie.douban.com/subject/26266893/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>千与千寻</td><td>9.4</td><td>柊瑠美 入野自由 夏木真理 菅原文太 中村彰男</td><td><a href="https://movie.douban.com/subject/1291561/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1291561/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>泰坦尼克号</td><td>9.4</td><td>莱昂纳多·迪卡普里奥 凯特·温丝莱特 比利·赞恩 凯西·贝茨 弗兰西丝·费舍</td><td><a href="https://movie.douban.com/subject/1292722/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1292722/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>阿甘正传</td><td>9.5</td><td>汤姆·汉克斯 罗宾·怀特 加里·西尼斯 麦凯尔泰·威廉逊 莎莉·菲尔德</td><td><a href="https://movie.douban.com/subject/1292720/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1292720/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>盗梦空间</td><td>9.3</td><td>莱昂纳多·迪卡普里奥 约瑟夫·高登-莱维特 艾利奥特·佩吉 汤姆·哈迪 渡边谦</td><td><a href="https://movie.douban.com/subject/3541415/" rel="external nofollow noreferrer">https://movie.douban.com/subject/3541415/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>霸王别姬</td><td>9.6</td><td>张国荣 张丰毅 巩俐 葛优 英达</td><td><a href="https://movie.douban.com/subject/1291546/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1291546/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>疯狂动物城</td><td>9.2</td><td>金妮弗·古德温 杰森·贝特曼 伊德里斯·艾尔巴 珍妮·斯蕾特 内特·托伦斯</td><td><a href="https://movie.douban.com/subject/25662329/" rel="external nofollow noreferrer">https://movie.douban.com/subject/25662329/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>摔跤吧！爸爸</td><td>9</td><td>阿米尔·汗 法缇玛·萨那·纱卡 桑亚·玛荷塔 阿帕尔夏克提·库拉那 沙克希·坦沃</td><td><a href="https://movie.douban.com/subject/26387939/" rel="external nofollow noreferrer">https://movie.douban.com/subject/26387939/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>西虹市首富</td><td>6.6</td><td>沈腾 宋芸桦 张一鸣 张晨光 常远</td><td><a href="https://movie.douban.com/subject/27605698/" rel="external nofollow noreferrer">https://movie.douban.com/subject/27605698/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>哪吒之魔童降世</td><td>8.4</td><td>吕艳婷 囧森瑟夫 瀚墨 陈浩 绿绮</td><td><a href="https://movie.douban.com/subject/26794435/" rel="external nofollow noreferrer">https://movie.douban.com/subject/26794435/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>三傻大闹宝莱坞</td><td>9.2</td><td>阿米尔·汗 卡琳娜·卡普尔 马达范 沙尔曼·乔希 奥米·瓦依达</td><td><a href="https://movie.douban.com/subject/3793023/" rel="external nofollow noreferrer">https://movie.douban.com/subject/3793023/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>怦然心动</td><td>9.1</td><td>玛德琳·卡罗尔 卡兰·麦克奥利菲 瑞贝卡·德·莫妮 安东尼·爱德华兹 约翰·马奥尼</td><td><a href="https://movie.douban.com/subject/3319755/" rel="external nofollow noreferrer">https://movie.douban.com/subject/3319755/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>让子弹飞</td><td>8.9</td><td>姜文 葛优 周润发 刘嘉玲 陈坤</td><td><a href="https://movie.douban.com/subject/3742360/" rel="external nofollow noreferrer">https://movie.douban.com/subject/3742360/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>复仇者联盟3：无限战争</td><td>8.1</td><td>小罗伯特·唐尼 克里斯·海姆斯沃斯 克里斯·埃文斯 马克·鲁弗洛 乔什·布洛林</td><td><a href="https://movie.douban.com/subject/24773958/" rel="external nofollow noreferrer">https://movie.douban.com/subject/24773958/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>海上钢琴师</td><td>9.3</td><td>蒂姆·罗斯 普路特·泰勒·文斯 比尔·努恩 克兰伦斯·威廉姆斯三世 梅兰尼·蒂埃里</td><td><a href="https://movie.douban.com/subject/1292001/" rel="external nofollow noreferrer">https://movie.douban.com/subject/1292001/</a></td><td></td><td></td><td></td><td></td></tr><tr><td>寻梦环游记</td><td>9.1</td><td>安东尼·冈萨雷斯 盖尔·加西亚·贝纳尔 本杰明·布拉特 阿兰娜·乌巴赫 芮妮·维克托</td><td><a href="https://movie.douban.com/subject/20495023/" rel="external nofollow noreferrer">https://movie.douban.com/subject/20495023/</a></td><td></td><td></td><td></td><td></td></tr></tbody></table><p><strong>问题</strong></p><p>上一节，我们通过分析Ajax，获取数据的接口地址，使用爬虫，实现了数据的获取。</p><p>但是，我们很快发现，为了防止网络爬虫，加大网络爬虫的难度。很多网站将接口地址做了处理，它们更多的具有这些特点：</p><p>既冗长又复杂</p><p>经过加密</p><p>具有时效性</p><p>毫无规律可言</p><p>以今日头条为例，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329124207.jpg" alt="img"> </p><p>其新闻信息的接口地址为：<a href="https://www.toutiao.com/api/pc/feed/?category=news_hot&amp;utm_source=toutiao&amp;widen=1&amp;max_behot_time=0&amp;max_behot_time_tmp=0&amp;tadrequire=true&amp;as=A195DBDC06ADC25&amp;cp=5BC65DAC62854E1&amp;_signature=ZtN.cQAAPRnM.D.xF5yhvGbTf2%E3%80%82%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E5%8F%88%E9%95%BF%E5%8F%88%E5%A4%8D%E6%9D%82%EF%BC%8C%E7%BB%8F%E8%BF%87%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E5%B0%B1%E4%BC%9A%E5%A4%B1%E6%95%88%E3%80%82%E4%BB%8E%E4%B8%AD%E6%88%91%E4%BB%AC%E5%BE%88%E9%9A%BE%E6%89%BE%E5%87%BA%E8%A7%84%E5%BE%8B%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%97%A0%E6%B3%95%E7%88%AC%E5%8F%96%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%96%B0%E9%97%BB%E4%BF%A1%E6%81%AF%E3%80%82" rel="external nofollow noreferrer">https://www.toutiao.com/api/pc/feed/?category=news_hot&amp;utm_source=toutiao&amp;widen=1&amp;max_behot_time=0&amp;max_behot_time_tmp=0&amp;tadrequire=true&amp;as=A195DBDC06ADC25&amp;cp=5BC65DAC62854E1&amp;_signature=ZtN.cQAAPRnM.D.xF5yhvGbTf2。这个接口地址又长又复杂，经过加密处理，一段时间后就会失效。从中我们很难找出规律，也就无法爬取更多的新闻信息。</a></p><p>难道我们就束手无策了吗？继续往下看，Selenium能帮我们解决这个难题。</p><h4 id="4-3-3-Selenium介绍"><a href="#4-3-3-Selenium介绍" class="headerlink" title="4.3.3 Selenium介绍"></a>4.3.3 Selenium介绍</h4><p>要解决上节的问题，我们的思路是：可以使用模拟浏览器运行的方式，它可以做到在浏览器中看到的是什么样，抓取的源码就是什么样，即可见即可爬。再也不用管网页内容是使用了JavaScrapt还是Ajax，也不用管接口有多复杂了（其实连接口是什么都不用管）。</p><p>Selenium /sə’liniəm/是一个用于Web应用程序测试的工具，它直接运行在浏览器中，就像真正的用户在操作一样。通俗点讲，它能直接驱动浏览器，模拟人的各种操作行为，如下拉、鼠标点击、键盘输入、拖拽等操作。最后可以获取页面渲染后的HTML代码。</p><p><strong>Selenium安装</strong></p><p>下面来看一下Selenium库和浏览器驱动程序的安装</p><p><strong>1.</strong>    <strong>安装Python支持的Selenium库</strong></p><p>安装Selenium非常简单，使用pip命令即可：</p><pre class="line-numbers language-python"><code class="language-python">pip install selenium<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>2.</strong>    <strong>安装浏览器驱动程序</strong></p><p>需要下载一个Selenium调用浏览器的驱动文件。我们以Chrome浏览器为例，看一下下载Chrome浏览器的驱动文件的步骤：</p><p>（1）    查看Chrome浏览器的版本。</p><p>首先要查看当前安装的Chrome浏览器的版本，以便下载与浏览器版本对应的驱动文件。</p><p>打开Chrome浏览器，点击菜单中的 “帮助”→“关于Google Chrome”，即可查看Chrome的版本号，如图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418103752.png" alt="image-20210418103752598"> </p><p>（2）    下载Chromedriver。</p><p>以下为Chromedriver的下载地址。无法打开官方下载地址的读者，可以选择第二个下载地址。笔者安装的是ChromeDriver 90.0.4430.24。该版本支持Chrome浏览器的90.0.4430范围的版本</p><p>官方下载地址：<a href="https://chromedriver.storage.googleapis.com/index.html%E3%80%82" rel="external nofollow noreferrer">https://chromedriver.storage.googleapis.com/index.html。</a></p><p>其他下载地址：<a href="http://npm.taobao.org/mirrors/chromedriver/%E3%80%82" rel="external nofollow noreferrer">http://npm.taobao.org/mirrors/chromedriver/。</a></p><p>（3）    配置环境变量。</p><p>最后，需要将驱动文件配置到环境变量中。在Windows下，将下载得到的chromedriver.exe文件拖到Anaconda3的Scripts目录下就可以了，如：C:\Anaconda3\Scripts下。</p><p><strong>Selenium语法</strong></p><ol><li><strong>声明浏览器对象</strong></li></ol><p>Selenium支持很多浏览器，如Chrome、Firefox、IE、Opera、Safari等，还有Android、BlackBerry等手机端的浏览器。selenium.webdriver 模块提供了所有浏览器的驱动（WebDriver），可以生成不同浏览器的对象。</p><p>下面是声明不同浏览器对象的实现代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriverdriver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#声明Chrome浏览器对象</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ie<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#声明ie浏览器对象</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#声明firefox浏览器对象</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>phantomjs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#声明phantomjs浏览器对象</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>safari<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#声明safari浏览器对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><strong>访问页面</strong></li></ol><p>可以使用get方法实现页面的访问：</p><pre class="line-numbers language-python"><code class="language-python">driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.suning.com/"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#请求页面</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li><strong>获取页面代码</strong></li></ol><p>使用driver的page_source属性获取页面的HMTL代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取代码</span>HTML<span class="token operator">=</span>driver<span class="token punctuation">.</span>page_source<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li><strong>定位元素</strong></li></ol><p>当获取到HTML代码后，就需要定位到HTML的各个元素，以便提取数据或者对该元素执行诸如输入、点击操作。WebDriver 提供了大量的方法查询页面中的节点，这些方法形如：find_element_by_*。</p><p>以下为Selenium查找单个节点的方法。</p><p>find_element_by_id：通过ID查找</p><p>find_element_by_name：通过NAME查找</p><p>find_element_by_xpath：通过xpath选择器查找</p><p>find_element_by_link_text：通过链接的文本查找（完全匹配）</p><p>find_element_by_partial_link_text：通过链接的文本查找（部分匹配）</p><p>find_element_by_tag_name：通过标签名查找</p><p>find_element_by_class_name：通过CLASS查找</p><p>find_element_by_css_selector：通过css选择器查找</p><ol start="5"><li><strong>页面交互</strong></li></ol><p>Selenium可以模拟用户对页面执行一系列操作，如输入数据、清除数据、单击按钮等。以下代码实现了定位到搜索框后，清空搜索框中的文字，输入“iphone”，回车的功能。</p><pre class="line-numbers language-python"><code class="language-python">input <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">"searchKeywords"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#查找节点</span>input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#清除输入框中默认文字</span>input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"iphone"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输入框中输入“iphone”</span>input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>RETURN<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#回车功能</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li><strong>执行JavaScript</strong></li></ol><p>Selenium并未提供所有的页面交互操作方法，例如爬虫中用得最多的下拉页面（用于加载更多内容）。Selenium提供了execute_script()方法，用于执行JS，这样我们就可以通过JS代码实现这些操作了。以下代码实现了将页面下拉到底部的功能。</p><p><code>driver.execute_script(&#39;window.scrollTo(0, document.body.scrollHeight)&#39;)</code></p><p>更多关于Selenium的语法，可以参考Selenium with Python的中文文档。</p><p>地址为：<a href="https://selenium-python-zh.readthedocs.io/en/latest/index.html#%E3%80%82" rel="external nofollow noreferrer">https://selenium-python-zh.readthedocs.io/en/latest/index.html#。</a></p><h4 id="4-3-4-Selenium实现百度搜索"><a href="#4-3-4-Selenium实现百度搜索" class="headerlink" title="4.3.4 Selenium实现百度搜索"></a>4.3.4 Selenium实现百度搜索</h4><p>为了熟悉Selenium的功能，接下来利用Selenium访问百度，输入搜索关键字后，完成提取搜索页面的查询结果的一个案例作为说明。</p><p><strong>以headless chrome方式访问百度首页</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token comment" spellcheck="true">#chrome选项</span>options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#使用无头chrome</span>options<span class="token punctuation">.</span>set_headless<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#配置并获得WebDriver对象</span>path <span class="token operator">=</span> <span class="token string">'D:/Soft/VSCode32_Python_Portable/Python378/Scripts/chromedriver.exe'</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>path<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#发起get请求</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>百度首页用来输入搜索关键词的组件是</strong></p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>s_ipt<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wd<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>kw<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>通过查看网页源代码可以查询到相关标签信息如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418113102.png" alt="百度搜索input"></p><p>那怎么通过Selenium模拟人的文本输入呢？比如说咱们要查找<code>python</code>关键字，可以使用以下方法：</p><pre class="line-numbers language-python"><code class="language-python">input_element <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span>input_element<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span>input_element<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这样就通过name属性获得input标签实例<code>input_element</code>后，输入要查询的<code>python</code>关键字，并通过调用submit方法进行提交，接下来就是等待百度返回结果了。</p><p><strong>百度的结果页查询</strong></p><p>当以python作为关键字查询时，百度返回查询结果页面时会在浏览器的标题(title)中包含查询的关键字，利用这个特点，当WebDriver的标题中出现包含’python’的文字即说明百度返回了搜索结果页面。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418123222.png" alt="nums_text网页源码"></p><p>通过代码进行提取</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> re<span class="token comment" spellcheck="true">#chrome选项</span>options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#使用无头chrome</span>options<span class="token punctuation">.</span>set_headless<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#配置并获得WebDriver对象</span>path <span class="token operator">=</span> <span class="token string">'D:/Soft/VSCode32_Python_Portable/Python378/Scripts/chromedriver.exe'</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>path<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#发起get请求</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span>input_element <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span>input_element<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span>input_element<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#最多等待10秒直到浏览器标题栏中出现我希望的字样（比如查询关键字出现在浏览器的title中）</span>    WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>        expected_conditions<span class="token punctuation">.</span>title_contains<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">)</span>    bsobj <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span>    num_text_element <span class="token operator">=</span> bsobj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'nums_text'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    nums <span class="token operator">=</span> filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">==</span> <span class="token string">','</span> <span class="token operator">or</span> s<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">finally</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#关闭浏览器</span>    driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码解析：首先是”百度为您找到相关结果约100,000,000个”，这个结果是存放在一个span中，</p><p><span class="nums_text">百度为您找到相关结果约100,000,000个</span>，利用class属性可以找到标签span，并提取span中的文本，再进一步只提取其中的数字100,000,000</p><p>利用页面的内容生成BeautifulSoup对象后，调用find方法找到class属性为nums_text的span标签，取出它的文本内容。</p><p>最后使用filter函数，过滤出文本内容中需要的部分（比如，数字和逗号）</p><p><strong>提取列表中的标题和链接</strong></p><p>通过网页可以看到对应的源代码通过class c-container封装在div标签中。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418124247.png" alt="搜索标题和链接信息"></p><p>再打开这个标签后，发现c-container标签下面的h3标签下面的a标签的href属性值就是一个搜索结果的链接地址。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418124553.png" alt="网页搜索的链接地址"></p><p><strong>最终获取标题和链接的代码</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> re<span class="token comment" spellcheck="true">#chrome选项</span>options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#使用无头chrome</span>options<span class="token punctuation">.</span>set_headless<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#配置并获得WebDriver对象</span>path <span class="token operator">=</span> <span class="token string">'D:/Soft/VSCode32_Python_Portable/Python378/Scripts/chromedriver.exe'</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>path<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#发起get请求</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span>input_element <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span>input_element<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span>input_element<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#最多等待10秒直到浏览器标题栏中出现我希望的字样（比如查询关键字出现在浏览器的title中）</span>    WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>        expected_conditions<span class="token punctuation">.</span>title_contains<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">)</span>    bsobj <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span>    num_text_element <span class="token operator">=</span> bsobj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'nums_text'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    nums <span class="token operator">=</span> filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">==</span> <span class="token string">','</span> <span class="token operator">or</span> s<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span>    elements <span class="token operator">=</span> bsobj<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'c-container'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> element <span class="token keyword">in</span> elements<span class="token punctuation">:</span>        <span class="token keyword">if</span> element<span class="token punctuation">.</span>h3 <span class="token keyword">is</span> <span class="token operator">not</span> None <span class="token operator">and</span> element<span class="token punctuation">.</span>h3<span class="token punctuation">.</span>a <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'标题：'</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>h3<span class="token punctuation">.</span>a<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'链接：'</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>h3<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'==============================================================='</span><span class="token punctuation">)</span><span class="token keyword">finally</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#关闭浏览器</span>    driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-3-5-我们使用Selenium实现一个案例"><a href="#4-3-5-我们使用Selenium实现一个案例" class="headerlink" title="4.3.5 我们使用Selenium实现一个案例"></a>4.3.5 我们使用Selenium实现一个案例</h4><p>下面，我们使用Selenium实现一个案例，需求是使用爬虫获取今日头条中热点新闻的获取，保存于CSV文件中。获取的字段有：新闻标题、来源和评论数。如下图所示。</p><p>1，新建一个python文件，导入需要的库</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver <span class="token comment" spellcheck="true">#导入web驱动库</span><span class="token keyword">import</span> time <span class="token comment" spellcheck="true">#导入时间库</span><span class="token keyword">import</span> pymongo<span class="token comment" spellcheck="true">#monggo #导入数据库</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2，因为获取的数据需要保存到mongodb数据库中，所以可以先连接数据库</p><pre class="line-numbers language-python"><code class="language-python"> 链接数据库client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#链接数据库</span>db <span class="token operator">=</span>client<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置数据库名</span>toutiao <span class="token operator">=</span>db<span class="token punctuation">[</span><span class="token string">'toutiao'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置集合名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>3，启动webdrive</p><pre class="line-numbers language-python"><code class="language-python">base_url <span class="token operator">=</span><span class="token string">'https://www.toutiao.com'</span>brower <span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base_url<span class="token punctuation">)</span>brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 最大化窗口</span>brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>find_element_by_link_text<span class="token punctuation">(</span><span class="token string">'热点'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4，用selenium自带的find_elements_by_xpath()方法获取页面需要的元素，这里我们获取新闻的标题title，详情页面的链接url,发布者source,评论总数comment</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    titles<span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> title <span class="token keyword">in</span> titles<span class="token punctuation">:</span>        title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    urls <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>        url <span class="token operator">=</span> url<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    sources <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn source"]'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>        sources_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>source<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    comments <span class="token operator">=</span>brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn comment"]'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> comment <span class="token keyword">in</span> comments<span class="token punctuation">:</span>        comments_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5, 因为今日头条是用ajax动态加载的，浏览器向下拉的过程中，页面会一直在下面加载出来，可以通过execute_script(“window.scrollTo();”)功能模拟浏览器下拉页面刷新数据</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_manyinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,1000);"</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> len<span class="token punctuation">(</span>title_list<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,document.body.scrollHeight);"</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>        brower<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        brower<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6，设计保存到数据库中，用zip()函数匹配title，url，source, comment,保存为字典格式，然后将字典保存到数据库中</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">save_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    infos <span class="token operator">=</span> zip<span class="token punctuation">(</span>title_list<span class="token punctuation">,</span> url_list<span class="token punctuation">,</span> sources_list<span class="token punctuation">,</span> comments_list<span class="token punctuation">)</span>    <span class="token keyword">for</span> info <span class="token keyword">in</span> infos<span class="token punctuation">:</span>        data<span class="token operator">=</span><span class="token punctuation">{</span>            <span class="token string">'标题'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">'url'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">'来源'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">'评论'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">#result =db['toutiao'].insert_one(data)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>完整代码</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">import</span> time<span class="token keyword">import</span> pymongo<span class="token comment" spellcheck="true"># 链接数据库</span>client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#链接数据库</span>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置数据库名</span>toutiao <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'toutiao'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置集合名</span><span class="token comment" spellcheck="true">#启动webdrive</span>base_url <span class="token operator">=</span><span class="token string">'https://www.toutiao.com'</span>brower <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base_url<span class="token punctuation">)</span>brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 最大化窗口</span>brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>find_element_by_link_text<span class="token punctuation">(</span><span class="token string">'热点'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>title_list<span class="token punctuation">,</span>url_list<span class="token punctuation">,</span>sources_list<span class="token punctuation">,</span>comments_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 获取页面新闻标题，详情页面链接，来源，评论，并添加到列表中</span><span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    titles<span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> title <span class="token keyword">in</span> titles<span class="token punctuation">:</span>        title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    urls <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>        url <span class="token operator">=</span> url<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    sources <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn source"]'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>        sources_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>source<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    comments <span class="token operator">=</span>brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn comment"]'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> comment <span class="token keyword">in</span> comments<span class="token punctuation">:</span>        comments_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 通过下拉进度条一直加载页面</span><span class="token keyword">def</span> <span class="token function">get_manyinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,1000);"</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> len<span class="token punctuation">(</span>title_list<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,document.body.scrollHeight);"</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>        brower<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        brower<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 保存获取的信息保存到mongodb中</span><span class="token keyword">def</span> <span class="token function">save_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    infos <span class="token operator">=</span> zip<span class="token punctuation">(</span>title_list<span class="token punctuation">,</span> url_list<span class="token punctuation">,</span> sources_list<span class="token punctuation">,</span> comments_list<span class="token punctuation">)</span>    <span class="token keyword">for</span> info <span class="token keyword">in</span> infos<span class="token punctuation">:</span>        data<span class="token operator">=</span><span class="token punctuation">{</span>            <span class="token string">'标题'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">'url'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">'来源'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">'评论'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span>        result <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'toutiao'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    get_manyinfo<span class="token punctuation">(</span><span class="token punctuation">)</span>    save_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>使用Requests实现网络爬虫，简单方便，功能强大。但是如果爬取海量数据，爬虫功能又比较复杂，全靠自己设计和实现就显得复杂而麻烦了，例如，实现并行爬取、分布式爬取、破解对方的反爬虫技术等。</p><p>这时，可以考虑使用Scrapy爬虫框架，它就像了一个爬虫流水线，自动给我们配置好工作队列、下载器、任务的分配，解析模块、持久化模块等，我们只要在相应的模块中实现对于的功能，再复杂的爬虫都能很顺畅、高效地运行。下一章开始，我们将为大家介绍一个爬虫框架-Scrapy。</p><h2 id="五、2天学会Scrapy框架爬虫"><a href="#五、2天学会Scrapy框架爬虫" class="headerlink" title="五、2天学会Scrapy框架爬虫"></a>五、2天学会Scrapy框架爬虫</h2><h3 id="5-1-Scrapy框架结构"><a href="#5-1-Scrapy框架结构" class="headerlink" title="5.1 Scrapy框架结构"></a>5.1 Scrapy框架结构</h3><p>第一章网络爬虫基础中，我们学习了爬虫原理和HTTP基本原理，理解了这些，就不难理解Scrapy的框架结构了，因为Scrapy框架结构和流程设计遵循网络爬虫的基本原理。</p><p>下图展示了Scrapy的框架结构。包含了不同功能的组件、系统中发生的数据流以及执行流程。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329154336.jpg" alt="Scrapy框架结构"> </p><p>首先来看一下框架结构中的各个组件：</p><p><strong>引擎（ENGINE）</strong></p><p>引擎犹如总指挥，是整个系统的大脑，指挥其他组件协同工作。</p><p><strong>调度器（SCHEDULER）</strong></p><p>调度器接收引擎发过来的请求，压入队列中。调度器根据请求先后顺序，确定执行顺序。同时去除重复的请求。</p><p><strong>下载器（DOWNLOADER）</strong></p><p>用于下载网页内容，并将网页内容返回给爬虫（Scrapy下载器是建立在twisted这个高效的异步模型上的）</p><p><strong>爬虫（SPIDERS）</strong></p><p>最核心的组件，用于从特定的网页中提取自己需要的信息，即所谓的实体（Item）。用户也可以从中提取出链接，让Scrapy继续抓取下一个页面。</p><p><strong>项目管道（ITEM PIPELINES）</strong></p><p>负责处理爬虫从网页中抽取的实体，主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。</p><p><strong>下载器中间件（Downloader Middlewares）</strong></p><p>介于引擎和下载器之间的组件，主要是处理Scrapy引擎与下载器之间的请求及响应。</p><p><strong>爬虫中间件（Spider Middlewares）</strong></p><p>介于引擎和爬虫之间的组件，主要工作是处理爬虫的响应输入和请求输出。</p><h3 id="5-2-Scrapy框架结构-数据流"><a href="#5-2-Scrapy框架结构-数据流" class="headerlink" title="5.2 Scrapy框架结构-数据流"></a>5.2 Scrapy框架结构-数据流</h3><p>我们都知道，爬虫中的数据主要有两种，一是向服务器发送请求的Request请求数据，二是服务器响应返回给浏览器的Response响应数据，Scrapy中的数据流是怎样的呢？下图为Scrapy的框架结构。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329154633.jpg" alt="img"> </p><p>来看一下Scrapy框架结构中展示的数据流，上图中的REQUESTS和RESPONSE分别表示请求数据和响应数据流：</p><p>Scrapy框架结构中传递和处理的数据主要有：</p><p>q 向网站服务器发送的请求数据（请求的内容见第一章的HTTP请求）</p><p>q 网站服务器返回的响应数据（响应的内容见第一章的HTTP响应）</p><p>q 解析后的结构数据（类似于字典）</p><p>Scrapy中定义的Request和Response类用于保存请求和响应数据，Item类保存解析后的结构数据，如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329154915.png" alt="请求流程"></p><h3 id="5-3-Scrapy执行流程"><a href="#5-3-Scrapy执行流程" class="headerlink" title="5.3 Scrapy执行流程"></a>5.3 Scrapy执行流程</h3><p>下面从数据流的角度揭示Scrapy框架的执行流程。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329155122.jpeg" alt="img"> </p><p>上图中第①②③④步执行的是HTTP请求，传递和处理的是向网站服务器发送的请求数据。</p><p><strong>第①步</strong>：爬虫（Spider）使用URL（要爬取页面的网址）构造一个请求（Request）对象，提交给引擎（ENGINE）。如果请求要伪装成浏览器，或者设置代理IP，可以先在爬虫中间件中设置，再发送给引擎。</p><p><strong>第②步</strong>：引擎将请求安排给调度器，调度器根据请求的优先级确定执行顺序。</p><p><strong>第③步</strong>：引擎从调度器获取即将要执行的请求。</p><p><strong>第④步</strong>：引擎通过下载器中间件，将请求发送给下载器下载页面。</p><p>上图中第⑤⑥⑦⑧步执行的是HTTP响应，传递和处理的是网站服务器返回的响应数据。</p><p><strong>第⑤步</strong>：页面完成下载后，下载器会生成一个响应（Response）对象并将其发送给引擎。下载后的数据就是保存于响应对象中的。</p><p><strong>第⑥步</strong>：引擎接收来自下载器的响应对象后，通过爬虫中间件，将其发送给爬虫（Spider）进行处理。</p><p><strong>第⑦步</strong>：爬虫将抽取到的一条数据实体（Item）和新的请求（如下一页的链接）发送给引擎。</p><p><strong>第⑧步</strong>：引擎将从爬虫获取到的Item发送给项目管道（ITEM PIPELINES），项目管道实现数据持久化等功能；将新的请求发送给调度器，再从第②步开始重复执行，直到调度器中没有更多的请求，引擎关闭该网站。</p><h3 id="5-4-Scrapy安装"><a href="#5-4-Scrapy安装" class="headerlink" title="5.4 Scrapy安装"></a>5.4 Scrapy安装</h3><p>Scrapy框架的安装非常简单，使用pip命令：</p><pre class="line-numbers language-bash"><code class="language-bash">pip <span class="token function">install</span> scrapy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完后验证安装是否成功，输入如下代码，执行。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">print</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>version_info<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>执行代码，没有任何错误，说明安装成功，执行后的结果为scrapy的安装版本：</p><p>(1, 5, 1)</p><h3 id="5-5-Spider组件介绍"><a href="#5-5-Spider组件介绍" class="headerlink" title="5.5 Spider组件介绍"></a>5.5 Spider组件介绍</h3><p>Scrapy网络爬虫编程的核心就是爬虫（Spider）组件，它其实是一个继承于Spider的类，主要功能是封装一个发送给网站服务器的HTTP请求，以及解析网站返回的网页、提取数据。</p><p>Spider组件解决了以下问题：</p><p>爬虫从哪个或哪些页面开始爬取。</p><p>对于一个已下载的页面，提取其中的哪些数据。</p><p>爬取完当前页面后，接下来爬取哪个或哪些页面。</p><p>上面问题的答案包含了一个爬虫最重要的逻辑，回答了这些问题，一个爬虫也就开发出来了。</p><p>接下来，通过一个具体案例，讲解一个Spider的开发流程，实现数据的爬取功能。</p><h3 id="5-6-Item介绍"><a href="#5-6-Item介绍" class="headerlink" title="5.6 Item介绍"></a>5.6 Item介绍</h3><p>上节通过Spider爬取到了数据，为了收集抓取到的这些数据，Scrapy提供了一个简单的容器Item。Item对象是一个简单的容器，用于收集抓取到的数据，其提供了类似于字典（dictionary-like）的API并具有用于声明可用字段的简单语法。</p><p>Scrapy还定义了一个类Field，用于描述自定义数据类包含的字段。</p><p>下面继续完成上节未完成的案例，实现使用Item封装数据。</p><h3 id="5-7-Pipeline介绍"><a href="#5-7-Pipeline介绍" class="headerlink" title="5.7 Pipeline介绍"></a>5.7 Pipeline介绍</h3><p>当我们通过Spider爬取数据，通过Item收集数据后，就需要对数据进行一些处理了，因为我们爬取到的数据并不一定是我们想要的最终数据，可能还需要进行数据的清洗以及验证数据的有效性。Scrapy中的Pipeline组件就用于数据的处理，一个Pipeline组件就是一个包含特定接口的类，通常只负责一种功能的数据处理，在一个项目中可以同时启用多个Pipeline。</p><p>以下是Pipeline的几种典型应用：</p><p>清洗数据</p><p>验证数据的有效性</p><p>过滤掉重复的数据</p><p>将数据存入数据库</p><h3 id="5-8-第一个Scrapy网络爬虫-豆瓣电影"><a href="#5-8-第一个Scrapy网络爬虫-豆瓣电影" class="headerlink" title="5.8 第一个Scrapy网络爬虫-豆瓣电影"></a>5.8 第一个Scrapy网络爬虫-豆瓣电影</h3><h4 id="5-8-1-Scrapy创建爬虫步骤"><a href="#5-8-1-Scrapy创建爬虫步骤" class="headerlink" title="5.8.1 Scrapy创建爬虫步骤"></a>5.8.1 Scrapy创建爬虫步骤</h4><p>新建项目 (scrapy startproject xxx)：新建一个新的爬虫项目</p><p>明确目标 （编写items.py）：明确你想要抓取的目标</p><p>制作爬虫 （spiders/xxspider.py）：制作爬虫开始爬取网页</p><p>存储内容 （pipelines.py）：设计管道存储爬取内容</p><h4 id="5-8-2-创建Scrapy项目"><a href="#5-8-2-创建Scrapy项目" class="headerlink" title="5.8.2 创建Scrapy项目"></a>5.8.2 创建Scrapy项目</h4><pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject mySpider<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中， mySpider 为项目名称，可以看到将会创建一个 mySpider 文件夹，目录结构大致如下：</p><p>下面来简单介绍一下各个主要文件的作用：</p><pre><code>doubanMovies/    scrapy.cfg    doubanMovies/        __init__.py        items.py        pipelines.py        settings.py        spiders/            __init__.py            ...</code></pre><p>这些文件分别是:</p><ul><li>scrapy.cfg: 项目的配置文件。</li><li>doubanMovies/: 项目的Python模块，将会从这里引用代码。</li><li>doubanMovies/items.py: 项目的目标文件。</li><li>doubanMovies/pipelines.py: 项目的管道文件。</li><li>doubanMovies/settings.py: 项目的设置文件。</li><li>doubanMovies/spiders/: 存储爬虫代码目录。</li></ul><h4 id="5-8-3-确定要抓取的信息"><a href="#5-8-3-确定要抓取的信息" class="headerlink" title="5.8.3 确定要抓取的信息"></a>5.8.3 确定要抓取的信息</h4><p>豆瓣TOP250的网址信息大概是这样，如果我们想要爬取的是TOP250电影的文字信息，主要是完成一些翻页的信息的内容爬取</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420105225.png" alt="**豆瓣TOP250网页信息**"></p><p>为了说明一个scrapy的爬取过程，咱们本次只爬取这些电影的名称<strong>Name</strong>，产出地<strong>location</strong>，averagePrice = scrapy.Field() broker = scrapy.Field()</p><h4 id="5-8-4-创建爬虫的启动代码"><a href="#5-8-4-创建爬虫的启动代码" class="headerlink" title="5.8.4 创建爬虫的启动代码"></a>5.8.4 创建爬虫的启动代码</h4><p>确定了要爬取的内容，就可以创建代码了。</p><p>一个比较好的方式是通过命令行创建要执行的主程序。</p><p>在当前目录下输入命令，将在doubanMovies/spider目录下创建一个名为douban.py的爬虫，并指定爬取域的范围：</p><pre><code>scrapy genspider douban &quot;movie.douban.com&quot;</code></pre><p>执行过程：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420110848.png" alt="创建scrapy的spider模块代码"></p><p>douban.py生成的代码内容如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">DoubanSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'douban'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'movie.douban.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>说明如下：</strong></p><p>要建立一个Spider模块， 你必须用scrapy.Spider类创建一个子类，并确定了<strong>三个属性</strong>和<strong>一个方法</strong>。</p><p><code>name</code>这个是爬虫的识别名称，必须是唯一的，在不同的爬虫必须定义不同的名字；</p><p><code>allow_domains</code>是搜索的域名范围，也就是爬虫的约束区域，规定爬虫只爬取这个域名下的网页，不存在的URL会被忽略；</p><p><code>start_urls</code>是爬取的URL元祖/列表。爬虫从这里开始抓取数据，所以，第一次下载的数据将会从这些urls开始。其他子URL将会从这些起始URL中继承性生成；</p><p><code>parse(self, response)</code>是解析的方法，每个初始URL完成下载后将被调用，调用的时候传入从每一个URL传回的Response对象来作为唯一参数，主要作用如下：</p><p>负责解析返回的网页数据(response.body)，提取结构化数据(<strong>生成item</strong>)生成需要下一页的URL请求。</p><h4 id="5-8-5-代码设计思路"><a href="#5-8-5-代码设计思路" class="headerlink" title="5.8.5 代码设计思路"></a>5.8.5 代码设计思路</h4><p>由于我们要爬取的数据是需要能够自动翻页的，因此以上代码中的<code>start_urls</code>修改如下：</p><pre class="line-numbers language-python"><code class="language-python">start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/top250?start='</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>乘以25是由于豆瓣TOP250网页每页默认显示的显示为25个，然后再通过range(10)循环十次，就可以遍历250个电影信息了。</p><p>那么这250个电影信息在网页的什么位置呢？</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420112137.png" alt="某个电影信息在网页代码中的位置"></p><p>可以发现在content/div/div[1]/ol/存放的是其中一个信息，使用xpath代码来访问如下：</p><pre class="line-numbers language-python"><code class="language-python">xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="content"]/div/div[1]/ol/li'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到了这个之后，咱们再把其中的电影信息，比如电影名字啦、哪个导演啦、评分多少啦等保存下来就可以啦。</p><p>douban.py的完整代码如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> doubanMovies<span class="token punctuation">.</span>items <span class="token keyword">import</span> doubanMovies<span class="token keyword">class</span> <span class="token class-name">DoubanSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>     name <span class="token operator">=</span> <span class="token string">'douban'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'movie.douban.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/top250?start='</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> row <span class="token keyword">in</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="content"]/div/div[1]/ol/li'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 获取所有li</span>            item <span class="token operator">=</span> doubanMovies<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 实例化</span>            item<span class="token punctuation">[</span><span class="token string">"Ranking"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[1]/em/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取排名</span>            item<span class="token punctuation">[</span><span class="token string">"movieName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[2]/div[1]/a/span[1]/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取电影名称</span>            item<span class="token punctuation">[</span><span class="token string">"director"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[2]/div[2]/p[1]/text()[1]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取导演</span>            item<span class="token punctuation">[</span><span class="token string">"rating"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[2]/div[2]/div/span[2]/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取评分</span>            item<span class="token punctuation">[</span><span class="token string">"imageURL"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[1]/a/@href"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取影片海报图片 url</span>            <span class="token keyword">yield</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上的代码parse的response是URL下载后返回的内容，可以在这个方法中编写解析内容，并把信息保存到Scrapy的模块中，可以看到上面的代码在item中定义了5个元素，因此我们还需要在item文件中定义这些数据内容，item.py的代码如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define here the models for your scraped items</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># See documentation in:</span><span class="token comment" spellcheck="true"># https://docs.scrapy.org/en/latest/topics/items.html</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">doubanMovies</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    Ranking <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    movieName <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    director <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    rating <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    imageURL <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">DoubanmoviesItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>    <span class="token comment" spellcheck="true"># name = scrapy.Field()</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了更好的模拟真实浏览器的请求，我们在settings.py中修改如下：</p><pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true">#关闭 robots 协议，否则很多页面都无法爬取</span>LOG_LEVEL <span class="token operator">=</span> <span class="token string">"WARNING"</span> <span class="token comment" spellcheck="true">#日志为警告以上才显示</span>USER_AGENT <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36'</span> <span class="token comment" spellcheck="true"># 模拟浏览器请求，改成自己网页最新的</span>FEED_EXPORT_FIELDS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Ranking"</span><span class="token punctuation">,</span><span class="token string">"movieName"</span><span class="token punctuation">,</span><span class="token string">"director"</span><span class="token punctuation">,</span><span class="token string">"rating"</span><span class="token punctuation">,</span><span class="token string">"imageURL"</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#使其输出的内容有顺序</span>DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment" spellcheck="true"># 设置爬取时间间隔，太快的爬取可能会被网页反爬虫机制检测到</span>RANDOMIZE_DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token boolean">True</span>COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment" spellcheck="true"># 使能cookie</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-8-6-启动爬虫并检测结果"><a href="#5-8-6-启动爬虫并检测结果" class="headerlink" title="5.8.6 启动爬虫并检测结果"></a>5.8.6 启动爬虫并检测结果</h4><p>以上步骤完成后，只需要通过<strong>scrapy crawl douban</strong>启动程序执行就可以了，也可以通过**-o douban.csv**，把解析的结果内容保存到douban.csv中，这样douban.py的parse最终返回的结果会存放到douban.csv中。</p><pre><code>scrapy crawl douban -o douban.csv</code></pre><p>打开douban.csv，得到如下的如下的文件内容：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420115444.png" alt="Scrapy豆瓣TOP250s数据保存内容"></p><h4 id="5-8-7-电影详情图片下载"><a href="#5-8-7-电影详情图片下载" class="headerlink" title="5.8.7 电影详情图片下载"></a>5.8.7 电影详情图片下载</h4><p>通过以上的内容，咱们获取到了每一个电影的详情URL地址，下载图片的方式如下：</p><p>douban.py文件:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> doubanMovies<span class="token punctuation">.</span>items <span class="token keyword">import</span> doubanMovies<span class="token keyword">class</span> <span class="token class-name">DoubanSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'douban'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'movie.douban.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/top250?start='</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> row <span class="token keyword">in</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="content"]/div/div[1]/ol/li'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 获取所有li</span>            url <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[1]/a/@href"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_detail<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">parse_detail</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> doubanMovies<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 实例化</span>       <span class="token comment" spellcheck="true">#item["movieName"] = response.xpath('//*[@id="content"]/h1/span[1]/text()').get()  # 获取电影名称</span>        <span class="token comment" spellcheck="true">#item["Screenwriter"] = response.xpath('string(//*[@id="info"]/span[2]/span[2])').get()  # 编剧</span>        item<span class="token punctuation">[</span><span class="token string">"image"</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="mainpic"]/a/img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取影片海报图片</span>        <span class="token keyword">yield</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>items.py文件:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define here the models for your scraped items</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># See documentation in:</span><span class="token comment" spellcheck="true"># https://docs.scrapy.org/en/latest/topics/items.html</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">doubanMovies</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    image <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">DoubanmoviesItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>    <span class="token comment" spellcheck="true"># name = scrapy.Field()</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pipelines.py文件：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define your item pipelines here</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span><span class="token comment" spellcheck="true"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span><span class="token comment" spellcheck="true"># useful for handling different item types with a single interface</span><span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>pipelines<span class="token punctuation">.</span>images <span class="token keyword">import</span> ImagesPipeline<span class="token keyword">from</span> scrapy <span class="token keyword">import</span> Request<span class="token keyword">class</span> <span class="token class-name">DoubanmoviesPipeline</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> item    <span class="token keyword">def</span> <span class="token function">get_media_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 循环每一张图片地址下载，若传过来的不是集合则无需循环直接yield</span>        <span class="token keyword">for</span> image_url <span class="token keyword">in</span> <span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">## meta里面的数据是从spider获取，然后通过meta传递给下面方法：file_path</span>            <span class="token comment" spellcheck="true"># yield Request(image_url, meta={'name': item['movieName']})</span>            <span class="token keyword">yield</span> Request<span class="token punctuation">(</span>image_url<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 重命名，若不重写这函数，图片名为哈希，就是一串乱七八糟的名字</span>    <span class="token keyword">def</span> <span class="token function">file_path</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token operator">=</span>None<span class="token punctuation">,</span> info<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        image_guid <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 提取url前面名称作为图片名。</span>        filename <span class="token operator">=</span> u<span class="token string">'{0}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>image_guid<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#保存图片</span>        <span class="token keyword">return</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>settings.py文件：</p><pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true">#关闭 robots 协议，否则很多页面都无法爬取</span>LOG_LEVEL <span class="token operator">=</span> <span class="token string">"WARNING"</span> <span class="token comment" spellcheck="true">#日志为警告以上才显示</span>USER_AGENT <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36'</span> <span class="token comment" spellcheck="true"># 模拟浏览器请求，改成自己网页最新的</span>FEED_EXPORT_FIELDS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Ranking"</span><span class="token punctuation">,</span><span class="token string">"movieName"</span><span class="token punctuation">,</span><span class="token string">"director"</span><span class="token punctuation">,</span><span class="token string">"rating"</span><span class="token punctuation">,</span><span class="token string">"imageURL"</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#使其输出的内容有顺序</span>DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment" spellcheck="true"># 设置爬取时间间隔，太快的爬取可能会被网页反爬虫机制检测到</span>RANDOMIZE_DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token boolean">True</span>COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment" spellcheck="true"># 使能cookie</span>ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'doubanMovies.pipelines.DoubanmoviesPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">}</span>IMAGES_STORE <span class="token operator">=</span> <span class="token string">'./imgs'</span> <span class="token comment" spellcheck="true">#保存目录</span>IMAGES_URLS_FIELD <span class="token operator">=</span> <span class="token string">"image"</span> <span class="token comment" spellcheck="true">#保存名为image的内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>终端执行以下命令开始运行程序：</p><pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl douban<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看imgs中的图片内容：</p><p>pipeline TODO:<a href="https://www.jianshu.com/p/1dddcbe8e312" rel="external nofollow noreferrer">https://www.jianshu.com/p/1dddcbe8e312</a></p><p>出现错误No module named ‘PIL’，可以通过以下方式安装相关依赖包</p><pre class="line-numbers language-python"><code class="language-python">pip install Pillow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-9-第二个Scrapy网络爬虫-校花爬爬爬"><a href="#5-9-第二个Scrapy网络爬虫-校花爬爬爬" class="headerlink" title="5.9 第二个Scrapy网络爬虫-校花爬爬爬"></a>5.9 第二个Scrapy网络爬虫-校花爬爬爬</h3><h4 id="5-9-1-爬取网页分析"><a href="#5-9-1-爬取网页分析" class="headerlink" title="5.9.1 爬取网页分析"></a>5.9.1 爬取网页分析</h4><p>网址：<a href="https://nice.ruyile.com/?f=3" rel="external nofollow noreferrer">https://nice.ruyile.com/?f=3</a></p><p>目标：获取网址中的校园美女的全部图片到本地，以便等寝室没人的时候偷偷欣赏</p><p>怎么获取到这些图片呢？通过源码分析如下：</p><p>F12打开网页源码可以发现，f=3是校园美女的分页，列出的校园美女元素在class=’m3_xhtp’的div标签下，每一个元素都是tp_list，里面存放了tp_a的图片链接和tp_mz的文字信息链接。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509103712005.png" alt="网页源码分析"></p><h4 id="5-9-2-校花美女实现"><a href="#5-9-2-校花美女实现" class="headerlink" title="5.9.2 校花美女实现"></a>5.9.2 校花美女实现</h4><p><strong>创建工程</strong></p><pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject girls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>创建爬虫程序</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> girlsscrapy genspider xh https://nice.ruyile.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>文件说明</strong></p><ul><li>scrapy.cfg  项目的配置信息，主要为Scrapy命令行工具提供一个基础的配置信息。（真正爬虫相关的配置信息在settings.py文件中）</li><li>items.py   设置数据存储模板，用于结构化数据，如：Django的Model</li><li>pipelines   数据处理行为，如：一般结构化的数据持久化</li><li>settings.py 配置文件，如：递归的层数、并发数，延迟下载等</li><li>spiders    爬虫目录，如：创建文件，编写爬虫规则</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509104816949.png" alt="工程目录结构"></p><p><strong>设置数据库存储模板</strong></p><p>Item.py文件</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">GirlsItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>    <span class="token comment" spellcheck="true"># name = scrapy.Field()</span>    addr <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>编写爬虫xh.py</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">import</span> os<span class="token keyword">from</span> girls<span class="token punctuation">.</span>items <span class="token keyword">import</span> GirlsItem<span class="token keyword">class</span> <span class="token class-name">XhSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'xh'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://nice.ruyile.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://nice.ruyile.com/?f=3&amp;p='</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">358</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        allPics <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tp_a"]/a'</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> pic <span class="token keyword">in</span> allPics<span class="token punctuation">:</span>            item <span class="token operator">=</span> GirlsItem<span class="token punctuation">(</span><span class="token punctuation">)</span>            name <span class="token operator">=</span> pic<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./img/@alt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            addr <span class="token operator">=</span> pic<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> name            item<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> addr            <span class="token comment" spellcheck="true"># 返回爬取到的数据</span>            <span class="token keyword">yield</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>设置配置文件setup.py</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 设置处理返回数据的类及执行优先级</span>ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token string">'girls.pipelines.GirlsPipeline'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 设置下载延迟，以防止被检测到爬虫行为</span>DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>编写数据库处理脚本pipeline.py</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter<span class="token keyword">import</span> requests<span class="token keyword">import</span> os<span class="token keyword">class</span> <span class="token class-name">GirlsPipeline</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'</span><span class="token punctuation">}</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>        file_name <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>r<span class="token string">'E:\imgs'</span><span class="token punctuation">,</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>            fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>        <span class="token keyword">return</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>执行爬虫</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> girlsscrapy crawl xh --nolog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>结果</strong></p><p>满屏的荷尔蒙，后宫三千佳丽般的赶脚😄</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509115359544.png" alt="满屏的荷尔蒙"></p><h3 id="5-10-第三个Scrapy网络爬虫-职业职场"><a href="#5-10-第三个Scrapy网络爬虫-职业职场" class="headerlink" title="5.10 第三个Scrapy网络爬虫-职业职场"></a>5.10 第三个Scrapy网络爬虫-职业职场</h3><p><a href="https://blog.csdn.net/diaolouan9546/article/details/101492132?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-2.vipsorttest&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-2.vipsorttest" rel="external nofollow noreferrer">https://blog.csdn.net/diaolouan9546/article/details/101492132?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.vipsorttest&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.vipsorttest</a></p><h4 id="5-10-1-爬取页面分析"><a href="#5-10-1-爬取页面分析" class="headerlink" title="5.10.1 爬取页面分析"></a>5.10.1 爬取页面分析</h4><p>网址：<a href="https://www.zhipin.com/" rel="external nofollow noreferrer">https://www.zhipin.com/</a></p><p>目标：根据查找的职业信息，找出符合条件的职位、公司、薪资、位置、经验、教育、工作内容需求、公司分类信息等；</p><p>怎么获取到这些内容呢？通过<strong>网址</strong>和<strong>网页源码</strong>分析如下：</p><p>网址<code>query=</code>表示<strong>查询内容</strong>，<code>page=</code>表示<strong>第几页</strong>，通过<code>网页源码</code>找到<strong>显示结果</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509170237939.png" alt="网页源码分析"></p><h4 id="5-10-2-直聘网爬取实现"><a href="#5-10-2-直聘网爬取实现" class="headerlink" title="5.10.2 直聘网爬取实现"></a>5.10.2 直聘网爬取实现</h4><p><strong>创建工程</strong></p><pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject boss<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>创建crawl爬虫程序</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> bossscrapy genspider boss_spider www.zhipin.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>设置数据库存储模板</strong></p><p>Item.py文件</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">BossItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    job_name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    money <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    tags <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    info_desc <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>编写爬虫</strong></p><p>boss_spider.py</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> boss<span class="token punctuation">.</span>items <span class="token keyword">import</span> BossItem<span class="token keyword">class</span> <span class="token class-name">BossSpiderSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'boss_spider'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'zhipin.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.zhipin.com/c101120100/?query=python&amp;page=1'</span><span class="token punctuation">]</span>    base_url <span class="token operator">=</span> <span class="token string">'https://www.zhipin.com'</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        job <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">"//div[@class='job-list']/ul/li"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> job<span class="token punctuation">:</span>            job_name <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//span[@class='job-name']/a/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>job_name<span class="token punctuation">)</span>            money <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//span[@class='red']/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>            name <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//h3[@class='name']/a/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>            tags <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//div[@class='tags']/span/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall <span class="token punctuation">(</span><span class="token punctuation">)</span>            tags <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join <span class="token punctuation">(</span>tags<span class="token punctuation">)</span>            info_desc <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//div[@class='info-desc']/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">yield</span> BossItem <span class="token punctuation">(</span>job_name<span class="token operator">=</span>job_name<span class="token punctuation">,</span> money<span class="token operator">=</span>money<span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">,</span> tags<span class="token operator">=</span>tags<span class="token punctuation">,</span> info_desc<span class="token operator">=</span>info_desc<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 获取下一页的地址</span>        page <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//div[@class='page']/a[last()]/@href"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        next_url <span class="token operator">=</span> self<span class="token punctuation">.</span>base_url <span class="token operator">+</span> page        <span class="token keyword">if</span> <span class="token operator">not</span> next_url<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"退出"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"下一页地址："</span><span class="token punctuation">,</span>next_url<span class="token punctuation">)</span>            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request <span class="token punctuation">(</span>next_url<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>设置middlewares.py</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> signals<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">import</span> time<span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> is_item<span class="token punctuation">,</span> ItemAdapter<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>http<span class="token punctuation">.</span>response<span class="token punctuation">.</span>html <span class="token keyword">import</span> HtmlResponse<span class="token keyword">class</span> <span class="token class-name">CookiesMiddlewares</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"init chrome boswer"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 我们等待5秒钟，让其加载</span>        source <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>page_source        <span class="token comment" spellcheck="true">#获取页面的源码</span>        response <span class="token operator">=</span> HtmlResponse<span class="token punctuation">(</span>url<span class="token operator">=</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>current_url<span class="token punctuation">,</span>body<span class="token operator">=</span>source<span class="token punctuation">,</span>request<span class="token operator">=</span>request<span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Response 对象用来描述一个HTTP响应</span>        <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>设置配置文件setup.py</strong></p><p>打开DOWNLOADER_MIDDLEWARES</p><pre class="line-numbers language-python"><code class="language-python">DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token string">'boss.middlewares.CookiesMiddlewares'</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>设置DEFAULT_REQUEST_HEADERS</p><pre class="line-numbers language-python"><code class="language-python">DEFAULT_REQUEST_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span><span class="token punctuation">,</span>  <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en'</span><span class="token punctuation">,</span>  <span class="token string">'USER_AGENT'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>关闭robot</p><pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>下载延迟设置</p><pre class="line-numbers language-python"><code class="language-python">DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>设置运行文件</strong></p><p>在工程目录下创建main.py</p><pre class="line-numbers language-bash"><code class="language-bash">from scrapy <span class="token function">import</span> cmdlinecmdline.execute<span class="token punctuation">(</span><span class="token string">'scrapy crawl boss_spider -o boss.csv'</span>.split<span class="token punctuation">(</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>结果</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210521174719493.png" alt="boss直聘爬虫结果"></p><h2 id="六、1天学会Scrapy分布式爬虫"><a href="#六、1天学会Scrapy分布式爬虫" class="headerlink" title="六、1天学会Scrapy分布式爬虫"></a>六、1天学会Scrapy分布式爬虫</h2><p>面章节，我们都是在一台机器上运行网络爬虫。单机由于受硬件和网络带宽的限制，如果爬取的数据量较大，就需要耗费很长时间。为了解决这个问题，我们可以在多台计算机上同时运行网络爬虫，以“人多力量大”的思想，共同完成一个大型爬取任务。</p><p>本章将学习爬虫的分布式部署及实现。主要内容包括：</p><p>\1. 分布式爬虫原理</p><p>介绍分布式爬虫的实现原理、分布式爬虫库Scrapy-Redis。建议学习时长为1.5学时。</p><p>\2. Scrapy分布式实现</p><p>在多台机器上部署分布式爬虫，实现分布式功能。建议学习时长3学时。</p><h3 id="6-1-分布式爬虫基本原理"><a href="#6-1-分布式爬虫基本原理" class="headerlink" title="6.1 分布式爬虫基本原理"></a>6.1 分布式爬虫基本原理</h3><p>分布式爬虫的思想是“人多力量大”，在网络中的多台计算机上同时运行爬虫程序，共同完成一个大型爬取任务。</p><p>Scrapy爬虫框架本身不支持分布式爬虫，要使其支持分布式爬虫，就需要对Scrapy框架做一些修改，先来看一下原始的Scrapy框架结构图：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329155948.jpg" alt="img"></p><p>该流程简单来说，就是：Spiders生成的请求经由Scheduler调度器发送给Downloader下载器，Downloader下载器从internet下载所需要的网络数据，返回response给Spiders，Spiders接着把数据放进item容器。</p><h3 id="6-2-Scrapy-Redis"><a href="#6-2-Scrapy-Redis" class="headerlink" title="6.2 Scrapy-Redis"></a>6.2 Scrapy-Redis</h3><p>如何实现分布式爬虫呢？这就要用到第三方库Scrapy-Redis了。它为Scrapy框架拓展了分布式爬取的功能，两者结合便是一个分布式Scrapy爬虫框架。</p><p>加上Scrapy-Redis之后的架构如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329160010.jpg" alt="Scrapy-Redis框架"> </p><p>如上图所示，scrapy-redis在scrapy的架构上增加了Redis。它利用Redis对请求(Requests)进行存储和调度(Schedule)，并对爬取产生的项目(Items)存储以供后续处理使用。Scrapy-Redis为多个爬虫分配爬取任务的方式是：让所有爬虫共享一个存在于Redis数据库中的请求队列（替代各爬虫独立的请求队列），每个爬虫从请求队列中获取请求，下载并解析页面后，将解析出的新请求再添加到请求队列中，因此每个爬虫既是下载任务的生产者有时消费者。</p><h3 id="6-3-分布式爬虫"><a href="#6-3-分布式爬虫" class="headerlink" title="6.3 分布式爬虫"></a>6.3 分布式爬虫</h3><p>为实现多个爬虫的任务分配，Scrapy-Redis重新实现了Scrapy中的以下组件：</p><p>Scheduler：Scrapy不支持多个Spider共享同一个队列（每个Spider各自独立），这就是Scrapy不支持分布式爬虫的原因之一，Scrapy-Redis的解决方法是把Scrapy的队列换成Redis数据库（即Redis队列）。将要爬取的Request存放在同一个Redis数据库中，多个Spider都读取同一个Reids数据库中的Request。</p><p>Duplication Filter：在Scrapy-Redis中去重是由Duplication Filter组件来实现的，它通过Redis的set不重复的特性，巧妙的实现了DuplicationFilter去重。Scrapy-Redis调度器从引擎接受Request，将Request存入Redis的set检查是否重复，并将不重复的Request写入Redis的Request队列。</p><p>当请求Request(Spider发出的）时，调度器从Redis的Request队列里根据优先级取出⼀个Request 返回给引擎，引擎将此Request发给Spider处理。</p><p>Item Pipeline：在分布式爬虫框架中，各个主机爬取到的数据最终要统一汇总到同一个地方，通常是某个数据库。Scrapy-Redis提供了一个Item Pipeline（RedisPipeline），用于将各个爬虫爬取到的数据存入同一个Redis数据库中。</p><p>Spider：Scrapy-Redis重写了Scrapy的类Spider，重写的RedisSpider继承了Spider和RedisMixin这两个类，RedisMixin是用来从redis读取url的类。</p><h3 id="6-4-分布式爬虫架构"><a href="#6-4-分布式爬虫架构" class="headerlink" title="6.4 分布式爬虫架构"></a>6.4 分布式爬虫架构</h3><p>搭建分布式爬虫，一般需要一台主机和N台从机。主机用于分配任务、去重；从机负责从主机获取任务，执行数据抓取、数据处理、数据存储。如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329160121.jpg" alt="分布式爬取框架"> </p><p>主要流程为：Slaver端从Master端获取任务（Request/url/ID），进行数据抓取，在抓取数据的同时也生成新任务，并将任务抛给Master。Master端只有一个Redis数据库，负责对Slaver提交的任务进行去重、加入待爬队列。</p><p>这种方式有其优缺点：</p><p>优点：scrapy-redis默认使用的就是这种策略，我们实现起来很简单，因为任务调度等工作scrapy-redis都已经帮我们做好了，我们只需要继承RedisSpider、指定redis_key就行了。</p><p>缺点：scrapy-redis调度的任务是Request对象，里面信息量比较大（不仅包含url，还有callback函数、headers等信息），导致的结果就是会降低爬虫速度、而且会占用Redis大量的存储空间。当然我们可以重写方法实现调度url。</p><h3 id="6-5-分布式爬虫环境搭建"><a href="#6-5-分布式爬虫环境搭建" class="headerlink" title="6.5 分布式爬虫环境搭建"></a>6.5 分布式爬虫环境搭建</h3><p>来看一下实现分布式爬虫需要的环境。</p><ol><li><p>安装Redis数据库。</p><p> Redis数据库是分布式爬虫必备的环境，需要在主机（Master）上安装好Redis数据库。关于Redis数据库的安装，可以参考第三章中“使用Redis持久化数据”一节，在此不再赘述。</p></li><li><p>配置Redis环境</p><p> Redis数据库默认只能本机访问，其他机器是无法访问的，因此需要设置一下Redis环境，使得从机（Slaver）也可以访问。</p><p> 在Redis目录下，找到并打开redis.windows-service.conf文件，做如下设置：</p></li></ol><p>（1） 将bind 127.0.0.1注释掉</p><p>（2） 将protected-mode由yes设置为no</p><ol start="3"><li><p>安装Redis数据库可视化工具：RedisDesktopManager。</p><p> RedisDesktopManager是一款Redis可视化工具，使用该工具可以简单快捷地查看Redis数据库中的额数据。也可以参考第三章中“使用Redis持久化数据”一节，不再赘述。</p></li><li><p>安装Scrapy-Redis库。</p><p> Scrapy-Redis库是分布式爬虫的核心库，它重写了Scrapy框架中的部分功能，使得Scrapy具有分布式爬虫的功能，安装Scrapy-Redis库非常简单，使用pip命令即可：<code>pip install scrapy-redis</code></p></li></ol><p>下面通过具体的视频详细了解一下环境搭建和环境配置的方法。</p><h3 id="6-6-案例"><a href="#6-6-案例" class="headerlink" title="6.6 案例"></a>6.6 案例</h3><p>对51Jobs的<a href="https://jobs.51job.com/all/p1%E7%BD%91%E9%A1%B5%E6%B6%89%E5%8F%8A%E7%9A%84%E5%B2%97%E4%BD%8D%E8%AF%A6%E6%83%85%E8%BF%9B%E8%A1%8C%E7%88%AC%E5%8F%96%E3%80%82" rel="external nofollow noreferrer">https://jobs.51job.com/all/p1网页涉及的岗位详情进行爬取。</a></p><h4 id="6-6-1-使用scrapy爬取"><a href="#6-6-1-使用scrapy爬取" class="headerlink" title="6.6.1 使用scrapy爬取"></a>6.6.1 使用scrapy爬取</h4><p><strong>创建项目</strong></p><pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject recruit<span class="token function">cd</span> recruitscrapy genspider job51 <span class="token string">'jobs.51job.com'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>修改爬取的数据items.py</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define here the models for your scraped items</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># See documentation in:</span><span class="token comment" spellcheck="true"># https://docs.scrapy.org/en/latest/topics/items.html</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">RecruitItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#职位名称</span>    title <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#公司名称</span>    company <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#公司的人数</span>    companyperson <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#公司类别</span>    companycategory <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#公司主要做什么的</span>    companydo <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#工作地点</span>    location <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#工作地址</span>    address <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#薪水</span>    salary <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#招聘人数</span>    person <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#发布时间</span>    data <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#学历要求</span>    request <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#工作经验</span>    experience <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>修改爬取文件Job51Spider.py</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> recruit<span class="token punctuation">.</span>items <span class="token keyword">import</span> RecruitItem<span class="token keyword">import</span> re<span class="token keyword">class</span> <span class="token class-name">Job51Spider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'job51'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'jobs.51job.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://jobs.51job.com/all/p1'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        url <span class="token operator">=</span> response<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>        city <span class="token operator">=</span> url<span class="token punctuation">[</span>len<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span>        page <span class="token operator">=</span> url<span class="token punctuation">[</span>len<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span>        new_page <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+'</span><span class="token punctuation">,</span>page<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        urls <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//div[@class="detlist gbox"]/div/p/span/a/@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_info<span class="token punctuation">)</span>        pages <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//div[@class="p_in"]/span[@class="td"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        pagenum <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+'</span><span class="token punctuation">,</span>pages<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> int<span class="token punctuation">(</span>new_page<span class="token punctuation">)</span> <span class="token operator">&lt;</span> int<span class="token punctuation">(</span>pagenum<span class="token punctuation">)</span><span class="token punctuation">:</span>            new_page <span class="token operator">=</span> int<span class="token punctuation">(</span>new_page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>            new_url <span class="token operator">=</span> <span class="token string">"https://jobs.51job.com/"</span> <span class="token operator">+</span> city <span class="token operator">+</span> <span class="token string">"/p"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>new_page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span>            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>new_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">parse_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># print(response.url)</span>        <span class="token keyword">pass</span>        item <span class="token operator">=</span> RecruitItem<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#职位名称</span>        item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="in"]/div/h1/@title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#公司名称</span>        item<span class="token punctuation">[</span><span class="token string">'company'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="in"]/div/p/a[@class="catn"]/@title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#获取公司信息</span>        company <span class="token operator">=</span> self<span class="token punctuation">.</span>getPerAndCatAndDo<span class="token punctuation">(</span>response<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#公司类别</span>        item<span class="token punctuation">[</span><span class="token string">'companycategory'</span><span class="token punctuation">]</span> <span class="token operator">=</span> company<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#公司的人数</span>        item<span class="token punctuation">[</span><span class="token string">'companyperson'</span><span class="token punctuation">]</span> <span class="token operator">=</span> company<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#公司主要做什么的</span>        item<span class="token punctuation">[</span><span class="token string">'companydo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> company<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#薪水</span>        salary<span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tHeader tHjob"]/div/div/strong/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> salary <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            item<span class="token punctuation">[</span><span class="token string">'salary'</span><span class="token punctuation">]</span> <span class="token operator">=</span> salary        <span class="token keyword">else</span><span class="token punctuation">:</span>            item<span class="token punctuation">[</span><span class="token string">'salary'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span>        <span class="token comment" spellcheck="true">#工作地址</span>        address <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tBorderTop_box"]/div[@class="bmsg inbox"]/p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> address <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            item<span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span> <span class="token operator">=</span> address        <span class="token keyword">else</span><span class="token punctuation">:</span>            item<span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span>        <span class="token comment" spellcheck="true">#获取招聘信息</span>        recruit <span class="token operator">=</span> self<span class="token punctuation">.</span>getRequestInfo<span class="token punctuation">(</span>response<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#工作地点</span>        item<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#工作经验</span>        item<span class="token punctuation">[</span><span class="token string">'experience'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#学历要求</span>        item<span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#招聘人数</span>        item<span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#发布时间</span>        item<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>        <span class="token keyword">yield</span> item    <span class="token keyword">def</span> <span class="token function">getPerAndCatAndDo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>        result <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tBorderTop_box"]/div[@class="com_tag"]/p/@title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">:</span>            companycategory <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            companydo <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">elif</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>            companycategory <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            companyperson <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+'</span><span class="token punctuation">,</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            companydo <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            companycategory <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            companyperson <span class="token operator">=</span> <span class="token string">''</span>            companydo <span class="token operator">=</span> <span class="token string">''</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>companycategory<span class="token punctuation">,</span>companyperson<span class="token punctuation">,</span>companydo<span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">getRequestInfo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>        result <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="in"]/div/p[@class="msg ltype"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># result = result.replace(r'\xa0',"")</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>            location <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            experience <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            request <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            person <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>            location <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            experience <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            request <span class="token operator">=</span> <span class="token string">''</span>            person <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>            data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>location<span class="token punctuation">,</span>experience<span class="token punctuation">,</span>request<span class="token punctuation">,</span>person<span class="token punctuation">,</span>data<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>修改pipelines.py文件</strong></p><p>把数据保存到mongodb数据库中</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define your item pipelines here</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span><span class="token comment" spellcheck="true"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span><span class="token comment" spellcheck="true"># useful for handling different item types with a single interface</span><span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter<span class="token keyword">import</span> pymongo<span class="token keyword">class</span> <span class="token class-name">RecruitPipeline</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 获取连接</span>        client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.56.128'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 设置数据库</span>        db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'recruit'</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#设置集合(表)</span>        self<span class="token punctuation">.</span>col <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'job51'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#写入集合(表)</span>        self<span class="token punctuation">.</span>col<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'插入成功'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>设置配置文件settings.py</strong></p><pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span>DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span>ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token string">'recruit.pipelines.RecruitPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>启动爬虫</strong></p><pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl job51<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>观察mongodb数据结果</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210524151808368.png" alt="爬取最终结果"></p><h4 id="6-6-2-改用scrapy-redis爬取"><a href="#6-6-2-改用scrapy-redis爬取" class="headerlink" title="6.6.2 改用scrapy-redis爬取"></a>6.6.2 改用scrapy-redis爬取</h4><ul><li><p>将爬虫的类 scrapy.Spider 换成 scrapy_redis.spiders.RedisSpider</p></li><li><p>将 start_urls = [‘<a href="https://jobs.51job.com/zhongshan/p1/%E2%80%99]" rel="external nofollow noreferrer">https://jobs.51job.com/zhongshan/p1/’]</a> 删掉添加一个 redis_key</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> scrapy_redis<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> RedisCrawlSpider<span class="token keyword">class</span> <span class="token class-name">Job51Spider</span><span class="token punctuation">(</span>RedisCrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'job51'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'jobs.51job.com'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># start_urls = ['https://jobs.51job.com/all/p1']</span>    <span class="token comment" spellcheck="true"># 将start_url插入redis,键为fang_url(lpush job51:start_urls https://jobs.51job.com/all/p1/)</span>    redis_key <span class="token operator">=</span> <span class="token string">"job51:start_urls"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ul><li><p>在配置文件中添加配置</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用scrapy-redis里的去重组件，不使用scrapy的默认去重，用来将url去重</span>DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">"scrapy_redis.dupefilter.RFPDupeFilter"</span><span class="token comment" spellcheck="true"># 使用scrapy-redis里的调度器组件，不使用scrapy的默认的调度器</span>SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span><span class="token comment" spellcheck="true"># 允许暂停，Redis请求记录不丢失</span>SCHEDULER_PERSIST <span class="token operator">=</span> <span class="token boolean">True</span><span class="token comment" spellcheck="true"># 指定要存储的redis数据库的主机IP</span>REDIS_HOST <span class="token operator">=</span> <span class="token string">'192.168.56.128'</span>  <span class="token comment" spellcheck="true"># 远端的ip地址</span><span class="token comment" spellcheck="true"># 指定redis数据库主机的端口</span>REDIS_PORT <span class="token operator">=</span> <span class="token number">6379</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ul><li><p>在redis中添加url数据</p><pre class="line-numbers language-bash"><code class="language-bash">lpush job51:start_urls https://jobs.51job.com/all/p1/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>  <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210524154126977.png" alt="redis start_urls"></p></li><li><p>启动爬虫，就可以在redis中看到爬取的数据了</p><pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl job51<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><ol><li><a href="https://docs.python.org/zh-cn/3/" rel="external nofollow noreferrer">https://docs.python.org/zh-cn/3/</a> python官方文档</li><li><a href="https://www.runoob.com/python3/" rel="external nofollow noreferrer">https://www.runoob.com/python3/</a> python入门菜鸟教程</li><li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400" rel="external nofollow noreferrer">https://www.liaoxuefeng.com/wiki/1016959663602400</a> 廖雪峰的python教程</li><li><a href="https://docs.scrapy.org/en/latest/" rel="external nofollow noreferrer">https://docs.scrapy.org/en/latest/</a> Scrapy官方文档</li><li><a href="https://www.runoob.com/w3cnote/scrapy-detail.html" rel="external nofollow noreferrer">https://www.runoob.com/w3cnote/scrapy-detail.html</a> Scrapy入门教程</li><li><a href="http://www.scrapyd.cn/doc/137.html" rel="external nofollow noreferrer">http://www.scrapyd.cn/doc/137.html</a> Scrapy中文学习</li><li>另外参考了github上的众多开源项目，由于参考比较多，不一一列举，如有侵权请告知</li></ol>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> scrapy </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WALLE</title>
      <link href="2021/02/walle/"/>
      <url>2021/02/walle/</url>
      
        <content type="html"><![CDATA[<h2 id="瓦力机器人全栈计划执行中…"><a href="#瓦力机器人全栈计划执行中…" class="headerlink" title="瓦力机器人全栈计划执行中…"></a>瓦力机器人全栈计划执行中…</h2><h3 id="WALLE瓦力机器人演示"><a href="#WALLE瓦力机器人演示" class="headerlink" title="WALLE瓦力机器人演示"></a>WALLE瓦力机器人演示</h3><h3 id="WALLE瓦力机器人结构"><a href="#WALLE瓦力机器人结构" class="headerlink" title="WALLE瓦力机器人结构"></a>WALLE瓦力机器人结构</h3><h3 id="WALLE瓦力机器人硬件"><a href="#WALLE瓦力机器人硬件" class="headerlink" title="WALLE瓦力机器人硬件"></a>WALLE瓦力机器人硬件</h3><h3 id="WALLE瓦力机器人软件"><a href="#WALLE瓦力机器人软件" class="headerlink" title="WALLE瓦力机器人软件"></a>WALLE瓦力机器人软件</h3>]]></content>
      
      
      <categories>
          
          <category> MarsPlan </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WALLE </tag>
            
            <tag> WALL-E </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何白嫖属于自己的免费网站</title>
      <link href="2021/02/ru-he-bai-piao-shu-yu-zi-ji-de-mian-fei-wang-zhan/"/>
      <url>2021/02/ru-he-bai-piao-shu-yu-zi-ji-de-mian-fei-wang-zhan/</url>
      
        <content type="html"><![CDATA[<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p><strong>如何做到白嫖免费搭建呢？</strong>服务器使用别人的就可以啦，比如<a href="https://pages.github.com/" rel="external nofollow noreferrer"><strong>GitHub Pages</strong></a>~</p><p><strong>网站增加文章的话还得懂网页开发？</strong>当然不需要啦，使用<a href="https://hexo.io/" rel="external nofollow noreferrer"><strong>Hexo</strong></a>帮你搭建一套个人网站就可以啦~</p><p><strong>增加网站内容会不会比较麻烦？</strong>这都啥时代啦，使用Markdown工具<a href="https://typora.io/" rel="external nofollow noreferrer"><strong>Typora</strong></a>发布内容非常方便哦~</p><p>刚才提到了三个关键词，解释如下：</p><table><thead><tr><th>名词</th><th align="left">解释</th></tr></thead><tbody><tr><td>GitHub Pages</td><td align="left">我们访问的任意网站都是放在服务器上的，通过域名或者说网址为我们提供服务，GitHub Pages就是为我们提供域名和服务器的，域名为GitHub.io的子域名</td></tr><tr><td>Hexo</td><td align="left">有了服务器还需要有一套网页的模板，还需要开发网页？Hexo提供了丰富的网页模板和插件，帮助我们更好的个性化和维护自己的网站</td></tr><tr><td>Typora</td><td align="left">增加网页的特点离不开文章内容的编写，文字、图片、视频、音乐等等，一个高效的编写工具尤为重要，Typora是一个文档编辑软件，基于Markdown语法开发保证了编写的效率，另外支持实时渲染，所见即所得，从而脱颖而出，成为目前最亮眼的Markdown文档编辑工具</td></tr></tbody></table><p>使用GitHub+Hexo+Typora搭建的免费网站，演示如下：</p><p>==为了方便理解，这里以后会放一个演示视频，先放这里占个位置，后期补上来(●ˇ∀ˇ●)==</p><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>GitHub提供了<strong>pages</strong>服务，即静态网页访问服务。因此咱们只需要按照GitHub的要求，创建一个GitHub pages仓库，就相当于拥有一个搭建网站的服务器啦。</p><p>而有了服务器咱们还需要些代码来完成网页的开发，小白表示太不友好了/(ㄒoㄒ)/~~。幸好有大神帮我们开发好了一套友好的框架叫<strong>Hexo</strong>，咱们主要学会安装部署，再学会Markdown文章高效编写就可以啦。</p><p>当然使用Gitee或者Coding也支持pages服务，如果觉得GitHub慢的小伙伴也可以用这两个哦，只是个人习惯了GitHub，也是全世界代码分享的平台（男性交友平台），不想放弃啊🤭。</p><p>另外Hexo也有替代产品，如果不喜欢折腾，想快速搭建的也可以使用<a href="https://gridea.dev/" rel="external nofollow noreferrer">gridea</a>来快速搭建博客，适合非开发人员或爱好者，使用gridea可以参考<a href="https://yharea.com/433/" rel="external nofollow noreferrer">这篇文章</a>。</p><p>下面咱们回归正题，使用GitHub Pages+Hexo开始搭建（折腾）吧，说不定等gridea各方面都完备了，就转过去了🤭。</p><h3 id="免费的服务器-GitHub"><a href="#免费的服务器-GitHub" class="headerlink" title="免费的服务器-GitHub"></a>免费的服务器-GitHub</h3><ol><li><p>创建GitHub账号，<a href="https://github.com/" rel="external nofollow noreferrer">注册地址</a></p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223145014702.png" alt="注册页面"></p><p> 填好自己得个人信息，注意Username使用英文；</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/v2-7872012db459db8c8bab2793f7f79101_1440w.jpg" alt="信息填写"></p><p> 选择免费的版本，并且点击继续，填写个人的一些信息后，点击Submit完成注册。</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223144550429.png" alt="注册成功后的界面"></p><p> 注册成功后，看到以上的界面信息就表示注册成功了。</p></li><li><p>创建GitHub Page仓库</p><p> 点击右上角的加号选择New repository来创建一个GitHub Pages</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223144754011.png" alt="创建仓库"></p><p> 创建仓库的名称（也作为将来的域名），注意图中的要求，仓库名称必须是<strong>用户名.github.io</strong>，其中用户名是注册时填写的Username字段。</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223150133862.png" alt="填写仓库名称"></p><p> 然后点击最下面的Create repository创建仓库就可以了。</p></li><li><p>安装Git工具</p><p> Git是一个版本管理工具，可以方便的使用Git命令管理你的仓库。</p><p> <a href="https://git-scm.com/download/win" rel="external nofollow noreferrer">下载Git命令</a></p><p> 如果是64位的windows可以选择图中相关的安装文件，下载后安装即可</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223151401927.png" alt="Git工具下载"></p></li></ol><p>下载并安装完成后，打开Git Bash应用</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223151528087.png" alt="Git Bash应用"></p><p>打开后，如图所示</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223151623811.png" alt="Git Bash命令行"></p><p>在命令行中输入全局配置，user.name和user.email配置信息</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">git</span> config --global user.name <span class="token string">"你的GitHub用户名"</span><span class="token function">git</span> config --global user.email <span class="token string">"你的GitHub注册邮箱"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>生成ssh密钥文件，提示内容时直接回车即可：</p><pre class="line-numbers language-shell"><code class="language-shell">ssh-keygen -t rsa -C "你的GitHub注册邮箱"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建成功后，大概是这个样子，注意红色框框的文件，需要打开，把内容拷贝到GitHub上去。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223152128655.png" alt="image-20210223152128655"></p><p>打开<a href="https://link.zhihu.com/?target=https://github.com/settings/keys" rel="external nofollow noreferrer">GitHub_Settings_keys</a> 页面，新建new SSH Key</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223152525778.png" alt="新增SSH Key"></p><p>标题Title可以随便写，增加成功后在Git Bash命令行中，输入</p><pre class="line-numbers language-shell"><code class="language-shell">ssh git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输入后，得到红框中的内容说明SSH Key设置成功</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223152757219.png" alt="SSH Key设置成功信息"></p><p>设置SSH Key的原因是，当我们编写好文章后，需要通过Git命令把内容推送给GitHub服务器上，这就需要账号密码验证，我们刚上传了id_rsa.pub的内容是公钥，私钥在咱们电脑上，这样在提交时就可以通过非对称加密的公钥与私钥来完成账号的验证了，就能检测提交代码者的身份是合法的了。</p><h3 id="搭建Hexo静态网站"><a href="#搭建Hexo静态网站" class="headerlink" title="搭建Hexo静态网站"></a>搭建Hexo静态网站</h3><ol><li><p>nodejs安装</p><p> Hexo基于nodejs的，下载nodejs：<a href="https://nodejs.org/en/download/%EF%BC%8C%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F" rel="external nofollow noreferrer">https://nodejs.org/en/download/，安装成功输入命令查看是否安装成功</a></p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223153525207.png" alt="查看node安装是否成功"></p></li><li><p>Hexo安装</p><p> hexo-cli安装</p><pre class="line-numbers language-shell"><code class="language-shell">npm install -g hexo-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 创建blog</p><pre class="line-numbers language-shell"><code class="language-shell">hexo init blog<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 以上的命令在当前目录下创建了一个blog目录，其中包含了Hexo的相关信息</p></li><li><p>hexo测试</p><p> hexo的基本命令如下：</p><p> 通过hexo new “test”来创建一篇新的名字叫test的文章</p><p> 通过hexo g命令generate进行构建，生成静态网页</p><p> 通过hexo s命令在本地创建一个server服务，默认是localhost:4000</p><p> 通过hexo d命令deploy部署静态网页到GitHub或其他你想发布的地方</p><p> 可以通过hexo g和hexo s，然后在浏览器中输入local host:4000检查是否已经可以看到你的网页了</p><pre><code>hexo ghexo s</code></pre><p> 构建时候，如果出现LF will be replaced的警告，可以通过以下的命令解决：</p><pre class="line-numbers language-shell"><code class="language-shell">git config --global core.autocrlf false<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> 这条命令是禁用自动转换，这个不设置后面上传时会出现警告</p></li><li><p>测试发布</p><p> 打开创建blog根目录下的_config.yml配置文件，修改deploy字段</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> git  <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/aibittek/aibittek.github.io.git  <span class="token key atrule">branch</span><span class="token punctuation">:</span> master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p> 注意repo填写的是仓库地址，可以进入仓库进行复制粘贴过来，防止写错了部署不成功，branch是版本分支的意思，按照下图中左侧可以查看分支名称，有可能新版本分支是main哦，小心一点</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223154908917.png" alt="复制仓库地址"></p></li></ol><p>安装提交git部署的插件</p><pre class="line-numbers language-shell"><code class="language-shell">npm install hexo-deployer-git --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输入命令进行部署</p><pre class="line-numbers language-shell"><code class="language-shell">hexo cleanhexo ghexo d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中clean是清除之前构建的内容，也可以通过一条命令完成以上的步骤</p><pre class="line-numbers language-shell"><code class="language-shell">hexo clean && hexo g -d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>部署成功后，会把hexo g构建的静态网页部署到_config.yml，deploy填写的repo仓库中，现在通过网页浏览你的网站吧，通过<strong>用户名.github.io</strong>来访问哦。</p><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><h3 id="绑定个性域名"><a href="#绑定个性域名" class="headerlink" title="绑定个性域名"></a>绑定个性域名</h3><p>你一定觉得使用github.io域名不够酷，想要一个自己的域名吧🤭</p><p>可以通过申请一个域名，把原本访问<strong>用户名.github.io</strong>改为访问你自己的域名即可，需要<strong>域名申请和域名绑定</strong>。</p><h4 id="域名申请"><a href="#域名申请" class="headerlink" title="域名申请"></a>域名申请</h4><p>可以到<a href="https://www.dnspod.cn/" rel="external nofollow noreferrer">DNSPod</a>申请一个喜欢的域名，或者任何其他你想要购买域名的地方。</p><p>选择DNSPod的原因是之前一直在用DNSPod的DDNS服务，花生咳这个服务用的我已经一口老血都咳出来了。DNSPod目前也是被腾讯收购了，当然阿里云之类的也可以，也是支持DDNS服务的，并提供API接口。点击上面的DNSPod链接，切换到域名一栏点击购买即可。</p><h4 id="域名绑定"><a href="#域名绑定" class="headerlink" title="域名绑定"></a>域名绑定</h4><p>有两处需要设置，假设上一节你已经选择好了域名，域名叫kui.ge，那么先到你的GitHub上，进入用户名.github.io这个仓库，点击右侧的settings</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223160605182.png" alt="设置域名绑定"></p><p>然后往下拉，找到GitHub Pages设置一栏，按照如下的方式填写即可</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223160749616.png" alt="个性化网页设置"></p><p>设置成功后，就使用你的新域名进行访问静态网页了。</p><p>但是如果我们直接在浏览器输入kui.ge的话，其实也是想访问<strong>你的用户名.github.io</strong>的，怎么办呢？在域名注册商处DNS解析的地方使用CNAME填写以下内容即可：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223161233437.png" alt="CNAME域名绑定"></p><p>CNAME后面填写的是你的GitHub的用户名.github.io.，注意后面还有个点，@记录后面填写的IP地址，这个地址可以通过<code>ping 你的用户名.github.io</code>来获得。</p><p>最后还要在你的博客目录下，增加一个CNAME文件，内容就写你的域名即可</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223161658525.png" alt="CNAME域名文件"></p><p>完成以上的步骤后，在blog目录下，执行以下命令，对新修改的内容进行部署发布</p><pre class="line-numbers language-shell"><code class="language-shell">hexo clean && hexo g -d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发布成功后，使用你自己的域名来访问就可以访问到GitHub Pages里面的静态网页啦，演示如下</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223161857758.png" alt="个性化域名访问GitHub Pages演示"></p><h3 id="高效发布文章"><a href="#高效发布文章" class="headerlink" title="高效发布文章"></a>高效发布文章</h3><h4 id="Typora图床编辑"><a href="#Typora图床编辑" class="headerlink" title="Typora图床编辑"></a>Typora图床编辑</h4><p>网站搭建好之后，是不是就想着发布分享自己的文章内容了呢，那么就要选择一款高效的工具，这里推荐的是Typora Markdown工具，不好意思不是推荐，我想强制你用这个😄。因为实在是太好用了，可以在写的同时渲染出结果，所见即所得，还有很多的优点，这里就不一一介绍啦。</p><p>下载地址：<a href="https://typora.io/" rel="external nofollow noreferrer">https://typora.io/</a></p><p>例子：使用hexo new “name”可以在source/_ports目录下创建出来name.md的Markdown文件，然后双击通过Typora打开进行创作就可以啦。</p><h4 id="图床PicGo"><a href="#图床PicGo" class="headerlink" title="图床PicGo"></a>图床PicGo</h4><p>咱们在写文章的时候，会用到图片，音乐和视频，你应该不希望这些数据都保存到你的GitHub中吧，否则随着文章的增多内容会增大很多，数据同步的话也变得困难。</p><p>一般的像网易云音乐，B站视频等都提供了外部链接，咱们可以把这些媒体资源信息放到对应的音乐视频网站上，减小自己网站的大小，然后通过提供的外部链接放到自己的文章里来就可以了。</p><p><strong>图片也一样，可以使用专门提供图片存储地址的服务，这个服务被翻译成图床，英文叫Image Host</strong></p><p>有很多软件提供了图床的功能，而PicGo则是提供聚合的图床的工具，我们可以看到支持了很多图床工具的设置</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223163843008.png" alt="PicGo图床支持"></p><p>接下来需要做这几步骤：</p><ol><li><p> Github创建一个新的仓库用来存放图片</p></li><li><p> Typora中设置PicGo应用，设置成功后，粘贴图片时会调用PicGo进行自动上传；</p></li><li><p> 下载安装PicGo，推荐使用app带界面的更加直观，配置PicGo在接收到数据后上传到哪里，这里我们要设置上传到咱们在GitHub上创建出来的专门放图片的仓库里</p></li><li><p> 由于PicGo把图片自动上传到GitHub上需要权限，因此在PicGo中填写GitHub中的token来授权</p></li></ol><p>Github创建仓库就不用说了，Typora中下载PicGo app，然后把下载的应用路径填写进去，再把上面的几个勾勾打上即可，Typora就能在插入图片时自动把图片交给PicGo上传啦。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223164847344.png" alt="Typora的偏好设置"></p><p>打开PicGo设置上传到的地址：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223165040077.png" alt="PicGo上传设置"></p><p>其中repo是你建立的仓库名称，branch是图片上传到哪个分支，token待会从GitHub获取，path是保存到这个分支的哪个目录下，customUrl使用了CDN加速，你自己的可以这么写<a href="https://cdn.jsdelivr.net/gh/aibittek/ImageHost%EF%BC%8C%E5%85%B6%E4%B8%ADaibittek/ImageHost%E6%94%B9%E6%88%90%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84repo%E5%8D%B3%E5%8F%AF%E3%80%82" rel="external nofollow noreferrer">https://cdn.jsdelivr.net/gh/aibittek/ImageHost，其中aibittek/ImageHost改成你自己的repo即可。</a></p><p>我使用的是githubPlus，上面其实有一个GitHub图床了，单有时候会上传失败，选择githubPlus插件，上传图片错误的概率会小一点，可以在插件设置里搜索githubPlus，然后下载就可以了，然后把以上的这些内容填写到githubPlus这些框框中，最后不要忘记设为默认图床哦。</p><p>还差最后一步token获取，登录GitHub-&gt;Settings-&gt;Developer Settings-&gt;Personal access tokens-&gt;Generate new token，在Note中取一个名字，然后repo勾上，最后会生成一个token，这个token令牌要注意保存下，只显示一次，并把token存放到PicGo的githubPlus的token一栏点击确定就可以啦。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223165904550.png" alt="token获取步骤"></p><p>设置好之后，在Typora里随便粘贴一张图片会发现正在上传，然后点击GitHub上的图床仓库，看图片是不是已经上传成功了呢。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223170113124.png" alt="上传成功验证"></p><p>这个是上面这张图粘贴到Typora中的时候的自动上传效果</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223170213582.png" alt="上传过程"></p><h3 id="美化网站内容"><a href="#美化网站内容" class="headerlink" title="美化网站内容"></a>美化网站内容</h3><h4 id="主题选择"><a href="#主题选择" class="headerlink" title="主题选择"></a>主题选择</h4><p>可以通过 <a href="https://hexo.io/themes" rel="external nofollow noreferrer">https://hexo.io/themes</a> 在搜索框中选择自己喜欢的主题，我选择的是这个主题Matery</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223171205653.png" alt="Matery主题"></p><p>主题下载地址：<a href="https://github.com/blinkfox/hexo-theme-matery" rel="external nofollow noreferrer">https://github.com/blinkfox/hexo-theme-matery</a></p><p>下载之后解压，把hexo-theme-matery目录放到博客的themes目录下即可</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223171352328.png" alt="matery主题"></p><p>修改根目录下的_config.yaml配置文件，使得新增加的主题生效</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># Extensions</span><span class="token comment" spellcheck="true">## Plugins: https://hexo.io/plugins/</span><span class="token comment" spellcheck="true">## Themes: https://hexo.io/themes/</span><span class="token key atrule">theme</span><span class="token punctuation">:</span> hexo<span class="token punctuation">-</span>theme<span class="token punctuation">-</span>matery<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>通过以下命令构建部署之后，访问网页查看结果是不是已经焕然一新了呢😄</p><pre class="line-numbers language-shell"><code class="language-shell">hexo clean && hexo g -d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h4><p>当然主题还有很多优化设置，比如主页怎么显示，动画怎么展示等等，这些matery已经都提供了修改方法，在源码的Readme文件中的配置一栏，这里就不详述了，可根据自己的需求在文档的配置章节，根据自己的喜好进行自定义修改，传送门：<a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md" rel="external nofollow noreferrer">https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md</a></p><h4 id="评论系统"><a href="#评论系统" class="headerlink" title="评论系统"></a>评论系统</h4><p>以上文档中提到了支持的评论系统，但是没有具体说明如何支持，这里咱们介绍下。</p><p>目前不需要服务端的评论系统有两个用的比较多的，一个是valine，一个是Gitalk。</p><p>valine使用了LeanCloud访问速度快，无需搭建服务端，也不需要用户登录，就可以随意评论，但是担心不能长久使用，所以我使用了Gitalk，也是基于GitHub的，本质上借助了issue的功能。</p><p>既然选择了Gitalk，就开始搭建评论系统的环境吧，需要以下几步：</p><ol><li> GitHub开启授权</li><li> Gitalk网页配置</li><li> GitalkBUG修复</li></ol><h4 id="GitHub开启授权"><a href="#GitHub开启授权" class="headerlink" title="GitHub开启授权"></a>GitHub开启授权</h4><p>通过Settings-&gt;Developer settings-&gt;OAuth Apps-&gt;New OAuth App创建一个授权，我这里已经创建好了一个叫kui.ge的授权</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223173530412.png" alt="开启授权操作路径"></p><p>看下我的授权是怎么写的</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223173639200.png" alt="授权内容填写"></p><p>注意，如果你的域名已经转到了自定义域名，这里填写的是你的新域名，如果没有，填写的callback URL应该是你的<strong>用户名.github.io</strong></p><p>填写好之后，点击确认，会得到Client ID和Client secrets，注意保存Client secrets，只显示一次：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223173822448.png" alt="获取Client ID和Client secrets"></p><h4 id="Gitalk网页配置"><a href="#Gitalk网页配置" class="headerlink" title="Gitalk网页配置"></a>Gitalk网页配置</h4><p>打开网站源码的themes/_config.yml配置文件，找到gitalk配置如下：</p><blockquote><p>  注意如果不是这个主题，可能没有集成Gitalk，需要按照Gitalk的要求进行配置，<a href="https://github.com/gitalk/gitalk" rel="external nofollow noreferrer">源码及文档地址</a></p></blockquote><pre class="line-numbers language-shell"><code class="language-shell"># the Gitalk config，default disabled# Gitalk 评论模块的配置，默认为不激活gitalk:  enable: true  owner: aibittek #填写你OAuth App的用户名  repo: aibittek.github.io #填写你自己的  oauth:    clientId: #填写上面获取到的    clientSecret: #填写上面获取到的  admin: aibittek #填写你自己的，github用户名  proxy: https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按照以上填写就可以了，多了一个proxy，是为了解决近期的一个BUG的，参考下一章节。</p><h4 id="Gitalk-BUG修复"><a href="#Gitalk-BUG修复" class="headerlink" title="Gitalk BUG修复"></a>Gitalk BUG修复</h4><p>最近使用Gitalk的都出现了不能评论的问题，具体原因可参考<a href="https://github.com/gitalk/gitalk/issues/429" rel="external nofollow noreferrer">issue</a></p><p>错误提示：<strong>Error: Request failed with status code 403</strong></p><p>错误原因：<a href="https://mp.weixin.qq.com/s/Lwl9rf95EqlTYLfconjflQ" rel="external nofollow noreferrer">https://mp.weixin.qq.com/s/Lwl9rf95EqlTYLfconjflQ</a></p><p>解决办法：在Gitalk构造时增加CORS proxy，然后在配置中增加这个代理。</p><p>刚才在配置中已经增加了proxy的字段了，后面的网址就是CORS proxy，也可以通过cloudflare自己创建一个worker，通过Gitalk提供的请求要求搭建一个，也可以像我一样白嫖人家的😄</p><blockquote><p>  注意：Gitalk有安全漏洞，从而导致GitHub获取到全局的读写权限，最差的可能是你的GitHub全站可能会被人删除跑路/(ㄒoㄒ)/~~，具体说明如下：<a href="https://www.v2ex.com/t/535608" rel="external nofollow noreferrer">https://www.v2ex.com/t/535608</a></p></blockquote><p>打开gitalk.ejs代码，增加以下一行即可，完结撒花解决这个BUG了</p><pre class="line-numbers language-js"><code class="language-js">proxy<span class="token punctuation">:</span> <span class="token string">'&lt;%- theme.gitalk.proxy %>'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223175045009.png" alt="构造增加proxy字段"></p><p>重新构建部署后，打开网站看看是不是可以评论啦</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223175227501.png" alt="评论界面"></p><p>如果不能够登录，需要登录授权后才能登录哦。</p><p>另外还可能出现一些其他奇怪的问题，大多的可能性和GitHub开启授权的时候填写的内容错误有关，需要注意callback URL的填写不是仓库的地址，而是github.io的静态网页访问的地址，但是如果你做了自定义域名，就要填写自定义域名的地址了，比如说我的就改成了<a href="https://kui.ge/">https://kui.ge</a></p><h2 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h2><h3 id="优化访问速度"><a href="#优化访问速度" class="headerlink" title="优化访问速度"></a>优化访问速度</h3><p>GitHub国内的访问速度比较慢，另外GitHub也禁止了百度爬虫，导致百度不能收录GitHub内容，这些问题通过这一章节都可以得到解决。</p><ul><li>  1、申请<a href="https://www.cloudflare.com/" rel="external nofollow noreferrer">Cloudflare账号</a>，点击右上角的<strong>添加站点</strong>按钮，输入自己的域名，如下：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222140210567.png" alt="Cloudflare添加站点"></p><ul><li>  2、到自己的域名服务器上修改DNS为Cloudflare的DNS</li></ul><p>不同的域名注册商略有不同，参考如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222140044197.png" alt="修改域名DNS服务商到cloudflare"></p><ul><li>  3、把自己的域名DNS解析转到Cloudflare</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222135814969.png" alt="域名DNS转到Cloudflare"></p><ul><li><p>4、确认激活状态</p><p>  进入注册Cloudflare的邮箱，查看激活状态。成功激活Cloudflare的邮箱参考如下：</p><p>  <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222140648526.png" alt="Cloudflare激活提示邮件"></p></li><li><p>5、确定状态激活成功</p><p>  如下所示，进入<a href="https://dash.cloudflare.com/" rel="external nofollow noreferrer">看板</a>查看概述，已经激活了。</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222140754636.png" alt="image-20210222140754636"></p><ul><li><p>6、访问自己的网站，访问速度明显加快</p><p>  以下是参考，打开浏览器的F12调试窗口，设置Disable cache，查看Finish大概3秒钟基本数据加载完毕，之前需要7-8秒钟的时间</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222142007780.png" alt="网页在不开缓存的情况下加载显示速度"></p><ul><li>  7、使用工具查看最终的访问路由是否正确指向了Cloudflare</li></ul><p>通过<a href="https://tools.ipip.net/traceroute.php" rel="external nofollow noreferrer">在线路由查询网址</a>，输入自己想查询的域名，看看经过的路由是不是最终到达了Cloudflare。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222144656971.png" alt="Cloudflare访问路由验证"></p><p><strong>其他的一些设置</strong></p><p>DNSSEC设置，点击启用后，在域名服务商处填写DS记录，大概10多分钟到1个小时后启动成功。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222155007186.png" alt="DNSSEC设置"></p><p>SSL/TLS的端到端加密</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222155107313.png" alt="设置端到端的加密访问策略"></p><h3 id="搜索引擎收录"><a href="#搜索引擎收录" class="headerlink" title="搜索引擎收录"></a>搜索引擎收录</h3><h4 id="Google-Analytics统计功能"><a href="#Google-Analytics统计功能" class="headerlink" title="Google Analytics统计功能"></a>Google Analytics统计功能</h4><p>打开<a href="https://analytics.google.com/" rel="external nofollow noreferrer">Google Analytics</a>链接，登录自己的谷歌账号，按提示添加服务，重要的地方如下，打开高级选项，选择创建Universal Analytics媒体资源，把要统计分析的网址填写上去。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222165210139.png" alt="设置媒体资源"></p><p>得到跟踪ID</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222165652588.png" alt="获取跟踪ID"></p><p>增加统计功能</p><p>在Hexo的主题配置文件_config.yml中查找googleAnalytics完成跟踪ID的添加，按照以下参考Google Analytics统计功能</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># Add google analytics configuration</span><span class="token comment" spellcheck="true"># 添加 Google Analytics 配置</span><span class="token key atrule">googleAnalytics</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">id</span><span class="token punctuation">:</span> UA<span class="token punctuation">-</span>xxxxxxxx<span class="token punctuation">-</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="谷歌收录"><a href="#谷歌收录" class="headerlink" title="谷歌收录"></a>谷歌收录</h4><h5 id="收录域名提交"><a href="#收录域名提交" class="headerlink" title="收录域名提交"></a>收录域名提交</h5><ol><li><p>登录<a href="https://search.google.com/search-console/about" rel="external nofollow noreferrer">谷歌搜索排名网址</a></p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222222819218.png" alt="收录域名提交"></p></li><li><p>获取网站验证码</p><p> 点击继续后，弹出谷歌网站验证码，点击复制，并把这个值按照图中的要求增加到域名的DNS记录中。</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223213459248.png" alt="获取网站验证码"></p></li><li><p>登录域名增加TXT解析记录</p><p> 增加一条TXT记录，name为@，内容为以上谷歌提供的值，我这里kui.ge的域名DNS解析已经转入了Cloudflare，因此在Cloudflare的TXT解析记录如下</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222223329909.png" alt="TXT解析记录"></p></li><li><p>点击验证，提示验证成功</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222223553295.png" alt="验证成功界面"></p></li><li><p>前往资源页面进行管理</p><p> 点击站点地图，把博客根目录下构建生成的sitemap.xml的URL地址填写进去帮忙收录，可以看到谷歌识别到了24个有效访问链接。</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222225246537.png" alt="站点地图提交"></p></li><li><p>查看收录结果</p><p> 使用<code>site:kui.ge</code>便可以查看收录结果，一般24小时内就能够查阅到结果，使用谷歌这个功能需要科学上网的哦</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223094704695.png" alt="谷歌成功收录结果"></p></li></ol><h5 id="Sitemap谷歌收录"><a href="#Sitemap谷歌收录" class="headerlink" title="Sitemap谷歌收录"></a>Sitemap谷歌收录</h5><ul><li><p>安装插件</p><pre class="line-numbers language-shell"><code class="language-shell">npm install hexo-generator-sitemap --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>修改配置文件</p><p>  修改根节点_config.xml，添加以下内容：</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">sitemap</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> sitemap.xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h4 id="百度收录"><a href="#百度收录" class="headerlink" title="百度收录"></a>百度收录</h4><p>提交百度有网页直接提交、手动提交、主动推送，自动推送和sitemap五种方式，各自的优缺点可以看<a href="https://zhuanlan.zhihu.com/p/129740968" rel="external nofollow noreferrer">这篇博文</a>。</p><h5 id="网页直接提交"><a href="#网页直接提交" class="headerlink" title="网页直接提交"></a>网页直接提交</h5><p>在百度搜索框搜索域名，然后点击提交网址，直接提交给百度即可。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222184206912.png" alt="网页提交指南"></p><h5 id="手动提交"><a href="#手动提交" class="headerlink" title="手动提交"></a>手动提交</h5><p>登录<a href="https://ziyuan.baidu.com/" rel="external nofollow noreferrer">百度搜索资源平台</a>， 登录成功之后在 用户中心 –&gt; 站点管理 页面中点击<a href="https://links.jianshu.com/go?to=https://ziyuan.baidu.com/site/siteadd" rel="external nofollow noreferrer">添加网站</a>，按提示操作。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222172445482.png" alt="添加站点"></p><blockquote><p>  注意：GitHub禁止了百度爬虫，因此需要确认是否完成了上一章节的Cloudflare设置</p></blockquote><p>HTML标签验证</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222173807500.png" alt="HTML标签验证"></p><p>先不要点击验证，找到Hexo主题的head.ejs文件，把上图的代码加入进来，然后<code>hexo clean &amp;&amp; hexo g -d</code>部署成功之后，再点击上面的完成验证。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222181525160.png" alt="添加baidu-site-verification"></p><p>如果使用的是Next主题可以复制百度上图中提供的content值，在Next主题的_config.yml中搜索 <code>baidu_site_verification</code>填入即可。</p><h5 id="主动推送"><a href="#主动推送" class="headerlink" title="主动推送"></a>主动推送</h5><p>GitHub禁止百度爬虫访问的补救办法，并能够及时把新创建的文件提交给百度收录，也能保护原创文章，推荐。</p><ul><li>  <strong>安装hexo-baidu-url-submit插件</strong></li></ul><p>首先，在Hexo根目录下，安装本插件：</p><pre class="line-numbers language-undefined"><code class="language-undefined">npm install hexo-baidu-url-submit --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>请注意， 本插件的配置文件中包含秘钥， 请把您的Hexo博客源文件托管到私有仓库里。</strong></p><ul><li>  <strong>配置_config.yml文件</strong></li></ul><p>同样在根目录下，把以下内容配置到<code>_config.yml</code>文件中:</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">baidu_url_submit</span><span class="token punctuation">:</span>  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">10                 </span><span class="token comment" spellcheck="true">## 比如10，代表提交最新的10个链接</span>  <span class="token key atrule">host</span><span class="token punctuation">:</span> kui.ge                 <span class="token comment" spellcheck="true">## 在百度站长平台中注册的域名</span>  <span class="token key atrule">token</span><span class="token punctuation">:</span> your_token         <span class="token comment" spellcheck="true">## 请注意这是您的秘钥，请不要发布在公众仓库里!</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> baidu_urls.txt         <span class="token comment" spellcheck="true">## 文本文档的地址，新链接会保存在此文本文档里</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>your_token可以通过登录<a href="https://ziyuan.baidu.com/" rel="external nofollow noreferrer">百度搜索资源平台</a>，找到自动提交中的主动推送，找到token，填写进入即可。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222174736408.png" alt="主动推送token获取"></p><ul><li>  <strong>检查url</strong></li></ul><p>其次，记得查看<code>_config.yml</code>文件中url的值， 必须包含是百度站长平台注册的域名（一般有www）， 比如:</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># URL</span><span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//kui.ge<span class="token key atrule">root</span><span class="token punctuation">:</span> /<span class="token key atrule">permalink</span><span class="token punctuation">:</span> <span class="token punctuation">:</span>year/<span class="token punctuation">:</span>month/<span class="token punctuation">:</span>title/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>  <strong>加入deploy</strong></li></ul><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">deploy</span><span class="token punctuation">:</span><span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> git  <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/aibittek/aibittek.github.io.git  <span class="token key atrule">branch</span><span class="token punctuation">:</span> master<span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> baidu_url_submitter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行hexo d的时候，新的链接就会被推送了。</p><p>成功推送的显示结果</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223180208395.png" alt="成功推送的显示结果"></p><p><strong>实现原理</strong></p><p>推送功能的实现，分为两部分：</p><p>新链接的产生，<code>hexo g</code>会产生一个文本文件，里面包含最新的链接</p><p>新链接的提交，<code>hexo d</code>会从上述文件中读取链接，提交至百度搜索引擎。</p><h5 id="自动推送"><a href="#自动推送" class="headerlink" title="自动推送"></a>自动推送</h5><p><code>hexo-theme-matery/_config.yml</code> 默认打开，如下：</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># 百度搜索资源平台提交链接</span><span class="token key atrule">baiduPush</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="Sitemap百度收录"><a href="#Sitemap百度收录" class="headerlink" title="Sitemap百度收录"></a>Sitemap百度收录</h5><ul><li><p>安装插件</p><pre class="line-numbers language-shell"><code class="language-shell">npm install hexo-generator-baidu-sitemap --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>修改配置文件</p><p>  修改根节点_config.xml，添加以下内容：</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">baidusitemap</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> baidusitemap.xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h5 id="查看百度收录结果"><a href="#查看百度收录结果" class="headerlink" title="查看百度收录结果"></a>查看百度收录结果</h5><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223094905172.png" alt="这是反例，1天了还没收录，还是各种手段都一起上的结果"></p><p>此时我的心情：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223095236095.png" alt="不要管哥的发型"></p><h4 id="必应收录"><a href="#必应收录" class="headerlink" title="必应收录"></a>必应收录</h4><h5 id="收录方法"><a href="#收录方法" class="headerlink" title="收录方法"></a>收录方法</h5><p>点击<a href="https://www.bing.com/webmasters" rel="external nofollow noreferrer">必应收录网址</a>，使用谷歌账号登录，会自动检测谷歌收录服务，点击直接导入即可</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222225637845.png" alt="必应使用谷歌收录导入"></p><p>Sitemap网站地图也要提交一遍，如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222225807576.png" alt="Sitemap提交"></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210222225910444.png" alt="提交sitemap.xml网站地图"></p><h5 id="收录结果"><a href="#收录结果" class="headerlink" title="收录结果"></a>收录结果</h5><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223095416086.png" alt="必应收录结果"></p><p>没有对比就没有伤害，百度我把网页提交、手动提交、自动提交、自动推送、sitemap、robots.txt能加的都加上了，目前还得不到收录，谷歌和必应基本上半天就有结果/(ㄒoㄒ)/~~</p><h4 id="SEO优化"><a href="#SEO优化" class="headerlink" title="SEO优化"></a>SEO优化</h4><h5 id="修改-url-格式"><a href="#修改-url-格式" class="headerlink" title="修改 url 格式"></a>修改 url 格式</h5><blockquote><p>  seo搜索引擎优化认为，网站的最佳结构是用户从首页点击三次就可以到达任何一个页面</p></blockquote><p>但是我们使用hexo编译的站点打开文章的url是：sitename/year/mounth/day/title四层的结构，这样的url结构很不利于seo，爬虫就会经常爬不到我们的文章，修改 hexo 配置文件：</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">permalink</span><span class="token punctuation">:</span> <span class="token punctuation">:</span>year/<span class="token punctuation">:</span>month/<span class="token punctuation">:</span>title/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="nofollow设置"><a href="#nofollow设置" class="headerlink" title="nofollow设置"></a>nofollow设置</h5><p>外链越多，搜索引擎给此站点的权重就越低，即排位越后。为了提高权重，可以禁止搜索引擎跟进外链，添加 nofollow 属性就可以做到。</p><p>hexo 博客根目录安装插件</p><pre class="line-numbers language-shell"><code class="language-shell">npm install hexo-filter-nofollow --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑 hexo 配置文件，添加：</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">nofollow</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">field</span><span class="token punctuation">:</span> post <span class="token comment" spellcheck="true"># post：仅处理文章内容，site：处理全站所有页面</span>  <span class="token key atrule">exclude</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token string">'exclude1.com'</span>    <span class="token punctuation">-</span> <span class="token string">'exclude2.com'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="增加robots-txt"><a href="#增加robots-txt" class="headerlink" title="增加robots.txt"></a>增加robots.txt</h5><p>在 source 目录下添加 robots.txt ，编写爬虫规则，参考如下</p><pre class="line-numbers language-txt"><code class="language-txt">User-agent: *Allow: /Allow: /archives/Allow: /tags/Allow: /categories/Disallow: /vendors/Disallow: /js/Disallow: /lib/Disallow: /css/Disallow: /fonts/Disallow: /vendors/Disallow: /fancybox/Disallow: /old/Sitemap: http://kui.ge/sitemap.xmlSitemap: http://kui.ge/baidusitemap.xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="收录工具"><a href="#收录工具" class="headerlink" title="收录工具"></a>收录工具</h4><p>对于这么多的搜索引擎，使用命令的方式或者分别登录不同平台的搜索引擎进行提交不太方便，有没有聚合的能在一个地方对所有的所有引擎提交收录呢，整理了网页版本和软件版本，有需要的可以学习使用下哦，效率更高。</p><h5 id="网页版本"><a href="#网页版本" class="headerlink" title="网页版本"></a>网页版本</h5><p><a href="https://www.sousuoyinqingtijiao.com/" rel="external nofollow noreferrer">https://www.sousuoyinqingtijiao.com/</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210223100423764.png" alt="image-20210223100423764"></p><h5 id="站长工具"><a href="#站长工具" class="headerlink" title="站长工具"></a>站长工具</h5><p>有了网站免不了要进行维护，查看用户访问数据，以便有针对的满足用户的需求。</p><p>不仅可以通过谷歌分析、百度分析等分析引擎，也可以使用<a href="https://tool.chinaz.com/" rel="external nofollow noreferrer">站长工具</a>可以比较方便的查看网站被收录，访问数据的信息情况。</p>]]></content>
      
      
      <categories>
          
          <category> Earth </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub pages </tag>
            
            <tag> Hexo </tag>
            
            <tag> Typora </tag>
            
            <tag> PicGo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自建永久免费的百度VIP网盘</title>
      <link href="2021/02/zi-jian-yong-jiu-mian-fei-de-bai-du-vip-wang-pan/"/>
      <url>2021/02/zi-jian-yong-jiu-mian-fei-de-bai-du-vip-wang-pan/</url>
      
        <content type="html"><![CDATA[<h2 id="自建永久免费的百度VIP网盘"><a href="#自建永久免费的百度VIP网盘" class="headerlink" title="自建永久免费的百度VIP网盘"></a>自建永久免费的百度VIP网盘</h2><h3 id="为什么要自建网盘？"><a href="#为什么要自建网盘？" class="headerlink" title="为什么要自建网盘？"></a>为什么要自建网盘？</h3><p>记得有次看到个不错的电影，叫什么3D有噗团，听说很有学习价值，好不容易找到了某度的网盘链接，大小差不多10多个GB，开始下载几百KB/s的速度，看了下大概需要20个小时左右下载完，心想着等时间到了再过来看🤭，就放它在后台慢慢下了。但事实证明我还是太天真了，20小时过去了，下载才20%，一看下载速度已经变成了2KB/s。纳尼~我这卫生纸都准备好了，你就这么对我┭┮﹏┭┮。作为一个”知识愤子”表示很愤怒，但是看着电影宣传页的画面，还是忍了一把，乖乖的掏出了20多米办了个会员，下载速度能到MB的级别了，期间提示我还有一个超级会员的下载速度60秒体验，点了一下下载速度又噌的一下上去了，好家伙会员也是有级别的。后来发现了办了会员后，也不用下载，只不过可惜我当时办的是会员，看的不是高清画面，最终还是下载到本地，用支持3D的屏幕享受了一把😄。</p><p>以上就是我的遭遇，并且有些视频上传上去之后，就被删除了，原因大家都懂o((⊙﹏⊙))o</p><p>因此后面就想自己建立个网盘喽。最好资料都保存在自己的硬盘里，远程可以访问，也可以分享给其他人，还能多终端在线浏览视频、音频、文档这些VIP功能那就再好不过了。</p><h3 id="为什么选择树莓派4b做网盘？"><a href="#为什么选择树莓派4b做网盘？" class="headerlink" title="为什么选择树莓派4b做网盘？"></a>为什么选择树莓派4b做网盘？</h3><p>以上我的需求其实就是NAS（Network Attached Storage）网络附属存储。业界做NAS最好的应该就是群晖之类的服务商了，如果家里有闲置电脑，还可以使用黑群晖来做也是可以的。还有一些发烧友使用万兆以太网搭配NVMe固态硬盘，为了达到同样的速度电脑接口可能也需要雷电3，支持万兆的网线，太土豪了，我还是想要一个：</p><ul><li>  <strong>永久免费</strong>（一次性投入硬件成本，后续不收费，有某度的VIP功能）</li><li>  <strong>功耗低</strong>（电费也是钱，尽量功耗最低，低到1年的电费可以忽略不计）</li><li>  <strong>小巧</strong>（想放哪放哪，不占地方）</li><li>  <strong>利用家里闲置带宽</strong>（不用白不用）</li><li>  <strong>可动态扩展</strong>（扩展网盘，任意文件内容，私密内容，做服务器，做其他有趣的东西都可以）</li></ul><p>好了，怎么diy做一个自己的网盘呢？首先挑选硬件平台。万兆太贵，家庭千兆网络环境已经普及。因此只要挑选一个能够支持千兆网路的设备做NAS主机，再挑选一块支持千兆读写的硬盘就可以啦。</p><p>不喜欢折腾的可以直接选择最近刚出的猫盘plus之类的NAS网盘；</p><p>米不多的可以选择黑群晖（功耗）、全洗白猫盘（100多加自备硬盘，需要自己折腾或者某宝某夕夕上）、N1（价格不到100加自备硬盘，硬伤是USB2.0）、蜗牛星际等；</p><p>因此我最终选择了树莓派4b，原因如下：</p><p>体积小：尽可能的”藏”在某个角落，一般来说最可能的是和入户光猫装在集线盒中，太大了放不下；</p><p>功耗低：树莓派做网盘一年的电费按6毛一度电计算，待机功耗5V * 0.55A左右$\approx$2.75W；全速拷贝速度在100MByte/s的时候功耗5V * 1.10A左右$\approx$5.5W；一年的电费在((2.75W * 24 * 365)/1000)*0.6~((5.5W * 24 * 365)/1000)*0.6，大概一年的电费在15元-30元之间；</p><p>速度快：树莓派4b支持千兆以太网配合上USB3.0的移动硬盘，可以满速达到1Gbps的数据读写，这个对于个人或者家庭使用已经够用了，当然也可以组RAID来提高磁盘读写速度和数据安全保障。如果有万兆需求的发烧友，要考虑通信设备（电脑、路由、网线等）支持万兆，硬盘一般也需要物理层M.2接口的，PCIe硬件协议的，NVMe通信协议的SSD固态硬盘才能保证万兆的下限读写速度，而这些都太贵了了，保证每个环节都满足条件也难，因此就不考虑这个情况了哦。</p><p>扩展性：个人有服务器的需求，比如做一些智能硬件远程控制、手机App、Web页面、微信小程序的功能会用到服务器，国内的主机又比较贵，使用家庭闲置带宽和树莓派4b可以临时搭建以上的这些服务器，完成相关的功能。后期如果能够商用或者用户量大的时候，再考虑购买国内的知名主机或者进行水平扩展。</p><p>最后，树莓派4b是一个硬件开放平台，可以安装很多的系统和软件，生态非常好，因此对于学习很多的物联网、人工智能、边缘计算的应用和实施都很有帮助，一平台多用途，这也是最终选择它的一个原因。</p><p>一个利用家里闲置带宽，使用树莓派4b搭建的支持千兆传输的网盘，能力媲美百度VIP网盘的配置如下。</p><table><thead><tr><th>序号</th><th>设备</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>树莓派4b 2G</td><td>体积小、功耗低、易扩展、千兆以太网、USB3.0</td></tr><tr><td>2</td><td>移动硬盘</td><td>支持千兆读写速度的高性价比2T移动硬盘</td></tr><tr><td>3</td><td>公网宽带</td><td>家庭公网宽带</td></tr><tr><td>4</td><td>其他</td><td>5V3A电源线、16G及以上TF卡、千兆网线、千兆路由、散热片或外壳、HDMI线（非必须）</td></tr></tbody></table><p>既然有了配置，接下来就开始完成一个自建永久免费网盘的功能吧</p><p>主要分为4个部分，完成前两个部分就是一个局域网的网盘了，完成第三个就是一个远程网盘了：</p><p>安装系统：<a href="#%E7%BB%99%E4%BD%A0%E7%9A%84%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85%E4%B8%80%E4%B8%AA%E7%B3%BB%E7%BB%9F">给你的树莓派安装一个系统</a>，后续网盘软件是建立在这个操作系统上的；</p><p>本地网盘：<a href="#%E5%81%9A%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E7%BD%91%E7%9B%98">做一个本地网盘</a>，在家里的局域网可以共享，投屏，千兆满速读写的本地网盘；</p><p>VIP网盘：<a href="#%E5%81%9A%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E7%99%BE%E5%BA%A6VIP%E7%BD%91%E7%9B%98">做一个完整的类似百度VIP网盘</a>，支持远程多终端访问上传下载，在线浏览，链接分享等VIP功能；</p><p>离线下载：<a href="#%E7%BB%99%E7%BD%91%E7%9B%98%E6%8F%92%E4%B8%8A%E7%BF%B1%E7%BF%94%E7%9A%84%E7%BF%85%E8%86%80">给网盘插上翱翔的翅膀</a>，让网盘可以利用家里的闲置带宽自动帮我们下载一些资源；</p><h2 id="给你的树莓派安装一个系统"><a href="#给你的树莓派安装一个系统" class="headerlink" title="给你的树莓派安装一个系统"></a>给你的树莓派安装一个系统</h2><h3 id="系统选择"><a href="#系统选择" class="headerlink" title="系统选择"></a>系统选择</h3><p>这里选择了树莓派官方的Raspbian Buster系统。</p><h3 id="系统下载"><a href="#系统下载" class="headerlink" title="系统下载"></a>系统下载</h3><p>官方镜像网站：<a href="https://www.raspberrypi.org/software/" rel="external nofollow noreferrer">https://www.raspberrypi.org/software/</a></p><p>目前官网有一个Raspberry Pi Imager的工具，制作树莓派操作更加便捷。如果遇到系统镜像的下载速度比较慢的，还是推荐地址<a href="https://www.raspberrypi.org/software/operating-systems/#raspberry-pi-os-32-bit" rel="external nofollow noreferrer">下载32位镜像</a>，总大小3GB，使用迅雷下载，下载速度大概能到15MB/s。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210216212903149.png" alt="2021-01-11-raspios-buster-armhf-full.zip"></p><p>下载好之后，是一个压缩包，解压得到2021-01-11-raspios-buster-armhf-full.img镜像文件，8GB多。</p><h3 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h3><p>系统是安装在TF卡中的。在安装系统之前，TF需要格式化。</p><h4 id="SDFormatter-4-0格式化TF卡"><a href="#SDFormatter-4-0格式化TF卡" class="headerlink" title="SDFormatter 4.0格式化TF卡"></a>SDFormatter 4.0格式化TF卡</h4><p>这里使用SDFormatter 4.0格式化SD卡，操作很简单，打开界面，选择要格式化的盘，注意一定要看好了TF卡的盘符，不要格式化错了，数据无价，一定要小心操作哦。</p><p>SDFormatter 4.0下载链接：</p><pre><code>链接: https://pan.baidu.com/s/1Fk7brPQlCy-hUtCfJBxgEg 提取码: htfi</code></pre><p>操作界面：</p><p>插上TF卡到电脑，Drive显示盘符，确认盘符无误后，选择格式化即可。</p><p>默认是快速格式化，也可以通过界面中的<strong>选项设置</strong>改变格式化选项。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/4e46bfb745591802c11bd48b4683b858.jpg" alt="SDFormatter操作界面"></p><h4 id="Win32-Disk-Imager制作系统"><a href="#Win32-Disk-Imager制作系统" class="headerlink" title="Win32 Disk Imager制作系统"></a>Win32 Disk Imager制作系统</h4><p><a href="https://win32diskimager.download/Win32DiskImager-1.0.0-src.zip" rel="external nofollow noreferrer">下载Win32 Disk Imager</a></p><p>选择U盘作为设备，下载解压好的映像文件，点击写入，当任务进度100%后，即可完成Raspberry系统到SD卡的写入。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210216215143775.png" alt="image-20210216215143775"></p><h3 id="系统启动与验证"><a href="#系统启动与验证" class="headerlink" title="系统启动与验证"></a>系统启动与验证</h3><ol><li> 为了验证系统是否成功，需要在刚才的SD卡中新建一个空文件，名为ssh，就可以开启SSH功能进行远程登录了；</li><li> 把SD卡插入到树莓派的SD插槽中，接上5V3A的电源，插上千兆网线到路由器，保证和电脑在同一个局域网；</li><li> 电脑上打开cmd命令行，输入以下命令<code>ping raspberrypi.local</code>查询树莓派的IP地址，用于SSH的远程登录；也可以在路由器中查看树莓派的IPv6地址；</li><li> 通过第三步得到的树莓派设备IP地址，使用SSH远程登录，能够进入命令行说明系统安装成功，具体操作如下：</li></ol><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210216221718333.png" alt="image-20210216221718333"></p><p>为了后面的服务，在路由器中给树莓派设置一个固定的IP。</p><h3 id="无线网络开启"><a href="#无线网络开启" class="headerlink" title="无线网络开启"></a>无线网络开启</h3><p>虽然做网盘不赞成用网盘，因为速度不稳定。</p><p>但是可能一开始在配置的时候，<strong>没有有线网络环境，因此可以通过以下方法在做完系统后开启无线网络，适合于暂时无显示器也没有有线网络的情况下。</strong></p><p>这种方式适用于第一次刻录完系统，并且没有有线网络连接的情况下设置树莓派WiFi。方法如下：<br>在SD卡的boot分区种新建 wpa_supplicant.conf 文件，并且配置 WiFi 的 SSID 和密码，这样树莓派启动后会自行读取 wpa_supplicant.conf 配置文件连接 WiFi 设备。</p><pre><code>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdevupdate_config=1network=&#123;ssid=&quot;WiFi的SSID&quot;psk=&quot;WiFi密码&quot;&#125;</code></pre><p>树莓派开机，就会自动连接WiFi，可以查看路由器中分配的IP地址是多少，或者通过命令ping raspberrypi.local获取树莓派的IP地址，再通过SSH登录到树莓派进行命令行的控制。</p><h2 id="做一个本地网盘"><a href="#做一个本地网盘" class="headerlink" title="做一个本地网盘"></a>做一个本地网盘</h2><p>树莓派安装了Linux的系统，一般使用samba服务把挂载的磁盘暴露给局域网内的其他主机，从而当作局域网网盘来使用。</p><p><strong>完成本地网盘需要两个部分：磁盘挂载，配置samba服务。</strong></p><h3 id="本地挂载"><a href="#本地挂载" class="headerlink" title="本地挂载"></a>本地挂载</h3><h4 id="查询磁盘"><a href="#查询磁盘" class="headerlink" title="查询磁盘"></a>查询磁盘</h4><p>插入购买的移动硬盘到USB3.0接口上之后，输入以下命令：</p><pre class="line-numbers language-shell"><code class="language-shell">sudo fdisk -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>找到对应的磁盘名称，一般是/dev/sda、/dev/sdb等，可根据容量判别</p><pre class="line-numbers language-shell"><code class="language-shell">Disk /dev/sda: 1.8 TiB, 2000398931968 bytes, 3907029164 sectorsDisk model: EXTERNAL_USB    Units: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x3fe8e79c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="磁盘格式化"><a href="#磁盘格式化" class="headerlink" title="磁盘格式化"></a>磁盘格式化</h4><p>磁盘被使用前需要格式化，假设磁盘的名称是/dev/sda，则磁盘格式化命令为：</p><pre class="line-numbers language-shell"><code class="language-shell">sudo fdisk /dev/sda<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后进入格式化命令行，分别执行输入n、w，其他的默认即可，如下：</p><pre class="line-numbers language-shell"><code class="language-shell">Command(m for help): nCommand action  e   extended  p   primary partition (1-4)      ---指定分区类型  e为扩展分区  p为主分区p （输入p选择创建主分区）Partition number (1-4): 1 （创建第一个主分区，也即是后来的sda1） ---主分区最多只能有四个First cylinder (1-2610, default 1): 1   ---设定起始分区的位置Last cylinder or +size or +sizeM or +sizeK(1-2610, default 2610):2610Using default value 2610            ---设定结束分区的位置Command (m for help): w             ---保存刚才的配置信息。The partition table has been altered!Calling ioctl() to re-read partition table.Syncing disks.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过以上的命令设置成功后，现在已经创建出了一个主分区，再次通过sudo fdisk -l查看是否存在名称为/dev/sda1的分区，当然如果磁盘的名称是sdb，那么名称应该是/dev/sdb1</p><pre class="line-numbers language-shell"><code class="language-shell">Device     Boot Start        End    Sectors  Size Id Type/dev/sda1        2048 3907029163 3907027116  1.8T 83 Linux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以看到/dev/sda1是一个2TB的分区，接下来再对磁盘进行格式化的操作。</p><p>使用mkfs命令格式化/dev/sda1分区（根据自己的情况，可能你的板子不是sda1的名字哦）</p><pre class="line-numbers language-shell"><code class="language-shell">sudo mkfs.ext4 /dev/sda1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意这里面ext4是Linux下的磁盘文件类型，支持的很好，<strong>千万不要用NTFS之类的格式，不然发挥不了USB3.0的性能，测试的读写速度也是跑不满的</strong>。</p><h4 id="磁盘手动挂载"><a href="#磁盘手动挂载" class="headerlink" title="磁盘手动挂载"></a>磁盘手动挂载</h4><pre class="line-numbers language-shell"><code class="language-shell">mount /dev/sda1 /mnt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以上的命令是把/dev/sda1这个磁盘挂载到了/mnt的目录下，以后读写mnt目录就相当于对/dev/sda1这个分区磁盘做读写了。</p><h4 id="磁盘自动挂载"><a href="#磁盘自动挂载" class="headerlink" title="磁盘自动挂载"></a>磁盘自动挂载</h4><p>系统系统启动时候能够自动挂载，可以打开/etc/fstab文件</p><pre class="line-numbers language-shell"><code class="language-shell">sudo nano /etc/fstab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在最后一行写入如下的内容，<strong>一定要注意配置这个文件，编写错误会造成无法开机</strong></p><pre class="line-numbers language-shell"><code class="language-shell">/dev/sda1       /mnt            ext4    defaults,noatime,nodiratime     0       0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后按ctrl+o进行保存，ctrl+x退出，sudo reboot后重新启动后输入df命令查看是否能看sda1对应到mnt的挂载目录，如果能看到，表示系统已经能够自启动挂载磁盘了。</p><pre><code>Filesystem      1K-blocks     Used  Available Use% Mounted on/dev/root        14989012  7355960    6928572  52% //dev/sda1      1921802516 15000880 1809109576   1% /mnttmpfs              191132        0     191132   0% /run/user/1000</code></pre><h3 id="samba服务"><a href="#samba服务" class="headerlink" title="samba服务"></a>samba服务</h3><h4 id="samba服务下载"><a href="#samba服务下载" class="headerlink" title="samba服务下载"></a>samba服务下载</h4><p>安装samba前，需要更新一下软件包的源，命令如下：</p><pre><code>sudo apt-get update</code></pre><p>安装</p><pre class="line-numbers language-shell"><code class="language-shell">sudo apt-get install samba samba-common-bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="samba服务配置与自启动"><a href="#samba服务配置与自启动" class="headerlink" title="samba服务配置与自启动"></a>samba服务配置与自启动</h4><p>修改共享配置文件</p><pre class="line-numbers language-shell"><code class="language-shell">sudo nano /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在smb.conf文件末尾增加以下内容，path代表共享的目录，valid users代表允许的用户，browseable代表可浏览。</p><pre><code>[box]   path=/mnt/   valid users=pi   write list=pi   browseable=yes   create mask=0777   public=no   guest ok = no</code></pre><p>由于samba服务使用的账号密码和系统的不一致，因此需要配置samba的用户密码，如下：</p><pre class="line-numbers language-shell"><code class="language-shell">sudo smbpasswd -a pi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使能pi用户</p><pre class="line-numbers language-shell"><code class="language-shell">sudo smbpasswd -e pi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动或重启samba服务</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl restart smbd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>需要自启动，可以使用systemctl命令：</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl enable smbd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="samba远程挂载"><a href="#samba远程挂载" class="headerlink" title="samba远程挂载"></a>samba远程挂载</h4><p>windows可以打开文件资源管理器窗口，找到映射网络驱动器，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210218223155457.png" alt="windows samba磁盘映射"></p><p>输入samba用户pi的账号密码即可访问到树莓派4b中的/mnt目录内容了，<strong>可以像本地磁盘一样进行文件的读写了</strong></p><h4 id="磁盘读写性能测试"><a href="#磁盘读写性能测试" class="headerlink" title="磁盘读写性能测试"></a>磁盘读写性能测试</h4><p>本地磁盘速度测试</p><p>写入测试，结果为<strong>128MB/s，满足千兆写入要求</strong></p><pre class="line-numbers language-shell"><code class="language-shell">pi@raspberrypi:~ $ sudo dd if=/dev/sda1 of=/dev/null bs=8k count=200000200000+0 records in200000+0 records out1638400000 bytes (1.6 GB, 1.5 GiB) copied, 13.2203 s, 128 MB/s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>读取测试，结果为<strong>123MB/s，也基本满足千兆读取要求</strong></p><pre class="line-numbers language-shell"><code class="language-shell">pi@raspberrypi:~ $ sudo dd if=/dev/sda1 of=/dev/null bs=8k count=200000200000+0 records in200000+0 records out1638400000 bytes (1.6 GB, 1.5 GiB) copied, 13.2891 s, 123 MB/s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>samba远程读写速度测试，找了一个2GB大小的单文件测试。</p><p>写入速度</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210218224939184.png" alt="image-20210218224939184"></p><p>读取速度</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210218225025491.png" alt="image-20210218225025491"></p><p>可以看到，基本上本地的网盘基本上已经满足千兆的读写要求啦，开心😊</p><p><strong>注意速度达不到要求的，要保证磁盘的文件类型不能为NTFS的，要格式化为ext4的，另外要使用千兆的路由器和网线。</strong></p><h3 id="耗电量检测"><a href="#耗电量检测" class="headerlink" title="耗电量检测"></a>耗电量检测</h3><p>待机功耗（非传输数据，磁盘休眠）</p><p><strong>按照1度电6毛线来算大概是一年15元钱</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210218231447163.png" alt="磁盘休眠时的功耗"></p><p>传输功耗（满负荷传输数据）</p><p><strong>按照1度电6毛线来算大概是一年30元钱</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210218230753508.png" alt="满负荷磁盘数据传输时的功耗"></p><p><strong>这个功耗不算开始的硬件投入，这些电费损耗可以忽略不计的话，做到这一步已经相当于有一个免费的本地网盘啦</strong>😊</p><h2 id="做一个完整的百度VIP网盘"><a href="#做一个完整的百度VIP网盘" class="headerlink" title="做一个完整的百度VIP网盘"></a>做一个完整的百度VIP网盘</h2><h3 id="网盘软件选择"><a href="#网盘软件选择" class="headerlink" title="网盘软件选择"></a>网盘软件选择</h3><p>目前开源的免费网盘应用很多，比如Seafile、Nextcloud、Cloudreve等等。为了简便，这里选择的是国内开源的，基于ThinkPHP开发的Cloudreve。</p><p>选择Cloudreve的原因是:</p><p>部署方便：单文件即可运行，没有其他依赖；</p><p>配置灵活：可选的Sqlite和Mysql支持；</p><p>使用方便：提供网页版操作界面，不会存在Nextcloud多终端App的适配问题；</p><p><a href="https://cloudreve.org/" rel="external nofollow noreferrer">功能丰富</a>：支持文件及批量上传、可分享、可在线预览、支持七牛/又拍云/阿里OSS等的云存储、WebDAV网盘映射等丰富的功能；</p><h3 id="网盘软件安装使用"><a href="#网盘软件安装使用" class="headerlink" title="网盘软件安装使用"></a>网盘软件安装使用</h3><p>安装非常简单，下载后直接运行即可。</p><p>下载地址：打开<a href="https://cloudreve.org/%EF%BC%8C%E7%82%B9%E5%87%BB%E4%B8%8B%E8%BD%BD%E5%8D%B3%E5%8F%AF%EF%BC%8C%E6%B3%A8%E6%84%8F%E5%92%B1%E4%BB%AC%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%98%AFarm32%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8B%E8%BD%BD%E5%A6%82%E4%B8%8B%E7%9A%84arm" rel="external nofollow noreferrer">https://cloudreve.org/，点击下载即可，注意咱们的系统是arm32的，所以下载如下的arm</a> 32位的版本：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219111752145.png" alt="下载ARM32位版本的Cloudreve"></p><p>进入目录后，直接在命令行运行即可：</p><pre class="line-numbers language-shell"><code class="language-shell">./cloudreve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>显示信息如下，</p><pre class="line-numbers language-shell"><code class="language-shell">   V3.2.1  Commit #3b22b4f  Pro=false================================================[Info]    2021-02-19 03:21:39 初始化数据库连接[Info]    2021-02-19 03:21:39 数据库版本匹配，跳过数据库迁移[Info]    2021-02-19 03:21:39 初始化任务队列，WorkerNum = 10[Info]    2021-02-19 03:21:39 初始化定时任务...[Info]    2021-02-19 03:21:39 当前运行模式：Master[Info]    2021-02-19 03:21:39 开始监听 :5212<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开浏览器输入树莓派的IP地址:5212即可访问你的网盘啦（注意第一次登录在终端会提供系统账号和密码，以后运行不再提供，需要记一下哦）</p><p>登录之后显示内容如下，可上传下载、分享、在线预览等网盘的一些VIP功能啦</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219112838397.png" alt="一个基本的VIP网盘诞生啦"></p><h3 id="服务自启动配置"><a href="#服务自启动配置" class="headerlink" title="服务自启动配置"></a>服务自启动配置</h3><p>打开自启动配置文件：</p><pre class="line-numbers language-shell"><code class="language-shell">sudo nano /usr/lib/systemd/system/cloudreve.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输入以下内容，注意其中WorkingDirectory要改为你的cloudreve执行程序的绝对路径，ExecStart改为cloudreve的绝对执行路径名称，然后ctrl+o保存，再ctrl+x退出即可。</p><pre><code>[Unit]    Description=Cloudreve    Documentation= =[查看链接](https://docs.cloudreve.org/)    After=network.target    Wants=network.target[Service]    WorkingDirectory=/mnt/Cloudreve    ExecStart=/mnt/Cloudreve/cloudreve    Restart=on-abnormal    RestartSec=5s    KillMode=mixed    StandardOutput=null    StandardError=syslog[Install]    WantedBy=multi-user.target</code></pre><h3 id="服务自启动"><a href="#服务自启动" class="headerlink" title="服务自启动"></a>服务自启动</h3><p>更新自启动配置</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动服务</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl start cloudreve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>开机自启动</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl enable cloudreve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>平时也可以通过以下命令来管理cloudreve网盘服务：</p><pre class="line-numbers language-shell"><code class="language-shell"># 启动服务systemctl start cloudreve# 停止服务systemctl stop cloudreve# 重启服务systemctl restart cloudreve# 查看状态，有启动的问题等也可以通过这里查看到systemctl status cloudreve<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="网站优化"><a href="#网站优化" class="headerlink" title="网站优化"></a>网站优化</h3><p>点击右上角的头像，在弹出的菜单中选择管理面板</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219114502409.png" alt="网盘管理面板如何进入"></p><p>进入后，右侧有相关的设置选项，请根据自己的需求进行设置哦，也可以登录Github查看他们的<a href="https://github.com/cloudreve/Cloudreve" rel="external nofollow noreferrer">使用文档</a>，注意其中的站点URL在确定外网访问地址后，要修改一下，否则分享出去的地址别人访问不了哦。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219114808546.png" alt="VIP网盘后台管理页面"></p><h3 id="支持外网访问"><a href="#支持外网访问" class="headerlink" title="支持外网访问"></a>支持外网访问</h3><p>到达这里，我们已经有一个局域网的VIP网盘啦😄。</p><p>如果希望通过外网域名访问自己的网盘，就需要满足<strong>以下3点基本条件</strong>：</p><p><strong>注册一个自己的域名</strong>：通过自己的域名访问你家里的网盘</p><p><strong>使用DDNS动态解析</strong>：由于IPv4地址紧缺，电信移动给咱们的出口IP地址都是动态更新的，需要能把动态改变的IP映射到自己的域名上，这样访问自己的域名就能通过动态解析的IP找到家里的IP啦</p><p><strong>家里的网需要是公网IP</strong>（查看路由器上的外网IP是否为公网的，不是的话可以打电话给电信或者移动，让他们把你家的IP地址改成公网的）</p><h4 id="域名注册"><a href="#域名注册" class="headerlink" title="域名注册"></a>域名注册</h4><p>推荐使用<a href="https://www.dnspod.cn/" rel="external nofollow noreferrer">DNSPOD</a>的注册，他家提供免费的DDNS服务，可以找一个便宜点的域名，差不多20多块钱就能搞定</p><h4 id="DDNS动态解析"><a href="#DDNS动态解析" class="headerlink" title="DDNS动态解析"></a>DDNS动态解析</h4><p>登录dnspod控制台<a href="https://console.dnspod.cn/dns/list%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E6%9D%A1A%E8%AE%B0%E5%BD%95%EF%BC%8C%E4%B8%BB%E6%9C%BA%E8%AE%B0%E5%BD%95%E5%A1%AB%E5%86%99%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E6%88%91%E8%BF%99%E9%87%8C%E6%98%AFbox%EF%BC%8C%E8%AE%B0%E5%BD%95%E5%80%BC%E5%A1%AB%E5%86%99%E7%9A%84%E6%98%AFIP%EF%BC%8C%E4%BD%86%E8%BF%99%E4%B8%AA%E6%98%AF%E5%90%8E%E9%9D%A2%E8%A6%81%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E5%AE%B6%E9%87%8C%E7%9A%84IP%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%BF%99%E9%87%8C%E5%85%88%E9%9A%8F%E4%BE%BF%E5%A1%AB%E5%86%99%E5%8D%B3%E5%8F%AF%E3%80%82" rel="external nofollow noreferrer">https://console.dnspod.cn/dns/list，创建一条A记录，主机记录填写二级域名的名称，我这里是box，记录值填写的是IP，但这个是后面要自动生成的家里的IP地址，这里先随便填写即可。</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219220321102.png" alt="动态域名"></p><p>在<a href="https://console.dnspod.cn/account/token%E9%A1%B5%E9%9D%A2%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AF%86%E9%92%A5%EF%BC%8C%E6%B3%A8%E6%84%8F%E4%B8%80%E5%AE%9A%E8%A6%81%E8%AE%B0%E4%BD%8F%E6%8F%90%E4%BE%9B%E7%9A%84Token%EF%BC%8C%E5%8F%AA%E4%BC%9A%E6%98%BE%E7%A4%BA%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%90%8E%E9%9D%A2%E6%9C%89%E7%94%A8%E3%80%82" rel="external nofollow noreferrer">https://console.dnspod.cn/account/token页面创建一个密钥，注意一定要记住提供的Token，只会显示一次，后面有用。</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219220606791.png" alt="ddns密钥"></p><p>在树莓派上下载动态更新脚本</p><pre class="line-numbers language-shell"><code class="language-shell">git clone https://github.com/imki911/ArDNSPod.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>讲DNSPOD上得到的ID和Token填写在dns.conf文件的arToken中，arDdnsCheck后面改成在DNSPAD上填写的一级和二级域名</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219221026595.png" alt="ddns配置文件"></p><p>在当前目录下创建一个守护程序ddns_daemon.sh，内容如下：</p><pre class="line-numbers language-shell"><code class="language-shell">#!/bin/shwhile [ 1 ]do    sh /mnt/DDNS/ArDNSPod/ddnspod.sh >/dev/null 2>&1    sleep 600done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意，第5行sh后面的脚本路径需要按照自己的绝对路径修改，目的是执行到ddnspod.sh这个脚本即可。另外保存后执行chmod +x ddns_daemon.sh，使得这个文件有被执行的权限。</p><p>增加系统自启动，打开/etc/rc.local，在exit 0之前增加一行：</p><pre class="line-numbers language-shell"><code class="language-shell">/mnt/DDNS/ArDNSPod/ddns_daemon.sh &<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意，ddns_daemon.sh也需要更改为你自己的绝对路径。</p><p>大功告成，可以手动执行ddns_daemon.sh，观察DNSPOD的A记录值是否发生变化，并且是你家里的出口IP，是的话，DDNS解析就可以啦，可以通过你的<strong>二级域名:5212</strong>这个网址来访问你的VIP网盘啦，如果能够显示cloudreve登录界面，<strong>恭喜你的网盘支持外网访问啦。</strong></p><h4 id="支持安全访问"><a href="#支持安全访问" class="headerlink" title="支持安全访问"></a>支持安全访问</h4><p>目前已经完成了公网访问网盘了，但是默认是HTTP访问的，这里我们希望访问通过HTTPS加密方式，因此需要HTTP访问时也跳转到HTTPS，因此目前需要解决两个问题：一是HTTPS访问支持，一是HTTP访问时跳转到HTTPS访问。</p><p>这里使用简单的方式，使用Nginx反向代理来做，先下载Nginx</p><p>安装Nginx</p><pre class="line-numbers language-shell"><code class="language-shell">sudo apt-get install nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动Nginx</p><pre class="line-numbers language-shell"><code class="language-shell">sudo /etc/init.d/nginx start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以在内网浏览器访问树莓派的IP地址，查看Nginx是否安装成功，成功之后会显示一个Nginx的网页，否则无法展示网页信息。</p><p>修改Nginx配置文件，sudo nano /etc/nginx/conf.d/aibittek.com.conf</p><pre><code>server &#123;        listen 8000 ssl;        server_name box.aibittek.com;        error_page 497 301 https://$server_name:8000$request_uri;        ssl_certificate  /mnt/crt/box.aibittek.com.crt;        ssl_certificate_key /mnt/crt/box.aibittek.com.key;        ssl_session_timeout 5m;        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;        ssl_prefer_server_ciphers on;        location / &#123;                proxy_buffer_size  128k;                proxy_buffers   32 32k;                proxy_busy_buffers_size 128k;                proxy_pass http://127.0.0.1:5212;                client_max_body_size 0;        &#125;&#125;</code></pre><p>对以上的配置文件内容说明如下：</p><p>listen 8000 ssl：表示监听8000端口，为什么不是默认的80或HTTPS的443？这个要问电信了，已经把入口的80和443端口给封了，否则你都没备案就可以自己在家造网页服务了，那不乱了套啦。所以访问我的网盘也变成了box.aibittek.com:8000才可以了，哎没办法，必须显性加端口号才能访问了；</p><p>server_name：是代理的域名；</p><p>error_page：是一种方法，使得原来http访问的强制使用后面的https方式访问；</p><p>ssl_certificate和ssl_certificate_key是https访问证书信息，进入<a href="https://console.dnspod.cn/dns/list%E7%BD%91%E5%9D%80%EF%BC%8C%E6%89%BE%E5%88%B0DDNS%E7%9A%84%E8%BF%99%E6%9D%A1%E8%AE%B0%E5%BD%95%E7%9A%84SSL%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%85%8D%E8%B4%B9%E4%B8%80%E5%B9%B4%E7%9A%84%E7%94%B3%E8%AF%B7%EF%BC%8C%E7%94%B3%E8%AF%B7%E9%80%9A%E8%BF%87%E5%90%8E%EF%BC%8C%E7%82%B9%E5%87%BB%E4%B8%8B%E8%BD%BD%E5%B0%B1%E5%BE%97%E5%88%B0%E4%BA%86%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E3%80%82![image-20210219223312858](https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219223312858.png)" rel="external nofollow noreferrer">https://console.dnspod.cn/dns/list网址，找到DDNS的这条记录的SSL，进行免费一年的申请，申请通过后，点击下载就得到了这两个文件。![image-20210219223312858](https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219223312858.png)</a></p><p>proxy_pass是代理到的IP和端口，这里的<a href="http://127.0.0.1:5212是cloudreve；" rel="external nofollow noreferrer">http://127.0.0.1:5212是cloudreve；</a></p><p>client_max_body_size是缓存大小，如果设置的太小，使用cloudreve下载上传数据时，会卡住；</p><p>设置Nginx跟随系统自启动</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl enable nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>好啦，一切都大功告成了，验证一下是不是每次重启系统树莓派之后，浏览器输入自己定义的域名，都能访问到网盘页面了呢，并且都是使用HTTPS访问了呢？</p><h2 id="给网盘插上翱翔的翅膀"><a href="#给网盘插上翱翔的翅膀" class="headerlink" title="给网盘插上翱翔的翅膀"></a>给网盘插上翱翔的翅膀</h2><p>以上已经完成了VIP网盘的全部内容，如果还想科学上网并离线下载，可以参考本章节的aria2离线下载和shadowsocksR的科学上网</p><h3 id="aria2离线下载"><a href="#aria2离线下载" class="headerlink" title="aria2离线下载"></a>aria2离线下载</h3><p>aria2是一个下载神器，超越迅雷，只要资源好，BT磁力链下载速度贼快，下面我们来安装使用下。</p><h4 id="aria2安装"><a href="#aria2安装" class="headerlink" title="aria2安装"></a>aria2安装</h4><p>专业人干专业事，已经有小伙伴做了一个一键安装和配置的<a href="https://github.com/P3TERX/aria2.sh" rel="external nofollow noreferrer">脚本</a>，安装方法如下：</p><ul><li><p>下载基础组件</p><pre class="line-numbers language-shell"><code class="language-shell">sudo apt install wget curl ca-certificates<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>下载脚本</p><pre class="line-numbers language-shell"><code class="language-shell">wget -N git.io/aria2.sh && chmod +x aria2.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>运行脚本</p><pre class="line-numbers language-shell"><code class="language-shell">sudo ./aria2.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>选择你要执行的选项</p><pre class="line-numbers language-shell"><code class="language-shell">Aria2 一键安装管理脚本 增强版 [v2.7.4] by P3TERX.COM  0. 升级脚本 ———————————————————————  1. 安装 Aria2  2. 更新 Aria2  3. 卸载 Aria2 ———————————————————————  4. 启动 Aria2  5. 停止 Aria2  6. 重启 Aria2 ———————————————————————  7. 修改 配置  8. 查看 配置  9. 查看 日志 10. 清空 日志 ——————————————————————— 11. 手动更新 BT-Tracker 12. 自动更新 BT-Tracker ——————————————————————— Aria2 状态: 未安装 | 未启动 自动更新 BT-Tracker: 未开启 请输入数字 [0-12]:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  输入1回车，等待安装完毕即可，成功之后的界面如下：</p><p>  <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210220140544763.png" alt="image-20210220140544763"></p></li></ul><p>打开AriaNG链接地址，测试下磁力链的下载速度：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210220140804414.png" alt="AriaNG的下载速度"></p><h4 id="cloudreve配置验证"><a href="#cloudreve配置验证" class="headerlink" title="cloudreve配置验证"></a>cloudreve配置验证</h4><p>本章节可以参考<a href="https://docs.cloudreve.org/use/aria2" rel="external nofollow noreferrer">官方文档</a>进行配置，配置界面如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219184958247.png" alt="image-20210219184958247"></p><p>注意修改这里的RPC Secret为Aria2脚本启动时提供的RPC密钥。配置完成点击保存，然后点击<strong>测试连接</strong>，如果右上角显示绿色的aria2的版本号则说明配置成功啦😄。</p><p>进入到主页点击离线下载，支持HTTP(s)/FTP/磁力链的下载，下载速度大概能到20MB/s，相当可观。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210220140933599.png" alt="image-20210220140933599"></p><h4 id="aria2自启动"><a href="#aria2自启动" class="headerlink" title="aria2自启动"></a>aria2自启动</h4><p>创建systemd文件:<code>sudo vim /lib/systemd/system/aria2.service</code>为如下:</p><pre class="line-numbers language-shell"><code class="language-shell">[Unit]Description=Aria2c download managerAfter=network.target[Service]Type=simpleUser=rootExecStart/usr/local/bin/aria2c --conf-path=/mnt/aria2/aria2.conf[Install]WantedBy=multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>启动:<code>sudo systemctl start aria2.service</code></p><p>可以设置开机启动:<code>sudo systemctl enable aria2.service</code>,如果要关闭开机启动:<code>sudo systemctl disable aria2.service</code></p><h3 id="shadowsocksR科学上网"><a href="#shadowsocksR科学上网" class="headerlink" title="shadowsocksR科学上网"></a>shadowsocksR科学上网</h3><p>在某些时候，可能需要科学上网，可以通过以下方式安装和使用。</p><h4 id="安装ssr-helper"><a href="#安装ssr-helper" class="headerlink" title="安装ssr-helper"></a>安装ssr-helper</h4><pre class="line-numbers language-shell"><code class="language-shell">npm install -g ssr-helper<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="安装配置脚本"><a href="#安装配置脚本" class="headerlink" title="安装配置脚本"></a>安装配置脚本</h4><pre class="line-numbers language-shell"><code class="language-shell">git clone -b manyuser https://github.com/shadowsocksr-backup/shadowsocksr.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>配置以上工具的路径，假设以上的源代码被放在了/mnt/shadowsocksr，则：</p><pre class="line-numbers language-shell"><code class="language-shell">ssr config /mnt/shadowsocksr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用ssr add命令添加服务器，根据自己SSR的情况一步步的填写即可。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210219214212116.png" alt="SSR服务器信息"></p><h4 id="启动ssr服务器"><a href="#启动ssr服务器" class="headerlink" title="启动ssr服务器"></a>启动ssr服务器</h4><pre class="line-numbers language-shell"><code class="language-shell">ssr start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="设置开机自启动"><a href="#设置开机自启动" class="headerlink" title="设置开机自启动"></a>设置开机自启动</h4><pre class="line-numbers language-shell"><code class="language-shell">ssr startup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="SwitchyOmega配置浏览器科学上网"><a href="#SwitchyOmega配置浏览器科学上网" class="headerlink" title="SwitchyOmega配置浏览器科学上网"></a>SwitchyOmega配置浏览器科学上网</h4><p>默认已经有了两个示例，一个 proxy 代理服务器、一个 auto switch 自动切换模块式，可直接修改，也可以点 + 新建情景模式。</p><p>先建立一个代理服务器</p><table><thead><tr><th align="left">网址协议</th><th align="left">代理协议</th><th align="left">代理服务器</th><th align="left">代理端口</th></tr></thead><tbody><tr><td align="left">(默认)</td><td align="left">socks5</td><td align="left">127.0.0.1</td><td align="left">1080</td></tr></tbody></table><p>再建一个自动切换模式</p><p>切换规则</p><table><thead><tr><th align="left">排序</th><th align="left">条件类型</th><th align="left">条件设置</th><th align="left">情景模式</th></tr></thead><tbody><tr><td align="left"></td><td align="left">规则列表规则</td><td align="left">(按照规则列表匹配请求)</td><td align="left">(刚刚建的代理服务器)</td></tr><tr><td align="left"></td><td align="left">默认情景模式</td><td align="left"></td><td align="left">直接连接</td></tr></tbody></table><p>规则列表设置</p><p>规则列表格式 SwitchyAu­to­Proxy<br>        规则列表网址 <a href="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt" rel="external nofollow noreferrer">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a></p><h4 id="使用全局代理"><a href="#使用全局代理" class="headerlink" title="使用全局代理"></a>使用全局代理</h4><p>安装Privoxy</p><pre class="line-numbers language-shell"><code class="language-shell">sudo apt-get install -y privoxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>修改配置文件</p><pre class="line-numbers language-shell"><code class="language-shell">sudo vim /etc/privoxy/config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>增加行</p><pre class="line-numbers language-shell"><code class="language-shell">forward-socks5t   /               127.0.0.1:1080 .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意forward顶格写，1080后面又一个点。</p><p>启动服务</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl start privoxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>修改环境变量</p><pre class="line-numbers language-shell"><code class="language-shell">export http_proxy=http://127.0.0.1:8118export https_proxy=http://127.0.0.1:8118export ftp_proxy=http://127.0.0.1:8118<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>也可以把以上的3行环境变量增加到~/.bashrc的文件末尾，然后使用source ~/.bashrc使之生效。</p><p>验证是否可以科学上网</p><pre class="line-numbers language-shell"><code class="language-shell">curl www.google.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看以上是否有输出内容即代表可以科学上网啦。</p>]]></content>
      
      
      <categories>
          
          <category> Earth </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 百度网盘 </tag>
            
            <tag> 自建网盘 </tag>
            
            <tag> cloudreve </tag>
            
            <tag> NAS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1秒钟给小学生批改作业的人工智能小程序</title>
      <link href="2021/01/1-miao-zhong-gei-xiao-xue-sheng-pi-gai-zuo-ye-de-ren-gong-zhi-neng-xiao-cheng-xu/"/>
      <url>2021/01/1-miao-zhong-gei-xiao-xue-sheng-pi-gai-zuo-ye-de-ren-gong-zhi-neng-xiao-cheng-xu/</url>
      
        <content type="html"><![CDATA[<h2 id="题拍拍小程序简介"><a href="#题拍拍小程序简介" class="headerlink" title="题拍拍小程序简介"></a>题拍拍小程序简介</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>咱们的家长们都很关心小朋友们的健康成长，快乐学习。</p><p>学校也为了小朋友们的成长煞费苦心，也会精心安排一些练习和作业验证学生们的学习成果，甚至要求作业要日清，周清，月清。这里可能包含家庭作业、课堂作业、午间作业等等。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201027759.png" alt="image-20210124201027759"></p><p>这些作业还不是一门，可能包含语文、数学、英语等等。这么多的作业对于很多家庭早已失去了主动学习、积极探索知识的本质，变成了一种<strong>负担</strong>。</p><p><strong>负担</strong>很容易变成一种应付，从而打击了学生最重要的一点：<strong>兴趣</strong></p><p>很多时候，作业的负担也承担在了家长的身上，想想自己繁重的工作还没有做完，房贷的压力、身体的透支、老人的照顾等等，小朋友们也失去了家长最重要的一点：<strong>关心</strong></p><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>要想解决以上的问题是一个复杂的问题，我们可以通过很多工具和方法来减缓这种繁重的作业。</p><p>比如家长教孩子作业，本来期望是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122104843824.png" alt="image-20210122104843824"></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122104915960.png" alt="image-20210122104915960"></p><p>而实际情况可能是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122104408686.png" alt="image-20210122104408686"></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122104609303.png" alt="image-20210122104609303"></p><p>我们的理想可能是这样的：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122105017631.png"></p><p><strong>为了缓解学生作业的压力，我们把重点放在了通过人工智能来完成作业的自动批改上，把之前需要家长完成的作业批改，使用人工智能自动批改，家里没有大人的孩子也可以通过自动批改的功能来自我验证，节省了家长和小朋友的很多时间和精力。</strong></p><h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><p>题拍拍的应用方案采用了小程序，打开就可以使用，非常方便。</p><p><strong>题拍拍的技术方案采用了科大讯飞的基于深度学习的拍照速算的能力，针对K12教育范围内15种题型的识别和判分，通过注册为开发者，通过HTTP接口调用，就可以比较容易的完成拍照速算的功能。</strong>以下是支持的速算题型。</p><table><thead><tr><th>No.</th><th>题型名称</th><th>题型示例</th></tr></thead><tbody><tr><td>1</td><td>四则混合运算</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAlAXsBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1ToooooooooooooooooooooooooooooooooooooooooooooooorkfFXjEeH9V0HSra2F9qOq3OxIC+3ZCuGlmb/c/rXXVy/ir4gaH4MudKttUuxDc6pcpa2kKLud5Gqv4m+ImleGNattImgv7vVLmF7qO20+ze5kManYX+StXw54kj8RQTSxWOoWPltt2ajaPbu3039a26KzPEHiDT/Cmj3Oq6rdR2Wn2y75Z5OgFczpvxY0S81fT9Nli1HTLm/wD+PT+0bN4VuOOiM3Worr4u6HC+o+RBqWo22nSPDd3ljYvNBE6ffBf/AGO9ddpWrWeuabbX9hcpdWVwnmwzx/cdKwo/Giw+O38NXtr9mae3+0WN1uylztP7xP8AeSutopn3K4Gz+L+j6pCtzY6Zrt9bu7Il1a6RO8b4fZw2yu8jfcit83zf3qlrnPFfjTS/BkNq2ozSb7uXyLa1ghaaa4f+4iIOtVND+Imj+IL+9sMXVhqdnF58tlqNu0M3lf39n8S1m6X8Y9H1y1gu9N0zxBfWsw/dXMOkTmN/+BbK71DuSn0UUVHJIsMbO3CLXB6b8XtK1m3hudP0vxBd2c/+quYdInMbj+/u2VpeIviNpXh/V4dHdLy+1WSLzjZ6fbvPIkWcb32j5RV/wv4s07xho8OpaXOZ7dmZDlSro6/fR1/hfrW/RWD4i8TxeG44Xk0/Ur3zTj/iX2T3Gz/f2VkaH8UdH17X/wCxVh1Kx1D7N9s8nULJ4P3WfvfPWf8A8Lo8NeSlxi+OjvP5K6v9if7Fu37P9d0+/wDxdK9Foori9W+KOj6Xq1zpccWoapfWiq11Hpdo9z9nz037Olb/AId8Sad4q0iDU9KuVu7KYfJIlatFFcr4Z+IGg+MNY1nTdJvlu7rSXWO78sEoj+m/+KsSb41eG4I5pz9tfSreXyZtXitHezRu/wC+H1+90rv45EuI0dG3o3zKy1NRXlmuRtZftB+G7u5QtbXWiXNnbN/CswkR3/8AHBXoOs3Fza6XdTWVt9uvEiZ4rXzNnmtj7u7tXzl4uh13S9HstU1nwtfzeI7zV9PkubxpYdmVnTZbQ/P8if8A167HxUui3XxSsb/WfEGreEr+bSPLSHeltC6+Zv2faf7/APsVr/BzXr/Uta8WWMeqz+IvDVjcxR6brE/ztJ8n76Ev/Hsf+P3rtvEd14htFgGhadZX+7/W/brx4dv5I9VdBvvFlxfbNZ0jTbCz8vPm2l+87l/Tb5aU34hazpfh3w1NqGs6c2paZBMjzIkIm2fOP3u3/Yry/wAUaxZ6x8UvBN3Y+IrfxnA995kOjwBD9hTZ/wAfW9P7n+3/AH657w3PDdeH/FUn/Cew+AzLf3XnaB8mbN9/+38/7z7/AMn9/wCSvYPgzcfbPhb4am/stdHQ2iFbFNwSNP8Agf8A31WP8Qo5NQ+MPw4t7Uj7RZveXlxt/gt/J2f+h4ruvFU1rB4b1F767k02zSF/OuoX2PEv95TXjWieJPFV1qWjReL7jUNK8LtL/wAS7UI4fJnv3/g+2bP9T/ufx17xen/Q5vlZ/kb5U+8fpXzfHe6N4b+Fkdz4e+IeqSa1Zxf6DpskyLI8w6Wz2eP+AYrvPEXiXxVbvp7Kmu2k81pDNcQ6VoqXkKS7PnTe7+tb/wANtY1bVDff2pJrMnl7dn9q6Wln/wB8bPv1a8beK9F8K6hov9sIlubh5obbVrhEENnLs/jf+DfXmWgzC8+KWuqNXbxsX0J0k1u1VN+m8/8AHsiR/Jlx8/8AfrDfUNM8L/Cuyu/Cfj/UrrXbOJE07SnmTzJn7Wz2dfSGmTTXFhbS3cXkXLxK0sf91scj86u0UUVla+N2h6gf33/Hu/8AqU3yfcP3F/velfPcmp6T4c+GOnXfhf4gajfa5ZwrDp2mvOmbl88Wz2f/AI57V2mheI7Lwb8UvE58UT2+kXWsW9nc2k1y4RGRI9jwq/8AsP8Azq98E42vbzxtrlvzomsa291p8h6SpsjR5E/2HdK7PxJdeJLOSAaHpthfIy/vXvrx4Nn5I9M8P3fiq7vHXWtM02wtdnyvaXrzuX/FErZ1LU7fR9Pub68lWC1t0eWWRuiovU15j8NdPTV9D8Q+N/EkH2eTxEjyPBcf8u+mqmI0P/AMv/wOuMHjbw58TtDttHg13Q/Cnw/XZCts16iXt/Cj/Imz/ljC4/4HX0Wv3Pl6fw15N4i1vxQvi7Q0ntdNtdQd5hY2MeuTIl3+7+fenk7X2V6Zo819NpsEmpwxWl5s/ewwvvRT/vV4m2sR+BviD4vXSvEWj6Z9slW8vrTxKrwuj7P9dbP/AMtkrqf2ftNuLHwbfXM8lw8Woarc3ltJdQ+S7wu/yPs/g3jmrHxC1zXtN1aGHTJNeSHyuul6Il4h+ru/WrPw41jW9Um1FdTk1h1jVdn9q6Qln/3wUf56Z8Uz4lvksNK0bTbibSrveNRurGdEuUj/AOeab/7/APfrjvhnqDWnxU8V2Q8LXGj6WlhZQsjywmO3REf7+HrGm8deHPHmhy+GtH1vRfCngRWeymuJryNLq6j3/OsKE/Ij/wB9vWvoLS47W3061is9gtEiRYdnTZjC1eorG1zw7p/iSO0jv4fO+x3Md3E27ayTJ9x62ahmhSf5ZUV0+9hlzUOoabZ6tB5F7axXUP8AcmQOv60+3t4bOFIYIlhhQfIiJsVas0Uz79UbHQ9P0t5Hs7C3tHk++9vEqbvypl14f02+uEubnTrWe5UcTTwIz/nWpWPa+HNOsdevdYitwNSvI0hmnLclU+4tatH36fWd/Yum/bvt/wBhtftmP+PryV8z/vrGa0aKq3VrDfQtDPEk0Lj5kkTerU3T9NtNKt/Js7aK1hH8EKBF/Sol0XTVvjfrY2qXjDm6EK+Z/wB9YzWjRRRRRWcmiaal81+ljareMObpYV8z/vrFSahpNnqkapeWkF1Gv8M0Qf8AnViOJY41VF2Kv8K1LRUM1vHdRNFKiyRt95GXg0fZ0aLydq+Tt27Kzf8AhFdF/wCgRp//AIDJWxTKfWfe6PYao0b3djb3Tx/ce4iV9taFFFFV1tYRI7eUm9/vts+9Wf8A8Irorf8AMI0//wABk/wrTjjWONURdir/AA1LRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRX//Z" alt="示例图片"></td></tr><tr><td>2</td><td>带题标号的四则混合运算</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAXAXYBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1I1DUbbSrR7m7mWCBPvO/SuYuvHRhkto5LEWpu38m0jvrtLea5f0RK09F8TRalcyWdxby6fqEY3fZ7g/fXP30b+Na1b6+g02zmu7qVYLeFd7yP0Va4vTvjd4F1W8t7a18SWlxPcvshSMvl/wBK76iiuK1r4weDfDuqT6dqXiG0tL2H/W28m7ev6V0uh63Y+JNMg1HTblLuynG6KaM8MK0KKyPEPijSvCenfbtYvodOtd2zzJ2wNx7VW8M+NNE8YRzto+owXxt22TJG3zxn0Za6CiisXR/FOkeIJr+HTdRtr57CTyLkQvv8l/7jVjWPxW8I6prC6Xa+IbGe8d/JSOJ8h3/uo/3X/Cuzoooorn9W8Uw6Tci2ihmvbzZvaCIf6pP77uflRa5vSPi5pmuXLxWD2+pGHJnTTrxLl0T+/s+86f7gNdzYahb6tZw3drKs1rKu9JE71h+KviP4b8FTWsOuavb6bNcruhSc430aB498O+KNPvL7TNXt7qytD/pEw+RIeN3z7unFV/DvxR8KeLNT+waPrtpe3ezzEhjk5dP76f3hXX0UyuAn+O/gG1lkSXxRYo8Pyv8Ae+X9K2r74ieG9L0Oz1m51i0h0y7/AOPefzOJv9z+9Vjwx4w0XxfZvc6LqNvqUUTeW5gfOx/Rl/hroKKqXd5Bp9tLc3UyQW0S73mdtiKtc54e+J3hfxRfmy0vWrS7umTzEhRtrOnqufvfhXXUUVma5run+GdLn1LVruGw0+2TfNdTvsRBUWqeKtJ0bRRq+oX9vZ6ZsSQXU77Uw33efeqXhfx94f8AF7TR6RqlvfT2/E0MZ2un1SulrlfFXkf254d+2bPs32h/vfd87Z+7/rXF/F3wzpdt4m8Fa2tnD/ak3iSyge7b7+z5/krr/HHkeboe3P8AaX26P7Hs+938z/gOzNHxUtobv4ceILea/h0mGazdWvrpf3cPH339q8/8Sap4m+Ffh/Q9V/4SO11yy862s/7IjsURJUfZH+5dPn+T79e2V4FefFPX9N1K50BdRtLnT1uPs0njmSEfZrPd/wAsXT7nnc/f+50317rYp5dnAhla6Kov75+r/wC1Xknh/wAM6xc6t40utE8dWVpHNqs0zrDYRzPC+xPkm3/3K6/4T+Lrvxx4HstUv4YVuy80Lva/6mbZI6eYn+w2zNaOt+JtR0u8ENv4b1DVYSu7z7V4Qn0+dxVnQdcvtXedbnQr7R9n3Hu2hO//AL4d64b4rabc/wDCX+DNas5rK5v7GadItFvrkQfbN6YPksf+WqVj6Lc61qXx8tbuewttICaK0d/Y283nSJ+8/c+e6fJ/z02JXo3jvxFN4Z0dbuK5s7RvNVPMvklePn/c5rjdB+KF3qmu2Fo+seH547qVU8u3trsO/wDuF/lr03UtNttY0+exvIhPbTJsljk6MtfP/iKxPhvR/jlbeH7SO0+zw2flQWqbNqfZU3/+OVP4sa/8L+B/D+sXF1o+t+H/ALRZpD4djsU8lN8iBPs0v396dq+hqKKKK8w1K28OXvgXxVD4mufstitzM+qP5ux9m/5N5/3NlY2j6e3xH8YeGdcSzg8OaJooebTYA6JeXYdNnzon3Iv9jvXc+DfK/tPxH9j/AOPH7d8m37m/Ynnbf+B1zXiTRbzVvi2kumeJ7TSr2PR/I+zfZhNcbHm3703/ACfwVwnjTxJrN14V8c+GtWu4tZh0a6sDearBF5XnWzunnI6J/Giff/2K674yfZ/J+H39keV/aH9u2f2H7Njd5HPnbP8AY8uvW53McbuqNIyr9xf4q5L/AITbWP8AoStZ/wC/1r/8erqbO5e6tYZZIWt3ZNzQv99a83+MmpTat/ZXgTTHdNQ8Ru8c00f/AC7Waf65/wCSf8Dp/ipfCvgXVvD97/Z817rtvbNYaNpll8zsmP4E+4nQfOcVa+HXhHVrHXvEHibXkt7XU9ZECHTrZt8cCQg7A7/xv83366vXtXvdJhhe10e71R3PzJaNH8v/AH26Vy3w98QapdW6QXlvqOpK00h/tac2flr85/d4hf8Ag+5+FN+OWhxa98NNUtbjVLfSYt8UhuL19kHyyJ8j/wCw2MfjXBePtT8Ra3ceBorrQrHw/fRa5bPaGG7S5kmT+Pydn3E2ff8Aavdr6f7LYzy70TYjPvf7g+teR/8AC477/oOeGf8AwHvf/iK9a0m6N9p9rcMySNLErl4vuHvxXzr8SPFS+LtH8U3HiHSdatLGwtrqHTNLk0qd4d+x0+1TPs2f7n9yu1g17wpe/D3wdr2uw33laW8P2C0e2dHuLnZsTZD/AB/7FanhPw7rPiDx7/wmmu2sei+VZvYWOlo++by3ffvmf+9/sfwV6fVS+0+31Wze3uoVnt5R86P0rnm8FmRY4hqclwltN50H2yFJ5IX/ANl3q/pPh2HT7iS8kllvr98p9quWywXrsT+6ue1as0EV5FJBMqzRMu143XKtXMaP8LfCeg6jBfWGh2cF1F/qHEf+q/3P7v4V1n36z10PTrfSf7NjsLePTdmz7KkKiLb6bat21rFZW8cMMaxQxrsRU4CrXMa38L/C/iTUJL3UNEtbq5l+Sd9u3zR/t4+9+NdJZ2sGn28NraRJDbxLsSGNdqqv0q3RWN4h8M6T4tsRaatYw39rv3LHMmdrjPzVH4Z8J6P4Vimg0mwgsRK3mTeWmHdvV26tW7RRWZb6JY2l5e3MVtEtzf7TcybOZ9q7Ru/CsLTPhd4S0fUINRtNCsoLiJhJBIkeBE3qi9F/CuwoooorlfE3gPSvF4kW9i3SMu2Reqyp/ckT7rj61g2nwT0G1voJ4oba0lhfejWNoltJ/wB9pXf2NjDptrHbW0SwwRLtRF6CsfxH4I0PxcYTq2mQX0tt/qnkHzx/7rdqk0fwjo+g6XJpen6fb2tg27fbRp8jb/vb/wC9n3qhoHw38M+F9RF7pOi2lldFNiSxx8qn91P7o+ldZRRWcug6eurvqv2OH+0nh8hrrb85jznbn0rI8RfDnwz4xvIL3WNHtb+5hj8qKaVMsqHnb9Kn8M+BNC8GSXTaNpsNgbkr5vlj72K6Gs3SdDsNCszaabZwWVtuZzDAuxNzHLHAqa+sbbUrWazu4Y57aVNkkMy7kdfcVheH/hv4b8L3hvNJ0i3tLgx+WJkX5lT+4n90fSupooqnqGn22q2s1ndwpcW06bJYZOVZaxfEHgPw54osrO01TSLa+trE/wCjJIn+p42fL+AqLQfhz4Y8Lah9u0nSLexutmzzIi33a6uv/9k=" alt="示例图片"></td></tr><tr><td>3</td><td>已知结果求运算因子</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAmAXgBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1Tooooooooooooooooooooooooooooooooooooooooooooooorn4PFdhceKJ/D8fnPqENutxNtj+SJW4Xc397iugqj/aln/aX2H7TD9u2eb9m8z59mfvbevWqWqeMdD0O6hs9R1ixsbub7kN1cJG7fgTUmteJtK8O2yTarqNrp0DtsR7qZUV/xNQaH4x0LxJJJBpGtWGpzIu547S5STb/3zS+KPE9p4R0WbVdR877HCy+a8Kbtg/v/AO7WxHIk8aujb0b7rLUtFUNW1az0Gxe8v7uCytYx88077EWodE8SaX4mtmuNK1G11G3Vtpe1lWRfzFV7XxjoV9rEmk2+tafPqSD5rWO6Rph/wCptb8T6P4ZhSbV9UtdORztV7qZU3/nV21uob+3S4t5UnhlXckkbbkYe1WqKjd1jTe3yKtUI9d06fTP7Siv7d9P2b/tSTJ5P/fdR6J4n0fxNC82kapa6iiHaz2syvs/Ksu8+JnhOwuJra58TaPbzRNskjlvkR1b0xmuit7iK8t0mgZZoXTejofkarNFFUtTujY6fc3CpveGJnCevGa808A6x498e+ENL8QrrGiWCahB532Qaa77P+B+fXQf2V4+X/mZNE/8ABU//AMepP7I8ff8AQy6J/wCCh/8A4/Qul+Pm+74k0T/wVP8A/HqX+y/H3/QyaJ/4Kn/+PUn9kePv+hl0T/wUP/8AH6q/D3xZrWseI/Fmi629rPLoc0MaXVlC0Il3x78lC716HRVLUNSttJs5ru9uI7a1hG55pm2Iv41U0XxVo/ieF5dI1S11KNOGe1mV9v5VWuPHHh+11f8AsqXXdPh1Lds+yvcoJP8AvjNdDRRWXrHiDTfDlmbnVb63061+7511KsafmaZD4k0q60karFqNq+mBN/21JkMH/fdZ1h8SvCmq3kVnZ+I9Lu7qb5Uhgu0d3/AGr2t+L9E8M+T/AGtq9lpvm8J9ruEj3/nWnBPHdQpNE6yRMNySI3ytU9eVfBKR7i88fXl2cag3iGaOYP8AwoiII/8Axyt74nfECL4d6Cl4YPPubmYW1sjnEe9+jO/8CV5J4L17w1pfxs0u4bxDDrGr6lpEqXeosj/vrh549kaf3E/uJXR/CPw/pPizSfGl5r9pBqWoXWt3ltfvfIHdEQ7Ej5+4ipxXIeEfD+teNvCfwxkim0u8/s578JFrT798P3IXCf8ALbYlejeB7688PfECXwnqunaKLyWw/tCG/wBGthb708zYyOnrmvRdft4LrQtQhugv2RreRJd/93Yc1xH7Pt1PefB3wtPdO8kptvLSST77oruE/wDHAK39X8eW+i6lJZto2t3Tp/y2tNOeWNv+BitDw/4ii8SW8sqWOoWJRthjvrZ4X/Wsbxdonh/xBr2jw6kbe51azE1zp2n3U2Emk2/f8s/f2/8Ajua8Y1aXUvD/AIm+Is1xYwaB4im8LyT2dlpL74ZYU8z987/J++38VtfETwzoHhz9n+z1HRbeC1udPhs7rTb6BB53nb0+ff8A7f8AWt7wzptp4i+NPjJ9bt47q+0+zs4bOC5QOkULpvfYh/26s/BGGDTdY8faZYY/sfT9bdLSFPuRb40d0T/gZNdH438Z3vhS4tIrZNHlWZdz/wBp6qtm3/AAUO+ovBnjm/8AFGoT2t1Fosaqm/Om6wt4/wD3wErb8WeF9O8XaWLXUo3ntVbzTAszokns+z7y184+EY47r4X/AAg0W4Rf7DvtcmhvIQPkl2PO6I/+xvFeqa9plj4b+M3gyfSbe3srrULa8gvo7ZRHvtkj3xuy/wCy/wDOuV8O+BfEWj+D7nVUtvBt8Ulub1457c3P2zMjv/x8fwf+P17H4D8R2/i7wbo2sWtt9ltr60SZIf7mR92uioorN17/AJAOqf8AXvJ/6BXF/s7/APJFPCH/AF4JWV4+0HQrDxBc+I/GurfbNHeFLbTtHO/CPj59iIcyu/FcLqFrrmi/CWSO8kvbSG+8Qo2l6A8z/bZrPeP9C3/fR3+f/crU0PZo/wAVvDCW+hX3gG2uYpkeK6mDpqj7Pkh2I7pvT7++szTbXS5bXXbTxpa6xJ49mubponjSbe6b/wBz9mdPkRNmyvV/gn4hv/Ffwr8N6rqr79Rmth50n99wdu+sv4c/8lY+KP8A182H/og11WveNofD98LaTStYvG2bvMsbF5k/76qbw54rh8SNOsWnapYmH/oI2bwb/wDc31m+N9B8O69faHZ67NG9wtz59jZTTbUuZkXjen8eK85063n0v48Qy61YWvh1p9ImjtI9LbfBeRo+93mfCbHT+D6mq/xC8JWNr8HrtPB2k6TrGh3NpNdXOry3XmXOzBd5kf8Ajb/gfavZPB9zb3PhTRprWeS6tXtIXinm/wBY67Bhm/CuL1b4papp2qXdrFD4Z2QvsTz/ABCiP/wNNnyV2Xg3Wp/EGhx3twLITMzf8g+7FzD/AN9gVyXxCt/C2i+JtO8Ra7Jc6jqPltZ6dpMa+dvdz9+GH+/231wOsfDvWbn4eePpJrXTvDk/ie4gNrpM1ykUFuqOv33+7vfH8PqK3L6PVfhtqvh+81PR/C93pt9fQ6eP7NsfIubSR/uMj/x9PRKx/Cum+IvGXinx7dQ2eiteW+sPZfaNat3ucwonyQov8Cc5/wCB13/wP1CyvPAohstOXSVs7u5s5rSOZpokmR/m2P8A3M5r0euW0/wfHpHjPU9dtLh449ThQXFjs+R5l/5bf72zC/hXTVkt4b06TxJDrTwA6nDbvbJN6Ru4cj81rC1b4T+HtXvry8mgubeS+5vo7K7mgS7/AOuqI431a1r4b+HdWsdMtWsPsi6Z/wAeElk7QPaf7jp9ypfDvgTSfDF9c6haJPNql0iRzXt5M880iL0Xe56VY8Y6BL4r8PXmlR38um/a02NPCuXCdGUfhWjpum2+i2FvY2cKw2tuixRRp/Co4q9RXOeKvBOk+LzZSahC/wBps38y2uoJnhmhb1R15qDw/wDD7RvDt1fXMcMl3fXyeVcXl/K1zNLH/wA8y7k/L/s1m6f8HfDOn3FnJBZ3DQWcvnWlnNeTPa2z/wB5Id+z9K0/EHw+0jxFqMOpSx3FpqkKeUl9Y3D202z+5vTB21e8N+GdO8J6bHp+lWsdrbK28og5Zz953b+Jj/Srt3pNnqRVrq0guWX7pniV8Ulro9jYtvtrK3t3/vwQolW5FDoV/vVyS/DHw1D4Oj8MJpirokbb1t/MbKPvL71f727fz1qfw78PdI8N6lNqUUdxd6nNEIXvr65e4m2ddm9+dtZM/wAGPDMi3EPkXkVhcu8s2mQ38yWszv8AfzDv2V21paQ2FrHbwRJBBEmxI04VVq1RRWbr3/IB1T/r3k/9ArzD4D+NNAsfg/4Vt7nXdNgnSyG9J7yNHXk+9VfEug6HrPjl/FVn8TodJvfsyW0UaTWcyQp/sb/u76tXWk+Hda0GC01n4jw6nqFtd/bLLVvtdtDPbv8A7Gz5f0otdO8PXPiDTNX1/wCI1r4hn0t99lC9zbQwxPjbv2J956q3Hh3QP+Jha2fxOax0O/mae501L62fG/76JM/zoj13ek+KvBuh6XbabYa7o9tZ20SxQwJfRfInb+OuW+FGpW+rfEz4m3NlcxXVs9zZbJoX3p/qK9ZornvFPhDSvGFnDFqtobg28omtpo3aOSKT++jp8yGqeg/DvSPDuqSaokdxfao8Xk/btRuHuZ/L67N7/dWsp/gv4WaGWzNrdLpUx3vpCXkyWTn/AK47tmP9mu7t7dLWFIYVWOFF2qij7tU5NA0uZ3eXTbV3b7zvChzVq0tIbOHyreJIYh0SNNtctrnwv0DxJ4gh126S8i1eGE26XVpfzQuqH+H5HqVfhxoraPfaXdLd6rp99zPBql5Ncg/Te3y/hVax+E+hWWoWl84vtQuLL/jz/tG9muUtv9xXc1NrHwz0XWNUn1JftdheXCeXczaddPbG4T/b2ferc8P+H9O8LaTb6bpVqllZW64SCMcCtSiiiiiiiiiiiiiiiiiiiiiiiiiiuak+G3hSR2d/DGjSu/3mewhJ/wDQKT/hWvhT/oVtF/8ABfD/APEUf8K18Kf9Ctov/gvh/wDiKP8AhWvhT/oVtF/8F8P/AMRR/wAK18Kf9Ctov/gvh/8AiKP+Fa+FP+hW0X/wXw//ABFaei6PpmiwvBpen22nRN83l20CxL+SgVp0UUUUUUUUUUUV/9k=" alt="示例图片"></td></tr><tr><td>4</td><td>填写“&lt;” “&gt;” “=”</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAhAWQBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1TooooooooooooooooooooooooooooooooooooooooooooqtdXH2a3llSJpnVN3lx/favNtc+N48M6bJqOqeC/E1pZo6I8jwwfxvsT/ltWtrXxOtdL1hNHs9K1LW9ZFslzNY2MSb7eJ+hd3dET8+1bPg/xnp3jXS5LzTmlQwzPbXNvOmya3mT78bp2YV0dFcp8RPGi+BfDE2oi2a7uWkS1tLVP+W0zvsRPzrobHz/scP2rZ9p2fvfL+7u71x2tfE63tdfudG03SNS1/UbREku4tNWPZb7z8gdndPmI/hzTYPilBqWi2uo6ToesayrzSWs0FnAnnWkyffSZHdMGl8MfFSDxB4sl8OS6DrGk6jDZ/bH+3QxhQm/YB8jvzmu8plPrjNe+KWi+HvFukeGpWuJ9T1F9iLbx70i95W/grs647wP4wl8SXWtafqNvHY6xpFz5M0Eb70dH+aGVf99P61o+LPFum+DdGfUdTZ/I3LGiRpvkldj8iIv8TVzMV58RtdiW5gttH8MRMPltb5ZL2fp/FsdEX9aiufHXiLwOqz+LtMtrvRh8s2saNv2W3+3NC/zbP9pN9eixyJcRq8bK6N8ystcl8Rfidonwx0yG71d5naV9kVrax75pOvRf7tTeLPHlj4Rj09Xt7m9v9QYi0sLNN80pxvf9Kh8J+PoPEuoXWlz2V7pWtW0azSWd+iBvKY43o6Eq612dFFFFFFFZHiXxHYeE9EvNW1SbyNPtE3zPt3YFcjZ/FqBbzSodU0PWPDsOqSpBZ3Wowp5csj/cT5HfY7f7eK9FriZPiloTfEK38HQvNPq0sLyvJCmYIdn8Dv8A3/8AZrsZJUijd2bYi/eZq85tfHniHxu7yeD9Nto9GU7U1rVWfy7jH/PGFPndOfvkpU0lx8R9Bha4kh0XxIij5rW0ElnN/wAB3u6V0Xg/xjYeNdJN/p7SIEkeCaCdNk1vMv343TswrWv9SttLtJry7mSC1hTfLNI3yIvrWB8P/iFpvxI0e51LS0uo7eG4e1P2uLY+9Ovy1B4s+IFn4Z1K00pbW81XWL5WeGwsUDOUX7zsWO1E+tP8J+PrPxdeX+nfZLvS9X04L9r0+9j2PGHHyOCPldSO49K7CivKNYaT4ifF200lQ/8AYfhXZe3gZPkuLxx+5T/gC/P+NUYdetPhz8X/ABjeeIZP7O0/WobKWy1GZMQsYUdHh3/3/arvwVtbq41Hxt4gaCW20/XdX+1WSzJsZ4UjRPM2/wC3g12fib/hKvOh/sBtHWDaRN/aKzb93+xspvh3/hLftTnX20drXZ8g05Zt+7/gdct8cH/s/T/DOtShnsNH122urwJ/AmSnmf8AAN9emJIJFDL92vEfHHxV0/SfG2p+HNJutN8OX22OTVdcvoum9P3exP8Als+z+/8AIldX4E1Dwp4Q+G95qWlaodT0u0ae5vNQY75Lib78jv6vSfBrQ7+PSL3xPrcIg8QeI5vttwneGH/ljD/wBK7HxD/bf2Ef2E1j9t3f8xHf5e3/AIBzXlvwgj8ax6l4k+1tpH2P/hILr7RhJt/3I/8AU9tn1r07xZJrSeHNQPh2O3l1ry/9GS6bbHv/ANqvDNa0vxD4XuvBMP8AwjKS3j68lzc3smoo73k3kv8AO/yfJX0PC7yQo0qeW7L86bvu15h4Htzqnxr8c67bOH0+G3ttLL/89Jky7/8AfG/bU3xKkFl8Qfh/fXromjQ3k8Mjt91Ll4cQfyf/AL7qt48Tx5JrUzK1w3hRR8ieGWRNQ/4H53/slaGh3XhHTfAeu3aR3cGnJDJJqi6p53m/c+ff53OcVa+ENpfaf8I/DcN3EwvI7BNkNx1HHyI3/jteS/ELRvF1h8OfFWo634ft7vWb5EjmvIL/AHpDD5ybIYU2Z212vjj4n2/gXT/DkuoaRY2/iq+V4bT7VLvhtE/jd50T5Eqx8JJtC1DXNT1NPFEPijxRcQxpcvACkNvCp+WGFP4E35Pua9cooooooorA8Za2/hvw7eaiml3Gs/ZxvaytU3yOo/uL3rxfxVrem+LPG3hjUvDes3Hi65Oowy/2DMu+2tk/jm+5+5dP9uvRvFHiPUfEmh6xZeCJoZtbtLlLS5a43xfZj1coXT532Zrzr7Drfhj4ieAbG08KJBFDDqB51Le8rvGm93fZ9+vWPipb3d78NvEkNkr/AGqSwmEap97Ow1z9xfa5qnw30C4+G0mmx2z28JQXWTth2D5I/wCHf0+/Wd4Nj0//AISayTxDD4kPidHb7NNr3zw79nz+SYf3NaPgGSO8+JXj67sDjTPPtoHeM/I94ifvvxx5a/hUXjjQ/E3iHxVbr/ZVvqvhazRJUszeLD9puM9ZgU+4n93vWJ8G9dvtJs/Hd7renLpunQ63eXM0wn84pyN67ETtXS+I/iVpFjNZxXZu9O0rVrAyW/iNF2Ro56Jkj5G/j+eud+CSn/hNfFsllNJr2iSpC0fiW7TM1xLzuhD8bkQV7XRRTGjEn3qfRRVS+sLbUrSazuoUntZU2PC65Rl9Kda2kFhbxW1vGI4Yk2IifwrU2yin0UUUUVm6PodhodobXT7SG0tt7P5cK7RuYksaNc0Ox8TaXc6bqVul1ZXCbJIZOhriovBPizQ40t9B8aMNPQbVt9csvtrpx/z23o5/4FmnR/DG41i4trjxdr8/iI28pmhso4EtrNHx/FGn3/8AgbGvRaKZRsp9FFFFFFFFRrGibtqqN1SUUV51efDG50u+ubvwjrs3hyS5YyzWYiS4s3f+/wCU/wBzp/Bikl8EeMdaU2+s+M/KsWykkOiWP2V39/Od3dP+AV2fh/w/p/hfSYdO0u2W1soRhI06Vp0VG8ayR7WG9aX7lPooooooooooooooooooooooooooooooooooooooooooooor/9k=" alt="示例图片"></td></tr><tr><td>5</td><td>填最大数、最小数</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAkAXIBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1KurqGxhaaeVIYUHzySPsVay/+E20D/oOaZ/4GJ/jR/wAJtoH/AEHNM/8AAxP8aP8AhNtA/wCg5pn/AIGJ/jWpa3UN9Cs0EqTQuPkkjferVZooooooooooooooooooooooooooooooooooooooooorzf4428V14Os7a4RJrebWNPSWOT7jp9qT5K2pPhj4LjR2fwroYVfnb/iXw/8AxFeaaPqHh3XrOC7034KtdafM+IbpLOw2Om/Zv+/Xpkfwt8G7Vb/hEtDT/uHw/wDxFcn+zfClr4E1CCJEjgi1vUESOP7qL574r1miuH8Q+MtRh8UReHNE0pb7UHtftc1xdTGC2t4y+xTv8t975/gqTwH44m8V3mu6be2H9naro1wlvcxrL5sT70Do6N9K7Ss5dYsW1P7At3B9u2b/ALL5o8zb67KuvII1LN92vNtB+MkXiX4lf8I9aaXMNLksHvLbWpHHl3OyTY+xP7n+3XptFFFFFFFFFFFFFFFFFcr428VXPhTS/tNjol7rd2yvtt7XYifKOfMdz8i+9YcHxKv9S8D+Gdb03QLi+v8AXUjMVrGxMNvvTfvml2fIi/SnaL8QtS/4T6LwlrmlW9nqM1g9/FPp90ZoWjV9nz70RlNdtqWrWWjwpNfXcNpEzbA8zhF3fjVmORZI96NvVv4lqWvNdX+MFvZ+O9I8PWGmyahDc3psLvUVm2w202zfs/23r0qs+HVrO6s5LqC6hmtk3b5o3DIu373I9KmtbqG/t0uLeVJ4ZV3JJG25GHtXG+H/ABZf+JfiR4gsYGRNE0JEtZvk+aW6f5z/AN8Js/77rpfE2rv4f0O81KOyudSkt0Lra2ib5pv9hB61xN98RvEPhm60JvEnh+0tLLV7xLJPsV4Z5raV/uB12fP/AMAr0eeN5IXWN/LdlwrY+7XG/DHxVeeJdJvoNURE1vSbx9Pv/LHyO6dHX2dCp/Gu4rz741f8ivpf/Yb03/0qjrsNYj87R72ErI++F12Q8O3y9Er5za18Kad8PYrbw7c+JrfxtZ2wg0+1nmm/tGGf+BHT7mzpv/g2V9Iab9q/s+2+1bftPlJ5u3pvx89eb/s7/wDIl6t/2H9S/wDR71tah4L8R3V9NNbeO9RtIWfckC2ds6oP7nKV0fh3S7zR9NS31DVJtYuA3/HzNEiOfwSvPPin4w8U6frFpouj6PrMenzRGe71zTLL7U6/9MYU7Of771tfCW302z0e6t9O0LWNH/fedPJrUBjnu5Xzud2/jNWPiJ4P1rxRHaf2P4gm0tIQ3nWOdsN5/sO6fOn/AACqPw10h/DNw+nTeDLfQZRHufUrGZJoZ/8Agbfvf++xWn8S/C+p+MtFj07TtUi06Bp0e8V4g/2iHvD9GrgrXwj4zs/jVod5u0xdLttFktvPtrF0hRPOT9z/AKz79e40UUUUUUUUUUUUUUUUVma9C82g6jDEm92t5ERP+AGvNPC914m8C/CnwRHH4flv1trVItWsl5vIUCfwJ/G/+xVDwB4fkT4mSap4e0DUvD/h17R01D+1I/Le7n3fJsR8uNnP+xzXp3iucx6NIh0V/EHmNt+wqsZD/wC9v+WvPvCfwz13TtcttQtrmHwZpKS+Y+h6bM9ylx/sPv8AkT/gCV6H4w0zUtY8OX9jo+pf2TqM0eyG92b/ACj615Dr3w98Y6TeeArPSzpLWWm6lv3w2sw8r9y43zfvPnr3aPf5K+bt8zb822vCde+GHiDxBq2p6vZWEOj6S82+fwu82yPWtv8AHNsOxP8A2f8Ajr2jQmLaPZsbBtKJiU/Ym2fuf9j5Dt/KuA8CxN4b+KHjfR7tAv8Aatyms2En/PaPy0R0/wCAOn/j9dv4qutXsdAvLjQrWK/1SJN8NrO+xJT/AHN3avHNS06fxR4u0XWPDPhPXPD/AIjS/Sa/1HU4CkKW3/LZPmfY+/8A2K93uLhLWF5pmWOFF3M7H7tec/BmGW9h8R+KJY2t7fX9Te7ton/591QJG/8AwMJv/GvTa5D4keGr/wAVeHY7XTHt0u4by2vF+1b/AC28mZJNp2f7lQ/bviD/ANAfw9/4Mpv/AIzSfbviD/0B/Dn/AIMp/wD4xS/bviD/ANAfw9/4Mpv/AIzUXwl8F33gbwxcWOpzW9xeXF/c3rfZd3lr5r79g38967qiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiomhSSRXZFLp91qloqNkEilW+dWoRFjTYvyKtSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUV//9k=" alt="示例图片"></td></tr><tr><td>6</td><td>约等于估算</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAbAXMBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1TooooooooooooooooooooooooooooooooooooooooooooooqrdRzSW8iwv5MzL8jsu8I1eReOtQ8e+D7fTEtPFGl6jrGpXaWdnZPo/l+c5+//AMtvuIgd60x4l8R+KvH+veG9K1Gy0SDQorbz7h7bz5rh5k3/ACpv+ROK5/8A4XVqb+HbqzSPT/8AhIbbxCnhx77cfsXmP/y3/wDsP79b0njDW/BPj3w1oGt6nZ63beIDNHDNDbi2mt5o03/c3nej/wBK9WrFsfEVjqGsajpcEjNeWHl/aFaJ127x8nzHhq2q8g+KXxU1LRYrqLwtb29y+mTw/wBp31zloYd8iL5KY+/Kd3/Ae/pXr9chq3xCi0nVjZLouuaiIh+/urHT3eGL/wCL/wCAb6Xw78QtG8XalJZ6VJc3MkKbpZPskiRxH+47Ov3vatfxFqF5pOg6he2Vi2pXsMLvFax/elf+BK811rxN4y8DyeG7rWNV03UrnVr6Gzk0O3tPLYb/AL4gfzMvs/26uWviDxV478Q+IodA1Ky0bTdGuTYJJPZ/aHuLlV+f+P5E5A9az1+LGr6t4R0WGztrWHxdqOqyaM0cwd7aGWHf50v+2mxP/HxWvZeJPEPhbx5o/hzxDf22r2utQzPZ30Ft9mkSaEb3R03n5NlenUUUUUUUUUUVj+JbrVbHQryXRLOO/wBVWPNtazvsR3/2m7V5hceNvEnhnxV4e0mfxBpXinUb65FveaLY2whmt0/5aTJ8/wBxP9v1rS8fX3ijwZoeteIZfF1jb6fbB5IbX+x97/7Cb/O+d/4KzNb8deJvD2k+DLTXtQ03QLrVI3/tHW7iH9xDPgMkMaF/v9fv/wBw1s/DPxtfeI/EWu6ZJqNn4i0uwCeTrVimxDI2d8L4+TenH3ez12niHxRpvhOxjvNVuFtLNpUh85x8qs3Td/d/+vTJvFumQ69baN9rSTU7iLzktY/mfy/77D+Far+PPF8HgXwjqWuTDelqnyRj+Nz8qJ/32RXm2g/EXV7rxBo9mPGGg6pfXM+y80kW726bM/P9mm/5aOmf+Be1e31wlx8VLG0upvP0XXoLCFtr6pJp0n2b69d+P9rZitjwr4003xnbXM2mfaJ7SFtn2mS3eOOX/cLD5qqePL7xBY2dlB4asluL28uFgkupv9VaIfvTOv8AFXLaT4u1/Q/ida+EdQvrfxHHcae9401rb+TNalOP3i7yuxz9ys7XvFPjnS/BuqeMr+/0/wANraiSeHQb2037kX7kbzb/AL74/g/v0/xL8SNSXXvDlhNfWngvTtT01Lw6hqMIfdP/AM+yb/k3oPnqvpvxmvbDwb4y1a9a11+20m4S307U7FdkGoO+AE68FHbY/wBDWjq3iLxl4AXRtV13U9P1TTby8gtr60gtPJaz835EaN9/zjfj7/rXrlFefWfg/UNS+KVx4l1fyTZ6fb/Y9Ghjfdt38zTP6P8AwfSsLx74H1PXvFUmoT+FNK8T6d9nVLU/ansb2Bv41eT+NDVW3+EmqaV4D1q3gtNFvtX1e/8At95ptzD/AKE6f8+yf3Pk430nhP4UzDxZpGqz+H7Twxp+kM80NrDdvdzXMzps3M5+6iD+CvV9W06HWNPltJ2mSGZNrNBK8b/99rXEab8LzHrV59rlvv7NhZHsZI9bvGlY/wAe9C+yvQLq3+0W0sQdodybfMj+8teMeJvgLqC+A30DQfE2p+V5qOsN08Wxz5293d/L3l/evX9Hs5LDT4YJrqa+kQY+0z7d7/8AfNc7rXww0LxDqz6lqCXk94dvlS/bJk+z/wDXHY42fhVnQPA8Wg6kb5tW1XVJ9nlAX92ZEjX2XitLxJJqsWg376LDDPq/kv8AZkuX2RmT+Dd7V5P4J8P+MdC1aHVNW8I2eseIZf3d1rl1re940P3/ACU8j5E/2ErYt9A8WeA/EPiCfw9pVlremazdG/SOe8+zPb3Lr8/8HzocD3qkvwm1fSfCeiTWVza3Hi3T9Vk1l5JiyQ3E02/zov8AYQo/b+4K1rDw34h8V+PNH8ReIrC30e10WGZLOxguPtLyzTJsd3fYPk2cV6fRRRRRRRRRRWB4w0/WL/w/cxaFfrp2r43280yb49/PyuP7tebap4R8VeOtX0KS90DTfCr2F+l5canaXnnTTbP4E2InyP8A7ddV4y8I6h4u8Y+GkmeGPwxpsn264h3fPc3Kf6lNv91D89Z/xA8I6vfeNNG8R2Nla69a2dvJbNo99NsRXY586PPyb8fJ8/rUfgnwbq8Xj/UvFF/ZW3h6zns1tI9JsZt/mvv3+dNj5d/8Fdb42sNX1HQ3stFe0imuT5Us14u9Iov422fxt9a5PwB8KpfhbqnkaNdC70G8Xfdx3nN0k399H/iT/YP3P4K6T4neC4fiN4H1Tw9cPtS8UBGH8DoQ6H/vtBXD6x4X8X+ObHRtC1PRdN0Kys7qG5m1C0u/Oz5Th/3KbPl3/wC3XstcHN8I9Dku5tQRtSt9Ymfe+owX8yTfT7/3P9itjwt4Ti8NpOy3uoX9zcMJJbnULkyu3tj7qj/cArJ+Klt4vvPD8Nt4O+zpfTTolzNLP5LpD/GY22n56yPhrpOr+F7qe2fwXa6NazBp7nUf7X+23NxN/tnZveuVt/Dfj688QPrPiTwpYeItRt53ksUbWdlraJ/AEh8v7/8AtvW3rXhPxEvxCXxYujWXiCGfT0sm0y6uAjWTqSzNCzptfdx6dPrVCP4Q6l4l0vxzHqcNr4bj1/yDZ6fZuJY7Z4slJn/g3s2z7n9wVf1XQPGnj5NG0jX9NsNL02zuYbq/u7W8857toiHVUQoNgZ+Tv9K9gooooooooooooooooooooooooooooooooooooooooooooooor//Z" alt="示例图片"></td></tr><tr><td>7</td><td>带余除数法</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAgAXUBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1ToooooooooooooooooooooooooooooooooooooooooooooorjvFvxE07wjqFlpz215qmr3iu8On6dCZZti/ecjPyrUng/4had40mv7e3iurG/sWRbux1CHyZot4ynFRa18UvD+g+MtF8L3Fw7azqkhSG3hTfswm7L/wBziuyoorg9c+KNjpeuzaRZafqWvX9tHvuodKt/OFvz8u9v7/8As+9b3hXxXp3jLSU1HS5HeFnaN1kQq8UinDI6/wAL1vUV5x8RFuNS8aeCdIF/e2djfvefaFsrh4XfZDvT5k960ZPhppsasz6vr6Kv8b63c/8AxdcnY3nw/vr6Czg8Y6tJJNJ5EMg1y82TP/cR9+x67D/hV+nf9BXxD/4O7n/4usX4D6pfap4LujqF7cX0tvqt7apNdPvcok7onzfQV6ZRXmHxx1C8tdN8MW9re3Wnrf6/Z2VzJazeS7wvv3pvrVvPh3pFjbTXE+seIEhiXe8n9t3P/wAXXGza58N7dPMk8baxDH/efV7xF/nXbR/DPS540ddW8QOjfOv/ABO7n/4usn9n/WL/AFv4Y6ddaldy310ZrmP7RO+95ESZ0T5/oK9MooormPHnjBfBHhm61RoWu50Kw21tH964mc7Ej/FjWzpsly+n2z3qLFeMi+bHGcqrVyGt/FbTtL1660ex0/U9e1CzRHvIdLt/O+z7z8u9v7/H3alh+LHhmbwXJ4p+2SJpsT+Q4eFvPSbfs8ny/vb9/Gym+Hvipp2ua9Dok+naromp3ETy29vq9n5JnRMb9nrXV6tJeR6bcvp8Uc98sbeTHM21Gf0NZHgXxhF428M2mqRJ5Ejl47iF/wDllMh2On4NXTUVz3i3xfp3gvRZtT1SVobdGVBsQs7uxwqIv8T1jaH8ULHVdch0u90/U9AvbhN1smrW/kC456I39/8A2K7qiivPdT+LWmWusX2nafpWseIJ9NbZePpdoZkt37oW7v8A7C11XhfxNp3jDRbbV9KuBdWNymUkFbFFFeZXXxw0iNr24tNM1rU9KsWdbrVrGxL2qbM7/n/j2/7Ga7/TtWtNSsbe9tp45bS4jWSGRTwykcGuO8SeNNH0vxZHpGoP/YWoXlhvtdeuERIX+f8A1CO/V/49lea+D77WNP1T4jy+GVXxzqxNt5OtyOkfnycp5JcfJiHn7tYevrq/hjxF8O1Pg3VHv21p7i4ubq7tnmvZvIf+PfX05DI8luj+V5UrL9xv4a8s1y/1/wD4TjQY7tNJg1crN9htY9WuUSZMDfvTydj9q9N0mS8n0+B7+GKC8KfvY7diyZ/2Wrxi4uk8G/ErxSdE8SaTpNxqHk3l9ZeIYHRA2zZ50L5Xf0+5W38AbS5j0fxLqks808Gr63Ne289wmzzk+RPMRP4UfZ8groPiFeata3VkNNudagRlbf8A2Xp0N0n/AAPf0qn4G1LWrrWSmoXOvTw+TwmpaVDbJ/32lT+M/wDkqfw5/wCumof+k1dD41m0q18LanNrnGjJbv8AbPv/AOpx8/3OeleTfGSGe38G6dcW0umv8P4pLN/sdimy7lTzE2eS+dn9yvdY23KprzH9nj/kSdS/7Dup/wDpU9dbJ4+8Ow22uXDavbJDor7NRct/x7N/t1Zbxdo39padpx1OAXuoQ+faQ5+eZMffWuH+PP8AqfA//Yz2X/s9ep15N44lPj/4h6Z4Kgcf2ZpuzVtbx/GM/uIP+Bv8/wD2zr1mvKv2a/8Akken/wDXzd/+j3r1WiiivLvjrG9vpvhTUn50/TfENndXnH3I/nTf/wB9ulenV5lqXjPR77VPEOhLq3/CD63bOrtfTrDG92m3/XIH++n+FeSadDLF8NNE1QQNd6Ro3jP7Zd6giP8A8TKHf/x+un++/wD45Xo/i7xDp/jT4ifD+00G6h1SazvX1C5uLNxIlvbeQ6fO4/v769kryr4CQyNpXirUlTZp+peIb26s+cZi37N//jlbnxKudVh0G/MaWMejfZH+2XU15LbzRJ/GU2Rv2p/w9uNXm0mz8+KxOk/ZE+y3UN5LNNKuPk37407Vm/G63tG8FpeXupSaMdPv4Ly31GO2+0pBMj/I7p/c/vV59rk2t+OviB4Ctm1nSNUn0+//ALQmj8P73ghhVPneZ2f+M/Ii+9e6a5JKuj3bwPMkyxOUe2j8yQH/AGE/iNeXf214q/6CHi//AMJ62r1uxdpLSFm3byi7vMXa3415fqni7R9ctdd0228Rt8PdT066lW88xYUmfn/XgP8AfR/79Xf2eXZvhZpJ/s7+zkV5Qn3v36bz+/8An5+f7/412z+JtJXxB/YjX0K6t9n+2/Zc/P5Odu/86zLf4jeGLqy0u9i1q2e21S6+x2Ugf/XTf3E/75NdNO2yF2CeZ8v3f71eE+MfGWi+L/htqDWPin/hBzbxTQ3OiOkKTb/+eLp98b/9j+/Xqvw1d5PAPh5pNL/sVzYQ50//AJ4fKPk/Ctq/sLbUoPJureK5iP8ABMgdafa2sNjCsNvEkESdEjTYtPeBJHR2RWdD8v8As1NUflpu37fnqSqN5pNlqWz7XZ290U+758Svs/Orf3KfRXmXxOuptD8XeCtc/s7UNRsrCa8W4XTbd55E3w7E+RKkf4zaZcIyP4a8UsjfeRtDm/wrjtPufh7pGow39r8PPEEd1DJvhC6DcsiN/fRPuJ+ldp/wuzTv+hc8Vf8AgkmqD4C6Zd6f4Fm+22dxYy3OqXtzHDdR7JAjzu6b17da9F+xw/vf3Uf737/y/f8ArQ1vCXRvKXen3G2fdrzX48Wd1No/hq7tbC71FdO161vbmOyh86RIU3732Vc/4XZp3/QueKv/AASTVl6b8SvDuk31/eWnhHxLb3V86TXk0ehTbpX+4N/Fan/C7NO/6FzxV/4JJqg/Z90m/wBF+FumW2oWctjdNNczfZ502SRo8zum9exwa9NooorP1jR7PX9LutO1C2S6sblPKmgk+46U7TrGLS7GG0txtghRUTc275aS90ex1TZ9ss7e72fc+0RK+z86teWipsCrs/u1XsdLs9O8z7LaxW2/73kxhN1N1LS4dX025sbpS9vcI8Miq235G4NLpem22i6dbWNjCkFnbosUMKdEUcVb+/RTZI1kjZHXerfw1Ws9Js9LRls7OC0VvvfZ4lT+VXqKKz7vRrDUpElurG3upE+488SPtq7TPs8Xm+dsXzNu3ftqP7DbqqL5EexG3INg+WrVZ02j2Et4t5LYW73KdJ3hXzP++q0a/9k=" alt="示例图片"></td></tr><tr><td>8</td><td>相邻数</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAeAKEBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1ToooooooooooooooooooorzL41avcLp2jeHLWZrefxHqUentMkmyRIeXmKf8AAEI/4HXotnZw2NrFbwpshjXYqe1eZ+Lz4ij1TVL3U/F9v4K8N22yOzcJC73B2/O7u/8A6B7VqfBnxTq/jDwPDqOrokk5nmjhvY08tLyFHwk+z+DeO3tWb8aLpvClvpHjCCWWJ9HvES4hjb5J7aZwjq30yH/CvUq5vxR460HwkhOrapBaOfuwbt0z/wC6i/Ma0NB1iPXNMgvYobiBJhuWO6iMUn/fNcR4zPiOTW7maTxJb+D/AArawoUu40ieW4l5379/CIlP+C3irU/Fnh/ULi+uodTtYL6S2stXhh8tb+FP+W23t3T/AIBVnxdb+MNa8UWel6Rc/wBiaEtu091qyJHLM778LCiP93jJ31m/CnxZrGsa54q0bUb5ddtNJuI0ttaiiRPO3Jl432fJvQ/3K9LmnS3jZ5HVI1+8zVy2n/EzQ9V15dH065k1W4x872ELzQw/78w+T9au+OfEP/CH+Dda1rb5hsLSS4VP9pUJrP8AhRo9xpHgXSzfTNc6neR/bbuZ2+/NL87/AM6veMvGVt4P02OaVGu725fybSxh/wBZczf3ErkPgv4o8SeJLjxjbeKJrZ73TNVNskdqnyQp5aPsz/F1610vxM0W513wXqMdjO1rqdun2q0mRuUmT50qz8P/ABIfGHgvRdbdAj31ok7Iv97HNdLXmvxm0W5udN0jXbGJri/8OX8epJBGm+SaPlJkT/gDmvQbO8S+tYriLdslXeu5a86v28Z6brGrwz6Ja+MdFuJfOsd8yQPbfJ/qXRk+f/fz3q78HvB+o+CvDN1b6i8P2m7v5rwWtq26G0R34hT2Sqfxe0ybxh/Y3hCG3me31S7Sa8uo1/dwW0Lh3+bs74Cfia9Kkj3ptryiw+Ddx4F1S/1TwdqMInvH8+a11yE3Id/9mf8A1qfjvr0bw/dajdaTA+rWkVjqB/1sEM3mqv8AwKuP1r/hLtL8TX7waXb+KfDl2ieVatMkM1o/RwS/Do9ZXg/wz4o8F+HfE2oW2nWUmt6nffbLbQ0n2W1vwibN4HsXpnxQ0/xtr2p6bZWGnGfwv5HmX0NnqK2s88v/ADxLnkJ/u11Xw7hvNP0s6dJ4Th8KWVv/AMe1vBdpMjf98Uz4kfDXTfido8FhqUt5AltN58L2sxQbx2dPuun+y47VB4c0vxZ4burbTJDpOq6HjYLqCH7FPD9UT5H/AOAbK3vGfh9PGXhDV9GZ/L+32klvv/u71xWT8K7y+vPAumRapbNa6nZJ9juY2XHzp8nH+zVPxF8Ln17xdB4jt/Eeq6Tew2/2ZEtPJZEQ/e2h435NYXwn+F+ueDPFHivUNQ126u7e+v8AzYEdkPnpsQeZJ8n36674lapfaT4L1E6VbtdalcJ9ltIVX/ls/wAiZ9FzV3wH4a/4Q3wfo2iGTzPsNskLP/eYf/XroqKKKKKKKKKKKKKKKKKKKKK//9k=" alt="示例图片"></td></tr><tr><td>9</td><td>分数四则运算</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAoAVQBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP0+1/W4fDulzX88VzNFCOUtIXmf/vhRXEW/x20C41jTNMlsNc0+51K4+y2xvdLmhR3/AN8ivTKKKKKxPFviqx8F+H73WdUd47GzTfI8aF3/AAWue0T4sadr+pW1jHo/iC3e4PyyXOlTQon++54Fd5RRRRRRRRRRRRRRRRRRVW4u4bO2kmndIYIk3u78Kq1wth8aPDmpXlrEBfW9reS+Ra6hc2jpa3L/AMISbpXolFFFc14s8b6X4MhtW1B5pJrl/LtrW1heae4f0REqPwl480rxm15DZPPBfWfFxY3sDwzw5+7vRq6miiivOtS+Nnh7T7q9QLqF1bWT+Td6jZWTzWts4+9vcD+HvXd2d5BqVnDc2syT20q70kTlWWrVFeUeG5h8RvihqXiASLNoPhvfpmm/3HvP+Xmb/gH+r/77r1eivPtQ+JjXmtXGleG9Gu/E91aOUuZoHSC2t3/uPM5+/wD7main+KF54dkU+K/DF3oNm3yjUIJkurVP990w6f8AfFegxyLJGro29W/irgfjbYWN98Or6DUtUfRrJpYN98tv53lfvk/g/u1yl7ql34X8aeFU0Txdd+J31i98i8026mS5Tydm95k2f6nZXt1FFFFFFFFFFFFFFFFFFc7480i017wXrWnX7yw2V1ZyxyvCPnRNhzXgni7UtW8QfCKw0OHXtDvorwW1rYz6UJHub3Y6bP3L/wCq+5vf02V9K26tHborn51X5ql+5WJb+MtEutBn1qHVLWTSYd5kut37tdn3+a1LK8g1K0hubeQSQzJvR/7y1wHxK8WeHvB2saHeXFhDqPi2USwaRbmRI5Pm/wBZ87HaiYxveovhroPmeIdX8Talq1hqHiLUoY4podLl3QWsK/cRP73++a9JlmSBN8jqiD+JjUP9pWjf8vER/wCBirdFeG+LfEWl+Ivhxq7eHPEtt4StrVbmG+066tER9+fnR0++m7/Y/v16P8MZUn+Hnhp4tNbRozYQ7LCQ5eFdgwldXWH4sWaTw/eeRrX/AAjzqm/+0fLRxCvr8/y143oOtTajdwadYfE/UbH7Y/8Aocj+G4baG4b/AKYu8Ox694t43jtkSV/OdU+Z/wC9VTXPtH9i6h9hx9q+zSeT/wBdNny1494XvLHTfhV4U1HR/F0fhWOG32TQ3yI8Nxc/8tkdH+ffv3/crZ8I/ES78Wafr8PifQfs/h+2t3L63h0srtMHfsSX5/Wt34HrcJ8KfDgn83/j2/def9/yd7+Tn/tnsq98SDJD4dkuB4mXwra2/wA893JbRTI6f3Cr15l4At4ZNfht9L8a3Fjczfvvstx4Yh097xP49jvAm/8A4BXvtFFFFFFFFFFFFFFFFFFeTfErxLJp3iKK1tvGuoaVN5G+TS9K0dNQkRP+ez/u3dBXO2mjRafob+LrX4k29vZuPn1CDQrNHd/7n3N+7/YrtPhf4zs9YW60ybxJd6zqyfvtmpab9gnEPYhNib1/269HrwfVPg/4h1jXpvFzx2NrfJcecnhjdvsrnZ9ySZ/+e3+3XttmzzWcTyxfZ5mRd8O7ds/2a8v+MFrbR3FldX/iZdOR08m308aLDqE0z/7CPG7/AJVD8H7W3m1a+ey8Tm9aNNl3pkmhQ6bOpP3HfaiPXf8AjLQX8S+H5rFILC4eRl+TUoWkg4/2K4HT/g9cWOoWtz/Y/g6LyZVkMkGmy7xj+589ewV518UvFVnokOn2Z8ZR+FdRuLmONPKt0uJpt/yKux8/99e1cJ4y0WPw9rlsdX8cy3euyp5sa2/ha2urnZ/f+SB32V6B8OGu9Tsv7UHjV/F2nXSbIt1pDB5Lfxn5Ezu/2Hr0CuN+LWjWWvfDfxDYahetptnNZuJbtU3mEf39vevIviFf674h8G+FNNe60Xz5tRsHs5NHneZrt0cPvRNnyJs+/wDjX0fRXm2rfBrSb7xOfEelTy6HrIADTQxpNC5/v+S6lN/+2vNWJPha+uXUT+J9evfEVrC25NPdEhtWb/bRPv8A/A813yRiNQq/drz742WVrffD+6a51KHSo7W4guUu7pN8COkiOm9e68Vwvja817xR40+HFrcf2RBcQar9sMGmXL3TGFUcPNv2JsSvfqKKKKKKKKKKKKKKKKKK8j1vxTp/h7xvrWm+E7G0uvGF8kM2qXV3cFLe2TZsheY/+yJXLa94TtPAXh/wK818mp6bF4n/ALQ1e+/5ZedMH+f/AGE8x0rq/ElxZ6p8cvAsenOs17aW15NeSQPv8u2eP5N3++9etUUVxPiXWvD9j4t0i0vDDa+ILi3m/s2+uYvlXs6I5/j77K4v4Z+dF8Y/FsWp3dvrWr/YbV31SyTYiQ5fZA6f3/469qooryL9oLS7CDwzbaitrbpfTapp8L3JT946eenyb6m8OXlvo/xs8cRanLFBdXlvZz2LzOE32yRlH2/7j7/zo+CsgvL7x3fWsm7RrzXpZLF0+4/yIkjp/wADBr1emNh/lasTSfBPh/QbuS707RbCxupPvzW9uiP+YFb1FFFFVbi3ivIXhuI1mhddrxum5GrO0PwfoXhl5n0jSLPTXm++9rCqbvyrboooooooooooooooooormtS+H3hnWr57u+8P6Zd3Mo+eaezR5G/4Hirtj4Y0jTdLfTbbS7S309x81rFAiwt/wCjRfCuj+GY5E0jS7XTVk5f7LCqbvyrYoorM1vw/pviOzNnqljb6han/AJY3MQdf1pNH8P6Z4dtfs2lWFvp0P3vLtYlQVqUUVRvtOttUiEN3bxXMKsr7Jk3jdVXWvCuj+Jo401fS7XUlj5T7VCr7fzq9Z2kNhbpb2sSQQRLsSFF2otWq/9k=" alt="示例图片"></td></tr><tr><td>10</td><td>单位换算</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAAZAXABAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1TrnrXx54cvtTOnW2u6fPe7tn2eO4Qvu9MVB4o+IeieDZYYdYuZbeSZdyeXbTTZ/74Q1if8L68Gf8AQRuv/Bbc/wDxuuxm1iwtdL/tC4u4ray2bzPO+xdvvuqtoni/RPExk/srVbTUni++lvMr7fyrH8V/FDw34L1iw0rVLx47285SOGNn8pP777fuLV7w78QvDniy+urPSdVgvru2TfNDGfnRa6WiiufvPF2n2/ii10BjK+oXFu9yERPkiRf4nb+H0roK56x8deG9Q1H+zrXXdPuL4fL5EVyjv+Wa3q56x8feGdU1L+zrXXtPuL37vkR3KO7V0L1h+GvFlj4s0j+0LMSxwRu8UyTpseF0++jr61zj/HfwbG+w6lcZ/wCwbc//ABFa/hf4laB4yuprbSrqa4nhXe6yWc0P/oaCurooooooooqrd3UNjbvc3UqwQxJueR22oorM0XxhoPiV3TStXstSdPvpbzI7Vlw/Fbwpca5/YsWt276r9o+y+R82fO/ufWtbXvFOn+GbBLy+m8uFp47YbBu+d32J+tbH36fRXPa34otNA1DSbG48yS91SYw28MS734G53/3EFb27b1rmP+FoeEN+z/hJtJ3/AHf+PxP8a6bzE8vfu+X+9VGx1qw1Sx+3WV3b3dnhv9Jt5VeP5T/eqnpHjXw/r11JbabrVjfXUf3obe4R3/LNat1P9lt5ZQjSbE3bI/vtWZ4X8T2Xi7QrXWNOd3tblN6702Ov+yyZ4aqsfjbS5n11IZXun0Rf9MWGJ32fJv2D++2K1dD1iz8RaRZ6lp8yz2V3Es0Mi/xKeag8Q6VHrmhX9hNcTWUNxC0L3Fu+yRFI6q3avHLrQ7T4iaTo3hjwdpf2fw3pV3bO3iGSLy0/cv8A8u38Tv8AIPn+5XY/FHVfEvhLRdU16y1rT7Sys4fMS1msd7u/9zfv/jfFZX9rePv+Et0jQ5dd0lJL7TpLx5P7Kf5HQp8n+v8A9ut3VdJ0nWLXQ7PxZqVhqd2l+JbRUHkwzXKElU8ve24r/drjILe+j+PGiyeIoYNPu59OuLXTG0V96TrgF/Pd8N8n8GK83f7B4P8AEHxJS01iaO6hvH2XV14keG6d/I/ufx/PVXwzriaHpvhG40fUvI1TVdSs3v3g8Q/anud/398P+dlfY9eL3Xxq1GC4mj+0+CAI3dMP4hff/wCiK9K8Ia1L4h8OWOoSyWMkkyZL6dcefB/wB/4q4r4dhpvi18THuwBeJPZxRf8AXt5OU/XfXdeKNFh8QeHdQ064upbGG5haJ7iB9jop4yG7V45daHafEbTfD3h3whpxtvDOi3ltO3iGSIRowhP3Lb+J3bj5/ufWvXvGB0oeF9TTWroWmlPCyXM5fZtRuD83brXkPxY0x9G03RI003TbTwNp15ZyJeafl7yH549nlp/v46fwV75Xjfg2O6b4k/Fi00a5itVa4s5EuJF85UuXg/efJ+VRf8JD46bxpr2gw65pMkej6cl7NdDSX/1jl9kP+v8A7iZrZ+HeqeLPEWi6Drup67psdtfxq72Udjsdv9hH316hRRRRRRRRXnPxr0OfXvCdtHCbWUxajbTtp99MIYr3a/8AqN+P464PxZq2qan8Qvhrd23hm58OTf2i9rN5/k+dLbeT86bE3/uvx7dqwdNhu7rVLa2mvNPk0ibxxcp9h2f6T/y0/j3/AHKk8WeDfD1x4ZuoL3wpa6Vq1jrtnbSvBv8AJmhadNro7/30r6P0vS7bRdPgsbKFbe1hXYkafw15p4l+LN/oeu3thFc+EY0hfYgv9b8mf/gabPkrrPAPiaXxZo0l5PJpcjrK6f8AEnvTdQ/997E+auVEn2j9pLbct/qPDm+0X/enxJ/JK9C175dB1A+asH+juPMdvlT5a8StLPxH8JvhFY6uJfDupWWj2iTT2UFsR5sI++6XP9//AIBWr4x8fWXiXVoPD91PcaHoggiutRn8qQvcI6b/ALMm1PuY++/4V57DrVhJ+zTqenaPN5FpBqskNzHAjoIbN71//HNlenfFvS9O0ceAbnSreC11O21q1tbDyUCDyX/1if7myvYK8O8D6XqWtSfEvStH1eXRrZfEjiG8gTe67o0MyJ/c+fPz1B4NvvGOga1e+C9A0vwvEmlwx3NzceddMm+U5+d9nzzP9+tD4I2moyal4ivPNj0q0t9UubK50ay+ezeZMZnh3fOm/wDuV6nruiWviPRr3S71Wks7uF4ZURiu5X64auJ0/wCAfhbSvsqWkmsQQWuzyYE1i58tdnT5d9a2qfD238R+IotT1i9utStLZlltNKfaltE/99k/jbn+OpPEvgl9c17T9Ys9XuNH1S0hkt0lhjR0ZHwSCj/7tULH4P6Avg/+wb9JdUie5e/e6mbbObl33+cjpjY+f7mKu+G/hfovhfUJdRtluLnU5E8r7df3L3MyR/3Edz8opmg/DHTtF8KXeitI9/Jeec9xqF0iPNNJN99/1rJuvg3DdDw/ZnVZI9F0d7aZbJbaLfNJD9x3m+/XplZv9g6W3/MNtf8Avyn+FXIbeK0iSGFFijX7qKvArmpvB8Y8dQeJbW6e1na3+yXkG35LpOdmf9pOa1/EGhWfibRb3S9QRpLO7iaGZFbbuQ9a4vTfgR4Y0f7L9km1iCO22eTB/a9z5a7Ony766SPwbpMd5rdwbUzNq237XHM7PHJhNg+Rvl6Vgab8F/Cul3VtOkF5dJZv5lraXd/NNbW7f7Ebvtrv5N2xtn364zQ/Acmg+F73T7LV5INWvpnubvV0hj82Wdnyz7PuZ/hq/wCGfAuneFdJu7K3M1w147yXd1dSb57h26u71zekfCFNMbQ4ZfEF/f6Vok3n2OmyRwoEYZ2b3RNzbN1emUUUUUUUUVleI/DeneLtJm0zVbRbuymGHjesTwv8M9G8Kag9/ai6u74p5SXWoXL3Mkcf9xC5+QVXtPhD4UsdSTUo9IhOorfPqX2px++89+p303xN4Du/FmpQG916b+xobmG5/stLdB8yHcp8z7/38flXdVnzaJp0zO8thau7fed4VOantbW3sY9lvDHAn92NNtc94h8HJrWv6NrUF2bK/wBLkf8AeogfzYW+/E3tXSSRpcRskiq6N8rK1cFD8D/CcM0eLS7azjfzo9LkvZmskf18nfsr0Dy0/u1haf4N0fS9DuNDitEfTbh5pJbWYbkfzHLvnPu1Yvh/4R+HfDOqQ39pbXFxc2ybLb7ddyXP2dPSHex2V195HNPaSx28vkTMmEl279jfSuV0nwI3h/wQNDsdYubS7cl5dUjVPPlmd98jnd/G9V7X4ay6BpMNh4Z1u40Mb3mubqSBLqa7d/43d/461/BPgu18C6D/AGdazS3TNNJdTXVy2ZJpXfe7t75rpqKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK//9k=" alt="示例图片"></td></tr><tr><td>11</td><td>竖式加减法</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCABIAVwBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1TooqN5BGpZvu1wn/C9vARfZ/wlFk77tmE3dfyrtmuoUtjcNKqwbN/mN93bXM6P8VvCevalDY2Gu2l1czf6lEk/wBd/uf3q0vE3jTRPBltBNrWpQ6dDK+xHnP3jWZ4f+K3hLxRqiadpWvWd9qDp5iwRv8APtrsKKKKKKKKKKKKKKKKKKKKKKKKKKKKKz5tb06FmSW/tUdeqPMoq1DOlxGrxurxt91lqt/alj9s+x/bLf7T/wA8POXzP++amuLqG1h824lSGP8AvSNsqCHXNOuGVIr+1kdv4EmU1oUUUVl678uh6gfOWD/R3/fyfdT5D89eI6RpPjD4afBu01PT/FehajZaRp/nR20dj/o1xD9/ibfv+evU9YXSvHHw5f8Atp2stJ1KwSa5/fbNiOu8/PXAXVnJ8YJfD9houlvpXgvR7yC8TVpk8l7jyfuJbJ/c/wBv2r2qRU/i2/8AAq8q+GCDx34w1nx9NEEtF36TovvbI/7yb/gb/wDoFes0UUUUUUUUUUUUUUUUUUUUUUUUUUUV85eGvhvrGm6Trt9qHgPw/q10+pXN7/xMZt81ym/5NnyP/B/fr1rwZrFn4y+Gtjd6Av8AYsF5ZNHaxrGAbR+U+5/sOP0ryLxD4T0B9Gi8FeEbRdb8ZwyJ9o8RQoPMsJt3z3M0w/j/ANivedS0Gw17S1sNYtodRtjt3x3Kb1ZvWvItP8FeHfEHxriXStAsdP03winnTXVrCiebev8AcjP+4nz/APA690oooqKSNZI2R13q38NcF/wo3wdux/Zj/ZvN877B9ql+y7/Xyd+z9K6vxF4Z07xd4fvdF1K2E+m3kfkzQ/d3J6VyVj8DfC2nT2s1supxi1ZHij/tS52Js6fLvrtdS0yHVtNubG5Uvb3MbwyKjbfkYYNN0XR7Pw/pdrpunwrbWVpEsMMKfwKO1aNFFFFFFFFFFFFFFFFFFFFFFFFFFFFeYv8ABkwi5t9L8U61oujXjO8+l2royfP97Y7oXT8666z8I2ej+E/7B0kvpNnHbtbwtanDw8Eb1/2u9ef+HfgTfeEtJttO0v4geILS0gH3US2+b/bb93XrexvJ2b23bfv1zfgXwTZ+AtDextZ5bt5rma7ubq5+/NNI5d3c11NFZ2q6tbaHpt1f3sogs7aN5pZD0VF61bguEuoUmibejruWmXd5HY20txM4jhiXez/7NeTyfGbWv+ETfxrH4XX/AIQ9E8/zHvNt61t187yfLx/wDfXbeLfGkPh7wDe+JobdruG3tPtMUG7Zv7oKx9D8UeN9UurIT+GdKt7abY8xTV97xIf9jy63/Gfiafwxo4urbTbjVrmaVILe1tV+879N74wif7XaubsfiBreleKNH0bxLodrYnWjItpcWF6bhQ6JvKN8ifwD73tXpFFFFFFFFFFFFFFFFFFFFFFFFFFFFFeTx/FbXtfj1fUfDnh6G/0PS5p4XmvLzyJrlovv+Smz/wBDxXY6F48sPEXgW28U2iyDT7i0+2IknyvsxmuR8OfEDxv4l0/T7+38K6THa3kaTKsms/vER/8AZ8mu68Ta8vhnw/eapJaXF59nj3/ZbJPMmdv7iCuHuviV4j8Oz6RP4k8M29hpmqXkdmj2t+ZprZ3+5vTZz/wCvU6K85+LHgG98WeGdZFnq2qQ3ctjJDFZWtykcMr7Djf8lbXg3wnP4atFEmranqTvEiNDqE+9IuP4PkFdDfXSWdrLNIrOkaM7BV3dK+cv+FiaX8UAH8Xy6lpPh3zv3Xhq30q5Dyoj/Ibl9n/kNK9h+Iljba18N9Qt10i41qzuLZc6fav5U0qdcIezV5NrUeg69daBF8OdLurTxRb38DtdfZJrb7NDvHnC5dx8/wAmfkr2bxt4ivvC2kwajY6TNrMK3CfbIrdv30UGfnkRP49n9yvLNJ/svWfitoWq+DE1W+aR3/tebUEm+zRQ7P4PO+4+/Z9yvfaKKKKKKKKKKKKKKKKKKKKKKKKK53xJ4Yk8RNBjWtW0ryjx/Zs4j8z/AH/lNQaF4Jk0O9NyfEOtaj8mzyb+4SRP/QK6mvnHX/ihB451XVNK1WXVvDHhS3me1e1tdLuftWpD+N/ORPkh/wBz569ehTT9U+GrQ6Lprz6ZNp7wW2nKPszvHs2eX8/3PSvE9YtfCN54Dg0Xwp4c1Sx8bQoiWEH2aZL20uEH8dy/8Cf79e7eJNW1rw/4Se8sNNGuavbxIzWcbbPOP8ez3rx3xNqGleM/Feiat4Qh1i58WJfQtNBfW8wtraHpN5yTfInyf3Pnr6IrK8Qa5b+G9JudRulme3gGX+zwtM//AHworiv+F+eGf+eOuf8Agluf/iKP+F+eGf8Anjrn/gluf/iKP+F+eGf+eOuf+CW5/wDiKP8Ahfnhn/njrn/gluf/AIij/hfnhn/njrn/AIJbn/4ij/hfnhn/AJ465/4Jbn/4ij/hfnhn/njrn/gluf8A4ij/AIX54Z/5465/4Jbn/wCIrsvDPiK08VaRBqVmtxHbzD5RdQvC/wD3y4rYoooooooooooooooooooooooqhqV9FpVhc3cu7yYEaV/LUs/rwtcJ/wAL88M/88dc/wDBLc//ABFH/C/PDP8Azx1z/wAEtz/8RR/wvzwz/wA8dc/8Etz/APEUf8L88M/88dc/8Etz/wDEUf8AC/PDP/PHXP8AwS3P/wARR/wvzwz/AM8dc/8ABLc//EUf8L88M/8APHXP/BLc/wDxFH/C/PDP/PHXP/BLc/8AxFbGk/FLQtatTcQpqIjDFMTaXco3HsUrsqKKo6lfpptjPdSq7pCm9hChZ/8AvmuDvvj54V0u1+030esWNrvRPPuNIuUT5+n8FdZ4j8Vab4W0galqlx9ltsog3r87O33EVf7/ALVl6H8UNF1vV10o/bNN1CVPMgttStHtnmX1Tf8AerR8U+L9L8GWYutUuvISZxFDGiGR5pP7kaL8zNx2qr4X+IGkeLrq6srKSaHULXaZrK9t3gmRf72xx0rq6KKKKKKKKKKKKKKKKKKKKKKKKKKKK4PUvjB4c028vLcy3lz9hfZezWVlNNDbN6O6JXQz+JLGPw8dbgma/wBP8nz0eyUzb0/2FT79cjN8dPC9o1sLtNYs0uZktkludHuUQyP9xN2yvSa5iy+IGg6j4tvvDFrqCzazYwCa4t1jPyIenzY2/hXT0UUUV5L4jkk+InxX07w9E6vofh3ZqWqHGVa5/wCWEP8A7PTfj/qIj0nw5p6okOoX2rwrZalNJshsJ0y6TP8Al93vWNrMOt+HviX4Hm8S6vaeJvtEr21pDa232V7eZ0+ebZl96YFbnxIkg0/4ufDi8vsJpu+8hV3+4t08f7v/ANnovpYb/wDaM0UWQ8yez0Sb7fJH/Arv+5R/x316zRRRRRRRRRRRRRRRRRRRRRRRRRRRRXiCanBcw614S+HFna2lp9omXUtZupf9Gt53z52xD88z/wDjnvXp3gfwzZ+C/Cel6FYyNNZ2EKwxySdWFcPfSH4kfGCCw2F9A8JhLqaT+CXUH+4n/AE+f/gdbfxU17XdL060s9DsL2ee+k8mW/s7czfYo+N0mzPLf3fevMPAl9p2gfHKGwsNC1i0h/sJIW+1WmJnfz/mmm/+Lr6NoooorL07Q9O0ae9msrOG1mvZvOuXhXHmv/fapNW0ew17T5rHULSK9spv9ZDMm9GrI8O/Drwz4TuWudI0W0sblk2G4iT5yvpurX1jRLDxFps1hqVpDfWUw+eGdd6NVXw54R0XwhbPb6LptvpkMjb3jt02hjW1RRRRRRRRRRRRRRRRRRRRRRRRRRRRXCTfBHwDNNNK/hLSTJM++Rvs4+Z/Wus0vSbPQtPgsNPt47SzhTZFDCvyIKh0vQ9O0L7T9hs4bQXMz3M3krs3yN992961azv7D0/+2P7V+yQ/2l5Xkfatvz7M5259K0a//9k=" alt="示例图片"></td></tr><tr><td>12</td><td>竖式乘除法</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCABSAW4BAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1ToooooooooooooooooooooooooooooooooooooooorlfG0niZbezt/DcNqs9xNtuL26PyWkXdwn8be1cb4M8aau3xC/4R19asvGOntZtdPqlhAifZX38JJsYr8/8ASvXKKKKKKK8b+Nfiq+0/xP4L0S11jUNGg1J7l7qTS4POnfZH8iJ8j/x1pfC/VrabVtQs28U69q2oRQo76Xr9ukE0K/39nlpV3xRo/ifXPE08I1dvDfhO3tFf7TYuguribJ3/ADv9xEWqnwZ8Uar4g03WVu7o6vp1lfvbabq8i7Hvocff98Nld3fFclqHxAn8WeIPEIPiDW9KsdHvHs4rXw7aee/yffmmfy3/AO+K9O+G+qTa14P068m1W11yR1/5CNimxJvnPJT+Fv7wrr6KKKKKKKKKKKKKKKKKKKKKKKKKKKKKK4/xzJ4qtVsLzw1Hb3qQy/6dpsx2PcQn/nm/8D1xvhXwZq1x8S7TxKmgR+C9Mt7SW2uLFJkL3ztjY7pD8nye/rXsVFFFFFFcb4x0/wATfa9P1Dw7c2bC33JcadeptW4RvSXG5HHFZXhnwnrtx46fxd4j+x2lyun/AGC20+ydn2Jv3szv/GayfiV4J8YeLvFNsYo9M1LwlBBxpN1eTW3m3PZ5tiHeg/uV2/g9dbj094Na0vTdKEZ2W8OlTvImz8UTZXI2fg/xN4B1nX5vDFppOo6frd49+6X0zwPbzP8Af+5G+9a6T4aeC38C+GzYz3KXd7NczXlzPGmxDNK+99i9lya7CiiiiiiiiiiiiiiiiiiiiiiiiqV/f22lWc15dzJBawpvlmk+4q1w9n8ZdBmbT5JbXVrHTdQmSK01K6snS1mZ/ufP/t/7WK6rxR4m07wnpM2parcR21nD/Ef4m52qv+0awtH+J2m6nr1tolzZ6lpGo3aPLbQapbmH7QiY3bPf/ZqbS47i+vtc+16pdwLb3jhNjIqrDsT/AGPrVb/hKvC3/Q/2/wD4NbatptNVbY3Ta5fC22b/ADfNTbt/74rM0vVNF1yd7fTPFzX86dY7e8ikf+VdfHH5aKpZn2/xNUtFFFFFFFFFVby+t7CB5rmaO3hXq8zhF/WrVFFFFFFFFFFFFFFFFFFFFFFFFFYPjVtGj8K6o/iHyf7CW3drzz/ueX3zXkVv4gsvi/NpQvdW0rQPB8M0NxZ6X9ri+23zofk3/P8AIn+x9/it/wDaCNxBo/hm8jm+y2Vnr1rJeXTpvS2h+dPO/wCAO6VlQ6g+gfEzwrpuheKLrxXbal53261u7lLr7NCE4nR0+5z8lel+HGWfWvEY++n2hF/8cFcF8XNL0/xDqWi+AbGwt45tabzr+aG3T91YJ/rP++/ufjWl8b1sLX4ay6UyMn2ma1srG1gX/XS708uF/wDY+T5/9jNcVqw8Q6b4k8EX3jXRdI0bTbe+RI7rw87s6XL/ACIj7h/qXr6Goooorwjxp448R+HPEus2nhW6n8RWXLX7tF5v9hNj76f89v8Arj14r1TwKbZvCunyWuszeIbdk3pqM773m966Oiiq13dw2NtNcTOI4Yk3u/8AdWvl/wCK3jrRfiV4N1bVrzWrSDTbZ4f7I0gzfvHfzk/0mZP/AEBK+l9D1S01nS7a8sLqK8tJE+SaB96NWlRRRRRRRRRRRRRRRRRRRRRRRRVTULG21K1e2u4o7m2lG14ZkDq34Vip8OfC0MiSR+HNJjdG3I8dhCCv0O2t+eGO4haKVFkjcbWV/wCKsew8M6d4ft7n+wtJ0/TLibr5NssaMf8Ab2CpvDuh/wBh2LxvN51xNM088uPvu3+RVay8I6bp/ifUdfjSR9Tvokhld33bUT7qKP4RzVjxP4Y03xZo8+m6pbJc2c3VDj5W5+ZePvc1zOn/AAg0ew1Kxv7u81bWZLB/MtE1S/eeOF/76L/frv6KKKKrQ2sNrvMUSx723vsX7zetFpaQ2cPlW8SQxDokabas0UUz79c54m8BaL4s0W60u9soza3O3zPJTY/D7/vfWt61tYbWFIYUWONPuotWKKKKKKKKKKKKKKKKKKKKKKKKKKKKKhnjeSF1jfy3ZcK2Pu14n8RpfiP4I8Pm8i8cWl9qNzOltYWX9iJ++nd/kT79d14+8Qar4N+Ht1qUUcd3qdvChlfb8iHKrJNs/uJy+PQVxmk+OdYs/Enh60t/GOl+OV1R9lxaWNtGklsneZNj/cX/AG69rooormdd8C6T4lvEudRjunmRNuYb6aEY/wB1HFUP+FR+Gf8AnhqH/g1u/wD45Tf+FS+Gv+fa/wD/AAa3f/xynf8ACo/DP/PDUP8Awa3f/wAco/4VH4Z/54ah/wCDW7/+OUf8Kj8M/wDPDUP/AAa3f/xyj/hUfhn/AJ4ah/4Nbv8A+OUf8Kj8M/8APDUP/Brd/wDxyrOl/DnQtD1CO+tYLxLiEfJv1G5kT/vh5Nn6V1lFFFFFFFFFFFFFFFFFFFFFFFFFFFFFedXXhPUPEPxYttb1OJI9B0S2/wCJbGJt3m3T/fmZMfJsX5PxNWvi14V1Hxd4P+waY6GVbmGaW1mfYl5Gj/PC7dg9cZe+CtU8R6z4bOm+DIPBMmnXiTzamk8JdYV+/Cnk/f3/AO3x1r26iiiiivG/HXh3w/peratr3j3VW1O3uHSDS9NR5k8lNn3EiR/nd3z8306V0fwi03XbH4e2tvrbzwXrNN9nju23z20Bc+TG/wDedEx+Vct4A0+90P47eKLC41rUNZ/4k9rM73sxI373+4n3EqfxLZ/8J78aE8N6rJM+hadpH9ofYUmdEuZnk2fPtPzbP61P8M9/hn4l+LvCEEs0ujWdta39pHcSPJ9n87zN8aO38GUqL4ieKbrxhb69oWgaj/Zun2NvMNU1iB08zfs/49of9v8Avv8AwV0fwPuvtnwm8KSNN58/2CHe7vvfp3rvqKKKKKKKKKKKKKKKKKKKKKKKKKKKK4DWvhHpevardahcajr0E1w29ktdXngRf9xEbAqp/wAKJ0X/AKDHib/weXP/AMXR/wAKJ0X/AKDHib/weXP/AMXR/wAKJ0X/AKDHib/weXP/AMXXZ+HNBg8NaXDp1vPdzxQjiS9meZ/++2rXooooryjUfg/q0vjq/wDFFl4sMF5cbUiS602G5+yQj+CF3+7mu/8ADtjqOmaYkOq6qdZvQzZuvsyQ/wDjiVl2PgeLT/iBqniv7TI89/aQ2b2235F2HO6qfi74ePr2vWfiDStUbQ9etoXtxdLAkyyxN/A6PUvgjwEnhW51PUry9l1nXNUdJLzUJ12btnCIiD7iLngVX1n4MeDdZivw3h7To57xX8ydLZN+9/46vfDr4f6X8M/DFpo+mRJiJFWWcIFeZh/G/vXW0UUUUUUUUUUUUUUUUUUUUUUUUUUUUUVzXxA8RSeFPA+vaxbIsk9hZzXCK/dkQkV5FrHhq98O/CGLxvb6/qUnii1s01Oa9e6d0uDw7wPFnZs/g6V7tpl19usba427PNiV9np3q5RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRVDVdJtdc066sbyMT2tzE8Msf95G4IrzH/hTWtXWj2vhm+8U/afCFuET7ItnsupoU+5C83mfc/wCAV6ykaxoqr8qL2qSiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiv/2Q==" alt="示例图片"></td></tr><tr><td>13</td><td>脱式运算</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCABOAJABAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1TooorP/trTvt32L7fa/a8f6jzl8z/AL5zWhWdDrenXl5JawX9rPcp96GOZWdf+A5rRooqt9qi87yPMXztu7y93zVZoqtdXUNjC01xKkESfekkbYoplhqNtqUHn2txFcxH/lpC4dajvNYsdNZVury3tXboJ5VQ0+x1S01FGe0uorlV+95Lh6u0UUVR1WMzafdJ9oa03ROvnr/yz4PzV8+fFb4f6Z4K8BPY6V4U+0RrCk83jDcjz2b7xvun/jd/4/k9a9l1TSZPF3gN7HT9ce3kvbRUTV7dfn2/309/8a8g1rwz4e1TUdB8OfD7S4ZNZ0q7hnudftU2JZon39838bv/AHK918QeJNN8L2P2zVLyOytt2zzJP71cX4W+LOm6ldXVrqWraSJpLspYpYvI5eH+DfuT79aXxD+IVt4FtbWFPJn1rUn8nTrKaXyxNJ1+dv4EXPWvLfAEdnov7Ql2134ki1bVL/QUe5uvtKbHm8/7kafwJ/sV7P4q8baP4Ph/4md/DaTOjvEkh+/iud+GPxa0vx/oumH7db/2zcwtI9rBu+Sj4leFdF1W+0zWfFGpRx6BpCySPY3Y/wBFlmbhHf8Av7cHCVznwn0oX3jjWvE2i6dJ4c8H3VokEVjJF5Ivp9+ftPk/wcfJ/t1V8c+Adb8Q/FiXUm8J6X4g0xNKS1tp9YmTyIpvMd3+TDP6Vv8Awjv7K2vNd8PnwvZ+FdZ090ku7fTwvkzI4+SVGHtnrXqdFFFUdU0u21rT7mwvIxPa3ETwyxt/ErcEV5q3wTvpdFXw7P401Sfwzt8o2RhiEzw4x5Pn437cV2niPwjHrHgy68O2N3LocM1v9mSex+/Cv+xXIeGfhPrvhezsbHT/AB1eQaZZ7QlrHptqiMnp9yvUKxPD/h06C2o7tSvtRF3cvcgXsm/yc/wJ/s1PrHhjSPEQjGq6Xa6j5XKfaoUk2/nXKWnwV8LWXjtPE1vptrHOln9lS1S2QQr+837+n367u6t0ureSFujrtrK8JeGYfB/h6y0i3keeCzj2JJJ9+uX+JPwvb4gavoWoLr1xpT6O7zwwpDHNC8nQO6P121qeFfC+v6LqEk+reLrrXYnj2LbTWcMIRv7+Uqp4g+HNxdeJDr+ia7d6BqckIhufLjSaG4RT8u9H/jH96rHgvwDD4PuNSvZb+41jW9RZGu9QusB32/cUKowiAdq7OiiiiiiiiiiiiiiiiiiiuEvvjV4N0y+ms7vWkiuoX8uSMwTZRvT7lb/hfxZpXi7T3vdIvPtdsrmIybHT5v8AgVbleF/FDxEtv8ULPR/EWuX+k+GprHzbWPRZ3jnluN/z+ds+fZsrV+BviK414+JRBq9xrPh20u44dOn1GTN4Pk/eJJn5sbz8m/nFdx408aWngzTIbydPOD3MNtsRv777K6OOZJPuur/7teU694Z1HUNQ17WvGHia58PaBZvjT10vUTaokP8Az2mb+/Wt8E9a1nXfANreay8s8jzTG2urhNk01rv/AHLun950rxvw7q0mv2Os6vrWp/ECYLqVzvfRJnS2t4Uf5P8AKV9DeCbrTb7wlpk+lajLrGnvD+5vp5fMeVfVnroqKKKKKK4m+8B6rdXs08XjLWLVHbekMaQ7E/8AHK2/Dek3Wi6e9vd6rd6xJuL+fdbN4/2flrbry678D+IfDvxF1fxXoMdhqw1W2hgms9QneF4tn9xwj/J/sVd8B+DdW0/xZ4g8Ta09lDfaskMP2GwHyQqmfvv/ABv8/WqHxM+CGh+OIfOt9Os01R7yGea6m35dEfLiu38N+D9H8HwzQ6PYQ2KTPvdI/wCKvMNe+H/jXVvHV7rOoWWg+IdPhm/4lFleXkyQ2yf33h2FGm/269P8OzavNpuddtrW1vQzZjsZnkj2/wC86If0rjWs/iVp9te6fFNpOsrM7m21O9kaF4kfoHhRMPtrofhv4LX4f+DtN0JLhrt7VTvuHXbvZ3Luf1rraKKKKKKKKKKKKKKKKKKKKKKKKgN1CvWVP++6ekiyfdZXqSuB8S6h4uuvEUem6PDa6XpMNt51zrd6omR3z/qkTeO3V3qr8L/HGp+KNX8T6RqZtbyTRriOFNT0/wD1NxvQPj/fTpT9YvvGF74kvrayk0/w3oVoi7NR1GHz3u3PJ2pvTYiVJ8JfG19430nUjqMFubjTr6Sy+3WZzbXmz/lrD7V6DRRRRRRRRRRXietfCfV9S1i8uovDngm4jmlaRJLyG585/wDfrvfhz4buPC2gvZ3VhpOnStM8nk6MriH/AMf/AIq6+vNPGWvaxp3iCez1TwzL4i8GX9ukaDTrbz5opc/Osyf3D61n/BnQb7S9Y8R3lvpU/hrwpdyRHTtGuvkdWH+sm2f8s9/Hye1P8W61eLq2p6R4q8HXHiTw5MyzafLp1mbron3JkP8AHnNTfA7w/rHh/R9V+3Wsul6VcX7TaTo8zfPY23ZOOn+52r1Kiiiiiiiiiiiiiiiiiiiiiiiiiiiv/9k=" alt="示例图片"></td></tr><tr><td>14</td><td>解方程</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCABnAVMBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP0U8XfFvRPCPiDTNCmNzd6pe3MMHkW0BfyfNfCO7/dUfWq2u/Fa+0/xPf6Lpfg7V/EEliIvtFzYvCsas6bwvzuO3867Lw9qNxrGi2t5dafcaXPMm97K6Kb4f9htvFa1Fee+Jvig+la9LomjaBf+JtTtokmu47N0RLZHzsDO+PnfH3K6Dwf4ssvHGh22qWBdYpiyvDMm2SF0O143HZlcEVv0+iuK8bfEGPwpeafpVrp95reu6gHe20+z2BnRPvu7udqJU/gXx3a+ObW8MdpPp+o2M32e90+5/wBbbvjcAfzqroPxM0rxJ431nw1p8Vw8+lQq8135eIWYuVKIf4tneu4oooooooooorhNC+KGj+JviBrPhKwSWe50q3Waa6AHk7t+0xr/ALa1iyfHS0jvJrj+xNUfwvFc/Y38RbE+zLJv2Z2ff2b/AJN+K9VooryrVPjZFBNqNxaaDqWoeHtNleHUNct9hhgdPvnZv3uiY+fYK9MtbuC/torm3kSaGVd6OnRlqan0V5nq3xaeLWNTs9F8N6n4kj0t/Lvrmy2IkLY3bEDuPMfYf4Km1T4waTHpOhXGjWl14jvNdTzNOs7FCskyL992342Kuerd63fAvju08cWNxLDDPYXlnL9nvLC6X97by/3WrqaKKKKK8y+NyJHpvhdti7m8Safv/wC+6yI/Cek654s8bTDxtq1hL9ojkubWzuDZm0ZIE2Pv/iTZj/Yrpvgv4g1DxV8PdMv9Wb7Tc+ZNEl1s2/aUR3RJsf7aAH8a5T41a94stbnSIrTQreTT11qy8m6/tEI8r7/ubK9O8M3mq3umebrenRaXe7mHkRXHnDZ/v1zusapD4nvde0DRNdfw14hsBE9xdC3R32snyPh+HX39q8ft9SS3+Dej3els8Himw1ee30Wa1kdxq14JnR3/ANuGb59/9zmvT/gXJDc+F7i9luZbjxBc3btrcdxxJBefxw7P4ETjYP7mKg+JXiDUtL19IbTxPqGjR+Tv8i18P/bU/wB/fW18L9UvNW0+9e71q61l1mwsl1pX2Ap7bf4vrVXx94osfCmvaZ9h0uHVvGd9FJbWEG5Ek8kfO7u/8ESd65W90PxB4L8J309hJNr3ijxFfq+r6hpi7zaR7MfuUz0RE2J+FVPAOqw6d8YP7LsPDWs6ZZR6DbWyR3MP+q/fP87/AD/+P171RRRRRRRRRXA/FnUtf03w/FHoFlfXVzeTJbTXViu+S0iOd8yJ/eGa8y8G6jHZfGSXSNO8O61pkC+GYbOFLiFA8X79/wB8/wA//j9SWesWEH7KUtjLLH9uhsH0l7X+P7Zv2eXs/v769w0GG5s/Denw3B8y8htUR/8AacJXi914n8d/8Losv+KWtvtX9hTf6F/bHyOnnp8/3K90tJJpLWJ7iLyZmVd8atu2N6V43qdwnxC/tPwj4WjtdC8JwzSWuqawu1POfcfOgt0/v9d7n1rC+MU0/hPxBb2vg+5u7d5rBIfEENmnmpaaYh2fak/uTIm/Z6/8Ar3Hwja6XZ+GdMh0V1k0lLdRbSI+8Mnb5u9eSax4t1mDWb1F8b6vbxpK6JDH4T3on/A/469Y8H3E194ZsJri7lvpnh+e6mtvszv77P4K8a0/w7qni3VPiJfaT4s/4RCBr6W1l0+KJJNromzzpi/3C+M/J/Biq/wl1y0bxN4Bv5bSHSLK+8MXWn2caP8AufOhuk37H/20TfXa/Dlv7S+K3xM1K0cyWDTWVmJo+VeaOD94P+AB0r1aiiiiis7UNIs9YjgS9torpIZVniEy79si/desnxF8OfDPiy8S81jQ7HUrpU2edcRZcL6V0EFulrCkMSLHEq7VjRcKtV77TLTUo4UuraOdYZVmjDru2uv3H/Cr9cz4k+HnhzxhNDPrOi2uoyxJsR50ywX+7VyDwvo8Nxp80Wm2izaejQ2jpCP9HT+6n93tU9rodhY315eW1pFBd3hRrmaNcPKU+7u/WtOiuZ8S/Dvwz4uuoLnWtDstVuYU2JLdQh2Vas+GvBuieD4ZodF0u10qOZ97paoE3Gry6RZpqT6kLWL7e8Qhe42fOyA521foooooooooorNXRrBdVfU0s4f7ReHyWutnzsnZd31rLb4eeGW8Qf262iWX9rb/ADPtXlDfv/v9Pve/Wumqh/ZNm2pJqP2WL7asXlLcbfnCZztq/XCTfBXwFcSzPL4S0mR5nd3P2ZPnZ/v10Wl+GdL0eS6kstPt7WS82+e8a/63YmxN/r8nFWdH0aw8P6fDYabaRWNlCPkggTYi1oUVyet/DHwt4j1E32p6DY3t23DTSQDcwx/F/erQ1fwjoviLS003UtLtbywT7sEkQ2Lx/D6fhVzR9DsPDunQ2GmWkNjZwj5IIE2IK0KKKKKKKwIfGWhXWsXmlRavaHU7N/LmtfOXzUbZv+71+7UFt8RfC11PFBbeI9JuJpW2JFHfwu7N7APXTUVXuLqG1j3zSpCn96R9lS/fp9FFRSSJAjPKyoi/xtRHIk6K8TK6N/GtOp9FFR+Ymzfu+WkSaOX7jq/+62aloooooorltP8AiL4Z1TSpNStdf06Wxh/1k4uU2L8+z5/7nz8Va0vxpoGvTm103W9P1K52bzFa3iO//jprfoqvJdQwyIjyqkj/AHFZvvVYoooqvNdw2u3zZUiLfd3t1qR5BGpZvu0kMyXEYeJldG/iU1LRRTKYlxHJI6K6s6ffXd92pqK+LvDt1ead440+433089nfzTfarrSkdHea98l3eb+5s/jrc8J33h/XPGWm6Ql3Chlv/wC2bu6GivvupkudiJC6fch+RK+mLrTdQn8Q2N3FqjQabFE6TacYEYXLnGx/M+8uw1u15v4+8G6bd6o/iTV7K98TW9tb+RBoMMImRG3/ADzIn8T1xHw/8Vaj4Q+Hd3q1nafatFt9auXu9Jkmb7VpFlv5j/30+/s/uGvSfh94wu/HNjc6x9jS00S5l/4lT5PmXMH/AD3f+7v/AIfarfibxuvhm7jtv7C1vVNybvM0ux89Fqz4W8Vf8JQszf2Pq2l+SeBqlp5Jb/d55rA+IXhK28Qajpmo69qECeFdHjmuruyuvlhlmwNjuT/Cg39a4v4d69a+EdP8aeIoLea08H3l5D/YVjs2ee+zY3kJ/Ckz42VJ4C0fU9P+Od1fa1O7azqXh37RcwLLugt/9K+SFP8AcWvYNW1ix0OykvNQu4LK1jHzzXMgRF/4Eay7H4jeFtUvIbOz8RaXdXUrbUhgvEd3/AGrviLRX8QaTNYrf3emibh57GTZNt/2H/hr580XRLi6+AtjpdnpV7rsMfiORJbJJN8jwpevne7/AErufADaN4f8cppF14FtfCOs3ls01pNaskyXCJ99N6fxpXsVFFFFFcZ8XvO/4Vb4q+z3MtpN/Zs2yeH76fIa+Z/CuqPoc3iGbfNYQNYPZvJfaEiJshghdERP45t7v8n+5XoHwOOgap48k/sydbeDw/A2m2Nl/ZbwzMjpG7vNMfvvxXt2n6bqNtrWp3NxqjXVhceX9msvs6ILfH3/AJ/49xrdrwfx94R8P+HbPxHeeKNviTxHrk0y6Raom+5X5D5MFsn8JT+/WtP8QNa+Evhvw3/wltqb6zfTktpr6Elpv7Q2/JC/+/jbv/v/AFr0fwjc6vfeH7OfXLWKw1SVN81rC29Ij/czWJq3xKXS9UurL/hGvEt2YW2Ce100vC/+6+ea6LQdYGuabBdizvLDzP8Alhfw+TMv1WvDvElxZf8AC1PFn9peGLrx/F9mhEUVknn/ANm/J88LK5+R3+/8lZ+gxHxB4c+FfhO8v31HStSnvbm6UO+XWHe6Wrufm+TeEf8A3K77wrpNt4L+Mmo6LpKfZNI1HR01I2KH9zDOk3l7kT+Den/ouu/1zxVpHhtIm1bVrHTPN+59suEhD/8AfRqDRPGmgeIbh7fStb0/U7hE3vHZ3KSsq/8AADWb478Wv4cs7Wy02NbvxBqTmDTbVuN7/wAbv/sIPnf6V5Lpc118LfC/xknt76fUdRs3SYXM77nedrVCz/8Afb/pV3xB4F0r4d+FPB/iLRonh1mzvLJZr5G+e+SZ0Sbzv7+/fXv1RSOyxsVXe/8AdzXzN/woHVLfWNKuW0uea5u1R7y4TU32W032zznym/502f8Aj9dpY/B/ULD4sQ3ket67/ZEOipCl19pQ/vBP/qfufc2V6ddeF7C88RWOtSxub+yheGGTznCBHAD5T7vatyvO/E3hDxNH4qfXvCusWtvPc26W15Y6orvbPszsdNh+R/mrDtfgxfy6SLG/1n7RFqepPq2vvCu37c+BthT+5F8iflXV+CfBNx4Lm1Wzt7xX0CaXz7Cy2ndZ7j88a4/g/uj+GpfFnw5sfF17Dd3WoaxatGmzZp+pTWyf98oat+EfBFr4Njultb3Urv7S+9v7QvpLnYf9jf0rkvi38PfEXjfUNDm0rUdNisNPd55tO1W2eaG4m48tnRfvbKvaf4F1XxLpr2PxBOj67BHMk9pHp9u8AidfffVHTPgdoOj/ABIh8S2ltDBDb2P2dId77km8zdvzu/u8V6Rf2NvqVs9tdW8dzC/3o5k3qfwNZ9p4T0SyuEng0jT4Jk+48VsiOv44rary/S/hfqej+BRo+n6+bHVodSn1K3vYU+TLzPJsdP40w+yrHh3wLr134ut/EXizUbK6vLGKSCwtdLjdIIt+N7tvPzP8tekUUUUUVyfxI0m/8QeBdb0vTlR7y+tjbLvfYPn+RufpXknh74Ctp/ju9WCz1Gy0jzpXh1T+0vOIQpBs2JJv+fej/PXVfCv4c6r4X8TeKr/UNV1V7ebVmmt0uLlXS4jMKDe/+f4K9A0/wzY6ZrmqarAj/btR8vz2eV3X5B8nynha3a8UHwz8e6b421zxFYa34fuJ76Ym3k1Kwlmnt4f4YUcP8iV0GqfDG88a31q/jC6gv9Ot7DyV0+zV0ja5fiSc5P8A3x/crp/A+j6noPhq207VdSTVrq3JhS8KbHliB+QuP7+3risTV/hHpmtapdX0+qeILea4beyWusTwov8AuIj8V1HhzQYPDOlQ6fbz3U8UI/1l7cPO/wD329cLN4E8UeHfFGu6l4S1TTUttZl+1XFpqlu7+VNsCb0dDz90fJUP/Cnbuz8NaWllrf8AxVGm382ppqk0PyyTTb/OR0/uPvNbHgjwXqun63f6/wCI9Sg1LXLyGO1X7HFthtoE52Jnnl2Lc112oaLYaxs+32Nve7T8v2iJX2/nTNP8P6Xo8ry2WnWtlIy7WkghRP5Vm+JfAOgeMLi2n1bTYr2a3R0geRmVkD/fxiuS8O/Ajw/oepeLpntomtdbXyFjR3/cw+T5bpVfTfhj4lu5NGsPEXiC21Hw5osyT20ENtsnuXT/AFPnP22f7H3+9et0UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUV5/4u1HxldeJF0nw1BaafZRW/nz6tqELSozZ+WJEXH1P+c1PAfxQTUtFkPiOa0sL+DV30MzQt/o9zOnQpn+/zXbWfiDTtQ1O/062vI576x2C5gTrFv+4G/KtWivOvHHirWW8Xab4U8N/ZLbU7q2kv5r69XekMKOE+RP433uKm+HHi7UdX1LxB4f1xLf8AtrQpIEnmsyfKmWVN6Oq/w8etd/RRRRRRRRRRRRRRRRXkGteJ/HV9N4j1PRoNN0vRtEkeNIdXgfffeUu933fwJz8hrr/CHxG0zxTp+gv5q2moatpyajFZTf6zyz94/hW3ofiCw8R6f9s064S9tdzJ50fKsVrVorg/il48n8F6G66baR6h4guYpDY2LthX2Jvd2/2EHWsfU/iNq0nhTwWulw2snibxNGnkiYP5MP7nfNK2P7npV7wV4q15/E+peF/FQs5NTgto722vdOVkjuIHcpko/wB11fivRqKKKKKKKKKK8w8c+J7Sx1q50Hxbpcx8K3ltHLb6lEs0iPNv+eGTZ9w/c2VwGl2N5D8KtT8PQ6BeXWn6tqk9l4ZsLqF0e2teNk07/fREfe/z/P8Acrufglpt34S0/UPC2qW0zazYzefc6w6Ps1Xf/wAvO/pvP8adjWh8SPCc/iDUbKaLw5FrmyIr5kmsTWfl8/3E+/U/w18MzeHft/m+H00Lztv3NVmvfN9/n+5WF8X4dPt/EHh+/vE1nS5IUmVPEmj4f7JwP3MqbHyj/wC5/BUXwV8PS2+v+LNfMd59j1KWGG2utQUrc3awp887+zu52f7CCvYKKKKKKKKKKKKKKKKK8A8WeMbfxp4o1jRfEU2p6L4T02byJLGDTrln1V8fPvdE/wBT/sJ9+rXxa0ef4nW2geHfC0EunXaw/b4db8p4Y7O2+55P/bbGzZ/czXonwx1GLUPB2nxx6M/h9rRPskmlsm0W7x4VkTj5kz/F3rkfF3gS71TxFe3KeDotQWZv+Pp/ENzBv/4An3K7jwDpD6L4bgtJNOXSmVnP2WO8e6CfP/fevOfFHgjx3Z6h4z1e0m0LUY763khtvtaTefb22z/Ups96x9O07xBoHh/4X+KNZsRONCR7e6g06GR3htpoAm90Pzb0/jrr/CF43jL4pah4lsre4i0Wz0uPTba6mieL7U7yeY7ojgfIuEr1aiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiuc8VeMtI8F2sMmp3X2drhvLhhjR5ppn9ERAWeneFfGWkeMrGW40i8+0iFzFMjo8ckUn9x0cblNdDRRRRRRRRRRRRRRRRRRRRRXHeJviZoHg29jsdSvJPtjJ5vk21u88iR/wB91RTtWpb74ieHtP8AD1trsuqxvpd5sS2nh/eec7/cRFTLMx9BVvwr4y0jxlYy3GkXn2kQuYpkdHjkik/uOjjcproaKKKKKKKKKKK8++MGoXmg+Gv+Eg0/VBY3GlSpdfZ3/wBXfKMg2ze75wn+3ioPg7rF/wCLdBuvE2oXzTy6rO0iabn5NOVPk+zf74x8/wDt5pPiF401fwxrFrb6fqHhO0heIu6a9fvBN16p/s1ofDfxXqXii3vG1G98P3rwsoU6BdvMq/7+6reuQaXN4jtnh+xP4vhs53043TNlUbG/p/B92uO+EUd7b+OPHqa6kaeKpri1nvPsf/Hl5Pk7IfI/j/g+ffXr9FFFFFFFFFFFFFFFFFeNfGzxprHwyvtP13Tbz7ZFdwvYtoszfLv++tyv+yn8f+xXf+CLGex8LafDd6w+uXLRB31BjkTM/wA+9P8AY/u+1cP4m+JfiHS9e1Cyg1XwNBBDL5aJqWpPHOn++grvfA+r3OveG7S8vZtMnuX3b5NHn862/wCAPXHeINR0zwD4t1STRdOuNc8beI0R/sSPwqxJsR3f/ljF7+tcfoXgubwR4y+FOg6lMt00MOq3TyRp+5+2PiTCgjjZvfZXZ6GqRftAeJ1tAuyXRbN7zaOfO3yBN3/AK9Pooooooooooormte8G6f4kvtJvNQ86ZdKnN1Fb+Z+4Mw+67p/EU/h9Kdo/g3TdD1vVdW09ZIZtUZZrmLf+5Z/+em3+971o32g6dqjq17p1tdOvR7iFH/nT7HR7LS9/2KygtN33/s8Spu/Kuf8AGnw/03xpJZT3T3dlf2TkW2oabN5NzDu+8A/93pxU/gvwDpngeG5+wi4murx/Our2+l865uH9XfvXUUUUUUUUUUUUUUUUUUVzDeB9Lm8T3HiG4R7q/nthZobht8cUJ+8kakfLv/i9an8JeELDwToqaXp/mf2fC7mKKZt/kqxz5aei+1WbrwzpFxI9xcaVZTSt9+SW2Rmb8cVds7G30+FILaGO3iT7scKbFH4CuA1r4I6PrXifU/Eaav4g02/1KNI7g6bqbwxuqfd+WtC6+Fuk6l4btNEurzVLs2MvmwahNeOb2GT++s3XNaPgvwDp3ga3uFsmuLm5u3866vb6Xzbm4f1d+9dRRRRRRX//2Q==" alt="示例图片"></td></tr><tr><td>15</td><td>求平方</td><td><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCAA0ATkBAREA/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/9oACAEBAAA/AP1ToooooooooooooooooooooooooqnqGoQ6bZTXdy4htrdHllkPRVXk15A/xj8Ur4ZbxhD4NV/CSL54ke7H217b/ntsx6fNs9K9d03UoNW061vbf54biJJUP+y4yKvV474q8VeLdB1NtQ+1QRRNqaWFh4dMSPJewl0R5t/3xwXf6JXsVFFc5448YWHgDwvqGualuNraJv8ALQfO7fwovvXByfFvxJ4abTLzxZ4Xj0nRNQmS2S6trvzntHf7nnJj+Vev0UUUUUUUUUUUUUUUUUUUUUUUUUUUVxvgDxx/wnUer3dvB5elW969naXGc/aNh2u/035re1zVLPSNGvb6/P8AodtC803yb/kQfPxXlPxY0u88dfDeTVtA8TraeHDYfbX07ykSG9hxv2PN99N6V6X4K1CHWPCOi39rbfYbW4tIZEtSP9UmwYT8Kp/ETxVL4K8K3uvRWf2+Gx2zXEK/f8kH52X325rmtG8Fatc+J7jxRb69a30d/Ik1u89mHeG16+Sj/wANeoUUV598btE03xD8NdXtdU1aHQ7X5GXUZvuQujjYW9t9eQ/Ga78e6x8Nzp/iSHStFSS8s4bZ9NuPOfVJvOTYiJ/An8f/AACvpe0jaO3iV/vqtWKKK88+IHibxJb6jpWgeFbCN9S1Le76jexu1raRJ1Ler/7FZ3g/xf4ps/Hdx4O8VPp99etYf2naahp6OiOnmbNjpUfhe+8Qy+Nra1/tZtYgWGV9Y8uNfs1vNx5aRN/fz2r1iiivHZPFHjnx5r+ux+D5tL0nSdHuZLL7TqMLzPdXKffGB9xBurrPhf46fxxo1011BHaavp1y9hqNrG29EmTAOw/3a7aiiiiiiiiiiiiiiisfxVcS2vhrVp7dN88VpM6f7wQ4rjvhPMvh/wCCPhm5trSW726VDdeRbL88sjoHcAf77mkk+LFzcRsjeAfFDo330ezT/wCLry//AIQnw7ueH/hB/Hn9kPP5/wDYfm/6Fj/c8z7n+xXqEHxVuLeFYovAPidERdqIlmn/AMXXQaZrX/CZeGNQa90e90qN0eF7XUI9jsuysP4A3k138H/CzS/N5dt5KN/0zRyif+OAV0ni7XNX0Oxim0nQJvEE7vseCG5SAov9/L1zmneOPGN1qVtFdfDu8sLWSTZJdNqtq/lJ/f2b66vxLr0nh3S3u4dNvNWdW2/ZbFN7n8K4TWPiEPEWlXOm6h8O/Et3ZXaeTNDJZpsdP++64rw5o+k+G9Tsr5PBfjrUHseLGHVH86Gz/wCuab69E/4W7ef9CJ4n/wDAZP8A4uuy0HVH1rSba8exudOeZcm1u02yJ7MK1KK43xB4807SfF2l+E7v7RbXGsW8r296Pkj3J1Tf/fxzXnXhHRIvBvx4utHtdTuPEP8AamktNeT6hL59zY7JBsTf/cff9z2r0jwr8N9K8Gsg06a/WCPeUgmu3eP5/vfJWL8YP+QbYf8AEy8TaZ++b5vDMO+RuP4/kNcR4Gz/AMJVpv8AxUPxGuf3v+p1W0RLVv8Af+SvoCvEdP029t/HHi8eDPFWn2MX2sT6vpeqWTyfY53QHzk+dPvoBS/sx6PJYaT4r1D7bLqVpqutzXVtezHm5T7hm/4G6PXttFFFFFFFFFFFFFFFRTRJNC6N9x121wHwc0PVvCPh+88N6lC3laVdyQ2F1/DNbP8AOn/fG/Z/wCvRK5Pxt8R/D/w5h099e1FLEX9ylrbIfmaWRugxXWVx/wATpNY/4QfU7fw/btPq11H9mtyP+WJf5PM/4BnNa3hPQYPCXhnS9Ftv9TYW0dqn/AUqDxb4N0zxlYx2eqRzSQo29RBM8X6qa5/Tfgh4U0u+gvLe2vfPhbehkv5n/wDZ69Brk9c+JHhzw94m0vw9e6pDHrOpPstrJDud/wAP4aTxh8RNI8FyWlveNcXF7dH9xZ2MDTzP/t7E/hqbwb480fxxY3FxpVxI8ltL5NzazRmKa3f+46Nyprp6KKw/E3hHR/GViLPWtOg1K2Rt6pOmdreq1X8LeBdB8ERzJoul29j53+tkjT53/wB966SiiiuP8S/Czwp4u1JL/WNEtLu8CeX50kfzun9x/wC8PrXS2Njb6bZxW1rClvawpsSGNdqIv0q3RRRRRRRRRRRRRRRRRWR4k8RWHhPQb7WNUnEGn2cTTTSHslfMHxRubLxJ4Ri8X6tqFidZvtV0/wCw2Mdwjvp1n5wfZ/vuPnevqy0vIb63S4gmSeFxlZIX3q1WqKKKK8Q+LPhfStE8a/D6/srC3t72+8TRvc3SJ8837mT771mXUniLVv2gvGNvoDWcF/babZIuo6hE8yW0J3vsRP77v/6LrpvhPrksnjTxhout6dp9v4tszBJealpibEvoXT9y5z/H1r1yiiiiiiiiiiiiiiiiiiiiiiiiiiiiqWpabbaxZy2d7bxXVrKNrwzJvRvwrzP4i/s/+HfGGhQWGm6dp+lTR3kNz5yWw5RJA7p/wKvTNN0220ezis7K3itbWIbUhhTYi/hV2iiiiuO8deCG8Xal4VulultxouqpqDptyJQI3TZ/4/WH4u+HWst4wTxT4P1a30nVpoFtL+G9h86G7hQ/J/uOpz0q78Ovh1c+FtQ1bWta1L+2fE2rsn2y7RNiIicIiL2SvQKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK//Z" alt="示例图片"></td></tr></tbody></table><h3 id="功能体验"><a href="#功能体验" class="headerlink" title="功能体验"></a>功能体验</h3><p>先来体验下功能是否满足咱们的要求吧。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201144855.png" alt="image-20210124201144855"></p><p>以下是用户的”真实”评价🤭：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122112823779.png" alt="image-20210122112823779"></p><h4 id="界面部分"><a href="#界面部分" class="headerlink" title="界面部分"></a><strong>界面部分</strong></h4><p>主页面：负责和用户交互，由相册和相机的功能选择项组成；</p><p>结果界面：负责展示识别的结果的对错信息绘制和展示；</p><h4 id="功能部分"><a href="#功能部分" class="headerlink" title="功能部分"></a><strong>功能部分</strong></h4><p>应用核心：通过调用科大讯飞拍照速算接口快速完成以上的功能；</p><p>算法核心：专题讲座；</p><p>打开微信，下拉在搜索中搜索<strong>比特人生的世界</strong>或者微信扫描以下二维码来体验吧。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122112304076.png" alt="image-20210122112304076"></p><h2 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h2><h3 id="软件下载安装"><a href="#软件下载安装" class="headerlink" title="软件下载安装"></a>软件下载安装</h3><p>安装微信开发者工具：tools/wechat_devtools_1.03.2012120_x64.exe</p><p>或者登录官方地址<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/stable.html" rel="external nofollow noreferrer">下载</a>，点击对应的系统下载即可。</p><p>对安装路径有要求的替换安装的路径，其他的直接下一步，安装完毕后，直接点击完成启动软件，界面如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201226564.png" alt="image-20210124201226564"></p><p>打开手机上的微信软件，扫描以上二维码，验证登录身份。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210115122530079.png" alt="image-20210115122530079"></p><p>在手机微信端，点击上图的确认登录后，即可进入桌面的小程序开发软件进行软件开发了，登录成功后的界面如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201255075.png" alt="image-20210124201255075"></p><h3 id="小程序创建及账号注册"><a href="#小程序创建及账号注册" class="headerlink" title="小程序创建及账号注册"></a>小程序创建及账号注册</h3><p>创建项目名称为quickcalc，源代码存放的目录，开发模式选择小程序，不使用云服务的开发模式，AppID通过点击注册按钮注册。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201318852.png" alt="image-20210124201318852"></p><p>点击注册按钮之后，进入小程序的注册界面，输入完账号信息，从邮箱中激活，便可以进入到小程序的管理页面找到AppID了。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201342413.png" alt="image-20210124201342413"></p><p>进入小程序管理页面后，点击左侧的设置按钮，找到AppID，拷贝到创建小程序的界面中，点击新建项目即可。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201406920.png" alt="image-20210124201406920"></p><p>看到以下界面，表示已经创建完成。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210115134830410.png" alt="image-20210115134830410"></p><h3 id="小程序运行调试"><a href="#小程序运行调试" class="headerlink" title="小程序运行调试"></a>小程序运行调试</h3><p>通过<strong>微信开发工具</strong>可以看到小程序的运行有模拟器运行和真机运行两种调试模式。前期开发可以使用模拟器更方便，后面可以使用真机调试，验证程序运行在手机上的真实效果。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124201524423.png" alt="image-20210124201524423"></p><h3 id="通过小程序搜索进入小程序"><a href="#通过小程序搜索进入小程序" class="headerlink" title="通过小程序搜索进入小程序"></a>通过小程序搜索进入小程序</h3><p>开发好了功能后，是不是想想让别人也体验你的成果呢？</p><p>先别急，先要了解小程序的三种不同的版本：开发版、体验版、发布版。</p><p><strong>开发版</strong>：本地编写好代码直接运行的就是开发版了，开发版只能开发者看到。</p><p><strong>体验版</strong>：体验版需要有两部操作，第一步是点击右上角的上传，第二步是进入<a href="https://mp.weixin.qq.com/" rel="external nofollow noreferrer">微信开发平台</a>，具体步骤如下。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122114147785.png" alt="img"></p><h3 id="通过小程序二维码进入小程序"><a href="#通过小程序二维码进入小程序" class="headerlink" title="通过小程序二维码进入小程序"></a>通过小程序二维码进入小程序</h3><p>成为体验版本和发布版本的小程序可以通过搜索二维码进入小程序，体验版会需要有一个向开发者验证身份的过程，通过开发者确认了后才能进入小程序。</p><p>小程序的二维码获取路径是通过<a href="https://mp.weixin.qq.com/" rel="external nofollow noreferrer">微信开放平台网址</a>登录后，找到左侧的<strong>设置选项</strong>，点击<strong>下载</strong>即可。这样就可以让别人通过二维码进入你的小程序啦。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122114849459.png" alt="image-20210122114849459"></p><h3 id="小程序发布"><a href="#小程序发布" class="headerlink" title="小程序发布"></a>小程序发布</h3><p>小程序的发布流程基本上是开发、上传、审核（几个小时到几天不等）、发布这几个流程。由于小程序的发布具体流程一直在变化，因此具体的要求，可以参考<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/release.html#%E5%8F%91%E5%B8%83%E4%B8%8A%E7%BA%BF" rel="external nofollow noreferrer">官方教程</a>。</p><h2 id="界面设计"><a href="#界面设计" class="headerlink" title="界面设计"></a>界面设计</h2><p>左边是原始界面，右边是我们要做的界面。</p><p>边看边想：界面修改和什么有关？（改改看）</p><p>边看边想：和网页有啥区别？（比比看）</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122115846433.png" alt="image-20210122115846433"></p><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>小程序包含一个描述整体程序的 <code>app</code> 和多个描述各自页面的 <code>page</code>。</p><p>一个小程序主体部分由三个文件组成，必须放在项目的根目录，如下：</p><table><thead><tr><th align="left">文件</th><th align="left">必需</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/app.html" rel="external nofollow noreferrer">app.js</a></td><td align="left">是</td><td align="left">小程序逻辑</td></tr><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html" rel="external nofollow noreferrer">app.json</a></td><td align="left">是</td><td align="left">小程序公共配置</td></tr><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" rel="external nofollow noreferrer">app.wxss</a></td><td align="left">否</td><td align="left">小程序公共样式表</td></tr></tbody></table><p>一个小程序页面由四个文件组成，分别是：</p><table><thead><tr><th align="left">文件类型</th><th align="left">必需</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page.html" rel="external nofollow noreferrer">js</a></td><td align="left">是</td><td align="left">页面逻辑</td></tr><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/" rel="external nofollow noreferrer">wxml</a></td><td align="left">是</td><td align="left">页面结构</td></tr><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE" rel="external nofollow noreferrer">json</a></td><td align="left">否</td><td align="left">页面配置</td></tr><tr><td align="left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" rel="external nofollow noreferrer">wxss</a></td><td align="left">否</td><td align="left">页面样式表</td></tr></tbody></table><p><strong>注意：为了方便开发者减少配置项，描述页面的四个文件必须具有相同的路径与文件名。</strong></p><p>允许上传的文件</p><p>在项目目录中，以下文件会经过编译，因此上传之后无法直接访问到：*.js、app.json、*.wxml、*.wxss（其中 wxml 和 wxss 文件仅针对在 app.json 中配置了的页面）。除此之外，只有后缀名在白名单内的文件可以被上传，不在白名单列表内文件在开发工具能被访问到，但无法被上传。具体白名单列表如下：</p><ol><li> wxs</li><li> png</li><li> jpg</li><li> jpeg</li><li> gif</li><li> svg</li><li> json</li><li> cer</li><li> mp3</li><li> aac</li><li> m4a</li><li> mp4</li><li> wav</li><li> ogg</li><li> silk</li></ol><h3 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h3><p>项目里边生成了不同类型的文件:</p><ol><li> <code>.json</code> 后缀的 <code>JSON</code> 配置文件</li><li> <code>.wxml</code> 后缀的 <code>WXML</code> 模板文件</li><li> <code>.wxss</code> 后缀的 <code>WXSS</code> 样式文件</li><li> <code>.js</code> 后缀的 <code>JS</code> 脚本逻辑文件</li></ol><p>接下来我们分别看看这4种文件的作用。</p><h4 id="配置文件json"><a href="#配置文件json" class="headerlink" title="配置文件json"></a>配置文件json</h4><p><strong>JSON 配置</strong></p><p>JSON 是一种数据格式，并不是编程语言，在小程序中，JSON扮演的静态配置的角色。</p><p>我们可以看到在项目的根目录有一个 <code>app.json</code> 和 <code>project.config.json</code>，此外在 <code>pages/logs</code> 目录下还有一个 <code>logs.json</code>，我们依次来说明一下它们的用途。</p><p><strong>小程序配置 app.json</strong></p><p><code>app.json</code> 是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等。QuickStart 项目里边的 <code>app.json</code> 配置内容如下：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"pages"</span><span class="token operator">:</span><span class="token punctuation">[</span>    <span class="token string">"pages/index/index"</span><span class="token punctuation">,</span>    <span class="token string">"pages/logs/logs"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"window"</span><span class="token operator">:</span><span class="token punctuation">{</span>    <span class="token property">"backgroundTextStyle"</span><span class="token operator">:</span><span class="token string">"light"</span><span class="token punctuation">,</span>    <span class="token property">"navigationBarBackgroundColor"</span><span class="token operator">:</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>    <span class="token property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"Weixin"</span><span class="token punctuation">,</span>    <span class="token property">"navigationBarTextStyle"</span><span class="token operator">:</span><span class="token string">"black"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们简单说一下这个配置各个项的含义:</p><ol><li> <code>pages</code>字段 —— 用于描述当前小程序所有页面路径，这是为了让微信客户端知道当前你的小程序页面定义在哪个目录。</li><li> <code>window</code>字段 —— 定义小程序所有页面的顶部背景颜色，文字颜色定义等。</li></ol><p>其他配置项细节可以参考文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html" rel="external nofollow noreferrer">小程序的配置 app.json</a> 。</p><p><strong>工具配置 project.config.json</strong></p><p>通常大家在使用一个工具的时候，都会针对各自喜好做一些个性化配置，例如界面颜色、编译配置等等，当你换了另外一台电脑重新安装工具的时候，你还要重新配置。</p><p>考虑到这点，小程序开发者工具在每个项目的根目录都会生成一个 <code>project.config.json</code>，你在工具上做的任何配置都会写入到这个文件，当你重新安装工具或者换电脑工作时，你只要载入同一个项目的代码包，开发者工具就自动会帮你恢复到当时你开发项目时的个性化配置，其中会包括编辑器的颜色、代码上传时自动压缩等等一系列选项。</p><p>其他配置项细节可以参考文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html" rel="external nofollow noreferrer">开发者工具的配置</a> 。</p><p><strong>页面配置 page.json</strong></p><p>这里的 <code>page.json</code> 其实用来表示 pages/logs 目录下的 <code>logs.json</code> 这类和小程序页面相关的配置。</p><p>如果你整个小程序的风格是蓝色调，那么你可以在 <code>app.json</code> 里边声明顶部颜色是蓝色即可。实际情况可能不是这样，可能你小程序里边的每个页面都有不一样的色调来区分不同功能模块，因此我们提供了 <code>page.json</code>，让开发者可以独立定义每个页面的一些属性，例如刚刚说的顶部颜色、是否允许下拉刷新等等。</p><p>其他配置项细节可以参考文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE" rel="external nofollow noreferrer">页面配置</a> 。</p><p><strong>JSON 语法</strong></p><p>这里说一下小程序里JSON配置的一些注意事项。</p><p>JSON文件都是被包裹在一个大括号中 {}，通过key-value的方式来表达数据。JSON的Key必须包裹在一个双引号中，在实践中，编写 JSON 的时候，忘了给 Key 值加双引号或者是把双引号写成单引号是常见错误。</p><p>JSON的值只能是以下几种数据格式，其他任何格式都会触发报错，例如 JavaScript 中的 undefined。</p><ol><li> 数字，包含浮点数和整数</li><li> 字符串，需要包裹在双引号中</li><li> Bool值，true 或者 false</li><li> 数组，需要包裹在方括号中 []</li><li> 对象，需要包裹在大括号中 {}</li><li> Null</li></ol><p>还需要注意的是 JSON 文件中无法使用注释，试图添加注释将会引发报错。</p><h4 id="布局文件WXML"><a href="#布局文件WXML" class="headerlink" title="布局文件WXML"></a>布局文件WXML</h4><p>从事过网页编程的人知道，网页编程采用的是 HTML + CSS + JS 这样的组合，其中 <code>HTML</code> 是用来描述当前这个页面的结构，<code>CSS</code> 用来描述页面的样子，<code>JS</code> 通常是用来处理这个页面和用户的交互。</p><p>同样道理，在小程序中也有同样的角色，其中 <code>WXML</code> 充当的就是类似 <code>HTML</code> 的角色。打开 <code>pages/index/index.wxml</code>，你会看到以下的内容:</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userinfo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{!hasUserInfo &amp;&amp; canIUse}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 获取头像昵称 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{userInfo.avatarUrl}}<span class="token punctuation">"</span></span> <span class="token attr-name">background-size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userinfo-nickname<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{userInfo.nickName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>usermotto<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-motto<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{motto}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和 <code>HTML</code> 非常相似，<code>WXML</code> 由标签、属性等等构成。但是也有很多不一样的地方，我们来一一阐述一下：</p><ol><li><p>标签名字有点不一样</p><p> 往往写 HTML 的时候，经常会用到的标签是 <code>div</code>, <code>p</code>, <code>span</code>，开发者在写一个页面的时候可以根据这些基础的标签组合出不一样的组件，例如日历、弹窗等等。换个思路，既然大家都需要这些组件，为什么我们不能把这些常用的组件包装起来，大大提高我们的开发效率。</p><p> 从上边的例子可以看到，小程序的 <code>WXML</code> 用的标签是 <code>view</code>, <code>button</code>, <code>text</code> 等等，这些标签就是小程序给开发者包装好的基本能力，我们还提供了地图、视频、音频等等组件能力。</p><p> 更多详细的组件讲述参考下个章节 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/framework.html" rel="external nofollow noreferrer">小程序的能力</a></p></li><li><p>多了一些wx:if这样的属性以及 <code>&#123;&#123; &#125;&#125;</code> 这样的表达式</p></li></ol><p>在网页的一般开发流程中，我们通常会通过 <code>JS</code> 操作 <code>DOM</code> (对应 <code>HTML</code> 的描述产生的树)，以引起界面的一些变化响应用户的行为。例如，用户点击某个按钮的时候，<code>JS</code> 会记录一些状态到 <code>JS</code> 变量里边，同时通过 DOM API 操控 <code>DOM</code> 的属性或者行为，进而引起界面一些变化。当项目越来越大的时候，你的代码会充斥着非常多的界面交互逻辑和程序的各种状态变量，显然这不是一个很好的开发模式，因此就有了 MVVM 的开发模式（例如 React, Vue），提倡把渲染和逻辑分离。简单来说就是不要再让 <code>JS</code> 直接操控 <code>DOM</code>，<code>JS</code> 只需要管理状态即可，然后再通过一种模板语法来描述状态和界面结构的关系即可。</p><p>小程序的框架也是用到了这个思路，如果你需要把一个 <code>Hello World</code> 的字符串显示在界面上。</p><p>WXML 是这么写 :</p><pre><code>```html&lt;text&gt;&#123;&#123;msg&#125;&#125;&lt;/text&gt;</code></pre><pre><code>JS 只需要管理状态即可:    ```js    this.setData(&#123; msg: &quot;Hello World&quot; &#125;)</code></pre><pre><code>通过 &#123;&#123; &#125;&#125; 的语法把一个变量绑定到界面上，我们称为数据绑定。仅仅通过数据绑定还不够完整的描述状态和界面的关系，还需要 `if`/`else`, `for`等控制能力，在小程序里边，这些控制能力都用 `wx:` 开头的属性来表达。</code></pre><p>更详细的文档可以参考 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/" rel="external nofollow noreferrer">WXML</a></p><h4 id="样式文件WXSS"><a href="#样式文件WXSS" class="headerlink" title="样式文件WXSS"></a>样式文件WXSS</h4><p><code>WXSS</code> 具有 <code>CSS</code> 大部分的特性，小程序在 <code>WXSS</code> 也做了一些扩充和修改。</p><ol><li> 新增了尺寸单位。在写 <code>CSS</code> 样式时，开发者需要考虑到手机设备的屏幕会有不同的宽度和设备像素比，采用一些技巧来换算一些像素单位。<code>WXSS</code> 在底层支持新的尺寸单位 <code>rpx</code> ，开发者可以免去换算的烦恼，只要交给小程序底层来换算即可，由于换算采用的浮点数运算，所以运算结果会和预期结果有一点点偏差。</li><li> 提供了全局的样式和局部样式。和前边 <code>app.json</code>, <code>page.json</code> 的概念相同，你可以写一个 <code>app.wxss</code> 作为全局样式，会作用于当前小程序的所有页面，局部页面样式 <code>page.wxss</code> 仅对当前页面生效。</li><li> 此外 <code>WXSS</code> 仅支持部分 <code>CSS</code> 选择器</li></ol><p>更详细的文档可以参考 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" rel="external nofollow noreferrer">WXSS</a> 。</p><h4 id="界面和代码结合"><a href="#界面和代码结合" class="headerlink" title="界面和代码结合"></a>界面和代码结合</h4><p>一个服务仅仅只有界面展示是不够的，还需要和用户做交互：响应用户的点击、获取用户的位置等等。在小程序里边，我们就通过编写 <code>JS</code> 脚本文件来处理用户的操作。</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clickMe<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>点击 <code>button</code> 按钮的时候，我们希望把界面上 <code>msg</code> 显示成 <code>&quot;Hello World&quot;</code>，于是我们在 <code>button</code> 上声明一个属性: <code>bindtap</code> ，在 JS 文件里边声明了 <code>clickMe</code> 方法来响应这次点击操作：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  clickMe<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> msg<span class="token punctuation">:</span> <span class="token string">"Hello World"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>响应用户的操作就是这么简单，更详细的事件可以参考文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html" rel="external nofollow noreferrer">WXML - 事件</a> 。</p><p>此外你还可以在 JS 中调用小程序提供的丰富的 API，利用这些 API 可以很方便的调起微信提供的能力，例如获取用户信息、本地存储、微信支付等。在前边的 QuickStart 例子中，在 <code>pages/index/index.js</code> 就调用了 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserInfo.html" rel="external nofollow noreferrer">wx.getUserInfo</a> 获取微信用户的头像和昵称，最后通过 <code>setData</code> 把获取到的信息显示到界面上。更多 API 可以参考文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html" rel="external nofollow noreferrer">小程序的API</a> 。</p><p>通过这个章节，你了解了小程序涉及到的文件类型以及对应的角色，在<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/framework.html" rel="external nofollow noreferrer">下个章节</a>中，我们把这一章所涉及到的文件通过 “小程序的框架” 给 “串” 起来，让他们都工作起来。</p><h3 id="目标布局修改演示"><a href="#目标布局修改演示" class="headerlink" title="目标布局修改演示"></a>目标布局修改演示</h3><h4 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h4><p>左边是新创建出的小程序，右边是界面设计的参考目标。</p><p>也可以自己发挥设计自己喜欢的风格😄，保留具备相册和相机的两个功能即可。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124131842062.png" alt="image-20210124131842062"></p><h4 id="界面元素分析"><a href="#界面元素分析" class="headerlink" title="界面元素分析"></a>界面元素分析</h4><p>背景图：居中对齐；</p><p>两个按钮：表格对齐，配置图片和文字；位置尽量靠近用户方便点击的位置；</p><p>灰白色背景：放置到两个按钮的后面，当作按钮功能的桌布，注意颜色搭配；</p><h4 id="绘制背景"><a href="#绘制背景" class="headerlink" title="绘制背景"></a>绘制背景</h4><p>找一张和内容搭配的背景图片，放到工程中，路径为images/welcome.png</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124133803332.png" alt="image-20210124133803332"></p><p>修改布局文件index.wxml如下（可以把之前index.wxml内容删除）:</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>bg<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/images/welcome.png<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>显示效果如下，可以看到图片默认被布局到了最上面，并且是填充满的，我们的目标是布局到中间，因此可以通过index.wxss样式文件来修改</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124134501857.png" alt="image-20210124134501857"></p><p>修改index.wxss文件，让背景图片居中显示：</p><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.bg</span> </span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">750</span>rpx<span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid green<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124140803618.png" alt="image-20210124140803618"></p><h4 id="绘制两个按钮"><a href="#绘制两个按钮" class="headerlink" title="绘制两个按钮"></a>绘制两个按钮</h4><p>在index.wxml中增加以下内容</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>photoImg<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/images/photo.png<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">60</span>rpx<span class="token punctuation">;</span> height=<span class="token number">60</span>rpx</span><span class="token punctuation">'</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>aspectFit<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cst<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>相册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>从相册选择<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cameraImg<span class="token punctuation">"</span></span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/images/camera.png<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">60</span>rpx<span class="token punctuation">;</span> height=<span class="token number">60</span>rpx</span><span class="token punctuation">'</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>aspectFit<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cst<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>相机<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>拍照扫描<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示效果：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124161023708.png" alt="image-20210124161023708"></p><p>使用CSS排版</p><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.photo</span> </span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#FFF</span><span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span>px <span class="token number">0</span>px <span class="token number">50</span>px <span class="token hexcode">#000000</span><span class="token number">18</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.camera</span></span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#FFF</span><span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span>px <span class="token number">0</span>px <span class="token number">10</span>px <span class="token hexcode">#000000</span><span class="token number">18</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.photoImg</span> </span><span class="token punctuation">{</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">20</span>rpx <span class="token number">0</span> <span class="token number">40</span>rpx<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">60</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.cameraImg</span> </span><span class="token punctuation">{</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">20</span>rpx <span class="token number">0</span> <span class="token number">40</span>rpx<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">60</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124161611025.png" alt="image-20210124161611025"></p><p>增加Grid布局，让两个按钮按行的方式布局</p><p>index.wxml：</p><pre><code>&lt;view class=&quot;operateButtons&quot;&gt;  &lt;view class=&quot;photo&quot; bindtap=&quot;photo&quot;&gt;    &lt;image class=&quot;photoImg&quot; src=&quot;/images/photo.png&quot; style=&#39;width:60rpx; height=60rpx&#39; mode=&#39;aspectFit&#39;&gt;&lt;/image&gt;    &lt;view class=&quot;cst&quot;&gt;      &lt;view class=&quot;t1&quot;&gt;相册&lt;/view&gt;      &lt;view class=&quot;t2&quot;&gt;从相册选择&lt;/view&gt;    &lt;/view&gt;  &lt;/view&gt;  &lt;view class=&quot;camera&quot; bindtap=&quot;camera&quot;&gt;    &lt;image class=&quot;cameraImg&quot;  src=&quot;/images/camera.png&quot; style=&#39;width:60rpx; height=60rpx&#39; mode=&#39;aspectFit&#39;&gt;&lt;/image&gt;    &lt;view class=&quot;cst&quot;&gt;      &lt;view class=&quot;t1&quot;&gt;相机&lt;/view&gt;      &lt;view class=&quot;t2&quot;&gt;拍照扫描&lt;/view&gt;    &lt;/view&gt;  &lt;/view&gt;&lt;/view&gt;</code></pre><p>index.wxss样式文件：</p><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.operateButtons</span></span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span>  <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">100%</span> - <span class="token number">50%</span> - <span class="token number">10</span>rpx<span class="token punctuation">)</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">100%</span> - <span class="token number">50%</span> - <span class="token number">10</span>rpx<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">grid-column-gap</span><span class="token punctuation">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124162127818.png" alt="image-20210124162127818"></p><p>把两个按钮靠手机底部放置，让用户更加容易点击：</p><p>index.wxml布局文件：</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--index.wxml--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>bg<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/images/welcome.png<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>operationDIV<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">bottom</span><span class="token punctuation">:</span><span class="token number">50</span>rpx</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>operateButtons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>photo<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>photo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>photoImg<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/images/photo.png<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">60</span>rpx<span class="token punctuation">;</span> height=<span class="token number">60</span>rpx</span><span class="token punctuation">'</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>aspectFit<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cst<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>相册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>从相册选择<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>camera<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>camera<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cameraImg<span class="token punctuation">"</span></span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/images/camera.png<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">60</span>rpx<span class="token punctuation">;</span> height=<span class="token number">60</span>rpx</span><span class="token punctuation">'</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>aspectFit<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cst<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>相机<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>拍照扫描<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bccDIV<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>index.wxss样式文件：</p><pre class="line-numbers language-css"><code class="language-css"><span class="token comment" spellcheck="true">/**index.wxss**/</span><span class="token selector">page </span><span class="token punctuation">{</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#448AFF</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.bg</span> </span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">750</span>rpx<span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>rpx<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">/* border: 1px solid green; */</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> </span><span class="token punctuation">{</span>  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>  <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span>  <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span>  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">/* border: 1px solid green; */</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.operateButtons</span></span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span>  <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">100%</span> - <span class="token number">50%</span> - <span class="token number">10</span>rpx<span class="token punctuation">)</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">100%</span> - <span class="token number">50%</span> - <span class="token number">10</span>rpx<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">grid-column-gap</span><span class="token punctuation">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.photoImg</span> </span><span class="token punctuation">{</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">20</span>rpx <span class="token number">0</span> <span class="token number">40</span>rpx<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">60</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.cameraImg</span> </span><span class="token punctuation">{</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">20</span>rpx <span class="token number">0</span> <span class="token number">40</span>rpx<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">60</span>rpx<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.photo</span> </span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#FFF</span><span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span>px <span class="token number">0</span>px <span class="token number">10</span>px <span class="token hexcode">#000000</span><span class="token number">18</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.camera</span></span><span class="token punctuation">{</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>rpx<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#FFF</span><span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span>px <span class="token number">0</span>px <span class="token number">10</span>px <span class="token hexcode">#000000</span><span class="token number">18</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.t1</span> </span><span class="token punctuation">{</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">30</span>rpx<span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#333</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.operationDIV</span> <span class="token class">.t2</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">28</span>rpx<span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#999999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.bccDIV</span></span><span class="token punctuation">{</span>  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span>rpx<span class="token punctuation">;</span>  <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">240</span>, <span class="token number">240</span>, <span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后的效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124162601928.png" alt="image-20210124162601928"></p><h4 id="让按钮可以触发事件"><a href="#让按钮可以触发事件" class="headerlink" title="让按钮可以触发事件"></a>让按钮可以触发事件</h4><p>使用bingtap属性给wxml中的view添加点击事件，语法如下：</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>photo<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>photo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>camera<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>camera<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这样就赋予了class为photo和camera的view具备了点击的能力，当按钮被单击时，会去执行bingtap指定的photo和camera方法。</p><p>在index.js中增加两个函数，当点击相册和相机按钮时，观察console中是否有相关的日志信息。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token function">photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'photo'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">camera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'camera'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>点击两个按钮，console显示的结果信息：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124163213292.png" alt="image-20210124163213292"></p><h2 id="软件框架与功能"><a href="#软件框架与功能" class="headerlink" title="软件框架与功能"></a>软件框架与功能</h2><h3 id="功能模块"><a href="#功能模块" class="headerlink" title="功能模块"></a>功能模块</h3><p>根据之前体验的内容，大致可以把用户的操作分为四个模块部分：</p><ol><li> 打开相册选择图片</li><li> 把图片上传给讯飞服务器识别</li><li> 服务器返回识别结果</li><li> 绘制识别结果并显示</li></ol><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124190753082.png" alt="image-20210124190753082"></p><p>整体的功能流程如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210124193117306.png" alt="image-20210124193117306"></p><h3 id="技能图"><a href="#技能图" class="headerlink" title="技能图"></a>技能图</h3><p>要完成整体功能，需要的技能如下，也可以通过以下的链接实时查看。</p><p><a href="https://kdocs.cn/l/sbvLWu1HUzXZ" rel="external nofollow noreferrer">静态技能思维导图-拍拍题小程序</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122145027362.png" alt="image-20210122145027362"></p><h3 id="Button事件处理技能"><a href="#Button事件处理技能" class="headerlink" title="Button事件处理技能"></a>Button事件处理技能</h3><p>点击界面的按钮一般都需要触发相关的事件，点击按钮和触发相关的事件联系演示如下。</p><p>详细信息可以参考微信<a href="https://developers.weixin.qq.com/miniprogram/dev/component/button.html" rel="external nofollow noreferrer">官方文档</a>。</p><p><strong>创建一个按钮</strong></p><p>打开index.wxml文件，增加以下一行</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>button<span class="token punctuation">'</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>primary<span class="token punctuation">'</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>click<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>显示结果：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122150503841.png" alt="image-20210122150503841"></p><p>以上说明：</p><pre><code>&lt;button&gt;&lt;/button&gt;：表示一个按钮；&lt;button&gt;按钮&lt;/button&gt;：按钮显示的文本；class可以在样式文件中引用，从而改变按钮的样式；type表示按钮显示的颜色；bingtap表示按钮单击时，会触发的行为动作为click</code></pre><p><strong>创建按钮的样式</strong></p><p>如果对按钮在画面中的位置样式等有调整，可以在<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" rel="external nofollow noreferrer">wxss</a>中修改，并查看所有支持的内容。</p><p>由于微信的wxss文件参考css文件格式，可以通过<a href="https://www.runoob.com/css/css-tutorial.html" rel="external nofollow noreferrer">css教程</a>查看对应的内容。</p><p>打开index.wxss文件，增加以下内容并Ctrl+s保存，观察界面的变化：</p><pre class="line-numbers language-css"><code class="language-css"><span class="token selector">button</span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span><span class="token number">100</span>px<span class="token punctuation">;</span>    <span class="token property">top</span><span class="token punctuation">:</span><span class="token number">150</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>给按钮绑定处理事件</strong></p><p>打开index.js文件，增加click()方法</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The button is clicked'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122155507761.png" alt="image-20210122155507761"></p><h3 id="图片处理技能"><a href="#图片处理技能" class="headerlink" title="图片处理技能"></a>图片处理技能</h3><h4 id="chooseImage"><a href="#chooseImage" class="headerlink" title="chooseImage"></a>chooseImage</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html" rel="external nofollow noreferrer">原型</a>：从本地相册选择图片或使用相机拍照。</p><pre><code>wx.chooseImage(Object object)</code></pre><p>示例：count是最多可以选择的图片张数，最多9张，sizeType是所选的图片的尺寸，sourceType选择图片的来源。返回值res.tempFilePaths是图片的本地临时文件路径列表 (本地路径)</p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  sizeType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'original'</span><span class="token punctuation">,</span> <span class="token string">'compressed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  sourceType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">,</span> <span class="token string">'camera'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// tempFilePath可以作为img标签的src属性显示图片</span>    <span class="token keyword">const</span> tempFilePaths <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="getImageInfo"><a href="#getImageInfo" class="headerlink" title="getImageInfo"></a>getImageInfo</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.getImageInfo.html" rel="external nofollow noreferrer">原型</a>：获取图片信息。网络图片需先配置download域名才能生效。</p><pre><code>wx.getImageInfo(Object object)</code></pre><p>示例：src是图片的路径，支持网络路径、本地路径、代码包路径，返回值res.width是图片原始宽度，单位px，res.height是图片原始高度，单位px。</p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">getImageInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  src<span class="token punctuation">:</span> <span class="token string">'images/a.jpg'</span><span class="token punctuation">,</span>  success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>width<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>height<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    wx<span class="token punctuation">.</span><span class="token function">getImageInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      src<span class="token punctuation">:</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>width<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>height<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://developers.weixin.qq.com/s/Kd47Sbmr6yYu" rel="external nofollow noreferrer">在开发者工具中预览效果</a></p><h4 id="readFile"><a href="#readFile" class="headerlink" title="readFile"></a>readFile</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readFile.html" rel="external nofollow noreferrer">原型</a>：读取本地文件内容</p><pre><code>FileSystemManager.readFile(Object object)</code></pre><p>示例：其中filePath是要读取的文件的路径 (本地路径)，encoding指定读取文件的字符编码，如果不传 encoding，则以 ArrayBuffer 格式读取文件的二进制内容</p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    filePath<span class="token punctuation">:</span> photo<span class="token punctuation">,</span>    encoding<span class="token punctuation">:</span> <span class="token string">'base64'</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">fail</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="saveImageToPhotosAlbum"><a href="#saveImageToPhotosAlbum" class="headerlink" title="saveImageToPhotosAlbum"></a>saveImageToPhotosAlbum</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.saveImageToPhotosAlbum.html" rel="external nofollow noreferrer">原型</a>：保存图片到系统相册</p><p>示例：其中url必须是图片文件路径，可以是临时文件路径或永久文件路径 (本地路径) ，不支持网络路径</p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">saveImageToPhotosAlbum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    filePath<span class="token punctuation">:</span> <span class="token string">'url'</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            content<span class="token punctuation">:</span> <span class="token string">'图片已保存到相册，去晒一下吧~'</span><span class="token punctuation">,</span>            showCancel<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            confirmText<span class="token punctuation">:</span> <span class="token string">'好哒'</span><span class="token punctuation">,</span>            confirmColor<span class="token punctuation">:</span> <span class="token string">'#72B9C3'</span><span class="token punctuation">,</span>            success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户点击确定'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="小程序同步处理Promise和then"><a href="#小程序同步处理Promise和then" class="headerlink" title="小程序同步处理Promise和then"></a>小程序同步处理Promise和then</h3><p>Promise是JavaScript的内置对象，then属于Promise的方法，then：Promise.prototype.then()</p><p>Promise如同它的本身含义，保证Promise内的代码执行完毕，才会执行then内的代码。也可以简单理解为then是Promise的回调函数，resolve表示成功的回调，reject表示失败的回调。</p><p>示例代码：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"Promise"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"then result:"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"then err:"</span> <span class="token operator">+</span> err<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果，调用reject会得到另一个结果：</p><pre class="line-numbers language-js"><code class="language-js">then result<span class="token punctuation">:</span>Promise<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="加解密模块"><a href="#加解密模块" class="headerlink" title="加解密模块"></a>加解密模块</h3><p>加解密模块使用谷歌开源的CryptoJs模块，功能强大，包含很多的前端解密算法。</p><p><a href="https://github.com/brix/crypto-js/releases" rel="external nofollow noreferrer">Github下载地址</a>或者使用提供的lib目录下的crypto-js-4.0.0.zip</p><p>解压之后放到utils目录下，如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210118102547915.png" alt="image-20210118102547915"></p><p><strong>注意</strong>，使用前需要导入这个包：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> CryptoJS <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'utils/crypto-js/crypto-js.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以下所有的加解密的结果，都可以在<a href="http://www.bejson.com/%E8%BF%9B%E8%A1%8C%E7%BB%93%E6%9E%9C%E7%9A%84%E9%AA%8C%E8%AF%81%E3%80%82" rel="external nofollow noreferrer">http://www.bejson.com/进行结果的验证。</a></p><h4 id="base64加解密"><a href="#base64加解密" class="headerlink" title="base64加解密"></a>base64加解密</h4><p>加密示例：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> base64encode <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'待加密字符串'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>base64encode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>解密示例：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> base64decode <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"5b6F5Yqg5a+G5a2X56ym5Liy"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>base64decode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="sha256加密"><a href="#sha256加密" class="headerlink" title="sha256加密"></a>sha256加密</h4><p>加密示例：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> sha256 <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token function">SHA256</span><span class="token punctuation">(</span><span class="token string">'待加密字符串'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sha256<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="hmac256加密"><a href="#hmac256加密" class="headerlink" title="hmac256加密"></a>hmac256加密</h4><p>调用方法，CryptoJS.HmacSHA256需要两个参数，第一个参数是需要加密的数据，第二个参数是加密的key。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> hmacsha256 <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token function">HmacSHA256</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hmacsha256<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Json数据模块"><a href="#Json数据模块" class="headerlink" title="Json数据模块"></a>Json数据模块</h3><p>JSON: <strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation(JavaScript 对象表示法)</p><p>JSON 是存储和交换文本信息的语法，类似 XML。</p><p>JSON 比 XML 更小、更快，更易解析。</p><p>JSON 语法是 JavaScript 对象表示语法的子集。</p><ul><li>  数据在名称/值对中</li><li>  数据由逗号分隔</li><li>  大括号 <strong>{}</strong> 保存对象</li><li>  中括号 <strong>[]</strong> 保存数组，数组可以包含多个对象</li></ul><p>一个简单的Json字符串例子：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tupaipai"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Json序列化和反序列化</strong></p><p>序列化是把代码中的数据key : value转化为Json字符串的过程，反序列化相反，下面看一个例子：</p><pre class="line-numbers language-json"><code class="language-json">var jsonData = '<span class="token punctuation">{</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tupaipai"</span> <span class="token punctuation">}</span>'var jsonParse = JSON.parse(jsonData<span class="token punctuation">)</span>console.log(jsonParse.name<span class="token punctuation">)</span>var jsonString = JSON.stringify(jsonParse<span class="token punctuation">)</span>console.log(jsonString<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打印结果：</p><pre class="line-numbers language-json"><code class="language-json">tupaipai<span class="token punctuation">{</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"tupaipai"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="网络模块"><a href="#网络模块" class="headerlink" title="网络模块"></a>网络模块</h3><p>原型：发起 HTTPS 网络请求。</p><pre><code>wx.request(Object object)</code></pre><p>示例：</p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span> <span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span>  success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>demo：访问百度网页，并得到网内容并展示</p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    url<span class="token punctuation">:</span> <span class="token string">'http://www.baidu.com'</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            filePath<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wx<span class="token punctuation">.</span>env<span class="token punctuation">.</span>USER_DATA_PATH<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html`</span></span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">,</span>            <span class="token function">success</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wx<span class="token punctuation">.</span>env<span class="token punctuation">.</span>USER_DATA_PATH<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html`</span></span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过console打印的信息栏里，点击打开<a href="http://usr/index.html%EF%BC%8C%E6%98%BE%E7%A4%BA%E5%A6%82%E4%B8%8B%EF%BC%9A" rel="external nofollow noreferrer">http://usr/index.html，显示如下：</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210122175426778.png" alt="image-20210122175426778"></p><h3 id="其他模块"><a href="#其他模块" class="headerlink" title="其他模块"></a>其他模块</h3><h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>获取GMT时间</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="canvas绘制"><a href="#canvas绘制" class="headerlink" title="canvas绘制"></a>canvas绘制</h3><p>wxml中需要增加一个canvas，以下定义一个canvas，宽度和高度由代码data数据中的width和height决定。</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>canv<span class="token punctuation">'</span></span> <span class="token attr-name">canvas-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>shareImg<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>width<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">px; height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>height<span class="token punctuation">}</span><span class="token punctuation">}</span>px</span><span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>绘制图片。以下绘制的图片源时imagePath，从x=0,y=0像素开始绘制，绘制的宽和高时res.width和res.height</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">'shareImg'</span><span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>width<span class="token punctuation">,</span> res<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>绘制空心矩形。以下绘制一个红色的空心矩形。</p><p>setStrokeStyle表示绘制的颜色是red</p><p>strokeRect表示绘制的是空心的矩形，0，0，100，100分别代表绘制的x,y,width,height</p><p>draw表示开始绘制以上提交的绘制请求</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">'shareImg'</span><span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="图片速算核心功能"><a href="#图片速算核心功能" class="headerlink" title="图片速算核心功能"></a>图片速算核心功能</h2><p>这个阶段完成的主要功能是<strong>输入图片</strong>，输出图片识别出来的<strong>输出文字结果</strong>即可。</p><p><strong>输入图片</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210123123444326.png" alt="image-20210123123444326"></p><p><strong>算术识别结果</strong>：</p><pre><code>对:2 + 3 = 5错:2 元 3 ( m ) = ( 2 . 3 ) 元对:7 \times 9 = 6 3对:9 0 + = ( 5 4 0 ) 分错:1 5 + 1 5 = 2 0对:3 ^ &#123; 2 &#125; = 9对:5 - 2 &lt; 4错:\frac &#123; 7 &#125; &#123; 9 &#125; &lt; \frac &#123; 5 &#125; &#123; 9 &#125;错:3 8 分 米 = ( 3 8 0 0 ) 厘 米</code></pre><h3 id="用例图"><a href="#用例图" class="headerlink" title="用例图"></a>用例图</h3><p>通过题拍拍的功能体验，可以把用户的操作过程分为：点击相册、获取照片、获取对错结果、结果显示这几个部分。我们从技术的角度把这个过程使用用例图描述下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201222143316997.png"></p><p>以上的用例图中所描述的是用户的操作对应的技术内容。拿上一章节的技能填充如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210123125057731.png" alt="image-20210123125057731"></p><h3 id="程序开发流程图"><a href="#程序开发流程图" class="headerlink" title="程序开发流程图"></a>程序开发流程图</h3><p>根据用例图和<a href="https://www.xfyun.cn/doc/words/photo-calculate-recg/API.html" rel="external nofollow noreferrer">讯飞的开发文档</a>分析得到以下的开发流程图：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210123125412550.png" alt="image-20210123125412550"></p><h3 id="分步骤编码"><a href="#分步骤编码" class="headerlink" title="分步骤编码"></a>分步骤编码</h3><h4 id="获取图片"><a href="#获取图片" class="headerlink" title="获取图片"></a>获取图片</h4><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    sizeType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'compressed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    sourceType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过打印信息查看文件是否能够正常打开，然后继续下一步；</p><h4 id="构造发送请求"><a href="#构造发送请求" class="headerlink" title="构造发送请求"></a>构造发送请求</h4><p>接下来是把图片发送给服务器，请求服务器要求如下：</p><p><strong>请求head要求</strong></p><pre><code>Content-Type:application/jsonAccept:application/json,version=1.0Host:rest-api.xfyun.cnDate:Mon, 18 Mar 2019 08:32:07 GMTDigest:SHA-256=Base64(SHA256(请求body))Authorization:api_key=&quot;your_key&quot;, algorithm=&quot;hmac-sha256&quot;, headers=&quot;host date request-line digest&quot;, signature=&quot;$signature&quot;</code></pre><p>其中signature的要求</p><pre><code>signature=base64(signature_sha)signature_sha=hmac-sha256(signature_origin,$apiSecret)</code></pre><p>signature_origin内容：</p><pre><code>host: rest-api.xfyun.cndate: Tue, 30 Jul 2019 07:51:27 GMTPOST /v2/itr HTTP/1.1digest: SHA-256=Base64(SHA256(请求body))</code></pre><p><strong>请求body</strong></p><p>image是咱们要上传识别的图片，需要通过base64加密上传</p><pre><code>&#123;    &quot;common&quot;: &#123;        &quot;app_id&quot;: &quot;xxXXXXXX&quot;    &#125;,    &quot;business&quot;: &#123;        &quot;ent&quot;: &quot;math-arith&quot;,        &quot;aue&quot;: &quot;raw&quot;    &#125;,    &quot;data&quot;: &#123;        &quot;image&quot;: base64(图片)    &#125;&#125;</code></pre><p>构造head和body的请求代码如下，<strong>注意替换以下的app_id和api_key为自己在讯飞开放平台注册的相关值。</strong></p><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    filePath<span class="token punctuation">:</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    encoding<span class="token punctuation">:</span> <span class="token string">'base64'</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">"common"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token string">"app_id"</span><span class="token punctuation">:</span> <span class="token string">"你的讯飞appid"</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token string">"business"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token string">"ent"</span><span class="token punctuation">:</span> <span class="token string">"math-arith"</span><span class="token punctuation">,</span>                <span class="token string">"aue"</span><span class="token punctuation">:</span> <span class="token string">"raw"</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token string">"image"</span><span class="token punctuation">:</span> res<span class="token punctuation">.</span>data            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 获取当前GMT时间</span>        <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Date:"</span> <span class="token operator">+</span> date<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 获取Digest</span>        <span class="token keyword">let</span> base64body <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> digest <span class="token operator">=</span> <span class="token string">'SHA-256='</span> <span class="token operator">+</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span><span class="token function">SHA256</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>base64body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Digest:"</span> <span class="token operator">+</span> digest<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 获取Authorization</span>        <span class="token keyword">let</span> signatureOrigin <span class="token operator">=</span> <span class="token template-string"><span class="token string">`host: rest-api.xfyun.cn\ndate: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\nPOST /v2/itr HTTP/1.1\ndigest: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>digest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>        <span class="token keyword">let</span> signatureSha <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token function">HmacSHA256</span><span class="token punctuation">(</span>signatureOrigin<span class="token punctuation">,</span> <span class="token string">'4f49ab1f8b4c430f3536e54d111eb705'</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> signature <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>signatureSha<span class="token punctuation">)</span>        <span class="token keyword">let</span> authorizationOrigin <span class="token operator">=</span> <span class="token template-string"><span class="token string">`api_key="你的讯飞应用apikey", algorithm="hmac-sha256", headers="host date request-line digest", signature="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>signature<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"`</span></span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"authorizationOrigin:"</span> <span class="token operator">+</span> authorizationOrigin<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="发送服务器"><a href="#发送服务器" class="headerlink" title="发送服务器"></a>发送服务器</h4><pre class="line-numbers language-js"><code class="language-js">wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    url<span class="token punctuation">:</span> <span class="token string">'https://rest-api.xfyun.cn/v2/itr'</span><span class="token punctuation">,</span>    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> body<span class="token punctuation">,</span>    header<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">"Date"</span><span class="token punctuation">:</span> date<span class="token punctuation">,</span>        <span class="token string">"Digest"</span><span class="token punctuation">:</span> digest<span class="token punctuation">,</span>        <span class="token string">"Authorization"</span><span class="token punctuation">:</span> authorizationOrigin<span class="token punctuation">,</span>        <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>        <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json,version=1.0"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> jsonString <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="图片速算完整代码"><a href="#图片速算完整代码" class="headerlink" title="图片速算完整代码"></a>图片速算完整代码</h3><p>注意替换以下的app_id和api_key为自己在讯飞开放平台注册的相关值。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">let</span> than <span class="token operator">=</span> <span class="token keyword">this</span>wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    sizeType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'compressed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    sourceType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            filePath<span class="token punctuation">:</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            encoding<span class="token punctuation">:</span> <span class="token string">'base64'</span><span class="token punctuation">,</span>            <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token punctuation">{</span>                    <span class="token string">"common"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                        <span class="token string">"app_id"</span><span class="token punctuation">:</span> <span class="token string">"xxxxxxxx"</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token string">"business"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                        <span class="token string">"ent"</span><span class="token punctuation">:</span> <span class="token string">"math-arith"</span><span class="token punctuation">,</span>                        <span class="token string">"aue"</span><span class="token punctuation">:</span> <span class="token string">"raw"</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                        <span class="token string">"image"</span><span class="token punctuation">:</span> res<span class="token punctuation">.</span>data                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">// 获取当前GMT时间</span>                <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Date:"</span> <span class="token operator">+</span> date<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// 获取Digest</span>                <span class="token keyword">let</span> base64body <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">let</span> digest <span class="token operator">=</span> <span class="token string">'SHA-256='</span> <span class="token operator">+</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span><span class="token function">SHA256</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>base64body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Digest:"</span> <span class="token operator">+</span> digest<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// 获取Authorization</span>                <span class="token keyword">let</span> signatureOrigin <span class="token operator">=</span> <span class="token template-string"><span class="token string">`host: rest-api.xfyun.cn\ndate: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\nPOST /v2/itr HTTP/1.1\ndigest: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>digest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>                <span class="token keyword">let</span> signatureSha <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token function">HmacSHA256</span><span class="token punctuation">(</span>signatureOrigin<span class="token punctuation">,</span> <span class="token string">'4f49ab1f8b4c430f3536e54d111eb705'</span><span class="token punctuation">)</span>                <span class="token keyword">let</span> signature <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>signatureSha<span class="token punctuation">)</span>                <span class="token keyword">let</span> authorizationOrigin <span class="token operator">=</span> <span class="token template-string"><span class="token string">`api_key="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", algorithm="hmac-sha256", headers="host date request-line digest", signature="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>signature<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"`</span></span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"authorizationOrigin:"</span> <span class="token operator">+</span> authorizationOrigin<span class="token punctuation">)</span>                wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    url<span class="token punctuation">:</span> <span class="token string">'https://rest-api.xfyun.cn/v2/itr'</span><span class="token punctuation">,</span>                    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>                    data<span class="token punctuation">:</span> body<span class="token punctuation">,</span>                    header<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        <span class="token string">"Date"</span><span class="token punctuation">:</span> date<span class="token punctuation">,</span>                        <span class="token string">"Digest"</span><span class="token punctuation">:</span> digest<span class="token punctuation">,</span>                        <span class="token string">"Authorization"</span><span class="token punctuation">:</span> authorizationOrigin<span class="token punctuation">,</span>                        <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>                        <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json,version=1.0"</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">var</span> jsonString <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h4><p>返回的内容是识别出的算术信息，以json格式给出，内容如下</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"ITRResult"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"attr_exception"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"math_phfw_arith"</span><span class="token punctuation">,</span>            <span class="token property">"multi_line_info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token property">"imp_line_info"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">87</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">303</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">361</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">410</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">1</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">533</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">340</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">950</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">434</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">96</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">457</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">367</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">575</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">1</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">579</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">464</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">956</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">550</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">1</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">631</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">410</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">741</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">772</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">318</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">890</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">1</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">547</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">810</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">856</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">903</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">1</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">101</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">934</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">333</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">1096</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"imp_line_rect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token property">"left_up_point_x"</span><span class="token operator">:</span> <span class="token number">497</span><span class="token punctuation">,</span>                        <span class="token property">"left_up_point_y"</span><span class="token operator">:</span> <span class="token number">937</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_x"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>                        <span class="token property">"right_down_point_y"</span><span class="token operator">:</span> <span class="token number">1041</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token property">"rec_rejection"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"strict_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token property">"total_score"</span><span class="token operator">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token property">"recog_result"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>                <span class="token property">"line_char_result"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>                <span class="token property">"line_word_result"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">271</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">271</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"2 + 3 = 5"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9977216124534607</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">415</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">415</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"2 元 3 ( m ) = ( 2 . 3 ) 元"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.684288740158081</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">269</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">269</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"7 \\times 9 = 6 3"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9932141900062561</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">84</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"9 0 + = ( 5 4 0 ) 分"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.8401721715927124</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">328</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">328</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"1 5 + 1 5 = 2 0"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9966763257980347</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">192</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">192</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"3 ^ { 2 } = 9"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9976226687431335</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">306</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">306</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"5 - 2 &lt; 4"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9145566821098328</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">230</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">230</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">159</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"\\frac { 7 } { 9 } &lt; \\frac { 5 } { 9 }"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9983761310577393</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    <span class="token property">"beg_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"beg_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_x"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"end_pos_y"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"3 8 分 米 = ( 3 8 0 0 ) 厘 米"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token property">"word_gwpp"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.9828618764877319</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"3.7.0.1032"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span>    <span class="token property">"sid"</span><span class="token operator">:</span> <span class="token string">"itr00084e6a@gz1772ddd0576460a902"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="拍照速算完整功能"><a href="#拍照速算完整功能" class="headerlink" title="拍照速算完整功能"></a>拍照速算完整功能</h2><p>此阶段完成的功能相当于是把界面设计和图片速算的结合，用户流程如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210123142023133.png" alt="image-20210123142023133"></p><p>即用户选择照片后，调用上一章节的代码完成速算，得到文字结果（上一章节的内容），</p><p>本章节只要把文字结果绘制到图片上即可。</p><h3 id="识别结果"><a href="#识别结果" class="headerlink" title="识别结果"></a>识别结果</h3><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210123142301412.png" alt="image-20210123142301412"></p><p>通过上图可知，服务端返回的结果是json格式，需要的关键信息如下：</p><table><thead><tr><th>参数名</th><th>类型</th><th>描述</th><th>备注</th></tr></thead><tbody><tr><td>imp_line_rect.<strong>left_up_point_x</strong></td><td>int</td><td>该行公式所在矩形区域左上角顶点的像素横坐标</td><td>数字，大于等于0</td></tr><tr><td>imp_line_rect.<strong>left_up_point_y</strong></td><td>int</td><td>该行公式所在矩形区域左上角顶点的像素纵坐标</td><td>数字，大于等于0</td></tr><tr><td>imp_line_rect.<strong>right_down_point_x</strong></td><td>int</td><td>该行公式所在矩形区域右下角顶点的像素横坐标</td><td>数字，大于等于0</td></tr><tr><td>imp_line_rect.<strong>right_down_point_y</strong></td><td>int</td><td>该行公式所在矩形区域右下角顶点的像素纵坐标</td><td>数字，大于等于0</td></tr><tr><td>imp_line_info.<strong>total_score</strong></td><td>int</td><td>该速算题判决正误信息</td><td>1（正确）/0（错误）</td></tr><tr><td>line_word_result.<strong>word_content</strong></td><td>string</td><td>该行公式识别结果</td><td>Latex公式</td></tr></tbody></table><h3 id="图片绘制"><a href="#图片绘制" class="headerlink" title="图片绘制"></a>图片绘制</h3><p>根据以上得到的结果，imp_line_rect表示识别结果在图片中对应的文职。使用imp_line_rect对图片进行绘制，total_score为1表示结果正确，绘制绿色框，否则认为结果错误，绘制红色框。</p><p>实现代码：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ITRResult<span class="token punctuation">.</span>multi_line_info<span class="token punctuation">.</span>imp_line_info<span class="token keyword">var</span> jsonString <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span>wx<span class="token punctuation">.</span><span class="token function">getImageInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//获取图片信息</span>    src<span class="token punctuation">:</span> imagePath<span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        than<span class="token punctuation">.</span>width <span class="token operator">=</span> res<span class="token punctuation">.</span>width        than<span class="token punctuation">.</span>height <span class="token operator">=</span> res<span class="token punctuation">.</span>height        <span class="token keyword">let</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">'shareImg'</span><span class="token punctuation">)</span>        than<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            width<span class="token punctuation">:</span> res<span class="token punctuation">.</span>width<span class="token punctuation">,</span>            height<span class="token punctuation">:</span> res<span class="token punctuation">.</span>height<span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>width<span class="token punctuation">,</span> res<span class="token punctuation">.</span>height<span class="token punctuation">)</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>total_score<span class="token punctuation">)</span> <span class="token punctuation">{</span>                ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>imp_line_rect<span class="token punctuation">.</span>left_up_point_x<span class="token punctuation">,</span>                           obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>imp_line_rect<span class="token punctuation">.</span>left_up_point_y<span class="token punctuation">,</span>                           obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>imp_line_rect<span class="token punctuation">.</span>right_down_point_x <span class="token operator">-</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>imp_line_rect<span class="token punctuation">.</span>left_up_point_x<span class="token punctuation">,</span>                           obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>imp_line_rect<span class="token punctuation">.</span>right_down_point_y <span class="token operator">-</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>imp_line_rect<span class="token punctuation">.</span>left_up_point_y<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            wx<span class="token punctuation">.</span><span class="token function">canvasToTempFilePath</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                width<span class="token punctuation">:</span> res<span class="token punctuation">.</span>width<span class="token punctuation">,</span>                height<span class="token punctuation">:</span> res<span class="token punctuation">.</span>height<span class="token punctuation">,</span>                destWidth<span class="token punctuation">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>width<span class="token punctuation">,</span>                destHeight<span class="token punctuation">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>height<span class="token punctuation">,</span>                fileType<span class="token punctuation">:</span> <span class="token string">'jpg'</span><span class="token punctuation">,</span>                canvasId<span class="token punctuation">:</span> <span class="token string">'shareImg'</span><span class="token punctuation">,</span>                <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span>                    than<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                        imageUrl<span class="token punctuation">:</span> res<span class="token punctuation">.</span>tempFilePath                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"图片绘制失败:"</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    fail<span class="token punctuation">:</span> err <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"获取图片信息失败:"</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 题拍拍 </tag>
            
            <tag> 人工智能小程序 </tag>
            
            <tag> 改试卷小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>只会C能做哪些人工智能的有趣小案例</title>
      <link href="2021/01/zhi-hui-c-neng-zuo-na-xie-ren-gong-zhi-neng-de-you-qu-xiao-an-li/"/>
      <url>2021/01/zhi-hui-c-neng-zuo-na-xie-ren-gong-zhi-neng-de-you-qu-xiao-an-li/</url>
      
        <content type="html"><![CDATA[<h1 id="基于讯飞AI开放平台的WebAPI应用项目实践"><a href="#基于讯飞AI开放平台的WebAPI应用项目实践" class="headerlink" title="基于讯飞AI开放平台的WebAPI应用项目实践"></a><a href="">基于讯飞AI开放平台的WebAPI应用项目实践</a></h1><h1 id="一、项目概述"><a href="#一、项目概述" class="headerlink" title="一、项目概述"></a>一、项目概述</h1><h2 id="1-1-项目背景"><a href="#1-1-项目背景" class="headerlink" title="1.1 项目背景"></a>1.1 项目背景</h2><p>人工智能时代来临，人们陷入焦虑的周期将越来越短。AI正以迅猛的发展速度不断替代人类既有的工作岗位。那么人工智能就是万能的吗？拥有所有的技能吗？答案并不是，跨领域推理能力、抽象能力、自我学习的能力、独立地搜索问题、解决问题和团队配合能力、知其然也知其所以然的能力、常识、自我意识、审美、情感等等，这些方面都是机器人所不能拥有的技能。所以企业对我们的这些能力要求很高，尤其是独立地搜索问题、解决问题和团队配合尤为重要。所以，我们希望通过这门实践课程的学习，锻炼学生开发项目的实践能力，同时又能对AI能力的应用开发有比较全面的了解和掌握。</p><h2 id="1-2-项目目标"><a href="#1-2-项目目标" class="headerlink" title="1.2 项目目标"></a>1.2 项目目标</h2><p>easyAIoT的目标是平台化、简单化讯飞AI能力平台的使用。因此采用了分层化的设计思路和更加轻量化的WebAPI接口，使得应用层的开发者可以很容易的接入，并且更加容易的实现AI能力的调用。</p><h2 id="1-3-项目范围"><a href="#1-3-项目范围" class="headerlink" title="1.3 项目范围"></a>1.3 项目范围</h2><p>本门课程基于讯飞开放平台提供的WebAPI接口，并进行二次封装，提供APP层的API接口，也提供了基础能力层的接口。APP层接口可以非常容易的开发基于讯飞的AI能力，基础能力层可以不受讯飞平台的限制，通过基础能力提供的接口，可以开发其他平台的AI能力应用，或者使用在其他需要的应用场景。</p><p>目前1.0版本提供的C语言的功能如下：</p><ol><li> AIUI<strong>应用层API接口</strong>；</li><li> 语音合成<strong>应用层API接口</strong>；</li><li> 语音实时转写<strong>应用层API接口</strong>；</li><li> 人脸比对<strong>应用层API接口</strong>；</li><li> <strong>跨平台</strong>TCP/UDP/HTTP/Websocket<strong>基础能力及应用接口</strong>；</li><li> <strong>跨平台</strong>PCM录音接口；</li><li> <strong>跨平台</strong>多线程应用接口；</li><li> MD5/Base64/Sha256等加解密基础能力接口；</li><li> Json序列化和反序列化的基础能力接口；</li><li> string/map/ring buffer等数据结构基础能力接口；</li></ol><h2 id="1-4-技术路线"><a href="#1-4-技术路线" class="headerlink" title="1.4 技术路线"></a>1.4 技术路线</h2><p>源代码中包含有C语言基础、数据结构与数据处理、网络编程、多线程编程、分层框架设计、技术路线偏向于做基于C语言的应用层开发方向。</p><p>使用的硬件平台：vscode（跨平台/protable版本免安装，不仅可以直接放在电脑中运行，也可以把软件和代码插在U盘中直接运行，免除一些机房限制导致的问题）</p><p>使用的编译环境：Windows：mingw/cmake；Linux/Mac：gcc/cmake；</p><p>使用的语言：C语言</p><h2 id="1-5-定义、首字母缩写词和缩略图"><a href="#1-5-定义、首字母缩写词和缩略图" class="headerlink" title="1.5 定义、首字母缩写词和缩略图"></a>1.5 定义、首字母缩写词和缩略图</h2><table><thead><tr><th><strong>序号</strong></th><th><strong>名称</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>easyAIoT</td><td>项目名称，让设备能更容易的获得人工智能的能力</td></tr><tr><td><strong>2</strong></td><td>AIUI</td><td>讯飞提供的一套用于机器交互的接口引擎，使得机器能听的懂</td></tr><tr><td><strong>3</strong></td><td>IAT</td><td>语音识别，把人的声音识别为文字的技术</td></tr><tr><td><strong>4</strong></td><td>TTS</td><td>语音合成（Text-To-Speech），通过机械的、电子的方法产生人造语音的技术</td></tr><tr><td><strong>5</strong></td><td></td><td></td></tr></tbody></table><h1 id="二、功能总览"><a href="#二、功能总览" class="headerlink" title="二、功能总览"></a>二、功能总览</h1><h2 id="2-1-项目角色"><a href="#2-1-项目角色" class="headerlink" title="2.1 项目角色"></a>2.1 项目角色</h2><p>本项目主要分为：AIUI机器交互应用、人脸比对应用、实时转写应用、语音合成应用；</p><p>也可以通过提供的基础能力层完成讯飞平台和其他AI开放平台（例如百度大脑）的AI能力集成；</p><h2 id="2-2-项目功能分解"><a href="#2-2-项目功能分解" class="headerlink" title="2.2 项目功能分解"></a>2.2 项目功能分解</h2><table><thead><tr><th><strong>序号</strong></th><th><strong>功能</strong></th><th>应用层用户</th><th>基础能力层用户</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>AIUI能力接口</td><td>提供录音、简单的HTTP接入、数据封装与处理；</td><td>提供自定义回调接口，方便用户自定义处理；</td></tr><tr><td><strong>2</strong></td><td>TTS语音合成接口</td><td>提供简单的TTS合成接口；</td><td>提供开放的回调接口，方便用户自定义处理；</td></tr><tr><td><strong>3</strong></td><td>IAT语音实时转写接口</td><td>提供简单的IAT实时转写功能；</td><td>提供开放的接口，供用户自定义语音输入和业务处理；</td></tr><tr><td><strong>4</strong></td><td>人脸比对接口</td><td>提供简单的人脸比对能力，只需要提供appid等验证信息和两张人脸照片即可；</td><td>提供基础的接口，可以扩展人脸相关的处理方式；</td></tr><tr><td><strong>5</strong></td><td>网络接口</td><td>提供TCP/UDP/Http/Websocket的C语言应用层接口，可以非常方便的接入对应协议的服务平台；</td><td>提供基础的网络接口，可以更加方面的自定义对网络的连接处理；</td></tr><tr><td><strong>6</strong></td><td>录音接口</td><td></td><td>■</td></tr><tr><td><strong>7</strong></td><td>多线程接口</td><td>提供跨平台的多线程接口，Windows/Linux平台已验证，Mac暂未测试</td><td>■</td></tr><tr><td><strong>8</strong></td><td>MD5/Base64/Sha256等加解密接口</td><td>提供加解密接口，方便通信过程中的加解密处理</td><td>■</td></tr><tr><td><strong>9</strong></td><td>Json接口封装</td><td>提供了基于C语言宏的Json序列化和反序列化，比原本的cJson阅读起来更加方便理解；</td><td>■</td></tr><tr><td><strong>10</strong></td><td>string/map/ring buffer接口</td><td>提供了基础的数据处理接口，解决了C语言处理数据不方便的问题；</td><td>■</td></tr></tbody></table><h1 id="三、功能说明"><a href="#三、功能说明" class="headerlink" title="三、功能说明"></a>三、功能说明</h1><h2 id="3-1-功能框图"><a href="#3-1-功能框图" class="headerlink" title="3.1 功能框图"></a>3.1 功能框图</h2><p>下图是easyAIoT项目的分层框架图。</p><p>AI展示层：用于展示各种AI能力，通过能力层提供的模块完成；</p><p>能力层：由AI应用模块提供的能力接口和其他辅助模块构成；</p><p>平台层：目前easyAIoT使用C语言适配了讯飞平台层提供的WebAPI能力；</p><p>开发平台层：由easyAIoT开发使用的主要开发环境、编译器和调试工具组成；</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/easyAIoT%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="easyAIoT系统分层框架图"></p><h2 id="3-2-AIUI模块功能说明"><a href="#3-2-AIUI模块功能说明" class="headerlink" title="3.2 AIUI模块功能说明"></a>3.2 AIUI模块功能说明</h2><p>此模块提供语音识别的能力，通过提供的语音识别成文字的过程。</p><p><strong>接口说明：</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 获取自然语言处理的结果（使用讯飞AIUIWebAPI引擎） * @param  pszAppid         应用APPID * @param  pszKey           应用APPKey * @param  pszParam         请求参数 * @param  pAudioData       请求语音数据 * @param  iAudioLen        请求语音数据长度 * @return cstring_t*       返回字符串结构体对象指针，错误返回NULL */</span>cstring_t <span class="token operator">*</span><span class="token function">getNlpResult</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAppid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszKey<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszParam<span class="token punctuation">,</span>                        <span class="token keyword">void</span> <span class="token operator">*</span>pAudioData<span class="token punctuation">,</span> <span class="token keyword">int</span> iAudioLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>实例代码：</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 修改为自己的appid，key、secret和auth_id,网址https://aiui.xfyun.cn/app/&lt;替换自己的appid>/info</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAppid <span class="token operator">=</span> <span class="token string">"xxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszKey <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszParam <span class="token operator">=</span> <span class="token string">"{\"result_level\":\"plain\",\"auth_id\":\"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\"data_type\":\"audio\",\"sample_rate\":\"16000\",\"scene\":\"main_box\"}"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 1.读取语音文件</span>    cstring_t <span class="token operator">*</span>pAudioData <span class="token operator">=</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">"../Res/test.pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pAudioData<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">LOG</span><span class="token punctuation">(</span>EERROR<span class="token punctuation">,</span> <span class="token string">"read audio file error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"pcm len:%d"</span><span class="token punctuation">,</span> pAudioData<span class="token operator">-></span><span class="token function">length</span><span class="token punctuation">(</span>pAudioData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2.提供信息进行语音识别成文本</span>    cstring_t <span class="token operator">*</span>pResult <span class="token operator">=</span> <span class="token function">getNlpResult</span><span class="token punctuation">(</span>pszAppid<span class="token punctuation">,</span> pszKey<span class="token punctuation">,</span> pszParam<span class="token punctuation">,</span> pAudioData<span class="token operator">-></span>str<span class="token punctuation">,</span> pAudioData<span class="token operator">-></span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pResult<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"识别结果：%s"</span><span class="token punctuation">,</span> pResult<span class="token operator">-></span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">cstring_del</span><span class="token punctuation">(</span>pResult<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">cstring_del</span><span class="token punctuation">(</span>pAudioData<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述代码中的param参数是json格式，说明如下：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"result_level"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span> //提供结果格式：简单文本格式    <span class="token property">"auth_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">,</span> //请求的auth_id，平台配置界面中查询    <span class="token property">"data_type"</span><span class="token operator">:</span> <span class="token string">"audio"</span><span class="token punctuation">,</span> // 请求的数据类型，这里是语音，也可以为文本    <span class="token property">"sample_rate"</span><span class="token operator">:</span> <span class="token string">"16000"</span><span class="token punctuation">,</span> // 如果请求的是audio，sample_rate表示音频采样率    <span class="token property">"scene"</span><span class="token operator">:</span> <span class="token string">"main_box"</span> // 请求场景，未发布版本，需要增加<span class="token string">"_box"</span>后缀<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果：</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201208122536071.png" alt="image-20201208122536071"></p><p>可以看到，返回的结果也是一个json格式，识别出了请求的语音文本为”今天全国新增确诊病例”，服务端返回的结果为：”今天全国新冠肺炎新增确诊病例15例”。</p><p><strong>注意</strong>，获得正确的返回结果，需要在应用中增加相关的技能，按照上例需要在应用中增加相关技能，并点击右上角的保存即可生效。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201208123453373.png" alt="image-20201208123453373"></p><h2 id="3-3-TTS语音合成模块功能说明"><a href="#3-3-TTS语音合成模块功能说明" class="headerlink" title="3.3 TTS语音合成模块功能说明"></a>3.3 TTS语音合成模块功能说明</h2><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 文字转语音 * @param  appid            讯飞appid * @param  key              讯飞api key * @param  param            讯飞合成参数 * @param  text             合成的文本内容 * @param  pathname         合成的结果音频文件路径名称 * @return true             合成成功 * @return false            合成失败 */</span>bool <span class="token function">getTTS</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>appid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>param<span class="token punctuation">,</span>     <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>text<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 修改为自己应用的appid，key和secret</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>appid <span class="token operator">=</span> <span class="token string">"xxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>secret <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token function">getTTS</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> key<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> <span class="token string">"欢迎来到比特人生的世界"</span><span class="token punctuation">,</span> <span class="token string">"../Res/tts.pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><p>生成的语音文件放在了Res/tts.pcm中，可以打开音频软件AU，设置16000采样，16bit深的音频信息来听取声音内容和要转写的文字内容是否一致。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201209165052710.png" alt="image-20201209165052710"></p><h2 id="3-4-IAT语音转写功能说明"><a href="#3-4-IAT语音转写功能说明" class="headerlink" title="3.4 IAT语音转写功能说明"></a>3.4 IAT语音转写功能说明</h2><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 语音转写 * @param  appid            应用appid * @param  key              应用apikey * @param  secret           应用secret */</span><span class="token keyword">void</span> <span class="token function">iat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>appid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 修改为自己应用的appid，key和secret</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>appid <span class="token operator">=</span> <span class="token string">"xxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>secret <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"尝试说一些话，看看有什么有趣的事情会发生(●'◡'●)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">iat</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> key<span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><p>程序运行后，可以一边说话，一边看返回结果。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201208213345015.png" alt="image-20201208213345015"></p><h2 id="3-5人脸比对接口功能说明"><a href="#3-5人脸比对接口功能说明" class="headerlink" title="3.5人脸比对接口功能说明"></a>3.5人脸比对接口功能说明</h2><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 讯飞人脸对比功能 * @param  pszAPPID         讯飞appid * @param  pszAPPSecret     讯飞api secret * @param  pszAPPKey        讯飞app key * @param  pszImagePath1    比较的图片1 * @param  pszImagePath2    比较的图片2 * @return float            比较的相似度，取值0-1，0.67以上阈值是同一个人的可行性很大 */</span><span class="token keyword">double</span> <span class="token function">fFaceCompare</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPID<span class="token punctuation">,</span>         <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPSecret<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPKey<span class="token punctuation">,</span>        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszImagePath1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszImagePath2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 修改为自己应用的appid，key和secret</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>appid <span class="token operator">=</span> <span class="token string">"xxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>secret <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> fScore <span class="token operator">=</span> <span class="token function">fFaceCompare</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token string">"../Res/1.jpg"</span><span class="token punctuation">,</span> <span class="token string">"../Res/2.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"face compare score:%.2f\n"</span><span class="token punctuation">,</span> fScore<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用的两张图片如下</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/1.jpg" alt="1"></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/2-1607434767599.jpg" alt="2"></p><p><strong>程序运行结果</strong></p><pre><code>[EDEBUG][E:\Source\C\easyAIoT\APP\FaceCompare.c fFaceCompare line:144]body:&#123;&quot;header&quot;:&#123;&quot;code&quot;:0,&quot;message&quot;:&quot;success&quot;,&quot;sid&quot;:&quot;ase000d52ea@hu17642958dc90212882&quot;&#125;,&quot;payload&quot;:&#123;&quot;face_compare_result&quot;:&#123;&quot;compress&quot;:&quot;raw&quot;,&quot;encoding&quot;:&quot;utf8&quot;,&quot;format&quot;:&quot;json&quot;,&quot;text&quot;:&quot;ewoJInJldCIgOiAwLAoJInNjb3JlIiA6IDAuOTc1NTI1Nzk2NDEzNDIxNjMKfQo=&quot;&#125;&#125;&#125;[EDEBUG][E:\Source\C\easyAIoT\APP\FaceCompare.c fGetScoreResult line:74]szResponse:&#123;&quot;header&quot;:&#123;&quot;code&quot;:0,&quot;message&quot;:&quot;success&quot;,&quot;sid&quot;:&quot;ase000d52ea@hu17642958dc90212882&quot;&#125;,&quot;payload&quot;:&#123;&quot;face_compare_result&quot;:&#123;&quot;compress&quot;:&quot;raw&quot;,&quot;encoding&quot;:&quot;utf8&quot;,&quot;format&quot;:&quot;json&quot;,&quot;text&quot;:&quot;ewoJInJldCIgOiAwLAoJInNjb3JlIiA6IDAuOTc1NTI1Nzk2NDEzNDIxNjMKfQo=&quot;&#125;&#125;&#125;       [EDEBUG][E:\Source\C\easyAIoT\APP\FaceCompare.c fGetScoreResult line:90]score json:&#123;        &quot;ret&quot; : 0,        &quot;score&quot; : 0.97552579641342163&#125;[EDEBUG][E:\Source\C\easyAIoT\APP\FaceCompare.c fGetScoreResult line:101]ret:0, score:0.98face compare score:0.98</code></pre><p>以上两张图片的得分0.98，代表识别的两张图片非常像。</p><h2 id="3-6-网络接口功能说明"><a href="#3-6-网络接口功能说明" class="headerlink" title="3.6 网络接口功能说明"></a>3.6 网络接口功能说明</h2><h3 id="3-6-1-tcp功能"><a href="#3-6-1-tcp功能" class="headerlink" title="3.6.1 tcp功能"></a>3.6.1 tcp功能</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 网络接收回调 */</span><span class="token keyword">typedef</span> <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>fnSockCallback<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvUserData<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvData<span class="token punctuation">,</span> <span class="token keyword">int</span> iLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 网络通信结构体，包含创建网络、连接网络、关闭网络，发送数据和网络通信事件循环 */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> SSockClient <span class="token punctuation">{</span>    sock_t          iSocket<span class="token punctuation">;</span>    <span class="token keyword">int</span>             iRecvBufferSize<span class="token punctuation">;</span>    <span class="token keyword">int</span>             iSendBufferSize<span class="token punctuation">;</span>    <span class="token keyword">int</span>             iProtocol<span class="token punctuation">;</span>    <span class="token keyword">struct</span> in_addr  iServerIp<span class="token punctuation">;</span>    <span class="token keyword">short</span>           nServerPort<span class="token punctuation">;</span>    <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>bCreate<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>ip<span class="token punctuation">,</span> <span class="token keyword">short</span> nPort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>bConnect<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>vClose<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>iSend<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvData<span class="token punctuation">,</span> <span class="token keyword">int</span> iLen<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>bEventLoop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">,</span> fnSockCallback cb<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvUserData<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>piLoop<span class="token punctuation">,</span> <span class="token keyword">int</span> iTimeOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>SSockClient_t<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 网络功能初始化 * @param  pstClient        网络功能对象 * @return true             网络初始化成功 * @return false            网络初始化失败 */</span>bool <span class="token function">bSockInit</span><span class="token punctuation">(</span>SSockClient_t <span class="token operator">*</span>pstClient<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 网络功能反初始化 * @param  pstClient        网络功能对象 * @return true             网络反初始化成功 * @return false            网络反初始化成功 */</span>bool <span class="token function">bSockUninit</span><span class="token punctuation">(</span>SSockClient_t <span class="token operator">*</span>pstClient<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">// 回调函数，当服务端有数据发送回来时执行这个回调</span>bool <span class="token function">bSockCallback</span><span class="token punctuation">(</span><span class="token keyword">struct</span> SSockClient <span class="token operator">*</span>pstClient<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvUserData<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvData<span class="token punctuation">,</span> <span class="token keyword">int</span> iLen<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"bSockCallback called:%s\r\n"</span><span class="token punctuation">,</span> pvData<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> true<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> iLoop <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 请求头信息</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>        <span class="token punctuation">{</span>            <span class="token string">"GET / HTTP/1.1\r\n"</span>            <span class="token string">"Host: www.baidu.com\r\n"</span>            <span class="token string">"Connection: keep-alive\r\n"</span>            <span class="token string">"Accept: */*\r\n\r\n"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 声明网络结构体变量</span>    SSockClient_t stSockClient<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 初始化网络结构体</span>    <span class="token function">bSockInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stSockClient<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 创建socket连接对象</span>    stSockClient<span class="token punctuation">.</span><span class="token function">bCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stSockClient<span class="token punctuation">,</span> <span class="token string">"14.215.177.39"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 连接服务端</span>    stSockClient<span class="token punctuation">.</span><span class="token function">bConnect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stSockClient<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 发送数据给服务端</span>    stSockClient<span class="token punctuation">.</span><span class="token function">iSend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stSockClient<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>header<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 等待网络事件，通过bSockCallback处理网络事件</span>    stSockClient<span class="token punctuation">.</span><span class="token function">bEventLoop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stSockClient<span class="token punctuation">,</span> bSockCallback<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>iLoop<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201209105106375.png" alt="image-20201209105106375"></p><h3 id="3-6-2-HTTP功能"><a href="#3-6-2-HTTP功能" class="headerlink" title="3.6.2 HTTP功能"></a>3.6.2 HTTP功能</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 连接http服务端 *  * @param pstHttpInfo httpclient的结构体，包含了请求、响应、网络连接、http解析四个功能 * @param pszUrl 访问的http url * @param pszExtraHeader 额外的头文件 * @param pvBody 如果是post消息，需要提供这一项，将会填充到http请求的body中 * @param iSize body的长度 *  * @return 调用成功返回true，否则返回false *  * @note 注意返回结果在pstHttpInfo的stResponse成员中，并且调用完成后 *       要通过bHttpClose来释放pstHttpInfo中的资源 */</span>bool <span class="token function">bConnectHttpServer</span><span class="token punctuation">(</span>SEIHttpInfo_t <span class="token operator">*</span>pstHttpInfo<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszUrl<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszExtraHeader<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pvBody<span class="token punctuation">,</span> <span class="token keyword">int</span> iSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    SEIHttpInfo_t stHttpInfo<span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszUrl <span class="token operator">=</span> <span class="token string">"http://www.baidu.com"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 连接HTTP服务器</span>    <span class="token function">bConnectHttpServer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stHttpInfo<span class="token punctuation">,</span> pszUrl<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"status:%d"</span><span class="token punctuation">,</span> stHttpInfo<span class="token punctuation">.</span>stResponse<span class="token punctuation">.</span>iStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"body:%d"</span><span class="token punctuation">,</span> stHttpInfo<span class="token punctuation">.</span>stResponse<span class="token punctuation">.</span>pstBody<span class="token operator">-></span>sBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">bHttpClose</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stHttpInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><p>status的返回值为http的状态码，200代表正常返回，body是服务端返回的内容，以上代码会返回网址的首页信息，因此会看到终端输出的是网页的内容信息。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201209112031575.png" alt="image-20201209112031575"></p><h3 id="3-6-3-Websocket功能"><a href="#3-6-3-Websocket功能" class="headerlink" title="3.6.3 Websocket功能"></a>3.6.3 Websocket功能</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 连接到websocket服务端 * @param  c_pszUrl         websocket服务器的URL * @param  cb               websocket服务器的响应信息 * @return true             连接成功 * @return false            连接失败 */</span>bool <span class="token function">bWebsocketConnect</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>c_pszUrl<span class="token punctuation">,</span> fnWebsocketCallback cb<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>appid <span class="token operator">=</span> <span class="token string">"xxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>app_secret <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>app_key <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>    <span class="token function">getTTS</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> app_key<span class="token punctuation">,</span> app_secret<span class="token punctuation">,</span> <span class="token string">"欢迎来到比特人生的世界"</span><span class="token punctuation">,</span> <span class="token string">"./tts.pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><p>合成的结果保存到了tts.pcm中，可以打开adobe auditiom软件，设置为16000K 16bit听声音是否和文本内容一致。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201209145844006.png" alt="image-20201209145844006"></p><h2 id="3-7-录音接口功能说明"><a href="#3-7-录音接口功能说明" class="headerlink" title="3.7 录音接口功能说明"></a>3.7 录音接口功能说明</h2><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">void</span><span class="token operator">*</span>   AudioHandle<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 录音回调 * @param pvHandle      录音对象，AudioRecorder_t类型的指针 * @param iType         录音状态，AUDIO_OPEN表示录音设备打开成功，AUDIO_DATA表示录音数据 * @param pvUserData    用户传递到回调的私有数据 * @param pvData        录音数据，当iType=AUDIO_DATA时有效 * @param iLen          录音数据长度，当iType=AUDIO_DATA时有效 */</span><span class="token keyword">typedef</span> <span class="token keyword">void</span>    <span class="token punctuation">(</span><span class="token operator">*</span>RecordCallback<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pvHandle<span class="token punctuation">,</span> int32_t iType<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pvUserData<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pvData<span class="token punctuation">,</span> int32_t iLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 录音配置结构体 */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> AudioConfig <span class="token punctuation">{</span>    uint32_t                iSampleRate<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* 每秒采样次数 */</span>    uint8_t                 byBitsPerSample<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 每次采样深度 */</span>    uint8_t                 byChannels<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">/* 采样通道 */</span>    RecordCallback          pfCallback<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">/* 获取音频数据的回调 */</span>    <span class="token keyword">void</span><span class="token operator">*</span>                   pvUserData<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">/* 传递给回调的参数 */</span><span class="token punctuation">}</span>AudioConfig_t<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 录音功能结构体 */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> AudioRecorder <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * @brief 打开录音设备     * @param   pAudioConfig    录音配置信息          * @return  bool            false打开失败，true打开成功      */</span>    <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>open<span class="token punctuation">)</span><span class="token punctuation">(</span>AudioConfig_t<span class="token operator">*</span> pAudioConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * @brief 开始流式录音，录音信息通过open时注册的回调函数返回给用户     */</span>    <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>start<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * @brief 停止录音，异步     */</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>stop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * @brief 关闭录音设备     */</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>close<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    AudioHandle             pvAudioHandle<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">/* 音频设备的句柄 */</span>    AudioConfig_t           stAudioConfig<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">/* 音频设备的配置 */</span>    bool                    bRecording<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">/* 是否正在录音 */</span><span class="token punctuation">}</span>AudioRecorder_t<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 录音对象单例 */</span><span class="token keyword">extern</span> AudioRecorder_t Recorder<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 16000K采样，16bit采样深度，1是单声道，RecordCB是音频信息的回调函数，test.pcm是传递给回调的参数</span>    AudioConfig_t stAudioConfig <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">16000</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> RecordCB<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"test.pcm"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 打开音频设备</span>    Recorder<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stAudioConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 开始录音，阻塞函数，需要关闭录音在其他地方调用Recorder.close()</span>    Recorder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 关闭录音设备</span>    Recorder<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><p>程序运行成功后，可以通过编写回调函数，来获取音频数据，上面程序的回调函数可以通过以下的回调处理来保存录音数据</p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">RecordCB</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pvHandle<span class="token punctuation">,</span> int32_t iType<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pvUserData<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pvData<span class="token punctuation">,</span> int32_t iLen<span class="token punctuation">)</span><span class="token punctuation">{</span>    uint32_t bytesWritten <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> uint32_t totalWriten <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>pvUserData<span class="token punctuation">;</span>    <span class="token keyword">static</span> FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fp<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>AUDIO_DATA <span class="token operator">==</span> iType<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token punctuation">{</span>            bytesWritten <span class="token operator">=</span> <span class="token function">fwrite</span><span class="token punctuation">(</span>pvData<span class="token punctuation">,</span> iLen<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>            totalWriten <span class="token operator">+</span><span class="token operator">=</span> bytesWritten<span class="token operator">*</span>iLen<span class="token punctuation">;</span>            <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"totalWriten:%d, iLen:%d"</span><span class="token punctuation">,</span> totalWriten<span class="token punctuation">,</span> iLen<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>totalWriten <span class="token operator">></span> <span class="token number">32000</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>AUDIO_CLOSE <span class="token operator">==</span> iType<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>        fp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        Recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>pvUserData</strong>参数是通过stAudioConfig传递进来的”test.pcm”，可以在回调中使用这个参数，把录取的音频数据保存到test.pcm中。保存之后可以通过adobe audition软件打开听取声音是否正常。</p><h2 id="3-8-多线程接口功能说明"><a href="#3-8-多线程接口功能说明" class="headerlink" title="3.8 多线程接口功能说明"></a>3.8 多线程接口功能说明</h2><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> ThreadFun ThreadFun<span class="token punctuation">;</span><span class="token keyword">struct</span> ThreadFun<span class="token punctuation">{</span>    <span class="token keyword">void</span><span class="token operator">*</span> params<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//线程函数的参数 </span><span class="token macro property">#<span class="token directive keyword">if</span> defined(_WIN32)</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>fun<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//线程函数指针 </span><span class="token macro property">#<span class="token directive keyword">else</span></span>    <span class="token keyword">void</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>fun<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//线程函数指针 </span><span class="token macro property">#<span class="token directive keyword">endif</span></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 线程创建 * @param  iThreadNum       线程创建的个数 * @param  funArray         线程处理函数组 */</span><span class="token keyword">void</span> <span class="token function">vStartThread</span><span class="token punctuation">(</span><span class="token keyword">int</span> iThreadNum<span class="token punctuation">,</span> ThreadFun funArray<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SimpleThread.h></span></span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"doStomething thread:%s\r\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    ThreadFun funArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    funArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fun <span class="token operator">=</span> doSomething<span class="token punctuation">;</span>    funArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"easyAIot"</span><span class="token punctuation">;</span>    <span class="token function">vStartThread</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> funArr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"main thread\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>main threaddoStomething thread:easyAIot</code></pre><h2 id="3-9-加解密接口功能说明"><a href="#3-9-加解密接口功能说明" class="headerlink" title="3.9 加解密接口功能说明"></a>3.9 加解密接口功能说明</h2><h3 id="3-9-1-MD5加密"><a href="#3-9-1-MD5加密" class="headerlink" title="3.9.1 MD5加密"></a>3.9.1 MD5加密</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief md5加密 * @param  initial_msg      加密消息串 * @param  initial_len      加密消息串长度 * @param  digest           加密后的内容，注意：长度固定16字节，在使用时一般会把每一个字节使用16进制转化为字符串 */</span><span class="token keyword">void</span> <span class="token function">vMD5</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>digest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief md5加密 * @param  initial_msg      加密消息串 * @param  initial_len      加密消息串长度 * @param  digest           加密后的32字节小写字符串内容 */</span><span class="token keyword">void</span> <span class="token function">md5String</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>digest<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszString <span class="token operator">=</span> <span class="token string">"easyAIoT"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szBuf<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">md5String</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint8_t <span class="token operator">*</span><span class="token punctuation">)</span>pszString<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pszString<span class="token punctuation">)</span><span class="token punctuation">,</span> szBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s md5-> %s\n"</span><span class="token punctuation">,</span> pszString<span class="token punctuation">,</span> szBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>easyAIoT md5-&gt; d1428978a06bcefed0e94ab70a5d1498</code></pre><h3 id="3-9-2-Base64加解密"><a href="#3-9-2-Base64加解密" class="headerlink" title="3.9.2 Base64加解密"></a>3.9.2 Base64加解密</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief Base64编码 * @param  pcData           需要编码的数据 * @param  pcBase64         Base64编码后的数据 * @param  pcDataLen        需要编码数据的长度 * @return int 编码后数据的长度 */</span><span class="token keyword">int</span> <span class="token function">iBase64Encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pcData<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>pcBase64<span class="token punctuation">,</span> <span class="token keyword">int</span> pcDataLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief Base64解码 * @param  base64           需要解码的Base64字符串 * @param  dedata           解码后的数据内容 * @return int 解码后数据的长度 */</span><span class="token keyword">int</span> <span class="token function">iBase64Decode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>base64<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>dedata<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;base64.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pcPlain <span class="token operator">=</span> <span class="token string">"easyAIoT"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szEncode<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szDecode<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> iEncodeLen <span class="token operator">=</span> <span class="token function">iBase64Encode</span><span class="token punctuation">(</span>pcPlain<span class="token punctuation">,</span> szEncode<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pcPlain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> iDecodeLen <span class="token operator">=</span> <span class="token function">iBase64Decode</span><span class="token punctuation">(</span>szEncode<span class="token punctuation">,</span> szDecode<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"encode:%s, len:%d\n"</span><span class="token punctuation">,</span> szEncode<span class="token punctuation">,</span> iEncodeLen<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"decode:%s, len:%d\n"</span><span class="token punctuation">,</span> szDecode<span class="token punctuation">,</span> iDecodeLen<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>encode:ZWFzeUFJb1Q=, len:12decode:easyAIoT, len:8</code></pre><h3 id="3-9-3-Sha256加解密"><a href="#3-9-3-Sha256加解密" class="headerlink" title="3.9.3 Sha256加解密"></a>3.9.3 Sha256加解密</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief sha256加密 * @param  input            加密源字符串 * @param  ilen             加密源字符串大小 * @param  out              加密字符串，大于等于65字节 */</span><span class="token keyword">void</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>input<span class="token punctuation">,</span> size_t ilen<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief HamcSHA256加密 * @param  data             加密数据 * @param  len              加密数据长度 * @param  key              加密key * @param  len_key          加密key长度 * @param  out              加密内容，out长度大于等于65 */</span><span class="token keyword">void</span> <span class="token function">hamcSha256String</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">int</span> len_key<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>input <span class="token operator">=</span> <span class="token string">"easyAIoT"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> out<span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> hamc_out<span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">sha256</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"out:%s\n"</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">hamcSha256String</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> hamc_out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hamc_out:%s\n"</span><span class="token punctuation">,</span> hamc_out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>out:72db9c2cd52e183d7f3a367c8f33a226090c2c73b049731908c8341093c87d77hamc_out:a46e68f86c13dbfb00a834f223cc68c516915f31c7736cdd5e1664ba69c32343</code></pre><h3 id="3-9-4-URL加解密"><a href="#3-9-4-URL加解密" class="headerlink" title="3.9.4 URL加解密"></a>3.9.4 URL加解密</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief url网址编码，便于网络传输 * @param  in               编码前网址 * @param  out              编码后网址 */</span><span class="token keyword">void</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token keyword">char</span> in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> out<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief url网址解码，便于查看 * @param  in               解码前网址 * @param  out              解码后网址 */</span><span class="token keyword">void</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token keyword">char</span> in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> out<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>in <span class="token operator">=</span> <span class="token string">"http://www.easyaiot.com/index.html?param1=1 2 3&amp;param2=1:2"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> enout<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> deout<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">urlencode</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> enout<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">urldecode</span><span class="token punctuation">(</span>enout<span class="token punctuation">,</span> deout<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"in:%s\n"</span><span class="token punctuation">,</span> in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"enout:%s\n"</span><span class="token punctuation">,</span> enout<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"deout:%s\n"</span><span class="token punctuation">,</span> deout<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>in:http://www.easyaiot.com/index.html?param1=1 2 3&amp;param2=1:2enout:http%3A//www.easyaiot.com/index.html?param1=1+2+3&amp;param2=1%3A2deout:http://www.easyaiot.com/index.html?param1=1 2 3&amp;param2=1:2</code></pre><h2 id="3-10-Json接口功能说明"><a href="#3-10-Json接口功能说明" class="headerlink" title="3.10 Json接口功能说明"></a>3.10 Json接口功能说明</h2><h3 id="3-10-1-Json序列化"><a href="#3-10-1-Json序列化" class="headerlink" title="3.10.1 Json序列化"></a>3.10.1 Json序列化</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">// 创建Json对象，序列化对象名：json_obj</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_CREATE_OBJECT_START(json_obj)</span><span class="token comment" spellcheck="true">// 创建序列化数组（key, value）到json_obj对象中</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_ADD_ARRAY_TO_OBJECT(json_obj, key, value)</span><span class="token comment" spellcheck="true">// 创建序列化对象（key, value）到json_obj对象中</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_ADD_OBJECT_TO_OBJECT(json_obj, key, value)</span><span class="token comment" spellcheck="true">// 增加一个字符串键值对（key, value）到json_obj对象中</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_ADD_STRING_TO_OBJECT(json_obj, key, value)</span><span class="token comment" spellcheck="true">// 增加一个整型键值对（key, value）到json_obj对象中</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_ADD_INT_TO_OBJECT(json_obj, key, value)</span><span class="token comment" spellcheck="true">// 创建一个数组Json对象</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_CREATE_ARRAY_START(json_array)</span><span class="token comment" spellcheck="true">// 增加一个数组Json对象（key, value）到json_array对象中</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_ADD_ARRAY_TO_ARRAY(json_array, sub_json_array)</span><span class="token comment" spellcheck="true">// 增加一Json对象（key, value）到数组对象json_array中</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_ADD_OBJECT_TO_ARRAY(json_array, json_obj)</span><span class="token comment" spellcheck="true">// 创建Json结束符</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_CREATE_END(json_obj)</span><span class="token comment" spellcheck="true">// JSON序列化为字符串</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_SERIALIZE_STRING(json_doc, str, len)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token function">JSON_SERIALIZE_CREATE_OBJECT_START</span><span class="token punctuation">(</span>json_common_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_common_obj<span class="token punctuation">,</span> <span class="token string">"app_id"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_CREATE_OBJECT_START</span><span class="token punctuation">(</span>json_business_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_business_obj<span class="token punctuation">,</span> <span class="token string">"language"</span><span class="token punctuation">,</span> <span class="token string">"zh_cn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_business_obj<span class="token punctuation">,</span> <span class="token string">"domain"</span><span class="token punctuation">,</span> <span class="token string">"iat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_business_obj<span class="token punctuation">,</span> <span class="token string">"accent"</span><span class="token punctuation">,</span> <span class="token string">"mandarin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_CREATE_OBJECT_START</span><span class="token punctuation">(</span>json_data_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_INT_TO_OBJECT</span><span class="token punctuation">(</span>json_data_obj<span class="token punctuation">,</span> <span class="token string">"status"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_data_obj<span class="token punctuation">,</span> <span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"audio/L16;rate=16000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_data_obj<span class="token punctuation">,</span> <span class="token string">"encoding"</span><span class="token punctuation">,</span> <span class="token string">"raw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_STRING_TO_OBJECT</span><span class="token punctuation">(</span>json_data_obj<span class="token punctuation">,</span> <span class="token string">"audio"</span><span class="token punctuation">,</span> <span class="token string">"exSI6ICJlbiIsCgkgICAgInBvc2l0aW9uIjogImZhbHNlIgoJf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// JSON_SERIALIZE_CREATE_END(json_data_obj);</span><span class="token function">JSON_SERIALIZE_CREATE_OBJECT_START</span><span class="token punctuation">(</span>json_frame_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_OBJECT_TO_OBJECT</span><span class="token punctuation">(</span>json_frame_obj<span class="token punctuation">,</span> <span class="token string">"common"</span><span class="token punctuation">,</span> json_common_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_OBJECT_TO_OBJECT</span><span class="token punctuation">(</span>json_frame_obj<span class="token punctuation">,</span> <span class="token string">"business"</span><span class="token punctuation">,</span> json_business_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_ADD_OBJECT_TO_OBJECT</span><span class="token punctuation">(</span>json_frame_obj<span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">,</span> json_data_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_STRING</span><span class="token punctuation">(</span>json_frame_obj<span class="token punctuation">,</span> pszRequest<span class="token punctuation">,</span> iLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JSON_SERIALIZE_CREATE_END</span><span class="token punctuation">(</span>json_frame_obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"common"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"app_id"</span><span class="token operator">:</span> <span class="token string">"123456"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"business"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"language"</span><span class="token operator">:</span> <span class="token string">"zh_cn"</span><span class="token punctuation">,</span>        <span class="token property">"domain"</span><span class="token operator">:</span> <span class="token string">"iat"</span><span class="token punctuation">,</span>        <span class="token property">"accent"</span><span class="token operator">:</span> <span class="token string">"mandarin"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"audio/L16;rate=16000"</span><span class="token punctuation">,</span>        <span class="token property">"encoding"</span><span class="token operator">:</span> <span class="token string">"raw"</span><span class="token punctuation">,</span>        <span class="token property">"audio"</span><span class="token operator">:</span> <span class="token string">"exSI6ICJlbiIsCgkgICAgInBvc2l0aW9uIjogImZhbHNlIgoJf"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-10-2-Json反序列化"><a href="#3-10-2-Json反序列化" class="headerlink" title="3.10.2 Json反序列化"></a>3.10.2 Json反序列化</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">// 根据json字符串json_string创建json对象json_root</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_START(json_root, json_string, ret)</span><span class="token comment" spellcheck="true">// 根据json对象json_doc，获取键值为key的整型变量放到value中，返回值放入ret中，jump为程序跳出方式</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_GET_INT(json_doc, key, value, ret, jump)</span><span class="token comment" spellcheck="true">// 根据json对象json_doc，获取键值为key的浮点型变量放到value中，返回值放入ret中，jump为程序跳出方式</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_GET_DOUBLE(json_doc, key, value, ret, jump)</span><span class="token comment" spellcheck="true">// 根据json对象json_doc，获取键值为key的字符串指针赋值给value，返回值放入ret中，jump为程序跳出方式</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_GET_STRING(json_doc, key, value, ret, jump)</span><span class="token comment" spellcheck="true">// 根据json对象json_doc，获取键值为key的字符串变量放到value中，返回值放入ret中，jump为程序跳出方式</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_GET_STRING_COPY(json_doc, key, value, len, ret, jump)</span><span class="token comment" spellcheck="true">// 根据json对象json_doc，获取键值为key的Json数组变量放到value中，返回值放入ret中，jump为程序跳出方式</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_GET_ARRAY(json_doc, key, value, ret, jump)</span><span class="token comment" spellcheck="true">// 根据json对象json_doc生成sub_item迭代器</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_ARRAY_FOR_EACH_START(json_doc, sub_item, pos, total)</span><span class="token comment" spellcheck="true">// 数组迭代结束标识</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_ARRAY_FOR_EACH_END()</span><span class="token comment" spellcheck="true">// 获取json_doc对象中的Json对象，键值为key，值放到value中，正确ret值为0，否则为负值，jump为失败后的跳转方式</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_GET_OBJECT(json_doc, key, value, ret, jump)</span><span class="token comment" spellcheck="true">// Json反序列结束标识</span><span class="token macro property">#<span class="token directive keyword">define</span> JSON_DESERIALIZE_END(json_root, ret)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><p>反序列的Json字符串</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"payload"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"face_compare_result"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"ewoJInJldCIgOiAwLAoJInNjb3JlIiA6IDAuOTk2MTg2MDc3NTk0NzU3MDgKfQo="</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>反序列化代码</p><pre><code>JSON_DESERIALIZE_START(json_root, szResponse, iRet);    JSON_DESERIALIZE_GET_OBJECT(json_root, &quot;payload&quot;, payload_obj, iRet, JSON_CTRL_BREAK);    JSON_DESERIALIZE_GET_OBJECT(payload_obj, &quot;face_compare_result&quot;, result_obj, iRet, JSON_CTRL_BREAK);    JSON_DESERIALIZE_GET_STRING(result_obj, &quot;text&quot;, pText, iRet, JSON_CTRL_NULL);    if (pText) text-&gt;appendStr(text, pText, strlen(pText));JSON_DESERIALIZE_END(json_root, iRet);</code></pre><p><strong>程序运行结果</strong></p><p>运行结果是通过JSON_DESERIALIZE_GET_STRING把text的值存放到了pText中。</p><h2 id="3-11-基础数据处理接口"><a href="#3-11-基础数据处理接口" class="headerlink" title="3.11  基础数据处理接口"></a>3.11  基础数据处理接口</h2><h3 id="3-11-1-string数据处理"><a href="#3-11-1-string数据处理" class="headerlink" title="3.11.1 string数据处理"></a>3.11.1 string数据处理</h3><p><strong>接口说明</strong></p><pre><code>// 创建一个新的字符串对象cscstring_new(cs);// 创建一个新的字符串对象cstr， 长度为lencstring_new_len(cstr, len);// 使用cstring_new的cstr需要通过cstring_del释放资源cstring_del(cstr);typedef struct cstring&#123;    char *str;                                                              // 字符串    size_t alloced;                                                         // 动态分配    size_t len;                                                             // 字符长度    struct cstring *(*create)(size_t len);                                  // 创建字符串    void (*destory)(struct cstring *);                                      // 释放字符串    void (*appendStr)(struct cstring *cs, const char *str, size_t len);     // 追加字符串    void (*appendChar)(struct cstring *cs, char c);                         // 追加字符    void (*appendInt)(struct cstring *cs, int val);                         // 追加整型    void (*frontStr)(struct cstring *cs, const char *str, size_t len);      // 从头插入字符串    void (*frontChar)(struct cstring *cs, char c);                          // 从头插入字符    void (*frontInt)(struct cstring *cs, int val);                          // 从头插入整型    void (*clear)(struct cstring *cs);                                      // 清空字符串内容    void (*truncate)(struct cstring *cs, size_t len);                       // 截断字符串    void (*dropBegin)(struct cstring *cs, size_t len);                      // 丢掉前面指定len的字符    void (*dropEnd)(struct cstring *cs, size_t len);                        // 丢掉后面指定len的字符    size_t (*length)(const struct cstring *cs);                             // 求取字符串长度    const char *(*peek)(const struct cstring *cs);                          // 获取字符串首地址    char *(*dump)(const struct cstring *cs, size_t *len);                   // 获取字符串内容&#125; cstring_t;</code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">cstring_new</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">;</span>    cs<span class="token operator">-></span><span class="token function">appendStr</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token string">"123"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cs<span class="token operator">-></span><span class="token function">appendChar</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cs<span class="token operator">-></span><span class="token function">appendInt</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s \n"</span><span class="token punctuation">,</span> cs<span class="token operator">-></span><span class="token function">peek</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cs<span class="token operator">-></span><span class="token function">frontStr</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token string">"789"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s \n"</span><span class="token punctuation">,</span> cs<span class="token operator">-></span><span class="token function">peek</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cs<span class="token operator">-></span><span class="token function">dropBegin</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s \n"</span><span class="token punctuation">,</span> cs<span class="token operator">-></span><span class="token function">peek</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cs<span class="token operator">-></span><span class="token function">dropEnd</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s \n"</span><span class="token punctuation">,</span> cs<span class="token operator">-></span><span class="token function">peek</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cstring_del</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>123452789123452912345291234</code></pre><h3 id="3-11-2-map数据处理"><a href="#3-11-2-map数据处理" class="headerlink" title="3.11.2 map数据处理"></a>3.11.2 map数据处理</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c">功能：所有的map都是通过宏定义实现的<span class="token punctuation">.</span><span class="token comment" spellcheck="true">// 创建一个map结构体，T可以为自定义类型</span><span class="token function">map_t</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>Creates a map <span class="token keyword">struct</span> <span class="token keyword">for</span> containing values of type T<span class="token punctuation">.</span><span class="token comment" spellcheck="true">// 初始化map，map在使用前必须要调用map_init</span><span class="token function">map_init</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>map_init<span class="token comment" spellcheck="true">// 反初始化map，释放使用的资源</span><span class="token function">map_deinit</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>Deinitialises the map<span class="token punctuation">,</span> freeing the memory the map allocated during use<span class="token punctuation">;</span> this should be called when we're finished with a map<span class="token punctuation">.</span><span class="token comment" spellcheck="true">// 获取给定key的map值，返回的是指向值得指针</span><span class="token function">map_get</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 设置一个指定key的值value到map中，操作正常返回0，否则失败返回-1</span><span class="token function">map_set</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 把指定为key的数据从map中移除</span><span class="token function">map_remove</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 获取map迭代器，返回一个map_iter_t类型，可以通过map_next遍历</span><span class="token function">map_iter</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>Returns a map_iter_t which can be used with <span class="token function">map_next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to iterate all the keys in the map<span class="token punctuation">.</span><span class="token comment" spellcheck="true">// 通过map_next迭代map中的数据</span><span class="token function">map_next</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> iter<span class="token punctuation">)</span>Uses the map_iter_t returned by <span class="token function">map_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to iterate all the keys in the map<span class="token punctuation">.</span> <span class="token function">map_next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> returns a key with each call and returns <span class="token constant">NULL</span> when there are no more keys<span class="token punctuation">.</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>map_iter_t iter <span class="token operator">=</span> <span class="token function">map_iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token function">map_next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s -> %d"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token function">map_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c">map_int_t m<span class="token punctuation">;</span><span class="token function">map_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">map_set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">,</span> <span class="token string">"testkey"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token operator">*</span>val <span class="token operator">=</span> <span class="token function">map_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">,</span> <span class="token string">"testkey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"value: %d\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"value not found\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">map_deinit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>value: 123</code></pre><h3 id="3-11-3-循环buffer数据处理"><a href="#3-11-3-循环buffer数据处理" class="headerlink" title="3.11.3 循环buffer数据处理"></a>3.11.3 循环buffer数据处理</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">// ring buffer初始化</span><span class="token keyword">void</span> <span class="token function">ring_buffer_init</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 存入data字符数据到buffer中</span><span class="token keyword">void</span> <span class="token function">ring_buffer_queue</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 存放长度位size的data数组到ring buffer中</span><span class="token keyword">void</span> <span class="token function">ring_buffer_queue_arr</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> ring_buffer_size_t size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 从ring buffer中获取一个字符数据到data中</span>uint8_t <span class="token function">ring_buffer_dequeue</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 从ring buffer中获取一个长度为len的数据到data中，返回真实的数据长度</span>ring_buffer_size_t <span class="token function">ring_buffer_dequeue_arr</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> ring_buffer_size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 从ring buffer中index索引处获取一个字符到data中，这个操作并不会影响ring buffer的内容</span>uint8_t <span class="token function">ring_buffer_peek</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> ring_buffer_size_t index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 判断ring buffer是否为空</span><span class="token keyword">inline</span> uint8_t <span class="token function">ring_buffer_is_empty</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>buffer<span class="token operator">-></span>head_index <span class="token operator">==</span> buffer<span class="token operator">-></span>tail_index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 判断ring buffer内容是否已经满了</span><span class="token keyword">inline</span> uint8_t <span class="token function">ring_buffer_is_full</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token operator">-></span>head_index <span class="token operator">-</span> buffer<span class="token operator">-></span>tail_index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> RING_BUFFER_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> RING_BUFFER_MASK<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 判断ring buffer剩余的内容大小，以字节大小返回</span><span class="token keyword">inline</span> ring_buffer_size_t <span class="token function">ring_buffer_num_items</span><span class="token punctuation">(</span>ring_buffer_t <span class="token operator">*</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token operator">-></span>head_index <span class="token operator">-</span> buffer<span class="token operator">-></span>tail_index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> RING_BUFFER_MASK<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ringbuffer.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">int</span> i<span class="token punctuation">,</span> cnt<span class="token punctuation">;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 创建循环buffer */</span>    ring_buffer_t ring_buffer<span class="token punctuation">;</span>    <span class="token function">ring_buffer_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ring_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 往ring buffer中写入内容 */</span>    <span class="token function">ring_buffer_queue_arr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ring_buffer<span class="token punctuation">,</span> <span class="token string">"Hello, easyAIoT!"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 获取ring buffer大小</span>    cnt <span class="token operator">=</span> <span class="token function">ring_buffer_num_items</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ring_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 获取buffer中的内容 */</span>    <span class="token function">ring_buffer_dequeue_arr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ring_buffer<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ring buffer size:%d, content:%s\n"</span><span class="token punctuation">,</span> cnt<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>ring buffer size:16, content:Hello, easyAIoT!</code></pre><h2 id="3-12-其他接口"><a href="#3-12-其他接口" class="headerlink" title="3.12 其他接口"></a>3.12 其他接口</h2><h3 id="3-12-1-时间接口"><a href="#3-12-1-时间接口" class="headerlink" title="3.12.1 时间接口"></a>3.12.1 时间接口</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief dateime结构体，通过now获取当前时间，通过format对时间进行格式化输出，输出到pDate中 */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> DateTime <span class="token punctuation">{</span>    <span class="token function">time_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>now<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">bool</span> <span class="token punctuation">(</span><span class="token operator">*</span>format<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>pDate<span class="token punctuation">,</span> <span class="token keyword">int</span> iLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>DateTime_t<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief datetime对象 */</span><span class="token keyword">extern</span> DateTime_t datetime<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">// 获取当前时间戳</span>time_t time <span class="token operator">=</span> datetime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取GMT时间</span><span class="token keyword">char</span> szDate<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>datetime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"GMT"</span><span class="token punctuation">,</span> szDate<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"now:%d, time:%s\n"</span><span class="token punctuation">,</span> time<span class="token punctuation">,</span> szDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>now:1607614344, time:Thu, 10 Dec 2020 15:32:25 GMT</code></pre><h3 id="3-12-2-文件接口"><a href="#3-12-2-文件接口" class="headerlink" title="3.12.2 文件接口"></a>3.12.2 文件接口</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 读取文件内容 * @param  pathname         需要读取的文件路径名称 * @return cstring_t*       读取数据存放的字符串结构体指针，读取失败返回NULL */</span>cstring_t <span class="token operator">*</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @brief 写入文件内容 * @param  pathname         要写入的文件 * @param  data             写入的数据 * @param  len              写入数据的长度 * @return size_t           真实写入的大小 */</span>size_t <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"easyAIoT"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cstring_t <span class="token operator">*</span> pContent <span class="token operator">=</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"file content:%s"</span><span class="token punctuation">,</span> pContent<span class="token operator">-></span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>file content:easyAIoT</code></pre><h3 id="3-12-3-讯飞authorization接口"><a href="#3-12-3-讯飞authorization接口" class="headerlink" title="3.12.3 讯飞authorization接口"></a>3.12.3 讯飞authorization接口</h3><p><strong>接口说明</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/** * @brief 构造鉴权参数authorization字段，参考讯飞云相关文档 * @param  pszAPIKey        用户的APPID * @param  pszBaseUrl       请求的URL基地址 * @param  pszReuqestLine   请求request-line * @param  pszGMTDate       请求GMT时间戳 * @param  pAuthData        获取到的Auth数据，如果失败数据内容长度为0 * @param  iLen             pAuthData参数的数组长度 */</span><span class="token keyword">void</span> <span class="token function">vGetAuth</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPKey<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPSecret<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszBaseUrl<span class="token punctuation">,</span>         <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszReuqestLine<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszGMTDate<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>pAuthData<span class="token punctuation">,</span> <span class="token keyword">int</span> iLen<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>示例代码</strong></p><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iFlyAuth.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> szDate<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szAuthData<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 获取GMT时间戳</span>    datetime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"GMT"</span><span class="token punctuation">,</span> szDate<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 构造authorization请求参数</span>    <span class="token function">vGetAuth</span><span class="token punctuation">(</span><span class="token string">"apikey"</span><span class="token punctuation">,</span> <span class="token string">"appsecret"</span><span class="token punctuation">,</span> <span class="token string">"api.xf-yun.com"</span><span class="token punctuation">,</span>             <span class="token string">"POST /v1/private/s67c9c78c HTTP/1.1"</span><span class="token punctuation">,</span> szDate<span class="token punctuation">,</span>             szAuthData<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szAuthData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"auth:%s\n"</span><span class="token punctuation">,</span> szAuthData<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程序运行结果</strong></p><pre><code>auth:YXBpX2tleT0iYXBpa2V5IiwgYWxnb3JpdGhtPSJobWFjLXNoYTI1NiIsIGhlYWRlcnM9Imhvc3QgZGF0ZSByZXF1ZXN0LWxpbmUiLCBzaWduYXR1cmU9IkNXLzZzUWxobVZtQVVDRW5oOE9XV2FZak4zZ2MybXF1NXlDYmUrQzJBRUk9Ig==</code></pre><h1 id="四、环境搭建"><a href="#四、环境搭建" class="headerlink" title="四、环境搭建"></a>四、环境搭建</h1><h2 id="4-1-vscode环境搭建"><a href="#4-1-vscode环境搭建" class="headerlink" title="4.1 vscode环境搭建"></a>4.1 vscode环境搭建</h2><p>vscode是微软近几年推出的一款<a href="https://code.visualstudio.com/" rel="external nofollow noreferrer">免费</a>、<a href="https://github.com/Microsoft/vscode" rel="external nofollow noreferrer">开源</a>、<a href="https://www.electronjs.org/" rel="external nofollow noreferrer">跨平台</a>、资源占用（较）少、架构优良、插件扩展丰富（不会像eclipse一样卡顿）的一款IDE代码编辑、编译、调试一体化的工具，是目前即全面又好用的IDE开发环境。</p><p>可能以下的配置过程略显麻烦，我们也提供了一个完整的环境，方便大家直接使用开发代码的protable版本，适用于windows的32和64位的版本：</p><pre><code>32位下载链接：https://pan.baidu.com/s/1YRwBz-EsxpNGmm1yHk3CLw提取码：123464位下载链接：https://pan.baidu.com/s/11vZUjX_a_0YlQykP0w4bqw提取码：1234</code></pre><p>以上只要把解压后的CMake/bin和mingw下的bin目录配置到系统的path中就可以直接使用了。</p><h3 id="4-1-1-vscode软件下载"><a href="#4-1-1-vscode软件下载" class="headerlink" title="4.1.1 vscode软件下载"></a>4.1.1 vscode软件下载</h3><p>vscode支持windows平台的protable免安装版本，再也不用下载之后还要在系统上安装了，可怜的C盘终于不用塞那么多软件了，如果你喜欢，甚至可以把软件放在U盘里，插到电脑上来使用，更加便捷。</p><p>由于是便捷版本，插件下载时必须设置相关目录才能被正常使用，接下来看看怎么使用这款神奇的软件吧。</p><p><strong>便携版下载地址：</strong></p><p>直接在浏览器搜索vscode即可，<a href="https://code.visualstudio.com/#alt-downloads" rel="external nofollow noreferrer">点击下载</a></p><p>根据自己的平台选择。windows平台选择zip为免安装版本，根据自己的电脑选择对应的版本，目前台式电脑还是x86的天下（苹果M1芯片将改变x86架构在PC端一统江湖的地位），对于目前电脑都是64bit的了，选择64bit即可。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201204153255342.png" alt="image-20201204153255342"></p><p>下载解压就可以用了，但是作为”真正”的便携，我们还需要为它做一些事情，有关描述，vscode开发者，也就是微软，给了详细的<a href="https://code.visualstudio.com/docs/editor/portable" rel="external nofollow noreferrer">说明</a>，流程如下：</p><p>1、使能便携模式</p><p>Window/Linux用户：</p><p>解压zip压缩包，并创建data目录</p><pre><code>|- VSCode-win32-x64-1.50.1|   |- Code.exe (or code executable)|   |- data|   |- ...</code></pre><p>macOS用户：</p><p>解压后，创建code-portable-data目录</p><pre><code>|- Visual Studio Code.app|- code-portable-data</code></pre><p>如果处于隔离模式，需要输入以下信息：</p><pre><code>xattr -dr com.apple.quarantine Visual\ Studio\ Code.app</code></pre><p>如果是Insiders（开发版）模式，创建的目录名称是<strong>code-insiders-portable-data</strong></p><p><strong>设置完整的便携模式流程</strong></p><ol><li> 下载VS Code ZIP包</li><li> 创建data或者code-portable-data目录</li><li> 拷贝目前系统上的Code目录到data目录下，并重新命名为user-data:</li></ol><ul><li>  <strong>Windows</strong> <code>%APPDATA%\Code</code></li><li>  <strong>macOS</strong> <code>$HOME/Library/Application Support/Code</code></li><li>  <strong>Linux</strong> <code>$HOME/.config/Code</code></li></ul><ol start="4"><li> 拷贝扩展包（下载的插件）目录到data目录下：</li></ol><ul><li>  <strong>Windows</strong> <code>%USERPROFILE%\.vscode\extensions</code></li><li>  <strong>macOS</strong> <code>~/.vscode/extensions</code></li><li>  <strong>Linux</strong> <code>~/.vscode/extensions</code></li></ul><p>最终的目录结构大概是这样：</p><pre><code>|- VSCode-win32-x64-1.50.1|   |- Code.exe (or code executable)|   |- data|   |   |- user-data|   |   |   |- ...|   |   |- extensions|   |   |   |- ...|   |- ...</code></pre><p>vscode在运行的过程中会产生一些临时文件，如果你想”收留”它们的话，可以在data目录下创建一个TMP目录用于存放vscode的一些临时数据内容。</p><h3 id="4-1-2-插件下载"><a href="#4-1-2-插件下载" class="headerlink" title="4.1.2 插件下载"></a>4.1.2 插件下载</h3><p>工欲善其事必先利其器，vscode只是一个IDE环境，丰富的插件才是vscode的灵魂所在。本项目中必选的插件如下：</p><ul><li>  <strong>C/C++ IntelliSense</strong>：必选，负责代码编辑、调试、代码浏览。比如好用的代码提示的功能；</li><li>  <strong>CMake Tools</strong>：必选，负责CMake工程的配置、创建、构建、调试；</li><li>  <strong>Chinese (Simplified) Language Pack</strong>：可选，IDE环境的中文支持；</li><li>  <strong>CMake</strong>：可选，编写CMake文件时提供CMake语法支持和提示信息，需要手动写CMake配置文件必备；</li></ul><p>以上这些可以通过左侧侧边栏扩展功能窗口，在搜索框中输入这些插件的名字来下载获得，下载好后，这些插件会存放到上一节创建的data/extensions目录下。快捷键ctrl+shift+x</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201204164135462.png" alt="image-20201204164135462"></p><h3 id="4-1-3-Mingw工具下载"><a href="#4-1-3-Mingw工具下载" class="headerlink" title="4.1.3 Mingw工具下载"></a>4.1.3 Mingw工具下载</h3><p>MinGW（Minimalist GNU for Windows），主要提供了针对 win32 应用的 GCC等工具集。另外如果想在windows平台模拟Linux的开发环境，也可以使用Cygwin，只适合学习，效率受到了模拟环境的影响。</p><p><a href="https://osdn.net/projects/mingw/releases/" rel="external nofollow noreferrer">下载地址</a></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201204165807471.png" alt="image-20201204165807471"></p><p>它是一个MinGW的在线下载工具，可以在线下载需要的组件，选择的配置信息如下：</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201207201730104.png" alt="image-20201207201730104"></p><p>由于线上下载速度可能会比较慢，可以通过以下给定的网盘下来离线版本，这里为了兼容Windows平台的录音库，并没有使用Posix版本。</p><p>链接：<a href="https://pan.baidu.com/s/16zvws1R-pNZoQQIGEQggDw" rel="external nofollow noreferrer">https://pan.baidu.com/s/16zvws1R-pNZoQQIGEQggDw</a><br>        提取码：1234</p><p>解压之后，把mingw64/bin目录设置到系统PATH变量中；</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201207202348621.png" alt="image-20201207202348621"></p><p>设置完成后，打开cmd命令，输入gcc -v，得到如下信息，表示安装成功。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201207202438631.png" alt="image-20201207202438631"></p><h3 id="4-1-4-cmake工具下载"><a href="#4-1-4-cmake工具下载" class="headerlink" title="4.1.4 cmake工具下载"></a>4.1.4 cmake工具下载</h3><p>CMake是自动工程管理工具。当源代码变多的时候，使用GCC需要自己维护编译的过程，通过CMake可以更加方便的管理。</p><p><a href="https://cmake.org/download/" rel="external nofollow noreferrer">CMake的下载</a>：按照自己的平台下载对应的软件安装即可。</p><p>提供额外的链接：<a href="https://pan.baidu.com/s/1XccI2MEFUouxZkQKzEhG3w" rel="external nofollow noreferrer">https://pan.baidu.com/s/1XccI2MEFUouxZkQKzEhG3w</a><br>        提取码：1234</p><p>安装完成后，打开cmd命令行输入”cmake  -version”验证cmake工具是否能够正常运行。</p><pre><code>C:\Users\AIBIT&gt;cmake -versioncmake version 3.17.5CMake suite maintained and supported by Kitware (kitware.com/cmake).</code></pre><p>看到cmake版本的展示说明软件安装成功。</p><h2 id="4-2-编译与调试"><a href="#4-2-编译与调试" class="headerlink" title="4.2 编译与调试"></a>4.2 编译与调试</h2><p>一个源代码工程可能由多个源文件组成，并且这些源文件可能由.c/.cpp或者其他语言的编译文件组成，这些源代码怎么编译呢？这就需要一个编译管理的工具，跨平台通用的管理工具叫做Make，我们只需要提供Makefile文件即可，这个文件中描述了我们要怎样编译源代码文件。</p><p>接下来的问题是，Makefile本身维护也很复杂，特别在目录多了后。那么有没有一款可以跨平台的代码编译管理工具呢？CMake即是最好的选择，仅仅写一些简单的描述，就会生成编译需要的Makfile文件，从而通过Make编译生成需要的最终程序运行文件。</p><p>在VSCode中怎样使用CMake来维护咱们的源代码工程呢？一起来看看吧。</p><h3 id="4-2-1-使用CMake管理工程"><a href="#4-2-1-使用CMake管理工程" class="headerlink" title="4.2.1 使用CMake管理工程"></a>4.2.1 使用CMake管理工程</h3><p>CMake管理编译工程的流程：<img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201208104717071.png" alt="image-20201208104717071"></p><ol><li><p><strong>CMake环境配置</strong></p><p> 首先，ctrl+shift+x快捷键打开扩展，在应用商店中搜索CMake Tools，这个插件是VSCode支持CMake功能的插件；</p><p> 其次，需要安装CMake程序，这个在之前章节中有<a href="https://cmake.org/download/" rel="external nofollow noreferrer">下载</a>使用说明；</p><p> 最后，通过ctrl+shift+p打开命令面板，输入cmake:scan for Kits和cmake:select a kit查找编译器和选择编译器</p></li><li><p><strong>CMakeLists.txt配置</strong></p><p> CMakeLists.txt是一个描述文件，用于生成Makefile文件以便指导源代码的编译。既然是描述文件就会有自己的语法，官方提供了<a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html" rel="external nofollow noreferrer">教程</a>。本文不具体介绍语法，通过项目提供的CMakeLists.txt文件，来说明介绍。</p><p> <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201208113318460.png" alt="image-20201208113318460"></p></li><li><p><strong>Makefile构建</strong></p><p> 这个步骤的目标是通过CMakeLists.txt生成真正的Makefile工程文件。可以通过ctrl+shift+p命令面板输入cmake:configure，成功后会在当前目录下生成build目录</p></li><li><p><strong>源代码编译</strong></p><p> 这个步骤的主要目标是通过Makefile工程文件生成可执行的程序的过程。可以直接通过F7快捷键即可进行编译的过程，也可以通过ctrl+shift+p命令面板输入cmake:build来完成</p></li><li><p><strong>链接生成可执行文件</strong></p><p> 这一个步骤是和上一个步骤同步完成的，但是要注意的是，如果发现undefined reference类似的错误是在这个阶段导致的，需要开发者增加缺失的符号，可能来自自己的代码，也可能是缺少第三方或者系统库的依赖。缺少第三方或系统库可以通过在CMakeLists.txt文件中增加对应的target_link_libraries依赖库文件即可（注意依赖库的名称，比如依赖库的名字为libpthread.so, 只需要填写pthread即可，不需要前面的lib，也不需要后面的.so）</p></li><li><p><strong>程序运行</strong></p><p> 编译成功后，直接使用VSCode提供Ctrl+F5进行程序的运行调试即可。运行程序会启动内部调试窗口，开发者可通过查看终端来进行代码的简单调试。更加复杂的调试可参考后面的内容</p></li></ol><h3 id="4-2-2-程序的调试过程"><a href="#4-2-2-程序的调试过程" class="headerlink" title="4.2.2 程序的调试过程"></a>4.2.2 程序的调试过程</h3><p>程序的调试非常重要，不仅能够帮助开发者找到程序的BUG，也是分析代码最重要的手段，强烈建议初学者就应该学习掌握。VSCode提供了非常简单直观的调试界面，通过调试的过程图来说明。</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201208120647496.png" alt="image-20201208120647496"></p><p>一般的调试流程：</p><ul><li>  设置断点</li><li>  运行程序</li><li>  断点处单步执行程序，观察变量值的变化</li></ul><p>从而发现问题和解决问题的过程</p><h1 id="五、AI能力应用开发流程"><a href="#五、AI能力应用开发流程" class="headerlink" title="五、AI能力应用开发流程"></a>五、AI能力应用开发流程</h1><p>以人脸比对作为说明。</p><h2 id="5-1-开发流程"><a href="#5-1-开发流程" class="headerlink" title="5.1 开发流程"></a>5.1 开发流程</h2><p>项目开发对于研发人员一般分为需求确认、技术调研、系统程序设计、软件编码、测试验收等环节。</p><p>以人脸比对应用举例，需求就是<strong>完成一个基本的人脸比对应用，能够比较给定的两张照片相似度，具体形式不限制</strong>。为了完成这个需求，需要做技术上的调研，分析抽象出人脸比对由哪些基础技术组成，再一个个的攻克这些基础问题。</p><p><strong>用例图</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201222143316997.png" alt="image-20201222143316997"></p><p><strong>使用到的技术</strong></p><p>输入比对照片：文件读取（两张照片读取）；</p><p>构造发送请求：NTP时间、Base64加解密、MD5加密、URL加解密；</p><p>发送服务器：HTTP客户端Post请求；</p><p>服务器验证APPID和请求合法性：提供APPID、APIKEY、APP PARAM、Json序列化；</p><p>人脸比对算法：获得HTTP人脸比对服务的接口URL；</p><p>返回比对结果：JSON数据反序列化；</p><h2 id="5-2-程序流程图"><a href="#5-2-程序流程图" class="headerlink" title="5.2 程序流程图"></a>5.2 程序流程图</h2><p>以上明确了人脸比对应用到的技术和问题，这里假设已经掌握了这些基础技术，那么怎么组合这些技术，按照一定的流程来完成需求呢？来看一下整体的程序时序和流程图</p><p>人脸比对时序图</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201222162637000.png" alt="image-20201222162637000"></p><p>人脸比对程序流程图</p><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201222162709968.png" alt="image-20201222162709968"></p><h2 id="5-3-编码"><a href="#5-3-编码" class="headerlink" title="5.3 编码"></a>5.3 编码</h2><p>针对目标的时序和流程有了，流程涉及到的知识也掌握了，接下来就可以通过编码的方式应用这些技术点完成这个流程，从而完成需求的过程。</p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">fFaceCompare</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPID<span class="token punctuation">,</span>                   <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPSecret<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszAPPKey<span class="token punctuation">,</span>                   <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszImagePath1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszImagePath2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">double</span> fScore <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szDate<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szAuthData<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> szFullUrl<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>szBaseUrl <span class="token operator">=</span> <span class="token string">"http://api.xf-yun.com/v1/private/s67c9c78c?host=%s&amp;date=%s&amp;authorization=%s"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 构造authorization请求参数</span>    datetime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"GMT"</span><span class="token punctuation">,</span> szDate<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">vGetAuth</span><span class="token punctuation">(</span>pszAPPKey<span class="token punctuation">,</span> pszAPPSecret<span class="token punctuation">,</span> <span class="token string">"api.xf-yun.com"</span><span class="token punctuation">,</span>             <span class="token string">"POST /v1/private/s67c9c78c HTTP/1.1"</span><span class="token punctuation">,</span> szDate<span class="token punctuation">,</span>             szAuthData<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szAuthData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 构造完整的请求URL</span>    <span class="token function">snprintf</span><span class="token punctuation">(</span>szFullUrl<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szFullUrl<span class="token punctuation">)</span><span class="token punctuation">,</span> szBaseUrl<span class="token punctuation">,</span> <span class="token string">"api.xf-yun.com"</span><span class="token punctuation">,</span> szDate<span class="token punctuation">,</span> szAuthData<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"url:%s"</span><span class="token punctuation">,</span> szFullUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 构造body数据</span>    cstring_t <span class="token operator">*</span>pBody <span class="token operator">=</span> <span class="token function">pstGenBody</span><span class="token punctuation">(</span>pszAPPID<span class="token punctuation">,</span> pszImagePath1<span class="token punctuation">,</span> pszImagePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">LOG</span><span class="token punctuation">(</span>EERROR<span class="token punctuation">,</span> <span class="token string">"empty body error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token number">0f</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// LOG(EDEBUG, "body:#%s#", pBody->str);</span>    <span class="token comment" spellcheck="true">// 构造需要的额外HTTP头</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> szHeader<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"content-type: application/json\r\n"</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 发起HTTP Post语音识别的请求</span>    SEIHttpInfo_t stHttpInfo<span class="token punctuation">;</span>    <span class="token function">bConnectHttpServer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stHttpInfo<span class="token punctuation">,</span> szFullUrl<span class="token punctuation">,</span> szHeader<span class="token punctuation">,</span>                       <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>pBody<span class="token operator">-></span><span class="token function">peek</span><span class="token punctuation">(</span>pBody<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>pBody<span class="token operator">-></span><span class="token function">length</span><span class="token punctuation">(</span>pBody<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"status:%d"</span><span class="token punctuation">,</span> stHttpInfo<span class="token punctuation">.</span>stResponse<span class="token punctuation">.</span>iStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">LOG</span><span class="token punctuation">(</span>EDEBUG<span class="token punctuation">,</span> <span class="token string">"body:%s"</span><span class="token punctuation">,</span> stHttpInfo<span class="token punctuation">.</span>stResponse<span class="token punctuation">.</span>pstBody<span class="token operator">-></span>sBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 获得人脸对比得分</span>    fScore <span class="token operator">=</span> <span class="token function">fGetScoreResult</span><span class="token punctuation">(</span>stHttpInfo<span class="token punctuation">.</span>stResponse<span class="token punctuation">.</span>pstBody<span class="token operator">-></span>sBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 关闭HTTP</span>    <span class="token function">bHttpClose</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stHttpInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cstring_del</span><span class="token punctuation">(</span>pBody<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> fScore<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-4-测试及结果"><a href="#5-4-测试及结果" class="headerlink" title="5.4 测试及结果"></a>5.4 测试及结果</h2><p>程序是否按照既定的流程走了呢？有没有可能在不同的的场景下会偏离流程，而出现不可预知的结果呢？测试在这里就起到了这样的作用：列举出用户使用的所有可能的场景，对场景的流程进行列举，再通过这些场景的流程去验证程序的流程正确性的过程。</p><p>测试过程可以选择</p><ol><li> 不同角度的人脸照片；</li><li> 不同分辨率图片大小；</li><li> 不同明暗度的图片；</li><li> 不同格式的图片；</li><li> 扩展自己的测试用例；</li></ol><p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20201222162955059.png" alt="image-20201222162955059"></p>]]></content>
      
      
      <categories>
          
          <category> MarsRescue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言项目 </tag>
            
            <tag> 人工智能应用 </tag>
            
            <tag> easyAIoT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>比特人生的小破站</title>
      <link href="2021/01/hello-world/"/>
      <url>2021/01/hello-world/</url>
      
        <content type="html"><![CDATA[<p>欢迎来到比特人生的世界！</p><p>Welcome to <a href="https://hexo.io/" rel="external nofollow noreferrer">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" rel="external nofollow noreferrer">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" rel="external nofollow noreferrer">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" rel="external nofollow noreferrer">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" rel="external nofollow noreferrer">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html" rel="external nofollow noreferrer">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" rel="external nofollow noreferrer">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" rel="external nofollow noreferrer">Deployment</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 比特人生的世界 </tag>
            
            <tag> hexo </tag>
            
            <tag> 个人网站 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
