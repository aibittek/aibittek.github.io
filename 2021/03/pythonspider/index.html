<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="baidu-site-verification" content="code-wBoEgdV6ng" />
    <meta name="keywords" content="小白零基础7天学会Python Scrapy爬虫之旅, 比特的世界">
    <meta name="description" content="想做做有趣实用小东西的手艺人">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-190338047-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-190338047-1');
</script>


    <title>小白零基础7天学会Python Scrapy爬虫之旅 | 比特的世界</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">比特的世界</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">比特的世界</div>
        <div class="logo-desc">
            
            想做做有趣实用小东西的手艺人
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">小白零基础7天学会Python Scrapy爬虫之旅</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/python/">
                                <span class="chip bg-color">python</span>
                            </a>
                        
                            <a href="/tags/scrapy/">
                                <span class="chip bg-color">scrapy</span>
                            </a>
                        
                            <a href="/tags/%E7%88%AC%E8%99%AB/">
                                <span class="chip bg-color">爬虫</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/MarsRescue/" class="post-category">
                                MarsRescue
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-03-16
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    54.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    225 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="小白零基础7天学会Python-Scrapy爬虫之旅"><a href="#小白零基础7天学会Python-Scrapy爬虫之旅" class="headerlink" title="小白零基础7天学会Python Scrapy爬虫之旅"></a>小白零基础7天学会Python Scrapy爬虫之旅</h2><p>赏花赏月赏秋香，爬影爬花爬职场</p>
<p>7天之旅带你爬取<strong>最受欢迎的电影、各大高校的校花、量身打造求职信息</strong>；</p>
<p>本教程源码参考链接：<a target="_blank" href="https://github.com/aibittek/PythonSpider" rel="external nofollow noreferrer noopener">https://github.com/aibittek/PythonSpider</a></p>
<h2 id="一、2天学会Python语法之路"><a href="#一、2天学会Python语法之路" class="headerlink" title="一、2天学会Python语法之路"></a>一、2天学会Python语法之路</h2><h3 id="1-1-环境搭建"><a href="#1-1-环境搭建" class="headerlink" title="1.1 环境搭建"></a>1.1 环境搭建</h3><h4 id="1-1-1-下载"><a href="#1-1-1-下载" class="headerlink" title="1.1.1 下载"></a>1.1.1 下载</h4><p><strong>Anaconda+Pycharm？</strong>合理的搭配，安装包全，兼容性好，开发界面友好</p>
<p>缺点：因为全，安装包太大，还要去下载两款软件再安装，再配置。</p>
<p>有没有拎包入住的版本？有的，以下提供了VSCode的Python便携版本，大小只有180MB多。解压双击Code.bat即可享用，不用安装、便携小巧、方便携带，可以放在U盘中，随时插入到任何电脑运行，而你要做的只是双击Code.bat运行即可。</p>
<p>下载地址：</p>
<pre><code>链接：https://pan.baidu.com/s/1AfiX7OJe120Ytg4V__hEFQ
提取码：1234</code></pre>
<p>压缩包名称：VSCode32_Python_Portable.zip</p>
<p>顺便提一下，Anaconda安装包带的Jupyter Notebook也非常好用，使用Anaconda环境的崭新小伙伴不要错过😄。</p>
<h4 id="1-1-2-运行"><a href="#1-1-2-运行" class="headerlink" title="1.1.2 运行"></a>1.1.2 运行</h4><p>解压后，进入VSCode32_Python_Portable目录，找到<strong>双击我运行.bat</strong>并运行，可以看到如下界面</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210308104054991.png" alt="VSCode界面"></p>
<h4 id="1-1-3-验证"><a href="#1-1-3-验证" class="headerlink" title="1.1.3 验证"></a>1.1.3 验证</h4><p>为了验证环境是否能够进行Python的开发，咱们创建第一个Python程序，步骤如下：</p>
<p>1、在无特殊符号无中文的目录下，创建一个用于存放Python源代码的目录；</p>
<p>2、在刚打开的界面中选择打开文件夹，并选择这个目录；</p>
<p>3、在这个目录下创建一个Python源代码文件，并输入以下内容；</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210308104804271.png" alt="第一个Python程序"></p>
<p>以上黄色的BASE是打开的源代码目录名称，黄色箭头指向的是这个目录存放的位置；</p>
<p>first.py是在base目录下创建的python代码文件，红色箭头指向的是first.py的代码，里面有两行内容：</p>
<pre><code># coding=utf-8表示这个文件的编码方式是utf-8格式的
print是一个打印函数，会向终端中打印数据，打印的数据内容由()中的内容指定，
这里咱们提供的是hello world字符串</code></pre>
<h4 id="1-1-4-运行第一个代码"><a href="#1-1-4-运行第一个代码" class="headerlink" title="1.1.4 运行第一个代码"></a>1.1.4 运行第一个代码</h4><p>点击first.py文件，点击F5快捷按键，选择Python文件选项，开始运行咱们的第一个Python代码，看到终端显示hello world代表环境成功。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210308105511590.png" alt="第一个Python程序运行结果"></p>
<h3 id="1-2-Python基础语法"><a href="#1-2-Python基础语法" class="headerlink" title="1.2 Python基础语法"></a>1.2 Python基础语法</h3><h4 id="1-2-1-编码"><a href="#1-2-1-编码" class="headerlink" title="1.2.1 编码"></a>1.2.1 编码</h4><p>有时候我们打开的文件会乱码，这是什么问题呢？</p>
<p>这是因为在计算机中保存的数据都是通过不同的编码保存的，如果打开的软件不知道这个文件是通过什么编码保存的，就不能以正确的方式打开，显示的内容就会错误啦。</p>
<p>因此，我们可以通过在文件中指定文件的编码方式来解决，Python文件通过以下两种方式指定文件的编码方式：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或者</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中utf-8代表的是一种编码方式，也是Python默认的编码方式。</p>
<p>关于编码的问题渊远流长，可以参考<a target="_blank" href="https://www.jianshu.com/p/36d20de2a1ee" rel="external nofollow noreferrer noopener">这篇文章</a>了解来龙去脉。</p>
<h4 id="1-2-2-标识符"><a href="#1-2-2-标识符" class="headerlink" title="1.2.2 标识符"></a>1.2.2 标识符</h4><p>在Python3中已经可以使用中文作为变量名称了</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

字符串<span class="token operator">=</span><span class="token string">'hello'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>字符串<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出的结果是hello，其中的<strong>字符串</strong>是一个变量名称。</p>
<p>其他的标识符约束：</p>
<ul>
<li>  第一个字符必须是字母表中字母或下划线 <strong>_</strong> 。</li>
<li>  标识符的其他的部分由字母、数字和下划线组成。</li>
<li>  标识符对大小写敏感。</li>
</ul>
<h4 id="1-2-3-Python保留字"><a href="#1-2-3-Python保留字" class="headerlink" title="1.2.3 Python保留字"></a>1.2.3 Python保留字</h4><p>Python语言有自己的语法规则，而这些语法规则使用了一些文字，比如<strong>if</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的代码含义是，如果条件为真，则输出hello，其中的if就是Python语言中用于判断真假的语法关键字，已经被占用了，咱们就不能再使用了。像这样的还有很多，我们称之为保留字。</p>
<p>Python的保留字可以通过以下方式获取</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">import</span> keyword
<span class="token keyword">print</span><span class="token punctuation">(</span>keyword<span class="token punctuation">.</span>kwlist<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出的保留关键字结果如下：</p>
<pre><code>[&#39;False&#39;, &#39;None&#39;, &#39;True&#39;, &#39;and&#39;, &#39;as&#39;, &#39;assert&#39;, &#39;async&#39;, &#39;await&#39;, &#39;break&#39;, &#39;class&#39;, &#39;continue&#39;, &#39;def&#39;, &#39;del&#39;, &#39;elif&#39;, &#39;else&#39;, 
&#39;except&#39;, &#39;finally&#39;, &#39;for&#39;, &#39;from&#39;, &#39;global&#39;, &#39;if&#39;, &#39;import&#39;, &#39;in&#39;, &#39;is&#39;, &#39;lambda&#39;, &#39;nonlocal&#39;, &#39;not&#39;, &#39;or&#39;, &#39;pass&#39;, &#39;raise&#39;, &#39;return&#39;, &#39;try&#39;, &#39;while&#39;, &#39;with&#39;, &#39;yield&#39;]</code></pre>
<h4 id="1-2-4-注释"><a href="#1-2-4-注释" class="headerlink" title="1.2.4 注释"></a>1.2.4 注释</h4><p>Python中的注释一般是#开头，多行使用’’’或者”””</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token triple-quoted-string string">'''
这是一条注释
'''</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Hello, Python!'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-5-行与缩进"><a href="#1-2-5-行与缩进" class="headerlink" title="1.2.5 行与缩进"></a>1.2.5 行与缩进</h4><p>Python的缩进需要特别注意，同一级别的代码块的缩进要保持相同，否则会出现逻辑或异常，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">if</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'True'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Really True'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"False"</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'why false'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的代码由于第8行缩进的问题，会执行异常，尝试使用相同的缩进，使得代码运行正常，并猜测打印出的结果。</p>
<h4 id="1-2-6-多行语句"><a href="#1-2-6-多行语句" class="headerlink" title="1.2.6 多行语句"></a>1.2.6 多行语句</h4><p>如果一条语句很长的时候，我们需要使用续行符来表示他们是属于同一行的，要注意续航符后面不能有字符哦。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

totalString <span class="token operator">=</span> <span class="token string">'Hello'</span> <span class="token operator">+</span> \
        <span class="token string">', '</span> <span class="token operator">+</span> \
        <span class="token string">'Python!'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>totalString<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出的结果为：</p>
<pre><code>Hello, Python!</code></pre>
<h4 id="1-2-7-数字Number类型"><a href="#1-2-7-数字Number类型" class="headerlink" title="1.2.7 数字Number类型"></a>1.2.7 数字Number类型</h4><p>python中数字有四种类型：整数、布尔型、浮点数和复数。</p>
<ul>
<li>  <strong>int</strong> (整数), 如 1, 只有一种整数类型 int，表示为长整型，没有 python2 中的 Long。</li>
<li>  <strong>bool</strong> (布尔), 如 True。</li>
<li>  <strong>float</strong> (浮点数), 如 1.23、3E-2</li>
<li>  <strong>complex</strong> (复数), 如 1 + 2j、 1.1 + 2.2j</li>
</ul>
<h4 id="1-2-8-字符串"><a href="#1-2-8-字符串" class="headerlink" title="1.2.8 字符串"></a>1.2.8 字符串</h4><ul>
<li>  python中单引号和双引号使用完全相同。</li>
<li>  使用三引号(‘’’或”””)可以指定一个多行字符串。</li>
<li>  转义符 ‘&#39;</li>
<li>  反斜杠可以用来转义，使用r可以让反斜杠不发生转义。。 如 r”this is a line with \n” 则\n会显示，并不是换行。</li>
<li>  按字面意义级联字符串，如”this “ “is “ “string”会被自动转换为this is string。</li>
<li>  字符串可以用 + 运算符连接在一起，用 * 运算符重复。</li>
<li>  Python 中的字符串有两种索引方式，从左往右以 0 开始，从右往左以 -1 开始。</li>
<li>  Python中的字符串不能改变。</li>
<li>  Python 没有单独的字符类型，一个字符就是长度为 1 的字符串。</li>
<li>  字符串的截取的语法格式如下：<strong>变量[头下标:尾下标:步长]</strong></li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

word <span class="token operator">=</span> <span class="token string">'字符串'</span>
sentence <span class="token operator">=</span> <span class="token string">"这是一个句子。"</span>
paragraph <span class="token operator">=</span> <span class="token triple-quoted-string string">"""这是一个段落，
可以由多行组成"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实例</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

str<span class="token operator">=</span><span class="token string">'Hello!'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true"># 输出字符串</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true"># 输出第一个到倒数第二个的所有字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>              <span class="token comment" spellcheck="true"># 输出字符串第一个字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 输出从第三个开始到第五个的字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 输出从第三个开始后的所有字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true"># 输出从第二个开始到第五个且每隔两个的字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 输出字符串两次</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token string">'你好'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 连接字符串</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------------------------------'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello\nworld'</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 使用反斜杠(\)+n转义特殊字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token string">'hello\nworld'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 在字符串前面添加一个 r，表示原始字符串，不会发生转义</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的 r 指 raw，即 raw string，会自动将反斜杠转义，例如：</p>
<pre><code>&gt;&gt;&gt; print(&#39;\n&#39;)       # 输出空行

&gt;&gt;&gt; print(r&#39;\n&#39;)      # 输出 \n
\n
&gt;&gt;&gt;</code></pre>
<p>以上实例输出结果：</p>
<pre><code>Hello!
Hello
H
llo
llo!
el
Hello!Hello!
Hello!你好
------------------------------
hello
world
hello\nworld</code></pre>
<h4 id="1-2-9-空行"><a href="#1-2-9-空行" class="headerlink" title="1.2.9 空行"></a>1.2.9 空行</h4><p>函数之间或类的方法之间用空行分隔，表示一段新的代码的开始。类和函数入口之间也用一行空行分隔，以突出函数入口的开始。</p>
<p>空行与代码缩进不同，空行并不是Python语法的一部分。书写时不插入空行，Python解释器运行也不会出错。但是空行的作用在于分隔两段不同功能或含义的代码，便于日后代码的维护或重构。</p>
<p><strong>记住：</strong>空行也是程序代码的一部分。</p>
<h4 id="1-2-10-用户输入"><a href="#1-2-10-用户输入" class="headerlink" title="1.2.10 用户输入"></a>1.2.10 用户输入</h4><p>执行下面的程序在按回车键后就会等待用户输入：</p>
<pre class="line-numbers language-python"><code class="language-python">input<span class="token punctuation">(</span><span class="token string">"\n\n按下 enter 键后退出。"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="1-2-11-一行多条语句"><a href="#1-2-11-一行多条语句" class="headerlink" title="1.2.11 一行多条语句"></a>1.2.11 一行多条语句</h4><p>Python可以在同一行中使用多条语句，语句之间使用分号(;)分割，以下是一个简单的实例：</p>
<pre class="line-numbers language-python"><code class="language-python">content <span class="token operator">=</span> <span class="token string">'python'</span><span class="token punctuation">;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="1-2-12-import与from-import"><a href="#1-2-12-import与from-import" class="headerlink" title="1.2.12 import与from import"></a>1.2.12 import与from import</h4><p>在 python 用 <strong>import</strong> 或者 <strong>from…import</strong> 来导入相应的模块。</p>
<p>将整个模块(somemodule)导入，格式为： <strong>import somemodule</strong></p>
<p>从某个模块中导入某个函数,格式为： <strong>from somemodule import somefunction</strong></p>
<p>从某个模块中导入多个函数,格式为： <strong>from somemodule import firstfunc, secondfunc, thirdfunc</strong></p>
<p>将某个模块中的全部函数导入，格式为： <strong>from somemodule import *</strong></p>
<p>导入sys模块</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'================Python import mode=========================='</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'命令行参数为:'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'\n python 路径为'</span><span class="token punctuation">,</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>导入sys模块的argv, path # 导入特定的成员</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> sys <span class="token keyword">import</span> argv<span class="token punctuation">,</span>path  <span class="token comment" spellcheck="true">#  导入特定的成员</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'================python from import==================================='</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'path:'</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 因为已经导入path成员，所以此处引用时不需要加sys.path</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-13-命令行参数"><a href="#1-2-13-命令行参数" class="headerlink" title="1.2.13 命令行参数"></a>1.2.13 命令行参数</h4><pre class="line-numbers language-bash"><code class="language-bash">python first.py arg1 arg2 arg3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Python 中也可以所用 <strong>sys</strong> 的 <strong>sys.argv</strong> 来获取命令行参数：</p>
<ul>
<li>  <strong>sys.argv</strong> 是命令行参数列表。</li>
<li>  <strong>len(sys.argv)</strong> 计算命令行参数个数。</li>
</ul>
<p><strong>注：**</strong>sys.argv[0]** 表示脚本名。</p>
<p>示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'参数个数为:'</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'个参数。'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'参数列表:'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'脚本名:'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行以上代码，输出结果为：</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ python3 first.py arg1 arg2 arg3
参数个数为: 4 个参数。
参数列表: <span class="token punctuation">[</span><span class="token string">'first.py'</span>, <span class="token string">'arg1'</span>, <span class="token string">'arg2'</span>, <span class="token string">'arg3'</span><span class="token punctuation">]</span>
脚本名: first.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Python 提供了 <strong>getopt</strong> 模块来获取命令行参数。</p>
<h4 id="1-2-14-算术运算符"><a href="#1-2-14-算术运算符" class="headerlink" title="1.2.14 算术运算符"></a>1.2.14 算术运算符</h4><p>以下假设变量a为10，变量b为21：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">加 - 两个对象相加</td>
<td align="left">a + b 输出结果 31</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">减 - 得到负数或是一个数减去另一个数</td>
<td align="left">a - b 输出结果 -11</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">乘 - 两个数相乘或是返回一个被重复若干次的字符串</td>
<td align="left">a * b 输出结果 210</td>
</tr>
<tr>
<td align="left">/</td>
<td align="left">除 - x 除以 y</td>
<td align="left">b / a 输出结果 2.1</td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">取模 - 返回除法的余数</td>
<td align="left">b % a 输出结果 1</td>
</tr>
<tr>
<td align="left">**</td>
<td align="left">幂 - 返回x的y次幂</td>
<td align="left">a**b 为10的21次方</td>
</tr>
<tr>
<td align="left">//</td>
<td align="left">取整除 - 向下取接近商的整数</td>
<td align="left"><code>&gt;&gt;&gt; 9//2 4 &gt;&gt;&gt; -9//2 -5</code></td>
</tr>
</tbody></table>
<p>以下实例演示了Python所有算术运算符的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">21</span>
b <span class="token operator">=</span> <span class="token number">10</span>
c <span class="token operator">=</span> <span class="token number">0</span>

c <span class="token operator">=</span> a <span class="token operator">+</span> b
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">-</span> b
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">*</span> b
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">/</span> b
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">%</span> b
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改变量 a 、b 、c</span>
a <span class="token operator">=</span> <span class="token number">2</span>
b <span class="token operator">=</span> <span class="token number">3</span>
c <span class="token operator">=</span> a<span class="token operator">**</span>b 
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

a <span class="token operator">=</span> <span class="token number">10</span>
b <span class="token operator">=</span> <span class="token number">5</span>
c <span class="token operator">=</span> a<span class="token operator">//</span>b 
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"7 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre class="line-numbers language-bash"><code class="language-bash">1 - c 的值为： 31
2 - c 的值为： 11
3 - c 的值为： 210
4 - c 的值为： 2.1
5 - c 的值为： 1
6 - c 的值为： 8
7 - c 的值为： 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-15-比较运算符"><a href="#1-2-15-比较运算符" class="headerlink" title="1.2.15 比较运算符"></a>1.2.15 比较运算符</h4><p>以下假设变量a为10，变量b为20：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">==</td>
<td align="left">等于 - 比较对象是否相等</td>
<td align="left">(a == b) 返回 False。</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left">不等于 - 比较两个对象是否不相等</td>
<td align="left">(a != b) 返回 True。</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于 - 返回x是否大于y</td>
<td align="left">(a &gt; b) 返回 False。</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于 - 返回x是否小于y。所有比较运算符返回1表示真，返回0表示假。这分别与特殊的变量True和False等价。注意，这些变量名的大写。</td>
<td align="left">(a &lt; b) 返回 True。</td>
</tr>
<tr>
<td align="left">&gt;=</td>
<td align="left">大于等于 - 返回x是否大于等于y。</td>
<td align="left">(a &gt;= b) 返回 False。</td>
</tr>
<tr>
<td align="left">&lt;=</td>
<td align="left">小于等于 - 返回x是否小于等于y。</td>
<td align="left">(a &lt;= b) 返回 True。</td>
</tr>
</tbody></table>
<p>以下实例演示了Python所有比较运算符的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">21</span>
b <span class="token operator">=</span> <span class="token number">10</span>
c <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">==</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 等于 b"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 不等于 b"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">!=</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 不等于 b"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 等于 b"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 小于 b"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 大于等于 b"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">></span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 大于 b"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 小于等于 b"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改变量 a 和 b 的值</span>
a <span class="token operator">=</span> <span class="token number">5</span>
b <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;=</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - a 小于等于 b"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - a 大于  b"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">>=</span> a <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - b 大于等于 a"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - b 小于 a"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：</p>
<pre class="line-numbers language-bash"><code class="language-bash">1 - a 不等于 b
2 - a 不等于 b
3 - a 大于等于 b
4 - a 大于 b
5 - a 小于等于 b
6 - b 大于等于 a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-16-赋值运算符"><a href="#1-2-16-赋值运算符" class="headerlink" title="1.2.16 赋值运算符"></a>1.2.16 赋值运算符</h4><p>以下假设变量a为10，变量b为20：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">=</td>
<td align="left">简单的赋值运算符</td>
<td align="left">c = a + b 将 a + b 的运算结果赋值为 c</td>
</tr>
<tr>
<td align="left">+=</td>
<td align="left">加法赋值运算符</td>
<td align="left">c += a 等效于 c = c + a</td>
</tr>
<tr>
<td align="left">-=</td>
<td align="left">减法赋值运算符</td>
<td align="left">c -= a 等效于 c = c - a</td>
</tr>
<tr>
<td align="left">*=</td>
<td align="left">乘法赋值运算符</td>
<td align="left">c *= a 等效于 c = c * a</td>
</tr>
<tr>
<td align="left">/=</td>
<td align="left">除法赋值运算符</td>
<td align="left">c /= a 等效于 c = c / a</td>
</tr>
<tr>
<td align="left">%=</td>
<td align="left">取模赋值运算符</td>
<td align="left">c %= a 等效于 c = c % a</td>
</tr>
<tr>
<td align="left">**=</td>
<td align="left">幂赋值运算符</td>
<td align="left">c **= a 等效于 c = c ** a</td>
</tr>
<tr>
<td align="left">//=</td>
<td align="left">取整除赋值运算符</td>
<td align="left">c //= a 等效于 c = c // a</td>
</tr>
<tr>
<td align="left">:=</td>
<td align="left">海象运算符，可在表达式内部为变量赋值。<strong>Python3.8 版本新增运算符</strong>。</td>
<td align="left">在这个示例中，赋值表达式可以避免调用 len() 两次:<code>if (n := len(a)) &gt; 10:    print(f&quot;List is too long (&#123;n&#125; elements, expected &lt;= 10)&quot;)</code></td>
</tr>
</tbody></table>
<p>以下实例演示了Python所有赋值运算符的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">21</span>
b <span class="token operator">=</span> <span class="token number">10</span>
c <span class="token operator">=</span> <span class="token number">0</span>

c <span class="token operator">=</span> a <span class="token operator">+</span> b
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">+=</span> a
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">*=</span> a
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">/=</span> a 
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> <span class="token number">2</span>
c <span class="token operator">%=</span> a
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">**=</span> a
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">//=</span> a
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"7 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上示例输出结果：</p>
<pre class="line-numbers language-bash"><code class="language-bash">1 - c 的值为： 31
2 - c 的值为： 52
3 - c 的值为： 1092
4 - c 的值为： 52.0
5 - c 的值为： 2
6 - c 的值为： 2097152
7 - c 的值为： 99864<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-17-位运算符"><a href="#1-2-17-位运算符" class="headerlink" title="1.2.17 位运算符"></a>1.2.17 位运算符</h4><p>按位运算符是把数字看作二进制来进行计算的。Python中的按位运算法则如下：</p>
<p>下表中变量 a 为 60，b 为 13二进制格式如下：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">0011</span> <span class="token number">1100</span>
b <span class="token operator">=</span> <span class="token number">0000</span> <span class="token number">1101</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
a<span class="token operator">&amp;</span>b <span class="token operator">=</span> <span class="token number">0000</span> <span class="token number">1100</span>
a<span class="token operator">|</span>b <span class="token operator">=</span> <span class="token number">0011</span> <span class="token number">1101</span>
a<span class="token operator">^</span>b <span class="token operator">=</span> <span class="token number">0011</span> <span class="token number">0001</span>
<span class="token operator">~</span>a  <span class="token operator">=</span> <span class="token number">1100</span> <span class="token number">0011</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&amp;</td>
<td align="left">按位与运算符：参与运算的两个值,如果两个相应位都为1,则该位的结果为1,否则为0</td>
<td align="left">(a &amp; b) 输出结果 12 ，二进制解释： 0000 1100</td>
</tr>
<tr>
<td align="left">|</td>
<td align="left">按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</td>
<td align="left">(a | b) 输出结果 61 ，二进制解释： 0011 1101</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">按位异或运算符：当两对应的二进位相异时，结果为1</td>
<td align="left">(a ^ b) 输出结果 49 ，二进制解释： 0011 0001</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left">按位取反运算符：对数据的每个二进制位取反,即把1变为0,把0变为1。**~x** 类似于 <strong>-x-1</strong></td>
<td align="left">(~a ) 输出结果 -61 ，二进制解释： 1100 0011， 在一个有符号二进制数的补码形式。</td>
</tr>
<tr>
<td align="left">&lt;&lt;</td>
<td align="left">左移动运算符：运算数的各二进位全部左移若干位，由”&lt;&lt;”右边的数指定移动的位数，高位丢弃，低位补0。</td>
<td align="left">a &lt;&lt; 2 输出结果 240 ，二进制解释： 1111 0000</td>
</tr>
<tr>
<td align="left">&gt;&gt;</td>
<td align="left">右移动运算符：把”&gt;&gt;”左边的运算数的各二进位全部右移若干位，”&gt;&gt;”右边的数指定移动的位数</td>
<td align="left">a &gt;&gt; 2 输出结果 15 ，二进制解释： 0000 1111</td>
</tr>
</tbody></table>
<p>以下实例演示了Python所有位运算符的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">60</span>            <span class="token comment" spellcheck="true"># 60 = 0011 1100 </span>
b <span class="token operator">=</span> <span class="token number">13</span>            <span class="token comment" spellcheck="true"># 13 = 0000 1101 </span>
c <span class="token operator">=</span> <span class="token number">0</span>

c <span class="token operator">=</span> a <span class="token operator">&amp;</span> b        <span class="token comment" spellcheck="true"># 12 = 0000 1100</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">|</span> b        <span class="token comment" spellcheck="true"># 61 = 0011 1101 </span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">^</span> b        <span class="token comment" spellcheck="true"># 49 = 0011 0001</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> <span class="token operator">~</span>a           <span class="token comment" spellcheck="true"># -61 = 1100 0011</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">&lt;&lt;</span> <span class="token number">2</span>       <span class="token comment" spellcheck="true"># 240 = 1111 0000</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

c <span class="token operator">=</span> a <span class="token operator">>></span> <span class="token number">2</span>       <span class="token comment" spellcheck="true"># 15 = 0000 1111</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"6 - c 的值为："</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：</p>
<pre class="line-numbers language-bash"><code class="language-bash">1 - c 的值为： 12
2 - c 的值为： 61
3 - c 的值为： 49
4 - c 的值为： -61
5 - c 的值为： 240
6 - c 的值为： 15<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-18-逻辑运算符"><a href="#1-2-18-逻辑运算符" class="headerlink" title="1.2.18 逻辑运算符"></a>1.2.18 逻辑运算符</h4><p>Python语言支持逻辑运算符，以下假设变量 a 为 10, b为 20:</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">逻辑表达式</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">and</td>
<td align="left">x and y</td>
<td align="left">布尔”与” - 如果 x 为 False，x and y 返回 x 的值，否则返回 y 的计算值。</td>
<td align="left">(a and b) 返回 20。</td>
</tr>
<tr>
<td align="left">or</td>
<td align="left">x or y</td>
<td align="left">布尔”或” - 如果 x 是 True，它返回 x 的值，否则它返回 y 的计算值。</td>
<td align="left">(a or b) 返回 10。</td>
</tr>
<tr>
<td align="left">not</td>
<td align="left">not x</td>
<td align="left">布尔”非” - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。</td>
<td align="left">not(a and b) 返回 False</td>
</tr>
</tbody></table>
<p>示例：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">10</span>
b <span class="token operator">=</span> <span class="token number">20</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">and</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 和 b 都为 true"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 和 b 有一个不为 true"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">or</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 a 和 b 都为 true，或其中一个变量为 true"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 a 和 b 都不为 true"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改变量 a 的值</span>
a <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">and</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 和 b 都为 true"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 和 b 有一个不为 true"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">or</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - 变量 a 和 b 都为 true，或其中一个变量为 true"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - 变量 a 和 b 都不为 true"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token operator">not</span><span class="token punctuation">(</span> a <span class="token operator">and</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - 变量 a 和 b 都为 false，或其中一个变量为 false"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"5 - 变量 a 和 b 都为 true"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token number">1</span> <span class="token operator">-</span> 变量 a 和 b 都为 true
<span class="token number">2</span> <span class="token operator">-</span> 变量 a 和 b 都为 true，或其中一个变量为 true
<span class="token number">3</span> <span class="token operator">-</span> 变量 a 和 b 有一个不为 true
<span class="token number">4</span> <span class="token operator">-</span> 变量 a 和 b 都为 true，或其中一个变量为 true
<span class="token number">5</span> <span class="token operator">-</span> 变量 a 和 b 都为 false，或其中一个变量为 false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-19-成员运算符"><a href="#1-2-19-成员运算符" class="headerlink" title="1.2.19 成员运算符"></a>1.2.19 成员运算符</h4><p>除了以上的一些运算符之外，Python还支持成员运算符，测试实例中包含了一系列的成员，包括字符串，列表或元组。</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">in</td>
<td align="left">如果在指定的序列中找到值返回 True，否则返回 False。</td>
<td align="left">x 在 y 序列中 , 如果 x 在 y 序列中返回 True。</td>
</tr>
<tr>
<td align="left">not in</td>
<td align="left">如果在指定的序列中没有找到值返回 True，否则返回 False。</td>
<td align="left">x 不在 y 序列中 , 如果 x 不在 y 序列中返回 True。</td>
</tr>
</tbody></table>
<p>以下实例演示了Python所有成员运算符的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">10</span>
b <span class="token operator">=</span> <span class="token number">20</span>
list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">in</span> list <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 在给定的列表中 list 中"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - 变量 a 不在给定的列表中 list 中"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">not</span> <span class="token keyword">in</span> list <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 b 不在给定的列表中 list 中"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - 变量 b 在给定的列表中 list 中"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改变量 a 的值</span>
a <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">in</span> list <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 在给定的列表中 list 中"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - 变量 a 不在给定的列表中 list 中"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：</p>
<pre class="line-numbers language-bash"><code class="language-bash">1 - 变量 a 不在给定的列表中 list 中
2 - 变量 b 不在给定的列表中 list 中
3 - 变量 a 在给定的列表中 list 中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-20-身份运算符"><a href="#1-2-20-身份运算符" class="headerlink" title="1.2.20 身份运算符"></a>1.2.20 身份运算符</h4><p>身份运算符用于比较两个对象的存储单元</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">is</td>
<td align="left">is 是判断两个标识符是不是引用自一个对象</td>
<td align="left"><strong>x is y</strong>, 类似 <strong>id(x) == id(y)</strong> , 如果引用的是同一个对象则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">is not</td>
<td align="left">is not 是判断两个标识符是不是引用自不同对象</td>
<td align="left"><strong>x is not y</strong> ， 类似 **id(a) != id(b)**。如果引用的不是同一个对象则返回结果 True，否则返回 False。</td>
</tr>
</tbody></table>
<p><strong>注：</strong> <a target="_blank" href="https://www.runoob.com/python/python-func-id.html" rel="external nofollow noreferrer noopener">id()</a> 函数用于获取对象内存地址。</p>
<p>以下实例演示了Python所有身份运算符的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">20</span>
b <span class="token operator">=</span> <span class="token number">20</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">is</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"1 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> id<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"2 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改变量 b 的值</span>
b <span class="token operator">=</span> <span class="token number">30</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">is</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"3 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token keyword">is</span> <span class="token operator">not</span> b <span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 和 b 没有相同的标识"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"4 - a 和 b 有相同的标识"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：</p>
<pre class="line-numbers language-bash"><code class="language-bash">1 - a 和 b 有相同的标识
2 - a 和 b 有相同的标识
3 - a 和 b 没有相同的标识
4 - a 和 b 没有相同的标识<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>is 与 == 区别：</p>
<p>is 用于判断两个变量引用对象是否为同一个， == 用于判断引用变量的值是否相等。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span>a <span class="token operator">=</span> <span class="token punctuation">[</span>1, 2, 3<span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a
<span class="token operator">>></span><span class="token operator">></span> b is a 
True
<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">==</span> a
True
<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a<span class="token punctuation">[</span>:<span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> b is a
False
<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">==</span> a
True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-2-21-运算符优先级"><a href="#1-2-21-运算符优先级" class="headerlink" title="1.2.21 运算符优先级"></a>1.2.21 运算符优先级</h4><p>以下表格列出了从最高到最低优先级的所有运算符：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">**</td>
<td align="left">指数 (最高优先级)</td>
</tr>
<tr>
<td align="left">~ + -</td>
<td align="left">按位翻转, 一元加号和减号 (最后两个的方法名为 +@ 和 -@)</td>
</tr>
<tr>
<td align="left">* / % //</td>
<td align="left">乘，除，求余数和取整除</td>
</tr>
<tr>
<td align="left">+ -</td>
<td align="left">加法减法</td>
</tr>
<tr>
<td align="left">&gt;&gt; &lt;&lt;</td>
<td align="left">右移，左移运算符</td>
</tr>
<tr>
<td align="left">&amp;</td>
<td align="left">位 ‘AND’</td>
</tr>
<tr>
<td align="left">^ |</td>
<td align="left">位运算符</td>
</tr>
<tr>
<td align="left">&lt;= &lt; &gt; &gt;=</td>
<td align="left">比较运算符</td>
</tr>
<tr>
<td align="left">== !=</td>
<td align="left">等于运算符</td>
</tr>
<tr>
<td align="left">= %= /= //= -= += *= **=</td>
<td align="left">赋值运算符</td>
</tr>
<tr>
<td align="left">is is not</td>
<td align="left">身份运算符</td>
</tr>
<tr>
<td align="left">in not in</td>
<td align="left">成员运算符</td>
</tr>
<tr>
<td align="left">not and or</td>
<td align="left">逻辑运算符</td>
</tr>
</tbody></table>
<p>以下实例演示了Python所有运算符优先级的操作：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">20</span>
b <span class="token operator">=</span> <span class="token number">10</span>
c <span class="token operator">=</span> <span class="token number">15</span>
d <span class="token operator">=</span> <span class="token number">5</span>
e <span class="token operator">=</span> <span class="token number">0</span>

e <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> c <span class="token operator">/</span> d       <span class="token comment" spellcheck="true">#( 30 * 15 ) / 5</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"(a + b) * c / d 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> d     <span class="token comment" spellcheck="true"># (30 * 15 ) / 5</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"((a + b) * c) / d 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>c <span class="token operator">/</span> d<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># (30) * (15/5)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"(a + b) * (c / d) 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span>

e <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> d      <span class="token comment" spellcheck="true">#  20 + (150/5)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"a + (b * c) / d 运算结果为："</span><span class="token punctuation">,</span>  e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">(</span>a + b<span class="token punctuation">)</span> * c / d 运算结果为： 90.0
<span class="token punctuation">((</span>a + b<span class="token punctuation">)</span> * c<span class="token punctuation">)</span> / d 运算结果为： 90.0
<span class="token punctuation">(</span>a + b<span class="token punctuation">)</span> * <span class="token punctuation">(</span>c / d<span class="token punctuation">)</span> 运算结果为： 90.0
a + <span class="token punctuation">(</span>b * c<span class="token punctuation">)</span> / d 运算结果为： 50.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>and 拥有更高优先级:</p>
<pre class="line-numbers language-python"><code class="language-python">x <span class="token operator">=</span> <span class="token boolean">True</span>
y <span class="token operator">=</span> <span class="token boolean">False</span>
z <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token keyword">if</span> x <span class="token operator">or</span> y <span class="token operator">and</span> z<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上实例输出结果：yes</p>
<p><strong>注意：</strong>Pyhton3 已不支持 &lt;&gt; 运算符，可以使用 != 代替</p>
<h4 id="练习1：实现数学公式的计算"><a href="#练习1：实现数学公式的计算" class="headerlink" title="练习1：实现数学公式的计算"></a>练习1：实现数学公式的计算</h4><ol>
<li> 分别求5和2之间的和、差、积、商（带小数）、商（取整）、余数，并将结果打印出来</li>
<li> 求半径为2.5的圆的面积，将结果打印出来</li>
</ol>
<p>参考框架</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#定义变量用于保存数字5和2</span>
    <span class="token comment" spellcheck="true">#求得这两个变量的和、差、积、商、余数，并将结果打印</span>
    <span class="token comment" spellcheck="true">#定义半径的变量</span>
    <span class="token comment" spellcheck="true">#求圆的面积，将结果打印出来</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="练习2：学生管理系统1-0"><a href="#练习2：学生管理系统1-0" class="headerlink" title="练习2：学生管理系统1.0"></a>练习2：学生管理系统1.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，首先我们实现学生管理系统的1.0版本，主要功能有：

1.定义变量，保存三个学生的学号、姓名、年龄、身高
2.打印三个学生的信息
3.求三个学生年龄和身高的平均值,且年龄精确到整数，身高精确到小数点两位数
4.动态输入一个学生信息，使用变量保存，并打印</code></pre>
<p>​    </p>
<h3 id="1-3-Python控制语句"><a href="#1-3-Python控制语句" class="headerlink" title="1.3 Python控制语句"></a>1.3 Python控制语句</h3><h4 id="1-3-1-if语句"><a href="#1-3-1-if语句" class="headerlink" title="1.3.1 if语句"></a>1.3.1 if语句</h4><p><strong>简单if语法举例：</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>执行以上代码，会打印hello</p>
<p><strong>语法说明</strong></p>
<p><strong>if</strong>表示判断，而if后面冒号之前是判断的条件，如果为真则执行冒号后面的代码，否则不执行。</p>
<p><strong>if else语法举例：</strong></p>
<pre class="line-numbers language-python"><code class="language-python">var <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入1个数字: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> var<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件为真'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件为假'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上使用input输入一个int类型的整数赋值给var，当var不为0时执行if后面的语句，否则执行else后面的语句，把以上代码拷贝到python源代码文件中，查看执行结果。</p>
<p><strong>if elif else语法举例：</strong></p>
<pre class="line-numbers language-python"><code class="language-python">score <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入1个分数: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> score <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'你要上天吗'</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> score <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'你是不是考了个寂寞'</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> score <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'一个鸭蛋？就很棒~'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'你考了%d分'</span> <span class="token operator">%</span> score<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上使用input输入一个int类型的整数赋值给score，先执行if判断，分数如果大于100分，执行if后面的语句，否则再次进行下面的elif判断，如果满足则执行，否则继续elif判断，最后如果都不满足条件，会执行else中的代码。</p>
<p>试试拷贝以上的代码，放到源代码中执行，分析结果和你想象的是否一致。</p>
<p>*<em>练习：狗的年龄和对应人的年龄，公式为22+(age-2)<em>5，其中age为狗子的年龄</em></em></p>
<p>参考代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">age <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入你家狗子的年龄: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> age <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Are you kidding me!"</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> age <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"相当于 14 岁的人。"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span> age <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>
    human <span class="token operator">=</span> <span class="token number">22</span> <span class="token operator">+</span> <span class="token punctuation">(</span>age <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"相当于 % 岁的人。"</span><span class="token punctuation">,</span> human<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-3-2-while循环"><a href="#1-3-2-while循环" class="headerlink" title="1.3.2 while循环"></a>1.3.2 while循环</h4><p>语法规则</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">while</span> 判断条件：
    执行语句<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>简单示例，计算1到10的加和：</p>
<pre class="line-numbers language-python"><code class="language-python">n <span class="token operator">=</span> <span class="token number">100</span>
sum <span class="token operator">=</span> <span class="token number">0</span>
counter <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">while</span> counter <span class="token operator">&lt;=</span> n<span class="token punctuation">:</span>
    sum <span class="token operator">=</span> sum <span class="token operator">+</span> counter
    counter <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1 到 %d 之和为: %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>练习，输入一个数字，直到猜到它为止</strong></p>
<p>以下是参考代码</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 该实例演示了数字猜谜游戏</span>
number <span class="token operator">=</span> <span class="token number">7</span>
guess <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数字猜谜游戏!"</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> guess <span class="token operator">!=</span> number<span class="token punctuation">:</span>
    guess <span class="token operator">=</span> int<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"请输入你猜的数字："</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> guess <span class="token operator">==</span> number<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"恭喜，你猜对了！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">elif</span> guess <span class="token operator">&lt;</span> number<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"猜的数字小了..."</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> guess <span class="token operator">></span> number<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"猜的数字大了..."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-3-3-for循环"><a href="#1-3-3-for循环" class="headerlink" title="1.3.3 for循环"></a>1.3.3 for循环</h4><p>语法：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> <span class="token operator">&lt;</span>variable<span class="token operator">></span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>sequence<span class="token operator">></span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>statements<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>语法：遍历列表sequence，并把每一次遍历的值赋值给variable，并执行statements语句</p>
<p>举例：</p>
<pre class="line-numbers language-python"><code class="language-python">fourKing <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"马斯克"</span><span class="token punctuation">,</span> <span class="token string">"巴菲特"</span><span class="token punctuation">,</span> <span class="token string">"马云"</span><span class="token punctuation">,</span> <span class="token string">"我"</span><span class="token punctuation">]</span> 
<span class="token keyword">for</span> person <span class="token keyword">in</span> fourKing<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'四位的财富加起来已经超过了2万亿人民币'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="练习1：完成BMI指数"><a href="#练习1：完成BMI指数" class="headerlink" title="练习1：完成BMI指数"></a>练习1：完成BMI指数</h4><p>1、看看自己身体是否达标，并提示相关建议；</p>
<p>2、给定一组列表，完成对BMI的判断和建议提醒；</p>
<p>BMI指数：英文为Body Mass Index，简称BMI，是用体重千克数除以身高米数的平方得出的数字，以下是数据参考。</p>
<table>
<thead>
<tr>
<th>BMI 分类</th>
<th>WHO标准</th>
<th>亚洲标准</th>
<th>中国参考标准</th>
<th>相关疾病发病的危险性</th>
</tr>
</thead>
<tbody><tr>
<td>体重过低</td>
<td>BMI&lt;18.5</td>
<td>BMI&lt;18.5</td>
<td>BMI&lt;18.5</td>
<td>低（但其它疾病危险性增加）</td>
</tr>
<tr>
<td>正常范围</td>
<td>18.5≤BMI&lt;25</td>
<td>18.5≤BMI&lt;23</td>
<td>18.5≤BMI&lt;24</td>
<td>平均水平</td>
</tr>
<tr>
<td>超重</td>
<td>BMI≥25</td>
<td>BMI≥23</td>
<td>BMI≥24</td>
<td>增加</td>
</tr>
<tr>
<td>肥胖前期</td>
<td>25≤BMI&lt;30</td>
<td>23≤BMI&lt;25</td>
<td>24≤BMI&lt;28</td>
<td>增加</td>
</tr>
<tr>
<td>I度肥胖</td>
<td>30≤BMI&lt;35</td>
<td>25≤BMI&lt;30</td>
<td>28≤BMI&lt;30</td>
<td>中度增加</td>
</tr>
<tr>
<td>II度肥胖</td>
<td>35≤BMI&lt;40</td>
<td>30≤BMI&lt;40</td>
<td>30≤BMI&lt;40</td>
<td>严重增加</td>
</tr>
<tr>
<td>Ⅲ度肥胖</td>
<td>BMI≥40.0</td>
<td>BMI≥40.0</td>
<td>BMI≥40.0</td>
<td>非常严重增加</td>
</tr>
</tbody></table>
<p>亚洲人士体型对照表，上下10%均为正常。</p>
<p><strong>男子标准体重对照表（千克，厘米）</strong></p>
<table>
<thead>
<tr>
<th>年龄|身高</th>
<th>152</th>
<th>156</th>
<th>160</th>
<th>164</th>
<th>168</th>
<th>172</th>
<th>176</th>
<th>180</th>
<th>184</th>
<th>188</th>
</tr>
</thead>
<tbody><tr>
<td>19</td>
<td>51</td>
<td>53</td>
<td>54</td>
<td>55</td>
<td>57</td>
<td>60</td>
<td>62</td>
<td>65</td>
<td>69</td>
<td>72</td>
</tr>
<tr>
<td>21</td>
<td>51</td>
<td>53</td>
<td>54</td>
<td>55</td>
<td>57</td>
<td>60</td>
<td>62</td>
<td>65</td>
<td>69</td>
<td>72</td>
</tr>
<tr>
<td>23</td>
<td>52</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>58</td>
<td>60</td>
<td>63</td>
<td>66</td>
<td>70</td>
<td>73</td>
</tr>
<tr>
<td>25</td>
<td>52</td>
<td>54</td>
<td>55</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>67</td>
<td>70</td>
<td>74</td>
</tr>
<tr>
<td>27</td>
<td>52</td>
<td>54</td>
<td>55</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
</tr>
<tr>
<td>29</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
</tr>
<tr>
<td>31</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>65</td>
<td>68</td>
<td>72</td>
<td>75</td>
</tr>
<tr>
<td>33</td>
<td>54</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>63</td>
<td>65</td>
<td>68</td>
<td>72</td>
<td>75</td>
</tr>
<tr>
<td>35</td>
<td>54</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>66</td>
<td>69</td>
<td>72</td>
<td>76</td>
</tr>
<tr>
<td>37</td>
<td>55</td>
<td>56</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>66</td>
<td>69</td>
<td>73</td>
<td>76</td>
</tr>
<tr>
<td>39</td>
<td>55</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>61</td>
<td>64</td>
<td>66</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>41</td>
<td>55</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>43</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>45</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>47</td>
<td>56</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>65</td>
<td>67</td>
<td>71</td>
<td>75</td>
<td>78</td>
</tr>
<tr>
<td>49</td>
<td>56</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>65</td>
<td>68</td>
<td>71</td>
<td>75</td>
<td>78</td>
</tr>
<tr>
<td>51</td>
<td>57</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>65</td>
<td>68</td>
<td>71</td>
<td>75</td>
<td>78</td>
</tr>
<tr>
<td>53</td>
<td>57</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>65</td>
<td>68</td>
<td>71</td>
<td>75</td>
<td>78</td>
</tr>
<tr>
<td>55</td>
<td>56</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>65</td>
<td>68</td>
<td>71</td>
<td>75</td>
<td>78</td>
</tr>
<tr>
<td>57</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>60</td>
<td>62</td>
<td>65</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>59</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>61</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>63</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>65</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>67</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>69</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>64</td>
<td>67</td>
<td>70</td>
<td>74</td>
<td>77</td>
</tr>
<tr>
<td>年龄|身高cm</td>
<td>152</td>
<td>156</td>
<td>160</td>
<td>164</td>
<td>168</td>
<td>172</td>
<td>176</td>
<td>180</td>
<td>184</td>
<td>188</td>
</tr>
</tbody></table>
<p><strong>女子标准体重对照表 千克，厘米（参考）</strong></p>
<table>
<thead>
<tr>
<th>年龄|身高</th>
<th>152</th>
<th>156</th>
<th>160</th>
<th>162</th>
<th>164</th>
<th>166</th>
<th>168</th>
<th>170</th>
<th>172</th>
<th>176</th>
</tr>
</thead>
<tbody><tr>
<td>19</td>
<td>46</td>
<td>47</td>
<td>49</td>
<td>50</td>
<td>51</td>
<td>52</td>
<td>54</td>
<td>56</td>
<td>58</td>
<td>60</td>
</tr>
<tr>
<td>21</td>
<td>46</td>
<td>47</td>
<td>49</td>
<td>50</td>
<td>51</td>
<td>52</td>
<td>54</td>
<td>56</td>
<td>58</td>
<td>60</td>
</tr>
<tr>
<td>23</td>
<td>46</td>
<td>47</td>
<td>49</td>
<td>50</td>
<td>51</td>
<td>52</td>
<td>54</td>
<td>56</td>
<td>58</td>
<td>60</td>
</tr>
<tr>
<td>25</td>
<td>46</td>
<td>48</td>
<td>49</td>
<td>50</td>
<td>51</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>59</td>
<td>61</td>
</tr>
<tr>
<td>27</td>
<td>47</td>
<td>48</td>
<td>50</td>
<td>51</td>
<td>52</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>59</td>
<td>61</td>
</tr>
<tr>
<td>29</td>
<td>47</td>
<td>49</td>
<td>51</td>
<td>52</td>
<td>53</td>
<td>54</td>
<td>56</td>
<td>58</td>
<td>59</td>
<td>62</td>
</tr>
<tr>
<td>31</td>
<td>48</td>
<td>49</td>
<td>51</td>
<td>52</td>
<td>53</td>
<td>54</td>
<td>56</td>
<td>58</td>
<td>60</td>
<td>62</td>
</tr>
<tr>
<td>33</td>
<td>48</td>
<td>50</td>
<td>51</td>
<td>52</td>
<td>53</td>
<td>55</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>63</td>
</tr>
<tr>
<td>35</td>
<td>49</td>
<td>50</td>
<td>52</td>
<td>52</td>
<td>53</td>
<td>55</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>63</td>
</tr>
<tr>
<td>37</td>
<td>49</td>
<td>51</td>
<td>53</td>
<td>53</td>
<td>54</td>
<td>56</td>
<td>59</td>
<td>60</td>
<td>61</td>
<td>64</td>
</tr>
<tr>
<td>39</td>
<td>50</td>
<td>52</td>
<td>53</td>
<td>53</td>
<td>55</td>
<td>57</td>
<td>59</td>
<td>60</td>
<td>62</td>
<td>65</td>
</tr>
<tr>
<td>41</td>
<td>51</td>
<td>52</td>
<td>54</td>
<td>54</td>
<td>55</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>65</td>
</tr>
<tr>
<td>43</td>
<td>51</td>
<td>53</td>
<td>55</td>
<td>55</td>
<td>56</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>63</td>
<td>66</td>
</tr>
<tr>
<td>45</td>
<td>52</td>
<td>53</td>
<td>55</td>
<td>55</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>63</td>
<td>66</td>
</tr>
<tr>
<td>47</td>
<td>52</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>62</td>
<td>63</td>
<td>67</td>
</tr>
<tr>
<td>49</td>
<td>52</td>
<td>53</td>
<td>56</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>60</td>
<td>62</td>
<td>63</td>
<td>67</td>
</tr>
<tr>
<td>51</td>
<td>52</td>
<td>54</td>
<td>56</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>67</td>
</tr>
<tr>
<td>53</td>
<td>53</td>
<td>54</td>
<td>56</td>
<td>56</td>
<td>58</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>64</td>
<td>67</td>
</tr>
<tr>
<td>55</td>
<td>53</td>
<td>54</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>61</td>
<td>63</td>
<td>64</td>
<td>67</td>
</tr>
<tr>
<td>57</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>61</td>
<td>63</td>
<td>64</td>
<td>68</td>
</tr>
<tr>
<td>59</td>
<td>53</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>58</td>
<td>60</td>
<td>61</td>
<td>63</td>
<td>64</td>
<td>68</td>
</tr>
<tr>
<td>61</td>
<td>53</td>
<td>54</td>
<td>56</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>63</td>
<td>64</td>
<td>67</td>
</tr>
<tr>
<td>63</td>
<td>52</td>
<td>54</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>67</td>
</tr>
<tr>
<td>65</td>
<td>52</td>
<td>54</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>66</td>
</tr>
<tr>
<td>67</td>
<td>52</td>
<td>54</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>66</td>
</tr>
<tr>
<td>69</td>
<td>52</td>
<td>54</td>
<td>55</td>
<td>56</td>
<td>57</td>
<td>59</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>66</td>
</tr>
<tr>
<td>年龄|身高</td>
<td>152</td>
<td>156</td>
<td>160</td>
<td>162</td>
<td>164</td>
<td>166</td>
<td>168</td>
<td>170</td>
<td>172</td>
<td>176</td>
</tr>
</tbody></table>
<h4 id="练习2：学生管理系统2-0"><a href="#练习2：学生管理系统2-0" class="headerlink" title="练习2：学生管理系统2.0"></a>练习2：学生管理系统2.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在1.0的基础上，现在实现学生管理系统的2.0版本，主要功能有：
1.计算三名同学身高的最大值、最小值
2.动态输入N名学生的信息，并打印
3.已知班级有50个学生，学号从100依次增加，即100~149，现要求:
学号能被5整除的周一打扫卫生
能被4整除的周二打扫（不包括周一打扫的）
第一个能被5整除且能被3整除的学生为劳动委员
请分别打印出周一打扫、周二打扫、劳动委员的学生学号</code></pre>
<h3 id="1-4-Python数据类型"><a href="#1-4-Python数据类型" class="headerlink" title="1.4 Python数据类型"></a>1.4 Python数据类型</h3><h4 id="1-4-1-标准数据类型"><a href="#1-4-1-标准数据类型" class="headerlink" title="1.4.1 标准数据类型"></a>1.4.1 标准数据类型</h4><p>Python3 中有六个标准的数据类型：</p>
<ul>
<li>  Number（数字）</li>
<li>  String（字符串）</li>
<li>  List（列表）</li>
<li>  Tuple（元组）</li>
<li>  Set（集合）</li>
<li>  Dictionary（字典）</li>
</ul>
<p>Python3 的六个标准数据类型中：</p>
<ul>
<li><p><strong>不可变数据（3 个）：</strong>Number（数字）、String（字符串）、Tuple（元组）；</p>
</li>
<li><p><strong>可变数据（3 个）：</strong>List（列表）、Dictionary（字典）、Set（集合）。</p>
</li>
</ul>
<h4 id="1-4-2-Number（数字）"><a href="#1-4-2-Number（数字）" class="headerlink" title="1.4.2 Number（数字）"></a>1.4.2 Number（数字）</h4><p>Python3 支持 <strong>int、float、bool、complex（复数）</strong>。</p>
<p>在Python 3里，只有一种整数类型 int，表示为长整型，没有 python2 中的 Long。</p>
<p>像大多数语言一样，数值类型的赋值和计算都是很直观的。</p>
<p>内置的 type() 函数可以用来查询变量所指的对象类型。</p>
<h4 id="1-4-3-String（字符串）"><a href="#1-4-3-String（字符串）" class="headerlink" title="1.4.3 String（字符串）"></a>1.4.3 String（字符串）</h4><p>字符串的基本可以参考上一节的Python基础语法部分，以下是字符串的内建函数：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-capitalize.html" rel="external nofollow noreferrer noopener">capitalize()</a> 将字符串的第一个字符转换为大写</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-center.html" rel="external nofollow noreferrer noopener">center(width, fillchar)</a> 返回一个指定的宽度 width 居中的字符串，fillchar 为填充的字符，默认为空格。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-count.html" rel="external nofollow noreferrer noopener">count(str, beg= 0,end=len(string))</a> 返回 str 在 string 里面出现的次数，如果 beg 或者 end 指定则返回指定范围内 str 出现的次数</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-decode.html" rel="external nofollow noreferrer noopener">bytes.decode(encoding=”utf-8”, errors=”strict”)</a> Python3 中没有 decode 方法，但我们可以使用 bytes 对象的 decode() 方法来解码给定的 bytes 对象，这个 bytes 对象可以由 str.encode() 来编码返回。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-encode.html" rel="external nofollow noreferrer noopener">encode(encoding=’UTF-8’,errors=’strict’)</a> 以 encoding 指定的编码格式编码字符串，如果出错默认报一个ValueError 的异常，除非 errors 指定的是’ignore’或者’replace’</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-endswith.html" rel="external nofollow noreferrer noopener">endswith(suffix, beg=0, end=len(string))</a> 检查字符串是否以 obj 结束，如果beg 或者 end 指定则检查指定的范围内是否以 obj 结束，如果是，返回 True,否则返回 False.</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-expandtabs.html" rel="external nofollow noreferrer noopener">expandtabs(tabsize=8)</a> 把字符串 string 中的 tab 符号转为空格，tab 符号默认的空格数是 8 。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-find.html" rel="external nofollow noreferrer noopener">find(str, beg=0, end=len(string))</a> 检测 str 是否包含在字符串中，如果指定范围 beg 和 end ，则检查是否包含在指定范围内，如果包含返回开始的索引值，否则返回-1</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-index.html" rel="external nofollow noreferrer noopener">index(str, beg=0, end=len(string))</a> 跟find()方法一样，只不过如果str不在字符串中会报一个异常。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isalnum.html" rel="external nofollow noreferrer noopener">isalnum()</a> 如果字符串至少有一个字符并且所有字符都是字母或数字则返 回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isalpha.html" rel="external nofollow noreferrer noopener">isalpha()</a> 如果字符串至少有一个字符并且所有字符都是字母或中文字则返回 True, 否则返回 False</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isdigit.html" rel="external nofollow noreferrer noopener">isdigit()</a> 如果字符串只包含数字则返回 True 否则返回 False</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-islower.html" rel="external nofollow noreferrer noopener">islower()</a> 如果字符串中包含至少一个区分大小写的字符，并且所有这些(区分大小写的)字符都是小写，则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isnumeric.html" rel="external nofollow noreferrer noopener">isnumeric()</a> 如果字符串中只包含数字字符，则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isspace.html" rel="external nofollow noreferrer noopener">isspace()</a> 如果字符串中只包含空白，则返回 True，否则返回 False.</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-istitle.html" rel="external nofollow noreferrer noopener">istitle()</a> 如果字符串是标题化的(见 title())则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isupper.html" rel="external nofollow noreferrer noopener">isupper()</a> 如果字符串中包含至少一个区分大小写的字符，并且所有这些(区分大小写的)字符都是大写，则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-join.html" rel="external nofollow noreferrer noopener">join(seq)</a> 以指定字符串作为分隔符，将 seq 中所有的元素(的字符串表示)合并为一个新的字符串</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-len.html" rel="external nofollow noreferrer noopener">len(string)</a> 返回字符串长度</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left">[ljust(width<a target="_blank" href="https://www.runoob.com/python3/python3-string-ljust.html" rel="external nofollow noreferrer noopener">, fillchar])</a> 返回一个原字符串左对齐,并使用 fillchar 填充至长度 width 的新字符串，fillchar 默认为空格。</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-lower.html" rel="external nofollow noreferrer noopener">lower()</a> 转换字符串中所有大写字符为小写.</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-lstrip.html" rel="external nofollow noreferrer noopener">lstrip()</a> 截掉字符串左边的空格或指定字符。</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-maketrans.html" rel="external nofollow noreferrer noopener">maketrans()</a> 创建字符映射的转换表，对于接受两个参数的最简单的调用方式，第一个参数是字符串，表示需要转换的字符，第二个参数也是字符串表示转换的目标。</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-max.html" rel="external nofollow noreferrer noopener">max(str)</a> 返回字符串 str 中最大的字母。</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-min.html" rel="external nofollow noreferrer noopener">min(str)</a> 返回字符串 str 中最小的字母。</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left">[replace(old, new <a target="_blank" href="https://www.runoob.com/python3/python3-string-replace.html" rel="external nofollow noreferrer noopener">, max])</a> 把 将字符串中的 old 替换成 new,如果 max 指定，则替换不超过 max 次。</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-rfind.html" rel="external nofollow noreferrer noopener">rfind(str, beg=0,end=len(string))</a> 类似于 find()函数，不过是从右边开始查找.</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-rindex.html" rel="external nofollow noreferrer noopener">rindex( str, beg=0, end=len(string))</a> 类似于 index()，不过是从右边开始.</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left">[rjust(width,<a target="_blank" href="https://www.runoob.com/python3/python3-string-rjust.html" rel="external nofollow noreferrer noopener">, fillchar])</a> 返回一个原字符串右对齐,并使用fillchar(默认空格）填充至长度 width 的新字符串</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-rstrip.html" rel="external nofollow noreferrer noopener">rstrip()</a> 删除字符串字符串末尾的空格.</td>
</tr>
<tr>
<td align="left">31</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-split.html" rel="external nofollow noreferrer noopener">split(str=””, num=string.count(str))</a> 以 str 为分隔符截取字符串，如果 num 有指定值，则仅截取 num+1 个子字符串</td>
</tr>
<tr>
<td align="left">32</td>
<td align="left">[splitlines(<a target="_blank" href="https://www.runoob.com/python3/python3-string-splitlines.html" rel="external nofollow noreferrer noopener">keepends])</a> 按照行(‘\r’, ‘\r\n’, \n’)分隔，返回一个包含各行作为元素的列表，如果参数 keepends 为 False，不包含换行符，如果为 True，则保留换行符。</td>
</tr>
<tr>
<td align="left">33</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-startswith.html" rel="external nofollow noreferrer noopener">startswith(substr, beg=0,end=len(string))</a> 检查字符串是否是以指定子字符串 substr 开头，是则返回 True，否则返回 False。如果beg 和 end 指定值，则在指定范围内检查。</td>
</tr>
<tr>
<td align="left">34</td>
<td align="left">[strip(<a target="_blank" href="https://www.runoob.com/python3/python3-string-strip.html" rel="external nofollow noreferrer noopener">chars])</a> 在字符串上执行 lstrip()和 rstrip()</td>
</tr>
<tr>
<td align="left">35</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-swapcase.html" rel="external nofollow noreferrer noopener">swapcase()</a> 将字符串中大写转换为小写，小写转换为大写</td>
</tr>
<tr>
<td align="left">36</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-title.html" rel="external nofollow noreferrer noopener">title()</a> 返回”标题化”的字符串,就是说所有单词都是以大写开始，其余字母均为小写(见 istitle())</td>
</tr>
<tr>
<td align="left">37</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-translate.html" rel="external nofollow noreferrer noopener">translate(table, deletechars=””)</a> 根据 str 给出的表(包含 256 个字符)转换 string 的字符, 要过滤掉的字符放到 deletechars 参数中</td>
</tr>
<tr>
<td align="left">38</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-upper.html" rel="external nofollow noreferrer noopener">upper()</a> 转换字符串中的小写字母为大写</td>
</tr>
<tr>
<td align="left">39</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-zfill.html" rel="external nofollow noreferrer noopener">zfill (width)</a> 返回长度为 width 的字符串，原字符串右对齐，前面填充0</td>
</tr>
<tr>
<td align="left">40</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-string-isdecimal.html" rel="external nofollow noreferrer noopener">isdecimal()</a> 检查字符串是否只包含十进制字符，如果是返回 true，否则返回 false。</td>
</tr>
</tbody></table>
<h4 id="1-4-4-List（列表）"><a href="#1-4-4-List（列表）" class="headerlink" title="1.4.4 List（列表）"></a>1.4.4 List（列表）</h4><p>例子：</p>
<pre class="line-numbers language-python"><code class="language-python">list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">]</span>
list2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span>
list3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的值中括号开始，中括号结束，其中有多个元素，以逗号隔开，其中的数据可以是任意类型，</p>
<p>访问方式可以使用数据下标的方式，比如print(list3[1])打印的是list3中下标为1的数据green，试着打印一下list1中第二个数据Python</p>
<p>列表元素的增删改查</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>示例</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>append增加元素</td>
<td>lists = [‘Hello’, ‘Python’]<br/>lists.append(100)<br/>print(lists)</td>
<td>[‘Hello’, ‘Python’, 100]</td>
</tr>
<tr>
<td>del删除元素</td>
<td>lists = [‘Hello’, ‘Python’]<br/>del lists[1]<br/>print(lists)</td>
<td>[‘Hello’]</td>
</tr>
<tr>
<td>insert插入修改元素</td>
<td>lists = [‘Hello’, ‘Python’]<br/>del lists[1]<br/>print(lists)</td>
<td>[‘Hello’, 100, ‘Python’]</td>
</tr>
<tr>
<td>index查找元素</td>
<td>lists = [‘Hello’, ‘Python’]<br/>index = lists.index(‘Python’)<br/>print(index)</td>
<td>1</td>
</tr>
</tbody></table>
<p>列表常用函数</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">函数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-len.html" rel="external nofollow noreferrer noopener">len(list)</a> 列表元素个数</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-max.html" rel="external nofollow noreferrer noopener">max(list)</a> 返回列表元素最大值</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-min.html" rel="external nofollow noreferrer noopener">min(list)</a> 返回列表元素最小值</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-list.html" rel="external nofollow noreferrer noopener">list(seq)</a> 将元组转换为列表</td>
</tr>
</tbody></table>
<p>列表常用方法</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-append.html" rel="external nofollow noreferrer noopener">list.append(obj)</a> 在列表末尾添加新的对象</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-count.html" rel="external nofollow noreferrer noopener">list.count(obj)</a> 统计某个元素在列表中出现的次数</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-extend.html" rel="external nofollow noreferrer noopener">list.extend(seq)</a> 在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-index.html" rel="external nofollow noreferrer noopener">list.index(obj)</a> 从列表中找出某个值第一个匹配项的索引位置</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-insert.html" rel="external nofollow noreferrer noopener">list.insert(index, obj)</a> 将对象插入列表</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">[list.pop(<a target="_blank" href="https://www.runoob.com/python3/python3-att-list-pop.html" rel="external nofollow noreferrer noopener">index=-1])</a> 移除列表中的一个元素（默认最后一个元素），并且返回该元素的值</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-remove.html" rel="external nofollow noreferrer noopener">list.remove(obj)</a> 移除列表中某个值的第一个匹配项</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-reverse.html" rel="external nofollow noreferrer noopener">list.reverse()</a> 反向列表中元素</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-sort.html" rel="external nofollow noreferrer noopener">list.sort( key=None, reverse=False)</a> 对原列表进行排序</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-clear.html" rel="external nofollow noreferrer noopener">list.clear()</a> 清空列表</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/python3-att-list-copy.html" rel="external nofollow noreferrer noopener">list.copy()</a> 复制列表</td>
</tr>
</tbody></table>
<h4 id="1-4-5-Tuple（元组）"><a href="#1-4-5-Tuple（元组）" class="headerlink" title="1.4.5 Tuple（元组）"></a>1.4.5 Tuple（元组）</h4><p>Python 的元组与列表类似，不同之处在于元组的元素不能修改，并且元组使用小括号 ( )，列表使用方括号 [ ]。</p>
<p>把以上列表的[]改成()就被当作元组了</p>
<pre class="line-numbers language-python"><code class="language-python">list1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
list2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
list3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>元组中的数据不可改变，因此尝试下list1[2] = 1000，看看会不会有问题，再把list1改成列表试试。</p>
<h4 id="1-4-6-Set（集合）"><a href="#1-4-6-Set（集合）" class="headerlink" title="1.4.6 Set（集合）"></a>1.4.6 Set（集合）</h4><p>集合（set）是一个无序的不重复元素序列。</p>
<p>可以使用大括号 <strong>{ }</strong> 或者 <strong>set()</strong> 函数创建集合，注意：创建一个空集合使用 <strong>set()</strong> 而不是 <strong>{ }**， **{ }</strong> 用来创建一个空的字典。</p>
<pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">{</span><span class="token string">'h'</span>, <span class="token string">'l'</span>, <span class="token string">'o'</span>, <span class="token string">'e'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>需要注意的是，输出的结果每次并不相同，并且’l’字符只打印了一次。这也证明了set集合是一个无需不重复的元素序列。</p>
<p><strong>集合的运算</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'abracadabra'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'alacazam'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># 输出{'a', 'r', 'b', 'c', 'd'}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 集合a中包含而集合b中不包含的元素, 输出{'r', 'd', 'b'}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 集合a或b中包含的所有元素, {'a', 'c', 'r', 'd', 'b', 'm', 'z', 'l'}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 集合a和b中都包含了的元素, {'a', 'c'}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 不同时包含于a和b的元素, {'r', 'd', 'b', 'm', 'z', 'l'}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>集合的方法</strong></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-add.html" rel="external nofollow noreferrer noopener">add()</a></td>
<td align="left">为集合添加元素</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-clear.html" rel="external nofollow noreferrer noopener">clear()</a></td>
<td align="left">移除集合中的所有元素</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-copy.html" rel="external nofollow noreferrer noopener">copy()</a></td>
<td align="left">拷贝一个集合</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-difference.html" rel="external nofollow noreferrer noopener">difference()</a></td>
<td align="left">返回多个集合的差集</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-difference_update.html" rel="external nofollow noreferrer noopener">difference_update()</a></td>
<td align="left">移除集合中的元素，该元素在指定的集合也存在。</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-discard.html" rel="external nofollow noreferrer noopener">discard()</a></td>
<td align="left">删除集合中指定的元素</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-intersection.html" rel="external nofollow noreferrer noopener">intersection()</a></td>
<td align="left">返回集合的交集</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-intersection_update.html" rel="external nofollow noreferrer noopener">intersection_update()</a></td>
<td align="left">返回集合的交集。</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-isdisjoint.html" rel="external nofollow noreferrer noopener">isdisjoint()</a></td>
<td align="left">判断两个集合是否包含相同的元素，如果没有返回 True，否则返回 False。</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-issubset.html" rel="external nofollow noreferrer noopener">issubset()</a></td>
<td align="left">判断指定集合是否为该方法参数集合的子集。</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-issuperset.html" rel="external nofollow noreferrer noopener">issuperset()</a></td>
<td align="left">判断该方法的参数集合是否为指定集合的子集</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-pop.html" rel="external nofollow noreferrer noopener">pop()</a></td>
<td align="left">随机移除元素</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-remove.html" rel="external nofollow noreferrer noopener">remove()</a></td>
<td align="left">移除指定元素</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-symmetric_difference.html" rel="external nofollow noreferrer noopener">symmetric_difference()</a></td>
<td align="left">返回两个集合中不重复的元素集合。</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-symmetric_difference_update.html" rel="external nofollow noreferrer noopener">symmetric_difference_update()</a></td>
<td align="left">移除当前集合中在另外一个指定集合相同的元素，并将另外一个指定集合中不同的元素插入到当前集合中。</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-union.html" rel="external nofollow noreferrer noopener">union()</a></td>
<td align="left">返回两个集合的并集</td>
</tr>
<tr>
<td align="left"><a target="_blank" href="https://www.runoob.com/python3/ref-set-update.html" rel="external nofollow noreferrer noopener">update()</a></td>
<td align="left">给集合添加元素</td>
</tr>
</tbody></table>
<p><strong>使用举例</strong></p>
<p>add添加元素</p>
<pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'Language'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输出为{‘Language’, ‘Hello’, ‘Python’}</p>
<p>remove删除元素</p>
<pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'Python'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输出为{‘Hello’}</p>
<p>计算集合长度</p>
<pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>输出为2</p>
<p>判断元素是否在集合中</p>
<pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Python'</span> <span class="token keyword">in</span> s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>输出为True</p>
<h4 id="1-4-7-Dictionary（字典）"><a href="#1-4-7-Dictionary（字典）" class="headerlink" title="1.4.7 Dictionary（字典）"></a>1.4.7 Dictionary（字典）</h4><p>字典是key和value的成对数据类型，可以理解为每一个值value都有一个名字key，使用方法如下：</p>
<pre class="line-numbers language-python"><code class="language-python">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span> <span class="token punctuation">:</span> <span class="token string">'黄飞鸿'</span><span class="token punctuation">,</span> <span class="token string">'技能'</span> <span class="token punctuation">:</span> <span class="token string">'无影脚'</span><span class="token punctuation">,</span> <span class="token string">'武力值'</span> <span class="token punctuation">:</span> <span class="token number">99</span> <span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>d是一个字典，使用{}，其中的元素以逗号作为分割，逗号分隔的就是key:value键值对，key必须是<strong>不重复不可改变的类型</strong>，而值可以是Python支持的任意数据类型。</p>
<p>也可以使用关键的key访问，比如访问name,可以写为d[‘name’]，得到的结果是’黄飞鸿’，尝试使用这种方法打印其他的值。</p>
<p>Python字典包含了以下内置函数：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">函数及描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">len(dict) 计算字典元素个数，即键的总数。</td>
<td align="left"><code>&gt;&gt;&gt; dict = &#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Age&#39;: 7, &#39;Class&#39;: &#39;First&#39;&#125; &gt;&gt;&gt; len(dict) 3</code></td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">str(dict) 输出字典，以可打印的字符串表示。</td>
<td align="left"><code>&gt;&gt;&gt; dict = &#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Age&#39;: 7, &#39;Class&#39;: &#39;First&#39;&#125; &gt;&gt;&gt; str(dict) &quot;&#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Class&#39;: &#39;First&#39;, &#39;Age&#39;: 7&#125;&quot;</code></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">type(variable) 返回输入的变量类型，如果变量是字典就返回字典类型。</td>
<td align="left"><code>&gt;&gt;&gt; dict = &#123;&#39;Name&#39;: &#39;Runoob&#39;, &#39;Age&#39;: 7, &#39;Class&#39;: &#39;First&#39;&#125; &gt;&gt;&gt; type(dict) &lt;class &#39;dict&#39;&gt;</code></td>
</tr>
</tbody></table>
<p>Python字典包含了以下内置方法：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">函数及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">radiansdict.clear()删除字典内所有元素</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">radiansdict.copy()返回一个字典的浅复制</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">radiansdict.fromkeys()创建一个新字典，以序列seq中元素做字典的键，val为字典所有键对应的初始值</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">radiansdict.get(key, default=None) 返回指定键的值，如果键不在字典中返回 default 设置的默认值</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">key in dict 如果键在字典dict里返回true，否则返回false</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">radiansdict.items() 以列表返回可遍历的(键, 值) 元组数组</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">radiansdict.keys() 返回一个迭代器，可以使用 list() 来转换为列表</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">radiansdict.setdefault(key, default=None) 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">radiansdict.update(dict2) 把字典dict2的键/值对更新到dict里</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">radiansdict.values() 返回一个迭代器，可以使用 list() 来转换为列表</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">[pop(key[,default]) 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">popitem() 随机返回并删除字典中的最后一对键和值。</td>
</tr>
</tbody></table>
<h4 id="练习：学生管理系统3-0"><a href="#练习：学生管理系统3-0" class="headerlink" title="练习：学生管理系统3.0"></a>练习：学生管理系统3.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在2.0的基础上，现在实现学生管理系统的3.0版本，主要功能有：

1.以列表的形式存储三位同学的信息，并打印
2.对同学“tom”进行增删改查操作
3.将所有同学信息存储与列表中,并打印所有学生信息
4.新增一个同学到学生列表中
5.修改学生列表中的数据
6.从学生列表中删除某个同学信息
7.根据条件查找所有符合条件的同学信息
8.改用字典保存一个同学的信息，将所有同学的信息保存于列表中,并打印</code></pre>
<h3 id="1-5-Python模块化设计"><a href="#1-5-Python模块化设计" class="headerlink" title="1.5 Python模块化设计"></a>1.5 Python模块化设计</h3><h4 id="1-5-1-函数"><a href="#1-5-1-函数" class="headerlink" title="1.5.1 函数"></a>1.5.1 函数</h4><p>函数可看作一个工具，你告诉它要干什么，它会听话的帮你把事情办好，得到你要的结果。</p>
<p>你告诉它可以表示成<strong>输入</strong>，把事情办好是<strong>功能模块</strong>，得到结果表示为<strong>输出</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210315222343.jpg" alt="img"></p>
<p>例如，我们希望有这么一个工具，告诉它两个数，希望得到他们的乘积，那么使用python可以这么写：</p>
<pre class="line-numbers language-python"><code class="language-python">result <span class="token operator">=</span> multip<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>result = multip(10, 20)表示<strong>输入</strong>10, 20两个数给multip这个<strong>功能模块</strong>，然后功能模块的输出结果赋值给result。在开发语言中这个过程叫做<strong>函数的调用</strong>。</p>
<p>函数的调用即是指通过传递给函数输入参数，比如以上传递的输入参数是10和20，完成函数代码执行的过程。</p>
<p>由于我们希望提供的两个输入完成的是<strong>乘积的功能</strong>，因此函数multip的功能模块代码可以如下定义：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">multip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>以上是一个函数的功能模块的定义语法，def为关键字，multip为函数的名字，()中表示传递进来的输入参数，冒号后面的是函数要执行的代码，a*b表示对两个输入参数做了乘积，return表示返回乘积的结果。</p>
<p>完整的代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 定义函数</span>
<span class="token keyword">def</span> <span class="token function">multip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b

<span class="token comment" spellcheck="true"># 调用函数并输出结果</span>
result <span class="token operator">=</span> multip<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>代码会从<code>result = multip(10, 20)</code>这一行开始执行，然后通过multip(10, 20)这个函数调用，执行到第一行和第二行的代码，最后通过return把结果返回给result，并通过print(result)打印出最终的结果。</p>
<p>通过multip这个函数，我们可以提供任意的两个数值给它，让它帮我们完成两个数的乘积。</p>
<p>使用函数和习惯函数方式的编程是一个好的开始，因为我们并不希望为了做一些事情，还要把事情所依赖的基础也重新做一遍，而函数的好处在于同类的事情只要实现一次即可，下次再遇到同类的问题，就可以通过调用函数来解决，这就好比现实中的工具一样，给我们带来了编程的方便。</p>
<h4 id="1-5-2-函数默认参数"><a href="#1-5-2-函数默认参数" class="headerlink" title="1.5.2 函数默认参数"></a>1.5.2 函数默认参数</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">printInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"你好%s,年龄为：%d岁"</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    printInfo<span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>
    printInfo<span class="token punctuation">(</span><span class="token string">"terry"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到printInfo需要两个参数，但第二个参数age有一个默认的赋值为30，这个表示当函数调用没有提供第二个参数的时候，age的值默认为0，如printInfo(“terry”)，打印的结果为你好terry,年龄为：<strong>30</strong>岁</p>
<h4 id="1-5-3-函数不定参数"><a href="#1-5-3-函数不定参数" class="headerlink" title="1.5.3 函数不定参数"></a>1.5.3 函数不定参数</h4><p>有这么一种情况，输入的参数可能不是固定的，比如说计算一天内花了多少笔钱，3顿饭，水果，饮料，打车等等，每天都不一样，怎么定义这样一个函数呢？</p>
<p>我们假设</p>
<p>第一天早饭10块钱，午饭20块钱，晚饭10块钱，苹果3块钱，纸巾3块钱；</p>
<p>第二天早饭8块钱，午饭12块钱，晚饭8块钱，香蕉2块钱，打车20块钱，饮料10块钱；</p>
<p>那么第一天是5个参数，第二天则多了一个是6个参数，使用函数的代码实现如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 不定参数的函数定义，在参数前面的*表示输入的参数都存放在money中</span>
<span class="token keyword">def</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token operator">*</span>money<span class="token punctuation">)</span><span class="token punctuation">:</span>
    all <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> one <span class="token keyword">in</span> money<span class="token punctuation">:</span>
        all<span class="token operator">+=</span>one
    <span class="token keyword">return</span> all

day1Spend <span class="token operator">=</span> cost<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 5个参数</span>
day2Spend <span class="token operator">=</span> cost<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 6个参数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第一天花费了%d'</span> <span class="token operator">%</span> day1Spend<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第二天花费了%d'</span> <span class="token operator">%</span> day2Spend<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="练习：学生管理系统4-0"><a href="#练习：学生管理系统4-0" class="headerlink" title="练习：学生管理系统4.0"></a>练习：学生管理系统4.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在3.0的基础上，现在实现学生管理系统的4.0版本，主要功能有：

实现学生管理系统的增删改查功能，每个功能使用函数封装
(1)显示所有学生信息
(2)新增一个学生信息
(3)修改学生的年龄
(4)根据学号删除学生
(5)按照姓名查找
(6)按照学号进行升序和降序排列
(7)功能菜单：该功能菜单供用户选择相应功能，调用上述不同功能模块
(8)数据从文件中读取（选做）
(9)将数据保存到文件中（选做）</code></pre>
<h4 id="1-5-4-类"><a href="#1-5-4-类" class="headerlink" title="1.5.4 类"></a>1.5.4 类</h4><p>之前学习的函数只负责某个功能模块，而人类的习惯中总是以类别来区分。比如说看到一个人，可能只看一眼，就能大概描绘出这个人的身高、体型、穿着打扮、年龄性别等信息。</p>
<p>函数是为了完成某个功能而设计，而为了完成这些同类信息的整体描述，在计算机中定义了类这个概念，以下是这个类定义大概的样子：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
        self<span class="token punctuation">.</span>sex <span class="token operator">=</span> sex
    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 定义info函数，类中的函数称为方法</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这个人大概是%s,年龄差不多%d"</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中class是类的修饰符，Person是类的名字，在类中有一个构造函数<code>__init__</code>，info是这个类中定义的函数，一般在类中叫做类的方法。</p>
<p>构造函数<code>__init__</code>是干嘛的呢，我们要先想下这个类Person能干嘛呢，Person看名字就是为了定义人的，只不过每一个人都不一样，因此可以借助这个Person模板，传递不同的参数来达到对不同人描述的效果。</p>
<p>那怎么描述不同的人呢，通过上一节的学习我们知道可以通过传递参数来获取不同的参数，类也是这样，通过定义这么一个特殊的函数<code>__init__</code>，并允许用户传递自己的参数，从而实现不同信息人的描述的。</p>
<p>比如上面的代码中<code>__init__</code>可以传递age和sex，表示不同人的年龄和性别。</p>
<p>那<code>self</code>又是干嘛的呢？self代表自己，我们已经直到Person只是个模板，当描述不同人的时候，每一个人都会有一个age和sex，那么这个self就指代的是他自己的age和sex变量了。</p>
<p>其中info表示类Person中的方法，可以通过这种方式完善Person这个功能模板。</p>
<h4 id="1-5-5-对象"><a href="#1-5-5-对象" class="headerlink" title="1.5.5 对象"></a>1.5.5 对象</h4><p>对象是对类的实例化。Person只是个模板，为了描述不同的人，就需要把模板实例化为对象，从而对不同的人进行描述。怎么实例化呢？如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
        self<span class="token punctuation">.</span>sex <span class="token operator">=</span> sex
        self<span class="token punctuation">.</span>status <span class="token operator">=</span> status
    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 定义info函数，类中的函数称为方法</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这个人大概是%s, 年龄差不多%d, 目前%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">,</span> self<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token string">'已婚'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 实例化</span>
    xiaohong <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">,</span> <span class="token string">'单身'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 实例化</span>
    zhangsan<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment" spellcheck="true"># 调用方法</span>
    xiaohong<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment" spellcheck="true"># 调用方法</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>10行和11行实例化了两个Person对象，分别叫zhangsan和xiaohong，并传递了三个参数，这个调用过程默认调用了参数匹配的<code>__init__</code>构造函数，这样这两个对象都拥有了自己的age,sex和status。</p>
<p>12行和13行分别通过对象名称调用其中的方法info，打印除了属于自己的age、sex、status属性。</p>
<h4 id="1-5-6-对象的私有属性和私有方法"><a href="#1-5-6-对象的私有属性和私有方法" class="headerlink" title="1.5.6 对象的私有属性和私有方法"></a>1.5.6 对象的私有属性和私有方法</h4><p>以上的zhangsan是一个对象，我们可以通过访问其中的属性sex来改变他zhangsan的性别，如：</p>
<pre class="line-numbers language-python"><code class="language-python">zhangsan<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'女'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这样，zhangsan的性别就被随意更改了，有时候并不希望数据被意外更改，</p>
<p>因此<strong>Python规定属性和方法前面增加两个下划线，以防止被意外更改，从而变成了私有的属性和方法</strong>。</p>
<p>那怎么访问呢？不能通过zhangsan后面加点的方式访问了，私有的也只能通过共有的方法访问了，保证了数据安全。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>
        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>
        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>
    <span class="token keyword">def</span> <span class="token function">__info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                   <span class="token comment" spellcheck="true"># __info为私有方法，不可以通过对象直接访问</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是一个私有的方法'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问方法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>
        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>
        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>
    <span class="token keyword">def</span> <span class="token function">__info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                   <span class="token comment" spellcheck="true"># __info为私有方法，不可以通过对象直接访问</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是一个私有的方法'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 实例化</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>_Person__age<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 访问对象的私有属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>_Person__info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 访问对象的私有方法</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-5-7-类的静态属性"><a href="#1-5-7-类的静态属性" class="headerlink" title="1.5.7 类的静态属性"></a>1.5.7 类的静态属性</h4><p>类的静态属性是在<code>__init__</code>构造函数之外定义的，如以下参考代码第二行total静态属性的定义。</p>
<p>静态属性访问规则：</p>
<ul>
<li>使用对象只读访问；</li>
<li>使用类名读写访问；</li>
<li>所有类的对象共享同一个静态属性；</li>
</ul>
<p>参考代码</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>
        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>
        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 实例化</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>total<span class="token punctuation">)</span>               <span class="token comment" spellcheck="true"># 对象可以访问类的静态变量total</span>
    zhangsan<span class="token punctuation">.</span>total <span class="token operator">=</span> <span class="token number">1</span>                  <span class="token comment" spellcheck="true"># 对象不可以修改类的静态变量total</span>
    Person<span class="token punctuation">.</span>total <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>total<span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true"># 类可以修改类的静态变量total</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>total<span class="token punctuation">)</span>               <span class="token comment" spellcheck="true"># 对象访问到修改后的静态变量，说明访问的是同一个total，是共享的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第9行输出0，第10行是有错误的，说明对象访问静态属性是只读的；</p>
<p>第11行通过类名对静态属性做了修改，第12行输出了修改后的值，说明类访问静态属性total是读写的权限；</p>
<p>第13行通过对象访问total是1，说明对象可以看到类修改后的静态属性total，使用的是同一个total，说明静态属性是共享的；</p>
<h4 id="1-5-8-类的静态方法"><a href="#1-5-8-类的静态方法" class="headerlink" title="1.5.8 类的静态方法"></a>1.5.8 类的静态方法</h4><p>通过对静态属性的了解，不难发现静态属性是属于类的，所有对象也都可以使用，只不过是只读的，这也是针对某些特殊需求是有帮助的。</p>
<p>那么<strong>类的静态方法</strong>又是个啥呢？没错和静态属性类似，也可以认为是属于类的，所有对象都可以调用，只不过静态方法既然属于类，就只能访问静态属性，而不能访问对象的私有属性了。</p>
<p>使用方法：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true">#__init__为类的构造函数</span>
        self<span class="token punctuation">.</span>__age <span class="token operator">=</span> age                <span class="token comment" spellcheck="true"># __age为私有属性，不可以通过对象直接访问修改</span>
        self<span class="token punctuation">.</span>__sex <span class="token operator">=</span> sex                <span class="token comment" spellcheck="true"># __sex为私有属性，不可以通过对象直接访问修改</span>
    @staticmethod                       <span class="token comment" spellcheck="true"># 静态方法的申明</span>
    <span class="token keyword">def</span> <span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Person<span class="token punctuation">.</span>total

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    zhangsan <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 实例化</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>getTotal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true"># 对象静态方法的访问</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>getTotal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 类静态方法的访问</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上通过第6行把getTotal定义成了一个类的静态方法，这个静态方法返回一个静态属性total；</p>
<p>12行是通过对象访问静态方法的例子；</p>
<p>13行是通过类访问静态方法的例子；</p>
<h4 id="1-5-9-类的构造函数和析构函数"><a href="#1-5-9-类的构造函数和析构函数" class="headerlink" title="1.5.9 类的构造函数和析构函数"></a>1.5.9 类的构造函数和析构函数</h4><p>构造函数：<code>__init__()</code>是用于初始对象的，为对象的属性设置默认值；</p>
<p>析构函数：<code>__del__()</code>是释放对象占用的资源的，Python默认会有析构函数，程序中也可以主动提供；</p>
<p>语法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment" spellcheck="true">#构造函数，建立对象时自动调用</span>
    self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
    self<span class="token punctuation">.</span>sex <span class="token operator">=</span> sex       
<span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>              <span class="token comment" spellcheck="true">#析构函数，释放对象时自动调用</span>
    self<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">""</span>
    self<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-5-10-继承"><a href="#1-5-10-继承" class="headerlink" title="1.5.10 继承"></a>1.5.10 继承</h4><p>继承的意思是我写了一个新的<strong>类B</strong>，发现和之前的一个<strong>类A</strong>很像，并发现<strong>类A</strong>可以是<strong>类B</strong>的一部分，那就可以省点心，编写类B时，和类A一样的部分直接继承类A的，不用再写了。</p>
<p>语法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>statement<span class="token number">-1</span><span class="token operator">></span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token operator">&lt;</span>statement<span class="token operator">-</span>N<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Person类定义</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'my age: %d'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Student子类继承父类Person</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>grade<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade
        <span class="token comment" spellcheck="true">#调用父类的构函</span>
        Person<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    stu <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    stu<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上定义了一个<strong>父类Person</strong>，<strong>子类Student</strong>继承了Person类；</p>
<p>18行调用时可以直接调用父类中的方法，并输出父类的属性age。</p>
<h4 id="1-5-11-类的方法重写"><a href="#1-5-11-类的方法重写" class="headerlink" title="1.5.11 类的方法重写"></a>1.5.11 类的方法重写</h4><p>我们发现上一个案例中，在子类中定义了一个grade，但是父类是肯定不知道的，那怎么在调用info方法不变的情况下，也输出grade属性呢？可以重写父类的info方法，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Person类定义</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'my age: %d'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Student子类继承基类Person</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">,</span>grade<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade
        <span class="token comment" spellcheck="true">#调用父类的构函</span>
        Person<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>age<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade
    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'我今年%d, 上%d年级了'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>age<span class="token punctuation">,</span> self<span class="token punctuation">.</span>grade<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    stu <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    stu<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上代码在Student中重新实现了父类的info方法，这样<code>stu.info()</code>代码调用的时候，执行的就是子类的info了。</p>
<h4 id="1-5-12-类的多重继承"><a href="#1-5-12-类的多重继承" class="headerlink" title="1.5.12 类的多重继承"></a>1.5.12 类的多重继承</h4><p>多重继承就是可以继承多个的意思，这又可以省写好多代码了😄。</p>
<p>语法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A1<span class="token punctuation">,</span> A2<span class="token punctuation">,</span> A3<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>statement<span class="token number">-1</span><span class="token operator">></span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token operator">&lt;</span>statement<span class="token operator">-</span>N<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>示例代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Person类定义</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name
    @property
    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_name

<span class="token comment" spellcheck="true"># Interest兴趣类定义</span>
<span class="token keyword">class</span> <span class="token class-name">Interest</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_hobby <span class="token operator">=</span> hobby
    @property
    <span class="token keyword">def</span> <span class="token function">hobby</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hobby

<span class="token comment" spellcheck="true"># Student子类继承基类Person</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> Interest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#调用父类的构函</span>
        Person<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
        Interest<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s喜欢%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>stu<span class="token punctuation">.</span>name<span class="token punctuation">,</span> stu<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    stu <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token string">'踢足球'</span><span class="token punctuation">)</span>
    stu<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上输出的结果是：<strong>张三喜欢踢足球</strong></p>
<p><strong>代码解释：</strong>以上代码定义了两个父类，一个是Person，一个是Interest，并分别使用@property设置了两个属性name和hobby，Student继承这两个父类；</p>
<p>通过27代码构造子类Student后，28行调用<code>info()</code>方法获得了父类的name和hobby属性，并输出结果；</p>
<h4 id="1-5-13-python中property和setter装饰器用法"><a href="#1-5-13-python中property和setter装饰器用法" class="headerlink" title="1.5.13 python中property和setter装饰器用法"></a>1.5.13 python中property和setter装饰器用法</h4><p><strong>作用：</strong>调用方法改为调用对象， 比如 ： p.set_name() 改为 p.set_name</p>
<p><strong>区别：</strong>前者改变get方法，后者改变set方法</p>
<p>效果图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418110553.jpeg" alt="img"></p>
<p>代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name

  <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>_name

  <span class="token keyword">def</span> <span class="token function">set_name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name

p <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'小黑'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>set_name<span class="token punctuation">(</span><span class="token string">'小灰'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>标准写法：</strong></p>
<p>效果图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418110633.jpeg" alt="img"></p>
<p>代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># property装饰器</span>
<span class="token comment" spellcheck="true"># 作用： 将一个get方法转换为对象的属性。 就是 调用方法改为调用对象</span>
<span class="token comment" spellcheck="true"># 使用条件： 必须和属性名一样</span>

<span class="token comment" spellcheck="true"># setter方法的装饰器：</span>
<span class="token comment" spellcheck="true"># 作用：将一个set方法转换为对象的属性。 就是 a调用方法改为调用对象</span>
<span class="token comment" spellcheck="true"># 使用方法：@属性名.setter</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name

  <span class="token comment" spellcheck="true"># 利用property装饰器将获取name方法转换为获取对象的属性</span>
  @property
  <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>_name

  <span class="token comment" spellcheck="true"># 利用property装饰器将设置name方法转换为获取对象的属性</span>
  @name<span class="token punctuation">.</span>setter
  <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>_name <span class="token operator">=</span> name


p <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'小黑'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 原获取 p.name() , 现 p.name</span>
p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'小灰'</span> <span class="token comment" spellcheck="true"># 原设置 p.name('小灰') ,现 p.name = '小灰'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="练习：学生管理系统5-0"><a href="#练习：学生管理系统5-0" class="headerlink" title="练习：学生管理系统5.0"></a>练习：学生管理系统5.0</h4><pre><code>学生管理系统是一款用于班级管理的软件，其最终功能有：学生信息录入、学生信息修改、学生信息查找、学生信息删除、排序、统计、保存到文件等。随着学习的逐步深入，我们将这套系统分为5个版本来实现，在4.0的基础上，现在实现学生管理系统的5.0版本，主要功能有：

1.学生类：存储学生个人信息
2.管理类：对学生的各种管理
 (1)显示所有学生信息
 (2)新增一个学生信息
 (3)修改学生的年龄
 (4)根据学号删除学生
 (5)按照姓名查找
 (6)按照学号进行升序和降序排列
 (7)功能菜单：该功能菜单供用户选择相应功能，调用上述不同功能模块
 (8)数据从文件中读取
 (9)将数据保存到文件中
</code></pre>
<h2 id="二、1天学会爬虫基本原理"><a href="#二、1天学会爬虫基本原理" class="headerlink" title="二、1天学会爬虫基本原理"></a>二、1天学会爬虫基本原理</h2><h3 id="2-1-网络爬虫概念"><a href="#2-1-网络爬虫概念" class="headerlink" title="2.1 网络爬虫概念"></a>2.1 网络爬虫概念</h3><p>网络爬虫的英文为Web Spider，又称作网络蜘蛛或网络机器人。如果把互联网比喻成一张大的蜘蛛网，数据便是存放于蜘蛛网的各个节点。爬虫就是网中爬行的蜘蛛，沿着网络抓取自己的猎物（数据）。</p>
<p>网络爬虫，简单来说，就是一种按照一定规则，自动地抓取互联网中信息的程序或脚本。</p>
<p>我们常用的搜索网站，可以看成就是通过网络爬虫爬取互联网中符合要求的信息，显示给用户的。</p>
<h3 id="2-2-HTTP基本原理"><a href="#2-2-HTTP基本原理" class="headerlink" title="2.2 HTTP基本原理"></a>2.2 HTTP基本原理</h3><p>在本节中，我们会详细了解HTTP的基本原理，了解在浏览器中敲入URL到获取网页内容之间发生了什么。了解了这些内容，有助于我们进一步了解爬虫的基本原理。</p>
<p>我们把在浏览器的地址栏里输入的网址叫做URL。URL全称<strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator，即<a target="_blank" href="https://baike.baidu.com/item/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6" rel="external nofollow noreferrer noopener">统一资源定位符</a>。URL用于确定分散在互联网中各种资源的位置和访问方式。例如，摄图网中故宫博物馆的图片地址为：<a target="_blank" href="http://seopic.699pic.com/photo/50088/2824.jpg_wh1200.jpg%E3%80%82%E5%AE%83%E5%8C%85%E5%90%AB%E4%BA%86%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%A7%8D%E4%BF%A1%E6%81%AF%E3%80%82" rel="external nofollow noreferrer noopener">http://seopic.699pic.com/photo/50088/2824.jpg_wh1200.jpg。它包含了以下几种信息。</a></p>
<p>访问协议：  http，用于确定数据传输的方式。</p>
<p>服务器名称：seopic.699pic.com，图片所在的网站地址。</p>
<p>访问路径：  photo/50088，图片目录。</p>
<p>资源名：   2824.jpg_wh1200.jpg，图片名称。</p>
<h3 id="2-3-网页基础"><a href="#2-3-网页基础" class="headerlink" title="2.3 网页基础"></a>2.3 网页基础</h3><p>我们访问的网页多种多样，展现形式各不相同，对于网络爬虫来说，弄清楚网页所展示的技术是十分重要的，因为我们所需要的数据就散落在网页当中，只有了解了网页的基本组成、结构和节点等内容，才能分析网页、解析网页，从中获取我们想要的数据。</p>
<h4 id="2-3-1-网页的组成基础"><a href="#2-3-1-网页的组成基础" class="headerlink" title="2.3.1 网页的组成基础"></a>2.3.1 网页的组成基础</h4><p>网页可以分为三大部分——HTML、CSS和JavaScript。如果把网页比作一个人的话，HTML相当于骨架，JavaScript相当于肌肉，CSS相当于皮肤，三者结合起来才能形成一个完善的网页。下面我们分别来介绍一下这三部分的功能。 </p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406112916.jpeg" alt="img"></p>
<h4 id="2-3-2-网页的组成HTML"><a href="#2-3-2-网页的组成HTML" class="headerlink" title="2.3.2 网页的组成HTML"></a>2.3.2 网页的组成HTML</h4><p><strong>HTML</strong>是用来描述网页的一种语言，全称叫做Hyper Text Markup Language，即超文本标记性语言。网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是HTML。不同类型的内容通过不同类型的标签来表示，如图片用img标签表示，视频用video标签表示，段落用p标签表示，它们之间的布局又常通过布局标签div嵌套组合而成，各种标签通过不同的排列和嵌套才形成了网页的框架。</p>
<p>在Chrome浏览器中打开百度，按F12键，打开开发者工具，按照下图所示的顺序执行，在Response选项中就可以查看百度HTML代码了。 </p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210318100540.jpeg" alt="Chrome浏览器网页HTML信息查询"></p>
<p>这就是HTML，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。</p>
<p>HTML定义了网页的结构，但是只有HTML页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里借助了CSS。</p>
<p>一个HTML的例子</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>这是一个标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>这是一个段落。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>网页效果</p>
<pre><code>  ![image-20210406114004103](https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210416090036.png)</code></pre>
<h4 id="2-3-3-网页的组成CSS"><a href="#2-3-3-网页的组成CSS" class="headerlink" title="2.3.3 网页的组成CSS"></a>2.3.3 网页的组成CSS</h4><p>CSS，全称叫做Cascading Style Sheets，即层叠样式表。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等格式。</p>
<p>CSS是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。</p>
<p>在Chrome浏览器中打开百度，按F12键，打开开发者工具，按照下图所示的顺序执行，在Preview选项中就可以查看百度需要用到的CSS代码了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210318100559.jpeg" alt="Chrome浏览器查看CSS代码"></p>
<p>基于HTML增加CSS的例子</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
<span class="token selector">body </span><span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">h1 </span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>这是一个标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>这是一个段落。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>增加上CSS的网页效果</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406114130.png" alt="image-20210406114129925"></p>
<h4 id="2-3-4-网页的组成JavaScript"><a href="#2-3-4-网页的组成JavaScript" class="headerlink" title="2.3.4 网页的组成JavaScript"></a>2.3.4 网页的组成JavaScript</h4><p><strong>JavaScript</strong>，简称JS，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是JavaScript的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种实时、动态、交互的页面功能。</p>
<p>在Chrome浏览器中打开百度，按F12键，打开开发者工具，按照下图所示的顺序执行，在Preview选项中就可以查看百度需要用到的JavaScript代码了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps4.jpg" alt="img"></p>
<p>基于HTML和CSS的Javascript网页代码</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>这是一个Javascript示例<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
<span class="token selector">body </span><span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">h1 </span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">function</span> <span class="token function">displayDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token operator">=</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>这是一个标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这是一个段落。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>displayDate()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>显示日期<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>网页显示</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406114632.png" alt="image-20210406114632789"></p>
<p>点击后显示</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210406114645.png" alt="image-20210406114645589"></p>
<p><strong>HTML基础教程参考：</strong></p>
<p><a target="_blank" href="https://www.runoob.com/html/html-tutorial.html" rel="external nofollow noreferrer noopener">https://www.runoob.com/html/html-tutorial.html</a></p>
<p><a target="_blank" href="https://www.w3school.com.cn/html5/index.asp" rel="external nofollow noreferrer noopener">https://www.w3school.com.cn/html5/index.asp</a></p>
<p><strong>CSS基础教程参考：</strong></p>
<p><a target="_blank" href="https://www.runoob.com/css/css-tutorial.html" rel="external nofollow noreferrer noopener">https://www.runoob.com/css/css-tutorial.html</a></p>
<p><a target="_blank" href="https://www.w3school.com.cn/css/index.asp" rel="external nofollow noreferrer noopener">https://www.w3school.com.cn/css/index.asp</a></p>
<p><strong>Javascript基础教程参考：</strong></p>
<p><a target="_blank" href="https://www.runoob.com/js/js-tutorial.html" rel="external nofollow noreferrer noopener">https://www.runoob.com/js/js-tutorial.html</a></p>
<p><a target="_blank" href="https://www.w3school.com.cn/js/index.asp" rel="external nofollow noreferrer noopener">https://www.w3school.com.cn/js/index.asp</a></p>
<h4 id="2-3-5-网页案例解析"><a href="#2-3-5-网页案例解析" class="headerlink" title="2.3.5 网页案例解析"></a>2.3.5 网页案例解析</h4><p>先看一个简单的电影排行的HTML的例子。代码可以在记事本中编写，保存后将后缀改为html（movies.html）。也可以在代码中新建一个HTML文档。推荐后一种方式，层次分明、可读性强。下面是实现的HTML代码：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>电影排行<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>电影排行榜单<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m_list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>1.肖申克的救赎<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>2.霸王别姬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用浏览器打开movies.html，网页效果如图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps5.jpg" alt="img"> </p>
<p>下面来分析一下这个HTML代码。</p>
<p>第一行用DOCTYPE定义了文档类型。</p>
<p>使用尖括号定义标签，如<code>&lt;html&gt;</code>、<code>&lt;head&gt;</code>、<code>&lt;body&gt;</code>、<code>&lt;div&gt;</code>。</p>
<p>标签是成对出现的，如<code>&lt;html&gt;</code>是起始标签，<code>&lt;/html&gt;</code>是终止标签。</p>
<p>最外层的是html标签，表示HTML代码的范围。内部包含head和body标签，分别表示网页头和网页体。</p>
<p>head标签内定义了网页的属性和引用。如<code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code>指明了网页的编码方式为UTF-8；<code>&lt;title&gt;</code>电影排行<code>&lt;/title&gt;</code>定义了网页的标题。</p>
<p>body标签内是浏览器显示的正文内容，也是爬虫获取数据的来源。</p>
<p>div标签类似于一个容器，它将内部所有的内容看成一个整体，主要用于页面的布局。</p>
<p>标签h1代表一级标题；p代表段落，会自动换行。</p>
<p>标签内可以定义自己的属性。如<code>&lt;div id=&quot;content&quot;&gt;</code>它的属性id值为content。这是一个非常有用的属性，因为整个网页中，id的值是唯一的，可以通过它快速定位到这个标签。<code>&lt;div class=&quot;m_list&quot;&gt;</code>中，属性class的值为m_list，这也是一个非常有用的属性，通过它可以定位到所有相同样式的标签。</p>
<h4 id="2-3-6-节点树及节点之间的关系"><a href="#2-3-6-节点树及节点之间的关系" class="headerlink" title="2.3.6 节点树及节点之间的关系"></a>2.3.6 节点树及节点之间的关系</h4><p>即使你了解了HTML代码，对爬虫来说也是无法从中爬取数据的，因为我们还是不知道HTML究竟是什么结构，只有了解了其结构特点，才可以在HTML中编写程序抽取出数据。</p>
<p>在HTML中，所有标签定义的内容都是节点，它们构成了一个HTML DOM树。</p>
<p>我们先看下什么是DOM，DOM是W3C（万维网联盟）的标准，其英文全称Document Object Model，即文档对象模型。它定义了访问HTML和XML文档的标准：</p>
<p><strong>W3C文档对象模型（DOM）是中立于平台和语言的接口，它允许程序和脚本动态地访问和更新文档的内容、结构和样式。</strong></p>
<p>W3C DOM标准被分为3个不同的部分。</p>
<p>核心DOM： 针对任何结构化文档的标准模型。</p>
<p>XML DOM：针对XML文档的标准模型。</p>
<p>HTML DOM：针对HTML文档的标准模型。</p>
<p>根据W3C的HTML DOM标准，HTML文档中的所有内容都是节点。</p>
<p>整个文档是一个文档节点；</p>
<p>每个HTML元素是元素节点；</p>
<p>HTML元素内的文本是文本节点；</p>
<p>每个HTML属性是属性节点；</p>
<p>注释是注释节点。</p>
<p>HTML DOM将HTML文档视作树结构，这种结构被称为节点树，如下图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps7.png" alt="img"></p>
<p>通过HTML DOM，树中的所有节点均可通过JavaScript访问，所有HTML节点元素均可被修改，也可以被创建或删除。</p>
<p>节点树中的节点彼此拥有层级关系。我们常用父（parent）、子（child）和兄弟（sibling）等术语描述这些关系。父节点拥有子节点，同级的子节点被称为兄弟节点。</p>
<p>在节点树中，顶端节点称为根（root）。除了根节点之外，每个节点都有父节点，同时可拥有任意数量的子节点或兄弟节点。下图展示了节点树以及节点之间的关系。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/wps7.png" alt="img"></p>
<p>本段参考W3SCHOOL，链接：<a target="_blank" href="http://www.w3school.com.cn/htmldom/dom_nodes.asp%E3%80%82" rel="external nofollow noreferrer noopener">http://www.w3school.com.cn/htmldom/dom_nodes.asp。</a></p>
<p>本章主要介绍了网络爬虫相关基础知识，包括网络爬虫的概念、HTTP基本原理和网页基础。</p>
<p>在网络爬虫概念一节中，了解了什么是网络爬虫，网络爬虫能用来干什么。</p>
<p>在HTTP基本原理一节中，介绍了URL、超文本、HTTP和HTTPS、HTTP请求和HTTP响应。这些都是后续实现网络爬虫的理论基础，理解了HTTP基本原理，能够更好地理解网络爬虫的原理。</p>
<p>在网页基础一节中，介绍了HTML、CSS、JS、网页结构以及节点树。这为网络爬虫实现数据的提取提供了解决方案，只有充分理解了HTML的树形结构，爬虫才可以根据其编写程序，实现最终的功能。</p>
<h3 id="2-4-网页请求requests库"><a href="#2-4-网页请求requests库" class="headerlink" title="2.4 网页请求requests库"></a>2.4 网页请求requests库</h3><h4 id="2-4-1-示例"><a href="#2-4-1-示例" class="headerlink" title="2.4.1 示例"></a>2.4.1 示例</h4><p>以下是一个使用requests模块模仿浏览器访问网页的代码，输入以下代码查看res.text的网页输出结果。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token comment" spellcheck="true"># 通过get方法获取网页的返回结果保存到res变量中</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://kui.ge'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 通过text获取返回的网页内容</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-4-2-请求方法"><a href="#2-4-2-请求方法" class="headerlink" title="2.4.2 请求方法"></a>2.4.2 请求方法</h4><p>除了以上的get方法外，还有一些其他的请求方法如下：</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">delete(url, args)</td>
<td align="left">向指定的 URL 发送 DELETE 请求。</td>
</tr>
<tr>
<td align="left">get(url, params, args)</td>
<td align="left">向指定的 URL 发送 GET 请求，params为dict，post请求时带入参数。</td>
</tr>
<tr>
<td align="left">head(url, args)</td>
<td align="left">向指定的 URL 发送 HEAD 请求，格式为dict。</td>
</tr>
<tr>
<td align="left">patch(url, data, args)</td>
<td align="left">向指定的 URL 发送 PATCH 请求。</td>
</tr>
<tr>
<td align="left">post(url, data, json, args)</td>
<td align="left">向指定的 URL 发送 POST 请求。</td>
</tr>
<tr>
<td align="left">put(url, data, args)</td>
<td align="left">向指定的 URL 发送 PUT 请求。</td>
</tr>
<tr>
<td align="left">request(method, url, args)</td>
<td align="left">将指定方法的请求发送到指定的 URL。</td>
</tr>
</tbody></table>
<h4 id="2-4-3-返回方法"><a href="#2-4-3-返回方法" class="headerlink" title="2.4.3 返回方法"></a>2.4.3 返回方法</h4><table>
<thead>
<tr>
<th align="left">属性或方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">encoding</td>
<td align="left">查看返回数据的编码方式，使用示例：r.encoding，结果示例：utf-8</td>
</tr>
<tr>
<td align="left">status_code</td>
<td align="left">查看返回的状态码，示例：r.status_code</td>
</tr>
<tr>
<td align="left">text</td>
<td align="left">查看返回的数据内容</td>
</tr>
<tr>
<td align="left">headers</td>
<td align="left">查看返回的头部数据</td>
</tr>
<tr>
<td align="left">content</td>
<td align="left">查看返回数据的二进制内容</td>
</tr>
<tr>
<td align="left">url</td>
<td align="left">查看访问的实际URL</td>
</tr>
<tr>
<td align="left">cookies</td>
<td align="left">查看cookies内容，使用示例：r.cookies[‘ts’]</td>
</tr>
<tr>
<td align="left">json()</td>
<td align="left">返回结果如果是json，可以通过这个方法直接获取json对象</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="2-4-4-安装"><a href="#2-4-4-安装" class="headerlink" title="2.4.4 安装"></a>2.4.4 安装</h4><p>如果import requests显示没有这个模块，可以使用以下的方式安装。</p>
<pre class="line-numbers language-bash"><code class="language-bash">pip <span class="token function">install</span> requests<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="2-4-5-header请求"><a href="#2-4-5-header请求" class="headerlink" title="2.4.5 header请求"></a>2.4.5 header请求</h4><pre class="line-numbers language-python"><code class="language-python">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.douban.com/'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="2-4-6-上传数据"><a href="#2-4-6-上传数据" class="headerlink" title="2.4.6 上传数据"></a>2.4.6 上传数据</h4><p>发送POST对比GET请求，需要增加data参数，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://search.douban.com/movie/subject_search'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'search_text'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">:</span> <span class="token string">'1002'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>url <span class="token comment" spellcheck="true">#实际请求的URL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>通过以上提交data参数，获取到相关的搜索结果信息</p>
<h4 id="2-4-7-上传json数据"><a href="#2-4-7-上传json数据" class="headerlink" title="2.4.7 上传json数据"></a>2.4.7 上传json数据</h4><p>使用json=params，内部会转化为json格式，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token string">'value'</span><span class="token punctuation">}</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>params<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="2-4-8-上传文件"><a href="#2-4-8-上传文件" class="headerlink" title="2.4.8 上传文件"></a>2.4.8 上传文件</h4><p>注意读取文件使用rb，否则获取的文件长度信息会不正确</p>
<pre class="line-numbers language-python"><code class="language-python">upload_files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> open<span class="token punctuation">(</span><span class="token string">'report.xls'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span>upload_files<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="2-5-正则表达式"><a href="#2-5-正则表达式" class="headerlink" title="2.5 正则表达式"></a>2.5 正则表达式</h3><h4 id="2-5-1-查找和替换"><a href="#2-5-1-查找和替换" class="headerlink" title="2.5.1 查找和替换"></a>2.5.1 查找和替换</h4><p>通过以上的requests模块，获取到了网页的信息，当信息多的时候，就需要检索，平时用的比较多的是搜索和替换，例如：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210317101004.png" alt="image-20210317101004414"></p>
<p>查找和替换是对文档用的最多的功能，那么在Python程序中，怎么实现查找替换的功能呢？</p>
<p>我们可以把打开的文档看作字符串，那么我们只要学会查找字符串就可以了。比如要在以下字符串中查找<code>o</code>这个字符，可以：</p>
<pre class="line-numbers language-python"><code class="language-python">count <span class="token operator">=</span> <span class="token number">0</span>
var <span class="token operator">=</span> <span class="token string">'hello world'</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> var<span class="token punctuation">:</span>
    <span class="token keyword">if</span> c <span class="token operator">==</span> <span class="token string">'o'</span><span class="token punctuation">:</span>
        count <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'查找到%d次'</span> <span class="token operator">%</span> count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果：</p>
<pre><code>查找到2次</code></pre>
<p>以上通过for循环对字符串var进行了遍历，并找到两个o，输出了找到的次数，这是查找和替换的简单场景，通过简单的代码也能够实现。</p>
<h4 id="2-5-2-search正则表达式"><a href="#2-5-2-search正则表达式" class="headerlink" title="2.5.2 search正则表达式"></a>2.5.2 search正则表达式</h4><p>有时候我们还会遇到一些复杂的情况，比如查找纯数字的内容、查找小写字母、甚至对查找到的数据做一些运算等等，这些功能虽然咱们自己也能够实现，还是很花时间和精力的。Python已经为我们提供了相关的工具类，而咱们要做的就是学会使用它们就可以完成字符串的查找和替换了。</p>
<p>一个简单的案例，在以下提供的字符串line中查找关键字梦想</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">import</span> re

line <span class="token operator">=</span> <span class="token triple-quoted-string string">'''每个人都拥有自己的梦想，设计自己的梦想，追求自己的梦想，实现自己的梦想。\
        梦想是生命的灵魂，是心灵的灯塔，是引导人走向成功的信仰。\
        有了崇高的梦想，只要矢志不渝地追求，梦想就会成为现实，奋斗就会变成壮举，生命就会创造奇迹。'''</span>
match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'梦想'</span><span class="token punctuation">,</span> line<span class="token punctuation">,</span> re<span class="token punctuation">.</span>M<span class="token operator">|</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上代码的输出结果是</p>
<pre><code>&lt;re.Match object; span=(9, 11), match=&#39;梦想&#39;&gt;</code></pre>
<p>结果说明：从结果中已经告诉我们在line列表中找到了<strong>梦想</strong>关键字，在第九到第11个字符。</p>
<p>代码解析：以上代码中，使用了re类，是Regular Expression的简写，有时候也简写成regex，中文含义是正则表达式，通过import的方式引入外部类，如第3行import re；</p>
<p>第8行<code>re.search(pattern, string, flag)</code>的search是re类的一个方法，三个参数在刚才的例子中表示为在string（第二个参数）中查找pattern（第一个参数）字符串第一次出现的地方，满足一定的flag（要求，比如大小写敏感等）。</p>
<p><strong>re.search的使用说明如下</strong></p>
<p>re.search 扫描整个字符串并返回第一个成功的匹配。</p>
<p>函数语法：</p>
<pre class="line-numbers language-python"><code class="language-python">re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string<span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>函数参数说明：</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">pattern</td>
<td align="left">匹配的正则表达式</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">要匹配的字符串</td>
</tr>
<tr>
<td align="left">flags</td>
<td align="left">标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等</td>
</tr>
</tbody></table>
<p>匹配成功re.search方法返回一个匹配的对象，否则返回None。</p>
<p>我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</p>
<table>
<thead>
<tr>
<th align="left">匹配对象方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">group(num=0)</td>
<td align="left">匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</td>
</tr>
<tr>
<td align="left">groups()</td>
<td align="left">返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。</td>
</tr>
</tbody></table>
<h4 id="2-5-3-findall正则表达式"><a href="#2-5-3-findall正则表达式" class="headerlink" title="2.5.3 findall正则表达式"></a>2.5.3 findall正则表达式</h4><p>通过re.search咱们发现，它只能找到字符串第一次出现的地方，而如果需要找所有出现的地方就需要使用findall了。</p>
<p>在字符串中找到正则表达式所匹配的所有子串，并返回一个列表，如果没有找到匹配的，则返回空列表。</p>
<p><strong>注意：</strong> match 和 search 是匹配一次 findall 匹配所有。</p>
<p>语法格式为：</p>
<pre class="line-numbers language-python"><code class="language-python">findall<span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token punctuation">,</span> endpos<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>参数：</p>
<ul>
<li><strong>string</strong> : 待匹配的字符串。</li>
<li><strong>pos</strong> : 可选参数，指定字符串的起始位置，默认为 0。</li>
<li><strong>endpos</strong> : 可选参数，指定字符串的结束位置，默认为字符串的长度。</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">import</span> re

line <span class="token operator">=</span> <span class="token triple-quoted-string string">'''每个人都拥有自己的梦想，设计自己的梦想，追求自己的梦想，实现自己的梦想。\
        梦想是生命的灵魂，是心灵的灯塔，是引导人走向成功的信仰。\
        有了崇高的梦想，只要矢志不渝地追求，梦想就会成为现实，奋斗就会变成壮举，生命就会创造奇迹。'''</span>

pattern <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'梦想'</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> pattern<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果：</p>
<pre><code>[&#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;, &#39;梦想&#39;]</code></pre>
<p>可以看到找到了7次匹配的内容,re.compile通过提供的正则表达式生成了正则表达式对象pattern，再通过pattern.findall获取到要匹配的文本进行规则的匹配，并找到符合正则表达式的所有内容。</p>
<h4 id="2-5-4-sub正则表达式"><a href="#2-5-4-sub正则表达式" class="headerlink" title="2.5.4 sub正则表达式"></a>2.5.4 sub正则表达式</h4><p>通过search和findall已经可以完成对字符串的查找了，怎么替换呢？使用sub正则表达式。</p>
<p>语法：</p>
<pre><code>re.sub(pattern, repl, string, count=0, flags=0)</code></pre>
<p>参数：</p>
<ul>
<li>pattern : 正则中的模式字符串。</li>
<li>repl : 替换的字符串，也可为一个函数。</li>
<li>string : 要被查找替换的原始字符串。</li>
<li>count : 模式匹配后替换的最大次数，默认 0 表示替换所有的匹配。</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">import</span> re

line <span class="token operator">=</span> <span class="token string">"每个人的身上都有毛毛，我要为你唱毛毛"</span>

result <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'毛毛'</span><span class="token punctuation">,</span> r<span class="token string">"猫猫"</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果：</p>
<pre><code>每个人的身上都有猫猫，我要为你唱猫猫</code></pre>
<p>咱们发现字符串里所有的毛毛变成了猫猫，这个是sub的替换功能实现的。</p>
<h4 id="2-5-5-正则表达式常用匹配符"><a href="#2-5-5-正则表达式常用匹配符" class="headerlink" title="2.5.5 正则表达式常用匹配符"></a>2.5.5 正则表达式常用匹配符</h4><p>构造正则表达式的方法和创建数学表达式的方法一样。正则表达式的组件可以是单个的字符、字符集合、字符范围、字符间的选择或者所有这些组件的任意组合。下表为正则表达式的重要符号：</p>
<table>
<thead>
<tr>
<th><strong><em>\</em>符号**</strong></th>
<th><strong><em>\</em>描述**</strong></th>
<th><strong><em>\</em>符号**</strong></th>
<th><strong><em>\</em>描述**</strong></th>
</tr>
</thead>
<tbody><tr>
<td>\w</td>
<td>匹配字母、数字、下划线</td>
<td>.</td>
<td>匹配任意字符，包括汉字</td>
</tr>
<tr>
<td>\W</td>
<td>匹配不是字母、数字、下划线的字符</td>
<td>[m]</td>
<td>匹配单个字符串</td>
</tr>
<tr>
<td>\s</td>
<td>匹配空白字符</td>
<td>[m1m2…n]</td>
<td>匹配多个字符串</td>
</tr>
<tr>
<td>\S</td>
<td>匹配不是空白的字符</td>
<td>[m-n]</td>
<td>匹配m到n区间内的数字、字母</td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字</td>
<td>[^m]</td>
<td>匹配除m以外的字符串</td>
</tr>
<tr>
<td>\D</td>
<td>匹配非数字的字符</td>
<td>()</td>
<td>对正则表达式进行分组，一对圆括号表示一组</td>
</tr>
<tr>
<td>*</td>
<td>重复0或N次</td>
<td>{m}</td>
<td>重复m次</td>
</tr>
<tr>
<td>+</td>
<td>重复1或N次</td>
<td>{m,n}</td>
<td>该限定符的意思是至少有 m 个重复，至多到 n 个重复</td>
</tr>
<tr>
<td>?</td>
<td>重复0或1次</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>正则表达式的规则比较多，但是对于爬虫而言，我们只要掌握几个重要的规则就可以了。</p>
<ul>
<li>. ：匹配任意1个字符，换行\n除外</li>
<li>*：匹配前一个字符0次或无限次</li>
<li>？：匹配前一个字符0次或一次</li>
<li>.* ：贪心算法，匹配除换行符之外的所有字符</li>
<li>.*?：非贪心算法，只匹配符合条件的字符</li>
<li>（.*?）：非贪心算法，只匹配符合条件的最少字符</li>
</ul>
<h4 id="举例说明-匹配符"><a href="#举例说明-匹配符" class="headerlink" title="举例说明.匹配符"></a>举例说明.匹配符</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaaabab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果：</p>
<pre><code>[&#39;aab&#39;, &#39;aab&#39;]</code></pre>
<p>可以看到a和b中间有字符且不是换行的都被匹配了出来</p>
<h4 id="举例说明-匹配符-1"><a href="#举例说明-匹配符-1" class="headerlink" title="举例说明*匹配符"></a>举例说明*匹配符</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaaabab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a*b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre><code>[&#39;aab&#39;, &#39;ab&#39;, &#39;aaab&#39;, &#39;ab&#39;]</code></pre>
<p>可以看到不管a重复了几次都被匹配了出来</p>
<h4 id="举例说明-匹配符，非贪婪算法"><a href="#举例说明-匹配符，非贪婪算法" class="headerlink" title="举例说明?匹配符，非贪婪算法"></a>举例说明?匹配符，非贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaaabab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre><code>[&#39;ab&#39;, &#39;ab&#39;, &#39;ab&#39;, &#39;ab&#39;]</code></pre>
<h4 id="举例说明-贪婪算法"><a href="#举例说明-贪婪算法" class="headerlink" title="举例说明.*贪婪算法"></a>举例说明.*贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaaabab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre><code>[&#39;aababaaabab&#39;]</code></pre>
<p>只要满足从a开始的，就开始截取，然后找到所有的b，并找到最长的那个作为截止。</p>
<h4 id="举例说明-非贪婪算法"><a href="#举例说明-非贪婪算法" class="headerlink" title="举例说明.*?非贪婪算法"></a>举例说明.*?非贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaaabab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre><code>[&#39;aab&#39;, &#39;ab&#39;, &#39;aaab&#39;, &#39;ab&#39;]</code></pre>
<p>从左到右只要满足从a开始到b结束的就截取出来，ab中间没有字符也会被截取</p>
<h4 id="举例说明-非贪婪算法-1"><a href="#举例说明-非贪婪算法-1" class="headerlink" title="举例说明(.*?)非贪婪算法"></a>举例说明(.*?)非贪婪算法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaaabab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a(.*?)b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果</p>
<pre><code>[&#39;a&#39;, &#39;&#39;, &#39;aa&#39;, &#39;&#39;]</code></pre>
<p>相比于.*?的结果()表示只保留了中间的部分，两边匹配的去除掉</p>
<p>另外如果字符串中有回车换行<code>\n</code>存在，需要使用<code>re.S</code>，这样就不会中断执行了。</p>
<h4 id="举例说明修饰符标志的用法"><a href="#举例说明修饰符标志的用法" class="headerlink" title="举例说明修饰符标志的用法"></a>举例说明修饰符标志的用法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re

var <span class="token operator">=</span> <span class="token string">'aababaa \n abab'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'a.*?b'</span><span class="token punctuation">,</span> var<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果为</p>
<pre><code>[&#39;aab&#39;, &#39;ab&#39;, &#39;ab&#39;, &#39;ab&#39;]
[&#39;aab&#39;, &#39;ab&#39;, &#39;aa \n ab&#39;, &#39;ab&#39;]</code></pre>
<p>可以看到带有re.S的把回车换行符<code>\n</code>也当作普通字符处理了，而没有re.S，则换行后，匹配会重新计算。</p>
<h4 id="可选的修饰符标志"><a href="#可选的修饰符标志" class="headerlink" title="可选的修饰符标志"></a>可选的修饰符标志</h4><table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">re.I</td>
<td align="left">使匹配对大小写不敏感</td>
</tr>
<tr>
<td align="left">re.L</td>
<td align="left">做本地化识别（locale-aware）匹配</td>
</tr>
<tr>
<td align="left">re.M</td>
<td align="left">多行匹配，影响 ^ 和 $</td>
</tr>
<tr>
<td align="left">re.S</td>
<td align="left">使 . 匹配包括换行在内的所有字符</td>
</tr>
<tr>
<td align="left">re.U</td>
<td align="left">根据Unicode字符集解析字符。这个标志影响 \w, \W, \b, \B.</td>
</tr>
<tr>
<td align="left">re.X</td>
<td align="left">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解。</td>
</tr>
</tbody></table>
<h3 id="2-6-XPath的HTML解析"><a href="#2-6-XPath的HTML解析" class="headerlink" title="2.6 XPath的HTML解析"></a>2.6 XPath的HTML解析</h3><h4 id="2-6-1-案例"><a href="#2-6-1-案例" class="headerlink" title="2.6.1 案例"></a>2.6.1 案例</h4><p>一个简单的HTML，使用XPath解析的案例</p>
<p>现有一个网址导航的HTML文档link.html，代码如下所示：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>网址导航<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m_list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.baidu.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.sina.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>新浪<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面我们使用Xpath提取该页面的中的数据。</p>
<p><strong>1. 准备工作：加载link.html页面。</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment" spellcheck="true">#解析movies.html文件，返回一个节点树的对象</span>
html_selector <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">"link.html"</span><span class="token punctuation">,</span>etree<span class="token punctuation">.</span>HTMLParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>2. 使用斜杠（/）从根节点开始获取html元素。</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取根节点html的元素</span>
root <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"/html"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<p><code>[&lt;Element html at 0x28c42b74dc8&gt;]</code></p>
<p>由结果可知，返回一个html元素的对象。</p>
<p><strong>3. 使用斜杠（/）从根节点开始逐层查找元素的子节点。</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#斜杠（/）获取节点title</span>
title <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"/html/head/title"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<p><code>[&lt;Element title at 0x24931025ec8&gt;]</code></p>
<p>由结果可知，返回一个title元素的对象。</p>
<p><strong>4. 使用text()获取节点title中的文本。</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#斜杠（/）获取节点title</span>
title <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"/html/head/title/text()"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<p><code>[&#39;Title&#39;]</code></p>
<p><strong>5. 获取所有链接名称。</strong></p>
<pre class="line-numbers language-python"><code class="language-python">link_name <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//a/text()"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>link_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<p><code>[&#39;百度&#39;, &#39;新浪&#39;]</code></p>
<p><strong>6. 获取所有链接地址。</strong></p>
<pre class="line-numbers language-python"><code class="language-python">link <span class="token operator">=</span> html_selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//a/@href"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>输出结果：</p>
<p><code>[&#39;https://www.baidu.com&#39;, &#39;http://www.sina.com&#39;]</code></p>
<h4 id="2-6-2-原理"><a href="#2-6-2-原理" class="headerlink" title="2.6.2 原理"></a>2.6.2 原理</h4><p>网络爬虫最核心、最重要的工作是从HTML文档中将想要的数据提取出来，而使用XPath就可以很轻松地解析HTML文档信息。下面来看一下什么是XPath。</p>
<p>XPath全称<strong>X</strong>ML <strong>Path</strong> Language，即XML路径语言。它是一门在XML文档中查找信息的语言。HTML与XML结构类似，也可以在HTML中查找信息。</p>
<p>XPath 使用路径表达式来选取HTML文档中的节点或者节点集。这些路径表达式和我们在常规的电脑文件系统中看到的表达式非常相似。</p>
<p>例如，Windows系统中，要指明桌面上的文件hello.py的路径，通常可以写成：C:\Users\aibit\Desktop\hello.py。从C盘开始，使用反斜杠（\）逐级往下找，直到最终的目标</p>
<h4 id="2-6-3-路径表达式"><a href="#2-6-3-路径表达式" class="headerlink" title="2.6.3 路径表达式"></a>2.6.3 路径表达式</h4><p>XPath 使用路径表达式来选取HTML文档中的节点或者节点集。</p>
<p>常用的XPath路径表达式如下表所示：</p>
<table>
<thead>
<tr>
<th><strong>表达式</strong></th>
<th><strong>描述</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>nodename</td>
<td>选取此节点的所有子节点</td>
<td>div,p,h1</td>
</tr>
<tr>
<td>/</td>
<td>从根节点选取（描述绝对路径）</td>
<td>/html</td>
</tr>
<tr>
<td>//</td>
<td>不考虑位置，选取页面中所有子孙节点</td>
<td>//div</td>
</tr>
<tr>
<td>.</td>
<td>选取当前节点（描述相对路径）</td>
<td>./div</td>
</tr>
<tr>
<td>..</td>
<td>选取当前节点的父节点（描述相对路径）</td>
<td>h1/../</td>
</tr>
<tr>
<td>@属性名</td>
<td>选取属性的值</td>
<td>@href,@id</td>
</tr>
<tr>
<td>text()</td>
<td>获取元素中的文本节点</td>
<td>//h1/text()</td>
</tr>
</tbody></table>
<p>大家对诸如：斜杠（/）、点（.）、两点（..）的用法一定不会陌生。即使不熟悉也没关系，因为XPath的语法实在太简单了。下面通过一个实例来加深对XPath用法的理解。</p>
<h3 id="2-7-BeautifulSoup的HTML解析"><a href="#2-7-BeautifulSoup的HTML解析" class="headerlink" title="2.7 BeautifulSoup的HTML解析"></a>2.7 BeautifulSoup的HTML解析</h3><p>除了XPath，另一个非常流行、功能强大的数据解析工具就是BeautifulSoup了，它借助网页的结构和属性等特性来解析网页，只需要简单的几条语句，就可以完成网页中某个元素的提取。接下来就来感受一下Beautiful Soup的强大之处吧。</p>
<p>简单来说，Beautiful Soup就是Python的一个HTML或XML的解析库，可以用它来方便地从网页中提取数据。官方解释如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329120725.png" alt="Beautiful Soup官方解释"></p>
<p>Beautiful Soup已成为和lxml、html6lib一样出色的Python解释器，为用户灵活地提供不同的解析策略或强劲的速度。</p>
<h4 id="2-7-1-安装BeautifulSoup"><a href="#2-7-1-安装BeautifulSoup" class="headerlink" title="2.7.1 安装BeautifulSoup"></a>2.7.1 安装BeautifulSoup</h4><p>首先，我们需要安装BeautifulSoup。可以使用pip命令安装：</p>
<p>pip install beautifulsoup4</p>
<p>这个包兼容Python2和Python3。</p>
<h4 id="2-7-2-解析器"><a href="#2-7-2-解析器" class="headerlink" title="2.7.2 解析器"></a>2.7.2 解析器</h4><p>Beautiful Soup支持Python标准库中的HTML解析器,还支持一些第三方的解析器，如lxml。上一节我们已经安装了lxml。</p>
<p>下表列出了主要的解析器,以及它们的优缺点:</p>
<table>
<thead>
<tr>
<th><strong><em>\</em>解析器**</strong></th>
<th><strong><em>\</em>使用方法**</strong></th>
<th><strong><em>\</em>优势**</strong></th>
<th><strong><em>\</em>劣势**</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Python标准库</td>
<td>BeautifulSoup(markup, “html.parser”)</td>
<td>ü Python的内置标准库ü 执行速度适中ü 文档容错能力强</td>
<td>Python 2.7.3 or 3.2.2)前 的版本中文档容错能力差</td>
</tr>
<tr>
<td>lxml HTML 解析器</td>
<td>BeautifulSoup(markup, “lxml”)</td>
<td>ü 速度快ü 文档容错能力强</td>
<td>需要安装C语言库</td>
</tr>
<tr>
<td>lxml XML 解析器</td>
<td>BeautifulSoup(markup, [“lxml”, “xml”])BeautifulSoup(markup, “xml”)</td>
<td>ü 速度快ü 唯一支持XML的解析器</td>
<td>需要安装C语言库</td>
</tr>
<tr>
<td>html5lib</td>
<td>BeautifulSoup(markup, “html5lib”)</td>
<td>ü 最好的容错性ü 以浏览器的方式解析文档ü 生成HTML5格式的文档</td>
<td>速度慢不依赖外部扩展</td>
</tr>
</tbody></table>
<p>推荐使用lxml作为解析器,因为效率更高。本课程默认使用的也是lxml。</p>
<h4 id="2-7-3-案例"><a href="#2-7-3-案例" class="headerlink" title="2.7.3 案例"></a>2.7.3 案例</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> bs4

res <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">"https://www.douban.com/tag/%E5%B0%8F%E8%AF%B4/?focus=book"</span><span class="token punctuation">)</span>
soup <span class="token operator">=</span> bs4<span class="token punctuation">.</span>BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
book_div <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token string">"book"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
book_a <span class="token operator">=</span> book_div<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"class"</span><span class="token punctuation">:</span><span class="token string">"title"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> book <span class="token keyword">in</span> book_a<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-7-4-CSS选择器"><a href="#2-7-4-CSS选择器" class="headerlink" title="2.7.4 CSS选择器"></a>2.7.4 CSS选择器</h4><p>Beautiful Soup还提供了另外一种选择器，那就是CSS选择器。如果对Web开发熟悉的话，那么对CSS选择器肯定也不陌生。如果不熟悉的话，可以参考<a target="_blank" href="http://www.w3school.com.cn/cssref/css_selectors.asp%E4%BA%86%E8%A7%A3%E3%80%82" rel="external nofollow noreferrer noopener">http://www.w3school.com.cn/cssref/css_selectors.asp了解。</a></p>
<p>使用CSS选择器时，只需要调用select()方法，传入相应的CSS选择器即可。</p>
<h3 id="2-8-多线程爬虫"><a href="#2-8-多线程爬虫" class="headerlink" title="2.8 多线程爬虫"></a>2.8 多线程爬虫</h3><p>到目前为止，我们实现的爬虫都是串行爬虫，即只有当前请求执行完后（爬取完成），才能执行下一个请求，就像排队一样，只能一个接一个的执行。很显然，这种方式效率比较低，当一个请求需要消耗较长时间时（如网络较慢、下载数据量较多、服务器问题等），爬虫就只能等待，直到运行完毕，才可以执行下一个请求。</p>
<p>为了解决以上问题，我们可以考虑使用多线程爬虫，即为爬虫开辟多个线程，每个线程负责处理一个页面的请求，当一个线程在等待时，进程就会切换执行另一个线程，提高了处理器运行的效率。</p>
<p>Python中内置了threading模块，用于实现多线程功能。</p>
<h4 id="2-8-1-线程方法"><a href="#2-8-1-线程方法" class="headerlink" title="2.8.1 线程方法"></a>2.8.1 线程方法</h4><table>
<thead>
<tr>
<th></th>
<th>方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Thread(target,args)</td>
<td>新建线程对象</td>
</tr>
<tr>
<td>2</td>
<td>setDaemon()</td>
<td>守护线程。<br />True: 主线程执行完毕后会将子线程回收掉<br />False: 主进程执行结束时不会回收子线程</td>
</tr>
<tr>
<td>3</td>
<td>join()</td>
<td>等待至线程终止</td>
</tr>
<tr>
<td>4</td>
<td>start()</td>
<td>启动线程活动</td>
</tr>
<tr>
<td>5</td>
<td>isAlive()</td>
<td>判断线程是否活动</td>
</tr>
<tr>
<td>6</td>
<td>remove()</td>
<td>删除线程</td>
</tr>
</tbody></table>
<h4 id="2-8-2-线程创建"><a href="#2-8-2-线程创建" class="headerlink" title="2.8.2 线程创建"></a>2.8.2 线程创建</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=UTF-8</span>

<span class="token keyword">import</span> threading

<span class="token comment" spellcheck="true"># 自定义线程类</span>
<span class="token keyword">class</span> <span class="token class-name">myThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment" spellcheck="true"># 重写run方法</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>counter <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s called %d times'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建新线程</span>
thread1 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread1"</span><span class="token punctuation">)</span>
thread2 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread2"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 启动线程</span>
thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Main thread called'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的代码自定义一个线程类，继承于threading.Thread，并重写了<code>__init__</code>和<code>run</code>方法。</p>
<p>当创建新线程thread1和thread2之后，就可以通过调用start方法来自动调用线程的<strong>run</strong>执行方法了，run方法就是线程的主要执行函数。</p>
<p>在重载的<strong>run</strong>线程方法里，我们可以为不同的线程对象执行不同的代码来并行执行代码了。</p>
<p>以上的代码打印结果如下：</p>
<pre><code>Thread1 called 1 times
Thread1 called 2 times
Thread1 called 3 times
Thread2 called 1 times
Main thread called
Thread2 called 2 times
Thread2 called 3 times</code></pre>
<h4 id="2-8-3-线程同步"><a href="#2-8-3-线程同步" class="headerlink" title="2.8.3 线程同步"></a>2.8.3 线程同步</h4><p>既然代码有多条不同的执行路径，代码的编写和调试就变得非常麻烦，因为可能一个变量会同时在多个线程中运行的情况，或者一段代码在未执行完的情况下，其中的值可能会受到其他执行线程的意外修改，导致实际执行结果与预期不符。</p>
<p>怎么解决这类问题呢？可以通过线程同步来解决，让一部分代码被保护起来，不允许并行执行。</p>
<p>使用Thread对象的Lock和Rlock可以实现简单的线程同步，这两个对象都有acquire方法和release方法，对于那些需要每次只允许一个线程操作的数据，可以将其操作放到acquire和release方法之间。如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=UTF-8</span>

<span class="token keyword">import</span> threading

<span class="token comment" spellcheck="true"># 自定义线程类</span>
<span class="token keyword">class</span> <span class="token class-name">myThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment" spellcheck="true"># 重写run方法</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threadLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>counter <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s called %d times'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        threadLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#创建线程锁</span>
threadLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建新线程</span>
thread1 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread1"</span><span class="token punctuation">)</span>
thread2 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread2"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 启动线程</span>
thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 等待线程退出</span>
thread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
thread2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Main thread called'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过以上代码通过创建threadLock，在<code>run</code>语句中加入acquire和release保护打印语句，这样只有在release被执行后，其他的线程才能通过acquire获取到代码的执行权限。执行的结果如下：</p>
<pre><code>Thread1 called 1 times
Thread1 called 2 times
Thread1 called 3 times
Thread2 called 1 times
Thread2 called 2 times
Thread2 called 3 times
Main thread called</code></pre>
<h4 id="2-8-4-线程队列"><a href="#2-8-4-线程队列" class="headerlink" title="2.8.4 线程队列"></a>2.8.4 线程队列</h4><p>以上的方式已经可以保护需要同步的数据了，而在实际代码编写中，数据可能会被不同的线程间共享处理，有没有一套比较好用的方法提供呢，今天它来了。</p>
<p>Python的Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先入先出)队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue。这些队列都实现了锁原语，能够在多线程中直接使用。可以使用队列来实现线程间的同步。</p>
<p>Queue模块中的常用方法:</p>
<ul>
<li>Queue.qsize() 返回队列的大小</li>
<li>Queue.empty() 如果队列为空，返回True,反之False</li>
<li>Queue.full() 如果队列满了，返回True,反之False</li>
<li>Queue.full 与 maxsize 大小对应</li>
<li>Queue.get([block[, timeout]])获取队列，timeout等待时间</li>
<li>Queue.get_nowait() 相当Queue.get(False)</li>
<li>Queue.put(item) 写入队列，timeout等待时间</li>
<li>Queue.put_nowait(item) 相当Queue.put(item, False)</li>
<li>Queue.task_done() 在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号</li>
<li>Queue.join() 实际上意味着等到队列为空，再执行别的操作</li>
</ul>
<p>参考代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span>

<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> threading

<span class="token comment" spellcheck="true"># 输入数据的线程类</span>
<span class="token keyword">class</span> <span class="token class-name">inputThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>q <span class="token operator">=</span> q
    <span class="token comment" spellcheck="true"># 重写run方法</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dataList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"One"</span><span class="token punctuation">,</span> <span class="token string">"Two"</span><span class="token punctuation">,</span> <span class="token string">"Three"</span><span class="token punctuation">,</span> <span class="token string">"Four"</span><span class="token punctuation">,</span> <span class="token string">"Five"</span><span class="token punctuation">,</span> <span class="token string">'Exit'</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> dataList<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出数据的线程类</span>
<span class="token keyword">class</span> <span class="token class-name">outputThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 重写__init__构造函数</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>q <span class="token operator">=</span> q
    <span class="token comment" spellcheck="true"># 重写run方法</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token string">'Exit'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s get data:%s'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建队列</span>
q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 创建1个输入线程和两个输出线程</span>
inputThread1 <span class="token operator">=</span> inputThread<span class="token punctuation">(</span><span class="token string">"inputThread1"</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
outputThread1 <span class="token operator">=</span> outputThread<span class="token punctuation">(</span><span class="token string">"outputThread1"</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 启动线程</span>
inputThread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
outputThread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 等待线程退出</span>
inputThread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
outputThread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Main thread called'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行结果</p>
<pre><code>outputThread1 get data:One
outputThread1 get data:Two
outputThread1 get data:Three
outputThread1 get data:Four
outputThread1 get data:Five
Main thread called</code></pre>
<p>通过以上代码可以看到，一个生产和消费数据的典型案例，也符合很多的业务场景的使用。</p>
<h2 id="三、1天学会爬虫数据持久化保存"><a href="#三、1天学会爬虫数据持久化保存" class="headerlink" title="三、1天学会爬虫数据持久化保存"></a>三、1天学会爬虫数据持久化保存</h2><h3 id="3-1-Docker服务环境搭建"><a href="#3-1-Docker服务环境搭建" class="headerlink" title="3.1 Docker服务环境搭建"></a>3.1 Docker服务环境搭建</h3><p>docker 是通过 <code>yum install docker</code>安装的，搜了一把，原来是因为linux与docker版本的兼容性问题。那就卸载旧版本安装最新版试试。</p>
<h4 id="3-1-1-安装docker"><a href="#3-1-1-安装docker" class="headerlink" title="3.1.1 安装docker"></a>3.1.1 安装docker</h4><p>0.通过uname -r命令查看你当前的内核版本</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">uname</span> -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>1.使用 <code>root</code> 权限登录 CentOS。确保 yum 包更新到最新。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2.卸载旧版本(如果安装过旧版本的话)</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum remove docker  docker-common docker-selinux docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3.安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4.设置yum源</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5.可以查看所有仓库中所有docker版本，并选择特定版本安装</p>
<pre class="line-numbers language-bash"><code class="language-bash">yum list docker-ce --showduplicates <span class="token operator">|</span> <span class="token function">sort</span> -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6.安装docker</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>7.启动并加入开机启动</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start docker
<span class="token function">sudo</span> systemctl <span class="token function">enable</span> docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>8.验证安装是否成功(有client和service两部分表示docker安装启动都成功了)</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>经过以上一通操作，pull 一下镜像再执行docker run命令，问题解决。</p>
<p>官网地址:<a target="_blank" href="https://docs.docker.com/compose/install/" rel="external nofollow noreferrer noopener">https://docs.docker.com/compose/install/</a></p>
<h4 id="3-1-2-安装Docker-Compose"><a href="#3-1-2-安装Docker-Compose" class="headerlink" title="3.1.2 安装Docker Compose"></a>3.1.2 安装Docker Compose</h4><p>1、运行此命令以下载Docker Compose的当前稳定版本</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L <span class="token string">"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>以上运行过慢，换成国内的</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L <span class="token string">"https://get.daocloud.io/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、对二进制文件应用可执行权限：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> 3、参考官网如下</p>
<p>安装完成后，可通过测试命令查看版本</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker-compose --version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="3-1-3-docker-compose-yml配置"><a href="#3-1-3-docker-compose-yml配置" class="headerlink" title="3.1.3 docker-compose.yml配置"></a>3.1.3 docker-compose.yml配置</h4><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2.0'</span>
<span class="token comment" spellcheck="true">#mysql mongo redis</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mongo
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"27017:27017"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /data/mongo/db<span class="token punctuation">:</span>/data/db    <span class="token comment" spellcheck="true">#数据挂载本地</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net  
    <span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 最好设置，因为数据库的日志占很大的内存，定期清理比较好</span>
        <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"json-file"</span>   <span class="token comment" spellcheck="true"># 设置日志格式</span>
        <span class="token key atrule">options</span><span class="token punctuation">:</span>
           <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>  <span class="token comment" spellcheck="true"># 单个日志文件的最大内存</span>
           <span class="token key atrule">max-file</span><span class="token punctuation">:</span> <span class="token string">"3"</span>   <span class="token comment" spellcheck="true">#最多保留几个文件，如果超多三个文件，会自动删除最早的一个</span>


  <span class="token key atrule">mongo-express</span><span class="token punctuation">:</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mongo
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mongo<span class="token punctuation">-</span>express
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">-</span>express
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8081:8081"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"6379:6379"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /data/redis<span class="token punctuation">:</span>/data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net


  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /data/mysql<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=123456  <span class="token comment" spellcheck="true">#设置root 用户密码</span>
        <span class="token punctuation">-</span> MYSQL_DATABASE=testDB
        <span class="token punctuation">-</span> MYSQL_USER=userName
        <span class="token punctuation">-</span> MYSQL_PASSWORD=xxxxx

  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> adminer
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8080:8080"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net


  <span class="token key atrule">phpredisadmin</span><span class="token punctuation">:</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> redis
    <span class="token key atrule">image</span><span class="token punctuation">:</span> erikdubbelboer/phpredisadmin
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> phpredisadmin
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ADMIN_USER=admin
      <span class="token punctuation">-</span> ADMIN_PASS=pass
      <span class="token punctuation">-</span> REDIS_1_HOST=redis
      <span class="token punctuation">-</span> REDIS_1_PORT=6379
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8082:80"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>net


<span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true">#  设置网络，使当前配置中的container都处在同一个网络环境</span>
  <span class="token key atrule">app-net</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的脚本会使用自创的app-net网络，让这些应用都在同一个网路下，通过以下命令创建app-net网络：</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker network create app-net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在这个文件目录下执行<code>docker-compose up -d</code>会自动下载相关镜像。</p>
<p>第一次会自动下载相关的docker镜像，</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@aliyunhost docker<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker-compose up -d</span>
Removing mongo
Removing redis
Removing mysql
Removing adminer
Pulling mongo <span class="token punctuation">(</span>mongo:<span class="token punctuation">)</span><span class="token punctuation">..</span>.
latest: Pulling from library/mongo
6e0aa5e7af40: Pull complete
d47239a868b3: Pull complete
49cbb10cca85: Pull complete
9729d7ec22de: Pull complete
7b7fd72268d8: Pull complete
5e2934dacaf5: Pull complete
bf9da24d4b2c: Pull complete
d2f8c3715616: Pull complete
dac42b84e850: Pull complete
0724cb122c25: Pull complete
f0fe10b8b0c1: Pull complete
28e025c87f29: Pull complete
Digest: sha256:75a5f624bd6d14254e0d84c2833f576109672750aaf2bf01d61cb5ead44f4505
Status: Downloaded newer image <span class="token keyword">for</span> mongo:latest
Pulling mongo-express <span class="token punctuation">(</span>mongo-express:<span class="token punctuation">)</span><span class="token punctuation">..</span>.
latest: Pulling from library/mongo-express
839b45e0263a: Pull complete
4e998bcc33c0: Pull complete
c22cf2090e91: Pull complete
878525310d1a: Pull complete
db887bbaed1c: Pull complete
d3a58ba86626: Pull complete
d6c8e5cc21ae: Pull complete
38edb5da73d5: Pull complete
Digest: sha256:15744add870beddeab3235fc6b32c45817d73cc035fa7a51cfc0137ff99c6ee2
Status: Downloaded newer image <span class="token keyword">for</span> mongo-express:latest
Pulling redis <span class="token punctuation">(</span>redis:<span class="token punctuation">)</span><span class="token punctuation">..</span>.
latest: Pulling from library/redis
ac2522cc7269: Pull complete
b388ed2d8c47: Pull complete
bbeb7f306246: Pull complete
0274447d4995: Pull complete
599fc96d5a95: Pull complete
7acf02fb3b33: Pull complete
Digest: sha256:2d17fb90c268b1c7799234216c875490a35fe8fa13fbc5495b7247d93e77255e
Status: Downloaded newer image <span class="token keyword">for</span> redis:latest
Pulling mysql <span class="token punctuation">(</span>mysql:<span class="token punctuation">)</span><span class="token punctuation">..</span>.
latest: Pulling from library/mysql
ac2522cc7269: Already exists
3ff4d5966d00: Pull complete
c8a8e9739c9e: Pull complete
8fd773bacd12: Pull complete
adbceeecb7f3: Pull complete
6b53011e5d04: Pull complete
32ae8cea62cb: Pull complete
cf09f068015c: Pull complete
41d80f48621d: Pull complete
fa9d48194f31: Pull complete
8ea01c86a52b: Pull complete
69e9db22376c: Pull complete
Digest: sha256:00b627abbd6e91d5d0e4be786869930497b9759bf40db3f15408bb894daf5263
Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest
Pulling adminer <span class="token punctuation">(</span>adminer:<span class="token punctuation">)</span><span class="token punctuation">..</span>.
latest: Pulling from library/adminer
9aae54b2144e: Pull complete
0552190813ec: Pull complete
d6abf49ad7ff: Pull complete
4a7b791901cf: Pull complete
f2ba0fadefcb: Pull complete
636a54b61db2: Pull complete
2e4910bcf8e6: Pull complete
916259daac19: Pull complete
964bb1b3446a: Pull complete
8412ac9f0551: Pull complete
801b463cfa6c: Pull complete
830dcd0791af: Pull complete
ffd662d4e755: Pull complete
f636d4cf2f7f: Pull complete
924162d16142: Pull complete
Digest: sha256:1bf211fe728494901bba5461024fa8011182a97f8d5fbd121a19e58043e41e9e
Status: Downloaded newer image <span class="token keyword">for</span> adminer:latest
Pulling phpredisadmin <span class="token punctuation">(</span>erikdubbelboer/phpredisadmin:<span class="token punctuation">)</span><span class="token punctuation">..</span>.
latest: Pulling from erikdubbelboer/phpredisadmin
Digest: sha256:a50ff6e3ec659a9f6a5b76952e1d3bc0547caf5c63a509092a0c6ab72a2c58ca
Status: Downloaded newer image <span class="token keyword">for</span> erikdubbelboer/phpredisadmin:latest
Recreating 184e4c8c516b_mysql   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Recreating 9e802b5c3a7b_redis   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Recreating e6584843b316_adminer <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Recreating 5a633dfe60eb_mongo   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating mongo-express          <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating phpredisadmin          <span class="token punctuation">..</span>. <span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看容器运行状态</p>
<pre><code>docker ps</code></pre>
<p>显示内容如下：</p>
<pre><code>CONTAINER ID   IMAGE                          COMMAND                  CREATED         STATUS         PORTS                               NAMES
d15264f725ab   erikdubbelboer/phpredisadmin   &quot;tini -- php -S 0.0.…&quot;   2 minutes ago   Up 2 minutes   0.0.0.0:8082-&gt;80/tcp                phpredisadmin
eb74afe91d88   mongo-express                  &quot;tini -- /docker-ent…&quot;   2 minutes ago   Up 2 minutes   0.0.0.0:8081-&gt;8081/tcp              mongo-express
cf9bc31fa915   redis                          &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 2 minutes   6379/tcp, 0.0.0.0:8379-&gt;8379/tcp    redis
608b3a3fcabe   mysql                          &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 2 minutes   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql
4b78e3790fb2   adminer                        &quot;entrypoint.sh docke…&quot;   3 minutes ago   Up 2 minutes   0.0.0.0:8080-&gt;8080/tcp              adminer
3591a2841870   mongo                          &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 2 minutes   0.0.0.0:27017-&gt;27017/tcp            mongo</code></pre>
<h4 id="3-1-4-各服务安装验证"><a href="#3-1-4-各服务安装验证" class="headerlink" title="3.1.4 各服务安装验证"></a>3.1.4 各服务安装验证</h4><p>以上说明相关的服务已经启动了，端口分别是，adminer（8888），mongo-express（8081），phpredisadmin（8082），确保你的服务器对应的端口是可以访问的，如果不能访问，需要去服务器的控制台设置入站规则。如果本地启动的话直接访问就可以了。</p>
<p>mongo-express界面</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329183456.png" alt="image-20210329183456045"></p>
<p>adminer界面,登录的服务器就是在docker-compose.yml中设置的 mysql，用户是root用户，密码是MYSQL_ROOT_PASSWORD对应的密码</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329183721.png" alt="mysql配置服务名称和登录密码"></p>
<p>通过端口8080登录mysql服务：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329183840.png" alt="登录mysql"></p>
<p>登录成功后，可对mysql数据库进行增删改查，界面如下：<img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329184012.png" alt="image-20210329184012060"></p>
<p>Redis登录界面</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329184647.png" alt="Redis登录界面"></p>
<p>用户名密码参考docker-compose.yml配置文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329184747.png" alt="Redis账号密码配置文件"></p>
<p>是不是很简单，只要有这个配置文件，不管在哪，只要装好docker ，一个启动指令，一切就都搞定了。</p>
<h3 id="3-2-文件保存"><a href="#3-2-文件保存" class="headerlink" title="3.2 文件保存"></a>3.2 文件保存</h3><h4 id="3-2-1-普通文件"><a href="#3-2-1-普通文件" class="headerlink" title="3.2.1 普通文件"></a>3.2.1 普通文件</h4><p>具体步骤</p>
<table>
<thead>
<tr>
<th>操作方式</th>
<th>伪代码</th>
</tr>
</thead>
<tbody><tr>
<td>打开文件</td>
<td>&lt;变量名&gt; = open(&lt;文件名&gt;,&lt;打开模式&gt;)</td>
</tr>
<tr>
<td>关闭文件</td>
<td>&lt;变量名&gt; = close()</td>
</tr>
<tr>
<td>文件操作</td>
<td>读写：&lt;变量名&gt;.read() / &lt;变量名&gt;.write()</td>
</tr>
</tbody></table>
<p>代码如下：</p>
<p>第一行：<code>./</code>表示打开当前目录下的<code>file.txt</code>，以<code>w</code>写方式打开，文件的编码方式为<code>&#39;utf-8&#39;</code></p>
<p>第二行：向已经打开的<code>f</code>这个文件中<code>write</code>写入一个字符串<code>&quot;test&quot;</code></p>
<p>第三行：把缓存中的数据写入file.txt中并<code>close</code>关闭文件</p>
<pre class="line-numbers language-python"><code class="language-python">f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'./file.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 打开文件</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 文件操作</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 关闭文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>或上下文管理器with语句</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> open <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'./file.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf=8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>文件打开模式</p>
<table>
<thead>
<tr>
<th>文件打开模式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>‘r’</td>
<td>只读模式，默认，若文件不存在，返回FileNotFoundError</td>
</tr>
<tr>
<td>‘w’</td>
<td>覆盖写，若不存在则创建文件，存在则覆盖原文</td>
</tr>
<tr>
<td>‘x’</td>
<td>创建写，若不存在则创建文件，存在则返回FileExistsError</td>
</tr>
<tr>
<td>‘a’</td>
<td>追加写，若不存在则创建文件，存在则在文件内容后追加写</td>
</tr>
<tr>
<td>‘b’</td>
<td>二进制模式</td>
</tr>
<tr>
<td>‘t’</td>
<td>文本模式，默认值</td>
</tr>
<tr>
<td>‘+’</td>
<td>与r/w/x/a/一同使用，在原功能基础上增加同时读写功能</td>
</tr>
</tbody></table>
<p>文件读取操作函数</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.read(size=-1)</td>
<td>读入全部内容并返回，若有参数读入前size长度</td>
</tr>
<tr>
<td>.readline(size=-1)</td>
<td>读入一行内容并返回，若有参数，读入该行前size长度</td>
</tr>
<tr>
<td>.readlines(hint=-1)</td>
<td>读入所有行并返回一个列表，若有参数，读入前hint行</td>
</tr>
</tbody></table>
<p>文件写入操作函数</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.write(s)</td>
<td>写入一个字符串或字节流</td>
</tr>
<tr>
<td>.writelines(lines)</td>
<td>将一个元素全为字符串的列表拼接后，写入文件</td>
</tr>
<tr>
<td>.seek(offset)</td>
<td>改变当前文件操作指针的位置，offset含义如下:<br/>0 - 文件开头；<br/>1 - 当前位置；<br/>2 - 文件结尾。</td>
</tr>
</tbody></table>
<h4 id="3-2-2-csv文件"><a href="#3-2-2-csv文件" class="headerlink" title="3.2.2 csv文件"></a>3.2.2 csv文件</h4><p>CSV（逗号分隔值）是在电子表格和数据库中使用的非常流行的导入和导出数据格式。 CSV 文件中的每一行都是一个数据记录。 每个记录由一个或多个字段组成，用逗号分隔。 CSV 是一种非常简单的数据格式，但是可以有很多差异，例如不同的定界符，换行或引号字符。</p>
<p><strong>Python CSV 模块</strong></p>
<p><code>csv</code>模块实现用于以 CSV 格式读取和写入表格数据的类。 <code>csv</code>模块的<code>reader</code>和<code>writer</code>对象读取和写入序列。 程序员还可以使用<code>DictReader</code>和<code>DictWriter</code>类以字典形式读取和写入数据。</p>
<p><strong>Python CSV 方法</strong></p>
<p>下表显示了Python csv方法：</p>
<table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>csv.reader</code></td>
<td align="center">返回一个遍历 CSV 文件各行的读取器对象</td>
</tr>
<tr>
<td align="center"><code>csv.writer</code></td>
<td align="center">返回将数据写入 CSV 文件的写入器对象</td>
</tr>
<tr>
<td align="center"><code>csv.register_dialect</code></td>
<td align="center">注册 CSV 方言</td>
</tr>
<tr>
<td align="center"><code>csv.unregister_dialect</code></td>
<td align="center">注销 CSV 方言</td>
</tr>
<tr>
<td align="center"><code>csv.get_dialect</code></td>
<td align="center">返回具有给定名称的方言</td>
</tr>
<tr>
<td align="center"><code>csv.list_dialects</code></td>
<td align="center">返回所有已注册的方言</td>
</tr>
<tr>
<td align="center"><code>csv.field_size_limit</code></td>
<td align="center">返回解析器允许的当前最大字段大小</td>
</tr>
</tbody></table>
<p>使用 Python <code>csv</code>模块</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>要使用 Python CSV 模块，我们导入<code>csv</code>。</p>
<p><strong>Python CSV 读取器</strong></p>
<p><code>csv.reader()</code>方法返回一个读取器对象，该对象遍历给定 CSV 文件中的行。</p>
<pre class="line-numbers language-python"><code class="language-python">$ cat numbers<span class="token punctuation">.</span>csv 
<span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>numbers.csv</code>文件包含数字。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'numbers.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">for</span> e <span class="token keyword">in</span> row<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在代码示例中，我们打开<code>numbers.csv</code>进行读取并读取其内容。</p>
<pre class="line-numbers language-python"><code class="language-python">reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们得到<code>reader</code>对象。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
    <span class="token keyword">for</span> e <span class="token keyword">in</span> row<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>通过两个 for 循环，我们遍历数据。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ ./read_csv.py 
16
6
4
12
81
6
71
6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是示例的输出。</p>
<p><strong>具有不同分隔符的 Python CSV 读取器</strong></p>
<p><code>csv.reader()</code>方法允许使用带有<code>delimiter</code>属性的不同定界符。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">cat</span> items.csv 
pen<span class="token operator">|</span>cup<span class="token operator">|</span>bottle
chair<span class="token operator">|</span>book<span class="token operator">|</span>tablet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>items.csv</code>包含用“ |”分隔的值 字符。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'items.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">"|"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">for</span> e <span class="token keyword">in</span> row<span class="token punctuation">:</span>            
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该代码示例从使用’|’的 CSV 文件读取并显示数据。 定界符。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ ./read_csv2.py 
pen
cup
bottle
chair
book
tablet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是示例的输出。</p>
<p><strong>Python CSV <code>DictReader</code></strong></p>
<p><code>csv.DictReader</code>类的操作类似于常规读取器，但会将读取的信息映射到字典中。 字典的键可以使用<code>fieldnames</code>参数传入，也可以从 CSV 文件的第一行推断出来。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">cat</span> values.csv 
min,avg,max
1, 5.5, 10
2, 3.5, 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>文件的第一行包含字典键。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'values.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'avg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该示例使用<code>csv.DictReader</code>从<code>values.csv</code>文件中读取值。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'avg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>该行是 Python 字典，我们使用键引用数据。</p>
<p><strong>Python CSV 编写器</strong></p>
<p><code>csv.writer()</code>方法返回一个 writer 对象，该对象将用户数据转换为给定文件状对象上的定界字符串。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

nms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'numbers2.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> nms<span class="token punctuation">:</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该脚本将数字写入<code>numbers2.csv</code>文件。 <code>writerow()</code>方法将一行数据写入指定的文件。</p>
<pre class="line-numbers language-python"><code class="language-python">$ cat numbers2<span class="token punctuation">.</span>csv 
<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span>
<span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>一次写入所有数据是可能的。 <code>writerows()</code>方法将所有给定的行写入 CSV 文件。</p>
<pre class="line-numbers language-python"><code class="language-python">write_csv2<span class="token punctuation">.</span>py
<span class="token comment" spellcheck="true">#!/usr/bin/python3</span>

<span class="token keyword">import</span> csv

nms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'numbers3.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>

    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span>nms<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该代码示例使用<code>writerows()</code>方法将三行数字写入文件。</p>
<p><strong>Python CSV <code>DictWriter</code></strong></p>
<p><code>csv.DictWriter</code>类的操作类似于常规编写器，但将 Python 词典映射到 CSV 行。 <code>fieldnames</code>参数是一系列键，这些键标识传递给<code>writerow()</code>方法的字典中的值写入 CSV 文件的顺序。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'names.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>

    fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">]</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>fnames<span class="token punctuation">)</span>    

    writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Smith'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'Robert'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Brown'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'Julia'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Griffin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该示例使用<code>csv.DictWriter</code>将 Python 词典中的值写入 CSV 文件。</p>
<pre class="line-numbers language-python"><code class="language-python">writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>fnames<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>创建了新的<code>csv.DictWriter</code>。 标头名称将传递给<code>fieldnames</code>参数。</p>
<pre class="line-numbers language-python"><code class="language-python">writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>writeheader()</code>方法将标头写入 CSV 文件。</p>
<pre class="line-numbers language-python"><code class="language-python">writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'first_name'</span> <span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">'Smith'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Python 字典被写入 CSV 文件中的一行。</p>
<pre class="line-numbers language-python"><code class="language-python">$ cat names<span class="token punctuation">.</span>csv 
first_name<span class="token punctuation">,</span>last_name
John<span class="token punctuation">,</span>Smith
Robert<span class="token punctuation">,</span>Brown
Julia<span class="token punctuation">,</span>Griffin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是输出。</p>
<p><strong>Python CSV 自定义方言</strong></p>
<p>使用<code>csv.register_dialect()</code>方法创建自定义方言。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

csv<span class="token punctuation">.</span>register_dialect<span class="token punctuation">(</span><span class="token string">"hashes"</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">"#"</span><span class="token punctuation">)</span>

f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'items3.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> f<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dialect<span class="token operator">=</span><span class="token string">"hashes"</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"pens"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"plates"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"bottles"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"cups"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该程序使用（# ）字符作为分隔符。 使用<code>csv.writer()</code>方法中的<code>dialect</code>选项指定方言。</p>
<pre class="line-numbers language-python"><code class="language-python">$ cat items3<span class="token punctuation">.</span>csv 
pens<span class="token comment" spellcheck="true">#4</span>
plates<span class="token comment" spellcheck="true">#2</span>
bottles<span class="token comment" spellcheck="true">#4</span>
cups<span class="token comment" spellcheck="true">#1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是输出。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv

<span class="token comment" spellcheck="true"># 创建CSV文件</span>
f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'./favorite_movies.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'电影名'</span><span class="token punctuation">,</span> <span class="token string">'得分'</span><span class="token punctuation">,</span> <span class="token string">'演员'</span><span class="token punctuation">,</span> <span class="token string">'链接地址'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'机器人总动员'</span><span class="token punctuation">,</span> <span class="token number">9.3</span><span class="token punctuation">,</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'kui.ge'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-3-Mysql数据库存储"><a href="#3-3-Mysql数据库存储" class="headerlink" title="3.3 Mysql数据库存储"></a>3.3 Mysql数据库存储</h3><h4 id="3-3-1-数据库安装"><a href="#3-3-1-数据库安装" class="headerlink" title="3.3.1 数据库安装"></a>3.3.1 数据库安装</h4><p><strong>pip安装方式</strong></p>
<pre><code>pip3 install PyMySQL</code></pre>
<p><strong>git安装</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/PyMySQL/PyMySQL
<span class="token function">cd</span> PyMySQL/
python3 setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>curl命令安装</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># X.X 为 PyMySQL 的版本号</span>
curl -L https://github.com/PyMySQL/PyMySQL/tarball/pymysql-X.X <span class="token operator">|</span> <span class="token function">tar</span> xz
<span class="token function">cd</span> PyMySQL*
python3 setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>注意：</strong>请确保您有root权限来安装上述模块。</p>
<p>安装的过程中可能会出现”ImportError: No module named setuptools”的错误提示，意思是你没有安装setuptools，你可以访问<a target="_blank" href="https://pypi.python.org/pypi/setuptools" rel="external nofollow noreferrer noopener">https://pypi.python.org/pypi/setuptools</a> 找到各个系统的安装方法。</p>
<p>Linux 系统安装实例：</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">wget</span> https://bootstrap.pypa.io/ez_setup.py
$ python3 ez_setup.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="3-3-2-数据库连接"><a href="#3-3-2-数据库连接" class="headerlink" title="3.3.2 数据库连接"></a>3.3.2 数据库连接</h4><p>连接数据库前，请先确认以下事项：</p>
<ul>
<li>您已经创建了数据库 TESTDB.</li>
<li>在TESTDB数据库中您已经创建了表 EMPLOYEE</li>
<li>EMPLOYEE表字段为 FIRST_NAME, LAST_NAME, AGE, SEX 和 INCOME。</li>
<li>连接数据库TESTDB使用的用户名为 “root” ，密码为 “123456”,你可以自己设定，Mysql数据库用户授权请使用Grant命令。</li>
<li>在你的机子上已经安装了 Python PyMySQL模块。</li>
<li>如果您对sql语句不熟悉，可以参考本文正在使用的参考教程<a target="_blank" href="https://www.runoob.com/sql/sql-tutorial.html" rel="external nofollow noreferrer noopener">SQL基础教程</a></li>
</ul>
<p>连接数据库方法原型：</p>
<pre class="line-numbers language-python"><code class="language-python">pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">,</span>
    host<span class="token operator">=</span>None<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 要连接的主机地址</span>
    user<span class="token operator">=</span>None<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 用于登录的数据库用户</span>
    password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 密码</span>
    database<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># 要连接的数据库</span>
    port<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># 端口，一般为 3306</span>
    unix_socket<span class="token operator">=</span>None<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 选择是否要用unix_socket而不是TCP/IP</span>
    charset<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>         <span class="token comment" spellcheck="true"># 字符编码</span>
    sql_mode<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># Default SQL_MODE to use.</span>
    read_default_file<span class="token operator">=</span>None<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 从默认配置文件(my.ini或my.cnf)中读取参数</span>
    conv<span class="token operator">=</span>None<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 转换字典</span>
    use_unicode<span class="token operator">=</span>None<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 是否使用 unicode 编码</span>
    client_flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># Custom flags to send to MySQL. Find potential values in constants.CLIENT.</span>
    cursorclass<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pymysql.cursors.Cursor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 选择 Cursor 类型</span>
    init_command<span class="token operator">=</span>None<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 连接建立时运行的初始语句 </span>
    connect_timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 连接超时时间，(default: 10, min: 1, max: 31536000)</span>
    ssl<span class="token operator">=</span>None<span class="token punctuation">,</span>           <span class="token comment" spellcheck="true"># A dict of arguments similar to mysql_ssl_set()'s parameters.For now the capath and cipher arguments are not supported. </span>
    read_default_group<span class="token operator">=</span>None<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># Group to read from in the configuration file.</span>
    compress<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># 不支持</span>
    named_pipe<span class="token operator">=</span>None<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 不支持</span>
    no_delay<span class="token operator">=</span>None<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true"># </span>
    autocommit<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 是否自动提交事务</span>
    db<span class="token operator">=</span>None<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 同 database，为了兼容 MySQLdb</span>
    passwd<span class="token operator">=</span>None<span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 同 password，为了兼容 MySQLdb</span>
    local_infile<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 是否允许载入本地文件</span>
    max_allowed_packet<span class="token operator">=</span><span class="token number">16777216</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 限制 `LOCAL DATA INFILE` 大小</span>
    defer_connect<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># Don't explicitly connect on contruction - wait for connect call.</span>
    auth_plugin_map<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#</span>
    read_timeout<span class="token operator">=</span>None<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># </span>
    write_timeout<span class="token operator">=</span>None<span class="token punctuation">,</span> 
    bind_address<span class="token operator">=</span>None   <span class="token comment" spellcheck="true"># 当客户有多个网络接口，指定一个连接到主机</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以下实例链接 Mysql 的 TESTDB 数据库：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 cursor() 方法创建一个游标对象 cursor</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 execute()  方法执行 SQL 查询 </span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT VERSION()"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 fetchone() 方法获取单条数据.</span>
data <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Database version : %s "</span> <span class="token operator">%</span> data<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行以上脚本输出结果如下：</p>
<pre><code>Database version : 5.5.20-log</code></pre>
<h4 id="3-3-3-创建数据库表"><a href="#3-3-3-创建数据库表" class="headerlink" title="3.3.3 创建数据库表"></a>3.3.3 创建数据库表</h4><p>如果数据库连接存在我们可以使用execute()方法来为数据库创建表，如下所示创建表EMPLOYEE：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 cursor() 方法创建一个游标对象 cursor</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 execute() 方法执行 SQL，如果表存在则删除</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"DROP TABLE IF EXISTS EMPLOYEE"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用预处理语句创建表</span>
sql <span class="token operator">=</span> <span class="token triple-quoted-string string">"""CREATE TABLE EMPLOYEE (
         FIRST_NAME  CHAR(20) NOT NULL,
         LAST_NAME  CHAR(20),
         AGE INT,  
         SEX CHAR(1),
         INCOME FLOAT )"""</span>

cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-3-4-数据库插入"><a href="#3-3-4-数据库插入" class="headerlink" title="3.3.4 数据库插入"></a>3.3.4 数据库插入</h4><p>以下实例使用执行 SQL INSERT 语句向表 EMPLOYEE 插入记录：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SQL 插入语句</span>
sql <span class="token operator">=</span> <span class="token triple-quoted-string string">"""INSERT INTO EMPLOYEE(FIRST_NAME,
         LAST_NAME, AGE, SEX, INCOME)
         VALUES ('Mac', 'Mohan', 20, 'M', 2000)"""</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 执行sql语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 提交到数据库执行</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 如果发生错误则回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上例子也可以写成如下形式：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SQL 插入语句</span>
sql <span class="token operator">=</span> "INSERT INTO EMPLOYEE<span class="token punctuation">(</span>FIRST_NAME<span class="token punctuation">,</span> \
       LAST_NAME<span class="token punctuation">,</span> AGE<span class="token punctuation">,</span> SEX<span class="token punctuation">,</span> INCOME<span class="token punctuation">)</span> \
       VALUES <span class="token punctuation">(</span><span class="token string">'%s'</span><span class="token punctuation">,</span> <span class="token string">'%s'</span><span class="token punctuation">,</span>  <span class="token operator">%</span>s<span class="token punctuation">,</span>  <span class="token string">'%s'</span><span class="token punctuation">,</span>  <span class="token operator">%</span>s<span class="token punctuation">)</span>" <span class="token operator">%</span> \
       <span class="token punctuation">(</span><span class="token string">'Mac'</span><span class="token punctuation">,</span> <span class="token string">'Mohan'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 执行sql语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 执行sql语句</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以下代码使用变量向SQL语句中传递参数:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
user_id <span class="token operator">=</span> <span class="token string">"username"</span>
password <span class="token operator">=</span> <span class="token string">"password"</span>

con<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into Login values( %s,  %s)'</span> <span class="token operator">%</span> \
             <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-3-5-数据库查询"><a href="#3-3-5-数据库查询" class="headerlink" title="3.3.5 数据库查询"></a>3.3.5 数据库查询</h4><p>Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。</p>
<ul>
<li><strong>fetchone():</strong> 该方法获取下一个查询结果集。结果集是一个对象</li>
<li><strong>fetchall():</strong> 接收全部的返回结果行.</li>
<li><strong>rowcount:</strong> 这是一个只读属性，并返回执行execute()方法后影响的行数。</li>
</ul>
<p>查询EMPLOYEE表中salary（工资）字段大于1000的所有数据：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SQL 查询语句</span>
sql <span class="token operator">=</span> "SELECT <span class="token operator">*</span> FROM EMPLOYEE \
       WHERE INCOME <span class="token operator">></span> <span class="token operator">%</span>s" <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 获取所有记录列表</span>
   results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">:</span>
      fname <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      lname <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      age <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
      sex <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
      income <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
       <span class="token comment" spellcheck="true"># 打印结果</span>
      <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"fname=%s,lname=%s,age=%s,sex=%s,income=%s"</span> <span class="token operator">%</span> \
             <span class="token punctuation">(</span>fname<span class="token punctuation">,</span> lname<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> income <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Error: unable to fetch data"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上脚本执行结果如下：</p>
<pre><code>fname=Mac, lname=Mohan, age=20, sex=M, income=2000</code></pre>
<h4 id="3-3-6-数据库更新"><a href="#3-3-6-数据库更新" class="headerlink" title="3.3.6 数据库更新"></a>3.3.6 数据库更新</h4><p>更新操作用于更新数据表的的数据，以下实例将 TESTDB 表中 SEX 为 ‘M’ 的 AGE 字段递增 1：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SQL 更新语句</span>
sql <span class="token operator">=</span> <span class="token string">"UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = '%c'"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 提交到数据库执行</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-3-7-数据库删除"><a href="#3-3-7-数据库删除" class="headerlink" title="3.3.7 数据库删除"></a>3.3.7 数据库删除</h4><p>删除操作用于删除数据表中的数据，以下实例演示了删除数据表 EMPLOYEE 中 AGE 大于 20 的所有数据：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql

<span class="token comment" spellcheck="true"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"testuser"</span><span class="token punctuation">,</span><span class="token string">"test123"</span><span class="token punctuation">,</span><span class="token string">"TESTDB"</span> <span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用cursor()方法获取操作游标 </span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># SQL 删除语句</span>
sql <span class="token operator">=</span> <span class="token string">"DELETE FROM EMPLOYEE WHERE AGE > %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 提交修改</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 关闭连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-3-8-执行事务"><a href="#3-3-8-执行事务" class="headerlink" title="3.3.8 执行事务"></a>3.3.8 执行事务</h4><p>事务机制可以确保数据一致性。</p>
<p>事务应该具有4个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。</p>
<ul>
<li>原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。</li>
<li>一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。</li>
<li>隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</li>
<li>持久性（durability）。持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。</li>
</ul>
<p>Python DB API 2.0 的事务提供了两个方法 commit 或 rollback。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># SQL删除记录语句</span>
sql <span class="token operator">=</span> <span class="token string">"DELETE FROM EMPLOYEE WHERE AGE > %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 向数据库提交</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 发生错误时回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于支持事务的数据库， 在Python数据库编程中，当游标建立之时，就自动开始了一个隐形的数据库事务。</p>
<p>commit()方法游标的所有更新操作，rollback（）方法回滚当前游标的所有操作。每一个方法都开始了一个新的事务。</p>
<h4 id="3-3-9-错误处理"><a href="#3-3-9-错误处理" class="headerlink" title="3.3.9 错误处理"></a>3.3.9 错误处理</h4><p>DB API中定义了一些数据库操作的错误及异常，下表列出了这些错误和异常:</p>
<table>
<thead>
<tr>
<th align="left">异常</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Warning</td>
<td align="left">当有严重警告时触发，例如插入数据是被截断等等。必须是 StandardError 的子类。</td>
</tr>
<tr>
<td align="left">Error</td>
<td align="left">警告以外所有其他错误类。必须是 StandardError 的子类。</td>
</tr>
<tr>
<td align="left">InterfaceError</td>
<td align="left">当有数据库接口模块本身的错误（而不是数据库的错误）发生时触发。 必须是Error的子类。</td>
</tr>
<tr>
<td align="left">DatabaseError</td>
<td align="left">和数据库有关的错误发生时触发。 必须是Error的子类。</td>
</tr>
<tr>
<td align="left">DataError</td>
<td align="left">当有数据处理时的错误发生时触发，例如：除零错误，数据超范围等等。 必须是DatabaseError的子类。</td>
</tr>
<tr>
<td align="left">OperationalError</td>
<td align="left">指非用户控制的，而是操作数据库时发生的错误。例如：连接意外断开、 数据库名未找到、事务处理失败、内存分配错误等等操作数据库是发生的错误。 必须是DatabaseError的子类。</td>
</tr>
<tr>
<td align="left">IntegrityError</td>
<td align="left">完整性相关的错误，例如外键检查失败等。必须是DatabaseError子类。</td>
</tr>
<tr>
<td align="left">InternalError</td>
<td align="left">数据库的内部错误，例如游标（cursor）失效了、事务同步失败等等。 必须是DatabaseError子类。</td>
</tr>
<tr>
<td align="left">ProgrammingError</td>
<td align="left">程序错误，例如数据表（table）没找到或已存在、SQL语句语法错误、 参数数量错误等等。必须是DatabaseError的子类。</td>
</tr>
<tr>
<td align="left">NotSupportedError</td>
<td align="left">不支持错误，指使用了数据库不支持的函数或API等。例如在连接对象上 使用.rollback()函数，然而数据库并不支持事务或者事务已关闭。 必须是DatabaseError的子类。</td>
</tr>
</tbody></table>
<h3 id="3-4-MongoDB数据库存储"><a href="#3-4-MongoDB数据库存储" class="headerlink" title="3.4 MongoDB数据库存储"></a>3.4 MongoDB数据库存储</h3><p>MongoDB 是目前最流行的 NoSQL 数据库之一，使用的数据类型 BSON（类似 JSON）。</p>
<p>MongoDB 官网地址：<a target="_blank" href="https://www.mongodb.com/" rel="external nofollow noreferrer noopener">https://www.mongodb.com/</a></p>
<p>MongoDB 官方英文文档：<a target="_blank" href="https://docs.mongodb.com/manual/" rel="external nofollow noreferrer noopener">https://docs.mongodb.com/manual/</a></p>
<p>MongoDB 各平台下载地址：<a target="_blank" href="https://www.mongodb.com/download-center#community" rel="external nofollow noreferrer noopener">https://www.mongodb.com/download-center#community</a></p>
<h4 id="3-4-1-创建数据库"><a href="#3-4-1-创建数据库" class="headerlink" title="3.4.1 创建数据库"></a>3.4.1 创建数据库</h4><p>可以通过以下的方式创建数据库，并创建出数据库中的集合。需要注意的是，只有增加数据后，数据库才会真正的创建。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 创建数据库</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置数据库名</span>
<span class="token comment" spellcheck="true"># 创建集合</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-4-2-数据库添加数据"><a href="#3-4-2-数据库添加数据" class="headerlink" title="3.4.2 数据库添加数据"></a>3.4.2 数据库添加数据</h4><p>MongoDB 中的一个文档类似 SQL 表中的一条记录。</p>
<p><strong>插入集合</strong></p>
<p>集合中插入文档使用 <strong>insert_one()</strong> 方法，该方法的第一参数是字典 <strong>name =&gt; value</strong> 对。</p>
<p>以下实例向 <strong>sets</strong> 集合中插入文档：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

dict <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mongdb插入测试"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://kui.ge"</span> <span class="token punctuation">}</span>

x <span class="token operator">=</span> sets<span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span>dict<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行输出结果如下，返回的是一个_id字段，<strong>insert_one()</strong> 方法返回 <strong>InsertOneResult</strong> 对象，该对象包含 <strong>inserted_id</strong> 属性，它是插入文档的 <strong>id</strong> 值。</p>
<pre><code>&lt;pymongo.results.InsertOneResult object at 0x04862F58&gt;</code></pre>
<p><strong>插入多个文档</strong></p>
<p>集合中插入多个文档使用 <strong>insert_many()</strong> 方法，该方法的第一参数是字典列表。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Taobao"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.taobao.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"QQ"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"101"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.qq.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Facebook"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.facebook.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"知乎"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"103"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.zhihu.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Github"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"109"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://www.github.com"</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

x <span class="token operator">=</span> sets<span class="token punctuation">.</span>insert_many<span class="token punctuation">(</span>list<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出插入的所有文档对应的 _id 值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>inserted_ids<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果类似如下：</p>
<pre><code>[ObjectId(&#39;607c3705e4a349efbcb257cc&#39;), ObjectId(&#39;607c3705e4a349efbcb257cd&#39;), ObjectId(&#39;607c3705e4a349efbcb257ce&#39;), ObjectId(&#39;607c3705e4a349efbcb257cf&#39;), ObjectId(&#39;607c3705e4a349efbcb257d0&#39;)]</code></pre>
<p><strong>insert_many()</strong> 方法返回 <strong>InsertManyResult</strong> 对象，该对象包含 <strong>inserted_ids</strong> 属性，该属性保存着所有插入文档的 <strong>id</strong> 值。</p>
<p><strong>插入指定 _id 的多个文档</strong></p>
<p>我们也可以自己指定 id插入，以下实例我们在 sets 集合中插入数据，<strong>_id</strong> 为我们指定的：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"马斯克"</span><span class="token punctuation">,</span> <span class="token string">"company"</span><span class="token punctuation">:</span> <span class="token string">"spaceX"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"乔布斯"</span><span class="token punctuation">,</span> <span class="token string">"company"</span><span class="token punctuation">:</span> <span class="token string">"苹果"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"瓦力"</span><span class="token punctuation">,</span> <span class="token string">"company"</span><span class="token punctuation">:</span> <span class="token string">"机器人总动员"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
x <span class="token operator">=</span> sets<span class="token punctuation">.</span>insert_many<span class="token punctuation">(</span>list<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出插入的所有文档对应的 _id 值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>inserted_ids<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打开mongodb数据库查看内容如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418215151.png" alt="image-20210418215151528"></p>
<h4 id="3-4-3-查询数据"><a href="#3-4-3-查询数据" class="headerlink" title="3.4.3 查询数据"></a>3.4.3 查询数据</h4><p>MongoDB 中使用了 find 和 find_one 方法来查询集合中的数据，它类似于 SQL 中的 SELECT 语句。</p>
<p><strong>查询一条数据</strong></p>
<p>我们可以使用 <strong>find_one()</strong> 方法来查询集合中的一条数据。</p>
<p>查询 <strong>sets</strong> 文档中的第一条数据：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

x <span class="token operator">=</span> sets<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>查询集合中所有数据</strong></p>
<p><strong>find()</strong> 方法可以查询集合中的所有数据，类似 SQL 中的 <strong>SELECT *</strong> 操作。</p>
<p>以下实例查找 <strong>sets</strong> 集合中的所有数据：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257ce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'103'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257d0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'109'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'spaceX'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'苹果'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>查询指定字段的数据</strong></p>
<p>除了 _id 之外，不能同时在find中的一个对象中指定 0 和 1，如果你设置了一个字段为 0，则其他都为 1，反之亦然。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输入结果如下，可以看到只显示name和url字段，其他字段不会显示。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>根据指定条件查询</strong></p>
<p>我们可以在 <strong>find()</strong> 中设置参数来过滤数据。</p>
<p>以下实例查找 name 字段为 “瓦力” 的数据：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"瓦力"</span> <span class="token punctuation">}</span>
doc <span class="token operator">=</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span>query<span class="token punctuation">)</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> doc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显示结果如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="3-4-4-修改数据"><a href="#3-4-4-修改数据" class="headerlink" title="3.4.4 修改数据"></a>3.4.4 修改数据</h4><p>在 MongoDB 中使用 <strong>update_one()</strong> 方法修改文档中的记录。该方法第一个参数为查询的条件，第二个参数为要修改的字段。如果查找到的匹配数据多于一条，则只会修改第一条。</p>
<p>测试数据内容：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257ce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'103'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257d0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'109'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'spaceX'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'苹果'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以下示例将 alexa 字段的值 100 改为 99:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"100"</span> <span class="token punctuation">}</span>
new <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"$set"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"99"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

sets<span class="token punctuation">.</span>update_one<span class="token punctuation">(</span>query<span class="token punctuation">,</span> new<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出修改后的  "sets"  集合</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"99"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显示结果为：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Taobao'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'99'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.taobao.com'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>update_one()</strong> 方法只能修匹配到的第一条记录，如果要修改所有匹配到的记录，可以使用 **update_many()**。</p>
<p>以下实例将查找所有以 <strong>F</strong> 开头的 <strong>name</strong> 字段，并将匹配到所有记录的 <strong>alexa</strong> 字段修改为 <strong>123</strong>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"$regex"</span><span class="token punctuation">:</span> <span class="token string">"^F"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
new <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"$set"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"alexa"</span><span class="token punctuation">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

x <span class="token operator">=</span> sets<span class="token punctuation">.</span>update_many<span class="token punctuation">(</span>query<span class="token punctuation">,</span> new<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>modified_count<span class="token punctuation">,</span> <span class="token string">"文档已修改"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显示结果为：</p>
<pre><code>1 文档已修改</code></pre>
<h4 id="3-4-5-排序数据"><a href="#3-4-5-排序数据" class="headerlink" title="3.4.5 排序数据"></a>3.4.5 排序数据</h4><p><strong>sort()</strong> 方法可以指定升序或降序排序。</p>
<p><strong>sort()</strong> 方法第一个参数为要排序的字段，第二个字段指定排序规则，<strong>1</strong> 为升序，**-1** 为降序，默认为升序。</p>
<p>对字段 alexa 按升序排序：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 升序排列</span>
doc <span class="token operator">=</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">"alexa"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 降序排列</span>
<span class="token comment" spellcheck="true"># doc = sets.find().sort("alexa", -1)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> doc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-4-6-删除数据"><a href="#3-4-6-删除数据" class="headerlink" title="3.4.6 删除数据"></a>3.4.6 删除数据</h4><p>我们可以使用 <strong>delete_one()</strong> 方法来删除一个文档，该方法第一个参数为查询对象，指定要删除哪些数据。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Taobao"</span> <span class="token punctuation">}</span>
sets<span class="token punctuation">.</span>delete_one<span class="token punctuation">(</span>query<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 删除后输出</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显示结果为：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c35e59d469363d21d8791'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'mongdb插入测试'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://kui.ge'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.qq.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257ce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Facebook'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.facebook.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257cf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'知乎'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'103'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">'607c3705e4a349efbcb257d0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> <span class="token string">'alexa'</span><span class="token punctuation">:</span> <span class="token string">'109'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://www.github.com'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'马斯克'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'spaceX'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'苹果'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'瓦力'</span><span class="token punctuation">,</span> <span class="token string">'company'</span><span class="token punctuation">:</span> <span class="token string">'机器人总动员'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>删除多个文档</strong></p>
<p>我们可以使用 <strong>delete_many()</strong> 方法来删除多个文档，该方法第一个参数为查询对象，指定要删除哪些数据。</p>
<p>删除所有 name 字段中以 F 开头的文档:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

query <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"$regex"</span><span class="token punctuation">:</span> <span class="token string">"^F"</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
x <span class="token operator">=</span> sets<span class="token punctuation">.</span>delete_many<span class="token punctuation">(</span>query<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>deleted_count<span class="token punctuation">,</span> <span class="token string">"个文档已删除"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<pre><code>1 个文档已删除</code></pre>
<p>删除集合中的所有文档</p>
<p><strong>delete_many()</strong> 方法如果传入的是一个空的查询对象，则会删除集合中的所有文档：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

x <span class="token operator">=</span> sets<span class="token punctuation">.</span>delete_many<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>deleted_count<span class="token punctuation">,</span> <span class="token string">"个文档已删除"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果为：</p>
<pre><code>7 个文档已删除</code></pre>
<hr>
<p><strong>删除集合</strong></p>
<p>我们可以使用 <strong>drop()</strong> 方法来删除一个集合。</p>
<p>以下实例删除了<strong>sets</strong>集合：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymongo

client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.1.100'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">"db"</span><span class="token punctuation">]</span>
sets <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">"sets"</span><span class="token punctuation">]</span>

<span class="token keyword">if</span> sets<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'删除失败'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-5-Redis键值对数据存储"><a href="#3-5-Redis键值对数据存储" class="headerlink" title="3.5 Redis键值对数据存储"></a>3.5 Redis键值对数据存储</h3><p>redis 是一个 Key-Value 数据库，Value 支持 string(字符串)，list(列表)，set(集合)，zset(有序集合)，hash(哈希类型)等类型。</p>
<h4 id="3-5-1-redis连接"><a href="#3-5-1-redis连接" class="headerlink" title="3.5.1 redis连接"></a>3.5.1 redis连接</h4><blockquote>
<p>redis提供两个类Redis和StrictRedis用于实现Redis的命令，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py。</p>
</blockquote>
<blockquote>
<p>redis连接实例是线程安全的，可以直接将redis连接实例设置为一个全局变量，直接使用。如果需要另一个Redis实例（or Redis数据库）时，就需要重新创建redis连接实例来获取一个新的连接。同理，python的redis没有实现select命令。</p>
</blockquote>
<p>安装redis</p>
<pre class="line-numbers language-undefined"><code class="language-undefined">pip install redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>连接redis，加上decode_responses=True，写入的键值对中的value为str类型，不加这个参数写入的则为字节类型。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis   <span class="token comment" spellcheck="true"># 导入redis模块，通过python操作redis 也可以直接在redis主机的服务端操作缓存数据库</span>

r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># host是redis主机，需要redis服务端和客户端都启动 redis默认端口是6379</span>
r<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'junxi'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># key是"foo" value是"bar" 将键值对存入redis缓存</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 取出键name对应的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-5-2-连接池"><a href="#3-5-2-连接池" class="headerlink" title="3.5.2 连接池"></a>3.5.2 连接池</h4><blockquote>
<p>redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。<br> 可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池</p>
</blockquote>
<p>连接池</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis    <span class="token comment" spellcheck="true"># 导入redis模块，通过python操作redis 也可以直接在redis主机的服务端操作缓存数据库</span>

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># host是redis主机，需要redis服务端和客户端都起着 redis默认端口是6379</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># key是"gender" value是"male" 将键值对存入redis缓存</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># gender 取出键male对应的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-5-3-redis基本命令-String"><a href="#3-5-3-redis基本命令-String" class="headerlink" title="3.5.3 redis基本命令 String"></a>3.5.3 redis基本命令 String</h4><p>在Redis中设置值，默认，不存在则创建，存在则修改</p>
<pre class="line-numbers language-python"><code class="language-python">set<span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> ex<span class="token operator">=</span>None<span class="token punctuation">,</span> px<span class="token operator">=</span>None<span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> xx<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>参数：</p>
<pre><code>ex，过期时间（秒）
px，过期时间（毫秒）
nx，如果设置为True，则只有name不存在时，当前set操作才执行
xx，如果设置为True，则只有name存在时，当前set操作才执行</code></pre>
<ol>
<li>ex，过期时间（秒） 这里过期时间是3秒，3秒后p，键food的值就变成None</li>
</ol>
<pre class="line-numbers language-dart"><code class="language-dart"><span class="token keyword">import</span> redis

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">,</span> <span class="token string">'mutton'</span><span class="token punctuation">,</span> ex<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>    # key是<span class="token string">"food"</span> value是<span class="token string">"mutton"</span> 将键值对存入redis缓存
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # mutton 取出键food对应的值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>px，过期时间（豪秒） 这里过期时间是3豪秒，3毫秒后，键foo的值就变成None</li>
</ol>
<pre class="line-numbers language-dart"><code class="language-dart"><span class="token keyword">import</span> redis

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">,</span> <span class="token string">'beef'</span><span class="token punctuation">,</span> px<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>nx，如果设置为True，则只有name不存在时，当前set操作才执行 （新建）</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">,</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># True--不存在</span>
<span class="token comment" spellcheck="true"># 如果键fruit不存在，那么输出是True；如果键fruit已经存在，输出是None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li>xx，如果设置为True，则只有name存在时，当前set操作才执行 （修改）</li>
</ol>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">,</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> xx<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token shell-comment comment"># True--已经存在</span>
<span class="token shell-comment comment"># 如果键fruit已经存在，那么输出是True；如果键fruit不存在，输出是None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="5">
<li><p>setnx(name, value)</p>
<p> 设置值，只有name不存在时，执行设置操作（添加）</p>
</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.setnx<span class="token punctuation">(</span><span class="token string">'fruit1'</span>, <span class="token string">'banana'</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># fruit1不存在，输出为True</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="6">
<li>setex(name, time, value)<br>  设置值，参数：<br>  time，过期时间（数字秒 或 timedelta对象）</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span>setex<span class="token punctuation">(</span><span class="token string">"fruit2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'fruit2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 5秒后，取值就从orange变成None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="7">
<li>psetex(name, time_ms, value)<br>  设置值，参数：<br>  time_ms，过期时间（数字毫秒 或 timedelta对象）</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.psetex<span class="token punctuation">(</span><span class="token string">"fruit3"</span>, 5000, <span class="token string">"apple"</span><span class="token punctuation">)</span>
time.sleep<span class="token punctuation">(</span>5<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">'fruit3'</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 5000毫秒后，取值就从apple变成None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="8">
<li>mset(*args, **kwargs)<br>  批量设置值，如：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.mget<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'k1'</span><span class="token keyword">:</span> <span class="token string">'v1'</span>, <span class="token string">'k2'</span><span class="token keyword">:</span> <span class="token string">'v2'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
r.mset<span class="token punctuation">(</span>k1<span class="token operator">=</span><span class="token string">"v1"</span>, k2<span class="token operator">=</span><span class="token string">"v2"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 这里k1 和k2 不能带引号 一次设置对个键值对</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"k1"</span>, <span class="token string">"k2"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 一次取出多个键对应的值</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="9">
<li>mget(keys, *args)<br>  批量获取，如：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">'k1'</span>, <span class="token string">'k2'</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'k1'</span>, <span class="token string">'k2'</span><span class="token punctuation">]</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"fruit"</span>, <span class="token string">"fruit1"</span>, <span class="token string">"fruit2"</span>, <span class="token string">"k1"</span>, <span class="token string">"k2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 将目前redis缓存中的键对应的值批量取出来</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="10">
<li><p>getset(name, value)</p>
<p>设置新值并获取原来的值</p>
</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.getset<span class="token punctuation">(</span><span class="token string">"food"</span>, <span class="token string">"barbecue"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 设置的新值是barbecue 设置前的值是beef</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="11">
<li>getrange(key, start, end)<br> 获取子序列（根据字节获取，非字符）<br> 参数：<br> name，Redis 的 name<br> start，起始位置（字节）<br> end，结束位置（字节）<br> 如： “君惜大大” ，0-3表示 “君”</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.set<span class="token punctuation">(</span><span class="token string">"cn_name"</span>, <span class="token string">"君惜大大"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 汉字</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"cn_name"</span>, 0, 2<span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 取索引号是0-2 前3位的字节 君 切片操作 （一个汉字3个字节 1个字母一个字节 每个字节8bit）</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"cn_name"</span>, 0, -1<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 取所有的字节 君惜大大 切片操作</span>
r.set<span class="token punctuation">(</span><span class="token string">"en_name"</span>,<span class="token string">"junxi"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 字母</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"en_name"</span>, 0, 2<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 取索引号是0-2 前3位的字节 jun 切片操作 （一个汉字3个字节 1个字母一个字节 每个字节8bit）</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"en_name"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取所有的字节 junxi 切片操作</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="12">
<li>setrange(name, offset, value)<br> 修改字符串内容，从指定字符串索引开始向后替换（新值太长时，则向后添加）<br> 参数：<br> offset，字符串的索引，字节（一个汉字三个字节）<br> value，要设置的值</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.setrange<span class="token punctuation">(</span><span class="token string">"en_name"</span>, 1, <span class="token string">"ccc"</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">"en_name"</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># jccci 原始值是junxi 从索引号是1开始替换成ccc 变成 jccci</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="13">
<li>setbit(name, offset, value)<br> 对name对应值的二进制表示的位进行操作<br> 参数：<br> name，redis的name<br> offset，位的索引（将值变换成二进制后再进行索引）<br> value，值只能是 1 或 0</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">注：如果在Redis中有一个对应： n1 <span class="token operator">=</span> <span class="token string">"foo"</span>，
那么字符串foo的二进制表示为：01100110 01101111 01101111
所以，如果执行 setbit<span class="token punctuation">(</span><span class="token string">'n1'</span>, 7, 1<span class="token punctuation">)</span>，则就会将第7位设置为1，
那么最终二进制则变成 01100111 01101111 01101111，即：<span class="token string">"goo"</span>

扩展，转换二进制表示：
<span class="token function">source</span> <span class="token operator">=</span> <span class="token string">"陈思维"</span>
<span class="token function">source</span> <span class="token operator">=</span> <span class="token string">"foo"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> source:
num <span class="token operator">=</span> ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
print bin<span class="token punctuation">(</span>num<span class="token punctuation">)</span>.replace<span class="token punctuation">(</span><span class="token string">'b'</span>,<span class="token string">''</span><span class="token punctuation">)</span>
特别的，如果source是汉字 <span class="token string">"陈思维"</span>怎么办？
答：对于utf-8，每一个汉字占 3 个字节，那么 <span class="token string">"陈思维"</span> 则有 9个字节
对于汉字，for循环时候会按照 字节 迭代，那么在迭代时，将每一个字节转换 十进制数，然后再将十进制数转换成二进制
11100110 10101101 10100110 11100110 10110010 10011011 11101001 10111101 10010000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="14">
<li>getbit(name, offset)<br> 获取name对应的值的二进制表示中的某位的值 （0或1）</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.getbit<span class="token punctuation">(</span><span class="token string">"foo1"</span>, 0<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 0 foo1 对应的二进制 4个字节 32位 第0位是0还是1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="15">
<li>bitcount(key, start=None, end=None)<br> 获取name对应的值的二进制表示中 1 的个数<br> 参数：<br> key，Redis的name<br> start 字节起始位置<br> end，字节结束位置</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># goo1 01100111</span>
print<span class="token punctuation">(</span>r.bitcount<span class="token punctuation">(</span><span class="token string">"foo"</span>,0,1<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 11 表示前2个字节中，1出现的个数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="16">
<li><p>bitop(operation, dest, *keys)<br> 获取多个值，并将值做位运算，将最后的结果保存至新的name对应的值</p>
<p>参数：<br> operation,AND（并） 、 OR（或） 、 NOT（非） 、 XOR（异或）<br> dest, 新的Redis的name<br> *keys,要查找的Redis的name</p>
</li>
</ol>
<p>如：</p>
<pre class="line-numbers language-bash"><code class="language-bash">bitop<span class="token punctuation">(</span><span class="token string">"AND"</span>, <span class="token string">'new_name'</span>, <span class="token string">'n1'</span>, <span class="token string">'n2'</span>, <span class="token string">'n3'</span><span class="token punctuation">)</span>
获取Redis中n1,n2,n3对应的值，然后讲所有的值做位运算（求并集），然后将结果保存 new_name 对应的值中
r.set<span class="token punctuation">(</span><span class="token string">"foo"</span>,<span class="token string">"1"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0110001</span>
r.set<span class="token punctuation">(</span><span class="token string">"foo1"</span>,<span class="token string">"2"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0110010</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"foo"</span>,<span class="token string">"foo1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># ['goo1', 'baaanew']</span>
print<span class="token punctuation">(</span>r.bitop<span class="token punctuation">(</span><span class="token string">"AND"</span>,<span class="token string">"new"</span>,<span class="token string">"foo"</span>,<span class="token string">"foo1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># "new" 0 0110000</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"foo"</span>,<span class="token string">"foo1"</span>,<span class="token string">"new"</span><span class="token punctuation">))</span>

<span class="token function">source</span> <span class="token operator">=</span> <span class="token string">"12"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> source:
num <span class="token operator">=</span> ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>num<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 打印每个字母字符或者汉字字符对应的ascii码值 f-102-0b100111-01100111</span>
print<span class="token punctuation">(</span>bin<span class="token punctuation">(</span>num<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 打印每个10进制ascii码值转换成二进制的值 0b1100110（0b表示二进制）</span>
print bin<span class="token punctuation">(</span>num<span class="token punctuation">)</span>.replace<span class="token punctuation">(</span><span class="token string">'b'</span>,<span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 将二进制0b1100110替换成01100110</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="17">
<li>strlen(name)<br> 返回name对应值的字节长度（一个汉字3个字节）</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.strlen<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 4 'goo1'的长度是4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="18">
<li>incr(self, name, amount=1)<br> 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。<br> 参数：<br> name,Redis的name<br> amount,自增数（必须是整数）<br> 注：同incrby</li>
</ol>
<pre class="line-numbers language-dart"><code class="language-dart">r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>应用场景 – 页面点击数<br> 假定我们对一系列页面需要记录点击次数。例如论坛的每个帖子都要记录点击次数，而点击次数比回帖的次数的多得多。如果使用关系数据库来存储点击，可能存在大量的行级锁争用。所以，点击数的增加使用redis的INCR命令最好不过了。<br> 当redis服务器启动时，可以从关系数据库读入点击数的初始值（12306这个页面被访问了34634次）</p>
<pre class="line-numbers language-css"><code class="language-css">r<span class="token number">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span>, <span class="token number">34634</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token number">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>每当有一个页面点击，则使用INCR增加点击数即可。</p>
<pre class="line-numbers language-css"><code class="language-css">r<span class="token number">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span>
r<span class="token number">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>页面载入的时候则可直接获取这个值</p>
<pre class="line-numbers language-css"><code class="language-css"><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token number">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"visit:12306:totals"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="19">
<li>incrbyfloat(self, name, amount=1.0)<br> 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。<br> 参数：<br> name,Redis的name<br> amount,自增数（浮点型）</li>
</ol>
<pre class="line-numbers language-dart"><code class="language-dart">r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"123.0"</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"foo2"</span><span class="token punctuation">,</span> <span class="token string">"221.0"</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">incrbyfloat</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">incrbyfloat</span><span class="token punctuation">(</span><span class="token string">"foo2"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">3.0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">,</span> <span class="token string">"foo2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="20">
<li>decr(self, name, amount=1)<br> 自减 name对应的值，当name不存在时，则创建name＝amount，否则，则自减。<br> 参数：<br> name,Redis的name<br> amount,自减数（整数)</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.decr<span class="token punctuation">(</span><span class="token string">"foo4"</span>, amount<span class="token operator">=</span>3<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 递减3</span>
r.decr<span class="token punctuation">(</span><span class="token string">"foo1"</span>, amount<span class="token operator">=</span>1<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 递减1</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"foo1"</span>, <span class="token string">"foo4"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="21">
<li>append(key, value)<br> 在redis name对应的值后面追加内容<br> 参数：<br> key, redis的name<br> value, 要追加的字符串</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.append<span class="token punctuation">(</span><span class="token string">"name"</span>, <span class="token string">"haha"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 在name对应的值junxi后面追加字符串haha</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="3-5-4-redis基本命令-hash"><a href="#3-5-4-redis基本命令-hash" class="headerlink" title="3.5.4 redis基本命令 hash"></a>3.5.4 redis基本命令 hash</h4><ol>
<li>单个增加–修改(单个取出)–没有就新增，有的话就修改<br>  hset(name, key, value)<br>  name对应的hash中设置一个键值对（不存在，则创建；否则，修改）<br>  参数：<br>  name，redis的name<br>  key，name对应的hash中的key<br>  value，name对应的hash中的value<br>  注：<br>  hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>

r<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"v1"</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">,</span> <span class="token string">"v2"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hkeys<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 取hash中所有的key</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 单个取hash的key对应的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hmget<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 多个取hash的key对应的值</span>
r<span class="token punctuation">.</span>hsetnx<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">,</span> <span class="token string">"v3"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 只能新建</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>批量增加（取出）<br>  hmset(name, mapping)<br>  在name对应的hash中批量设置键值对<br>  参数：<br>  name，redis的name<br>  mapping，字典，如：{‘k1’:’v1’, ‘k2’: ‘v2’}<br>  如：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.hmset<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token punctuation">{</span><span class="token string">"k2"</span><span class="token keyword">:</span> <span class="token string">"v2"</span>, <span class="token string">"k3"</span><span class="token keyword">:</span> <span class="token string">"v3"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li><p>获取结果</p>
<p> hget(name,key)<br>  在name对应的hash中获取根据key获取value<br>  hmget(name, keys, *args)<br>  在name对应的hash中获取多个key的值<br>  参数：<br>  name，reids对应的name<br>  keys，要获取key集合，如：[‘k1’, ‘k2’, ‘k3’]<br>  *args，要获取的key，如：k1,k2,k3<br>  如：</p>
</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hget<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token string">"k2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 单个取出"hash2"的key-k2对应的value</span>
print<span class="token punctuation">(</span>r.hmget<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token string">"k2"</span>, <span class="token string">"k3"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 批量取出"hash2"的key-k2 k3对应的value --方式1</span>
print<span class="token punctuation">(</span>r.hmget<span class="token punctuation">(</span><span class="token string">"hash2"</span>, <span class="token punctuation">[</span><span class="token string">"k2"</span>, <span class="token string">"k3"</span><span class="token punctuation">]</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 批量取出"hash2"的key-k2 k3对应的value --方式2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li>取出所有的键值对<br>  hgetall(name)<br>  获取name对应hash的所有键值</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="5">
<li>得到所有键值对的格式 hash长度<br>  hlen(name)<br>  获取name对应的hash中键值对的个数</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hlen<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="6">
<li>得到所有的keys（类似字典的取所有keys）<br>  hkeys(name)<br>  获取name对应的hash中所有的key的值</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hkeys<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="7">
<li>得到所有的value（类似字典的取所有value）<br>  hvals(name)<br>  获取name对应的hash中所有的value的值</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hvals<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="8">
<li>判断成员是否存在（类似字典的in）<br>  hexists(name, key)<br>  检查name对应的hash是否存在当前传入的key</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hexists<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k4"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># False 不存在</span>
print<span class="token punctuation">(</span>r.hexists<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># True 存在</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="9">
<li>删除键值对<br>  hdel(name,*keys)<br>  将name对应的hash中指定key的键值对删除</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>
r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k2"</span>, <span class="token string">"v222"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 修改已有的key k2</span>
r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k11"</span>, <span class="token string">"v1"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 新增键值对 k11</span>
r.hdel<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k1"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除一个键值对</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="10">
<li>自增自减整数(将key对应的value–整数 自增1或者2，或者别的整数 负数就是自减)<br> hincrby(name, key, amount=1)<br> 自增name对应的hash中的指定key的值，不存在则创建key=amount<br> 参数：<br> name，redis中的name<br> key， hash对应的key<br> amount，自增数（整数）</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k3"</span>, 123<span class="token punctuation">)</span>
r.hincrby<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k3"</span>, amount<span class="token operator">=</span>-1<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>
r.hincrby<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k4"</span>, amount<span class="token operator">=</span>1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 不存在的话，value默认就是1</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="11">
<li>自增自减浮点数(将key对应的value–浮点数 自增1.0或者2.0，或者别的浮点数 负数就是自减)<br> hincrbyfloat(name, key, amount=1.0)<br> 自增name对应的hash中的指定key的值，不存在则创建key=amount<br> 参数：<br> name，redis中的name<br> key， hash对应的key<br> amount，自增数（浮点数）<br> 自增name对应的hash中的指定key的值，不存在则创建key=amount</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.hset<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k5"</span>, <span class="token string">"1.0"</span><span class="token punctuation">)</span>
r.hincrbyfloat<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k5"</span>, amount<span class="token operator">=</span>-1.0<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 已经存在，递减-1.0</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>
r.hincrbyfloat<span class="token punctuation">(</span><span class="token string">"hash1"</span>, <span class="token string">"k6"</span>, amount<span class="token operator">=</span>-1.0<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 不存在，value初始值是-1.0 每次递减1.0</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="12">
<li>取值查看–分片读取<br> hscan(name, cursor=0, match=None, count=None)<br> 增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而放置内存被撑爆<br> 参数：<br> name，redis的name<br> cursor，游标（基于游标分批取获取数据）<br> match，匹配指定key，默认None 表示所有的key<br> count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数<br> 如：<br> 第一次：cursor1, data1 = r.hscan(‘xx’, cursor=0, match=None, count=None)<br> 第二次：cursor2, data1 = r.hscan(‘xx’, cursor=cursor1, match=None, count=None)<br> …<br> 直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hscan<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="13">
<li>hscan_iter(name, match=None, count=None)<br> 利用yield封装hscan创建生成器，实现分批去redis中获取数据<br> 参数：<br> match，匹配指定key，默认None 表示所有的key<br> count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数<br> 如：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> item <span class="token keyword">in</span> r.hscan_iter<span class="token punctuation">(</span><span class="token string">'hash1'</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.hscan_iter<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># 生成器内存地址</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="3-5-5-redis基本命令-list"><a href="#3-5-5-redis基本命令-list" class="headerlink" title="3.5.5 redis基本命令 list"></a>3.5.5 redis基本命令 list</h4><ol>
<li>增加（类似于list的append，只是这里是从左边新增加）–没有就新建<br>  lpush(name,values)<br>  在name对应的list中添加元素，每个新的元素都添加到列表的最左边<br>  如：</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>

r<span class="token punctuation">.</span>lpush<span class="token punctuation">(</span><span class="token string">"list1"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>lrange<span class="token punctuation">(</span><span class="token string">'list1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>保存顺序为: 33,22,11</p>
<p>扩展：</p>
<pre class="line-numbers language-bash"><code class="language-bash">r.rpush<span class="token punctuation">(</span><span class="token string">"list2"</span>, 11, 22, 33<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 表示从右向左操作</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, 3<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0-3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>增加（从右边增加）–没有就新建</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.rpush<span class="token punctuation">(</span><span class="token string">"list2"</span>, 44, 55, 66<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 在列表的右边，依次添加44,55,66</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0到-1(最后一个元素)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>往已经有的name的列表的左边添加元素，没有的话无法创建<br>  lpushx(name,value)<br>  在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边<br>  更多：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.lpushx<span class="token punctuation">(</span><span class="token string">"list10"</span>, 10<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 这里list10不存在</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list10"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 0</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list10"</span>, 0, -1<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># []</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash">r.lpushx<span class="token punctuation">(</span><span class="token string">"list2"</span>, 77<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 这里"list2"之前已经存在，往列表最左边添加一个元素，一次只能添加一个</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0到-1(最后一个元素</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li>往已经有的name的列表的右边添加元素，没有的话无法创建</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.rpushx<span class="token punctuation">(</span><span class="token string">"list2"</span>, 99<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 这里"foo_list1"之前已经存在，往列表最右边添加一个元素，一次只能添加一个</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 切片取出值，范围是索引号0到-1(最后一个元素)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="5">
<li>新增（固定索引号位置插入元素）<br>  linsert(name, where, refvalue, value))<br>  在name对应的列表的某一个值前或后插入一个新值<br>  参数：<br>  name，redis的name<br>  where，BEFORE或AFTER<br>  refvalue，标杆值，即：在它前后插入数据<br>  value，要插入的数据</li>
</ol>
<pre class="line-numbers language-objectivec"><code class="language-objectivec">r<span class="token punctuation">.</span><span class="token function">linsert</span><span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">,</span> <span class="token string">"before"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">,</span> <span class="token string">"00"</span><span class="token punctuation">)</span>   # 往列表中左边第一个出现的元素<span class="token string">"11"</span>前插入元素<span class="token string">"00"</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   # 切片取出值，范围是索引号<span class="token number">0</span><span class="token operator">-</span>最后一个元素<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="6">
<li>修改（指定索引号进行修改）<br>  r.lset(name, index, value)<br>  对name对应的list中的某一个索引位置重新赋值<br>  参数：<br>  name，redis的name<br>  index，list的索引位置<br>  value，要设置的值</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.lset<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -11<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 把索引号是0的元素修改成-11</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="7">
<li>删除（指定值进行删除）<br>  r.lrem(name, value, num)<br>  在name对应的list中删除指定的值<br>  参数：<br>  name，redis的name<br>  value，要删除的值<br>  num， num=0，删除列表中所有的指定值；<br>  num=2,从前到后，删除2个； num=1,从前到后，删除左边第1个<br>  num=-2,从后向前，删除2个</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.lrem<span class="token punctuation">(</span><span class="token string">"list2"</span>, <span class="token string">"11"</span>, 1<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将列表中左边第一次出现的"11"删除</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>
r.lrem<span class="token punctuation">(</span><span class="token string">"list2"</span>, <span class="token string">"99"</span>, -1<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将列表中右边第一次出现的"99"删除</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>
r.lrem<span class="token punctuation">(</span><span class="token string">"list2"</span>, <span class="token string">"22"</span>, 0<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将列表中所有的"22"删除</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="8">
<li>删除并返回<br>  lpop(name)<br>  在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素<br>  更多：<br>  rpop(name) 表示从右向左操作</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.lpop<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除列表最左边的元素，并且返回删除的元素</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>
r.rpop<span class="token punctuation">(</span><span class="token string">"list2"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除列表最右边的元素，并且返回删除的元素</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="9">
<li>删除索引之外的值<br>  ltrim(name, start, end)<br>  在name对应的列表中移除没有在start-end索引之间的值<br>  参数：<br>  name，redis的name<br>  start，索引的起始位置<br>  end，索引结束位置</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.ltrim<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, 2<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 删除索引号是0-2之外的元素，值保留索引号是0-2的元素</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="10">
<li>取值（根据索引号取值）<br> lindex(name, index)<br> 在name对应的列表中根据索引获取列表元素</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.lindex<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 取出索引号是0的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="11">
<li>移动  元素从一个列表移动到另外一个列表<br> rpoplpush(src, dst)<br> 从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边<br> 参数：<br> src，要取数据的列表的name<br> dst，要添加数据的列表的name</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.rpoplpush<span class="token punctuation">(</span><span class="token string">"list1"</span>, <span class="token string">"list2"</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="12">
<li>移动  元素从一个列表移动到另外一个列表 可以设置超时<br> brpoplpush(src, dst, timeout=0)<br> 从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧<br> 参数：<br> src，取出并要移除元素的列表对应的name<br> dst，要插入元素的列表对应的name<br> timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.brpoplpush<span class="token punctuation">(</span><span class="token string">"list1"</span>, <span class="token string">"list2"</span>, timeout<span class="token operator">=</span>2<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="13">
<li>一次移除多个列表<br> blpop(keys, timeout)<br> 将多个列表排列，按照从左到右去pop对应列表的元素<br> 参数：<br> keys，redis的name的集合<br> timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞<br> 更多：<br> r.brpop(keys, timeout)  同blpop，将多个列表排列,按照从右像左去移除各个列表内的元素</li>
</ol>
<pre class="line-numbers language-php"><code class="language-php">r<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"list10"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"list11"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> True<span class="token punctuation">:</span>
    r<span class="token punctuation">.</span><span class="token function">blpop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"list10"</span><span class="token punctuation">,</span> <span class="token string">"list11"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"list10"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"list11"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="14">
<li><p>自定义增量迭代<br> 由于redis类库中没有提供对列表元素的增量迭代，如果想要循环name对应的列表的所有元素，那么就需要：</p>
</li>
<li><p>获取name对应的所有列表</p>
</li>
<li><p>循环列表</p>
</li>
</ol>
<p>但是，如果列表非常大，那么就有可能在第一步时就将程序的内容撑爆，所有有必要自定义一个增量迭代的功能：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">list_iter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    自定义redis列表增量迭代
    :param name: redis中的name，即：迭代name对应的列表
    :return: yield 返回 列表元素
    """</span>
    list_count <span class="token operator">=</span> r<span class="token punctuation">.</span>llen<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">for</span> index <span class="token keyword">in</span> range<span class="token punctuation">(</span>list_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> r<span class="token punctuation">.</span>lindex<span class="token punctuation">(</span>name<span class="token punctuation">,</span> index<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> list_iter<span class="token punctuation">(</span><span class="token string">'list2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 遍历这个列表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-5-6-redis基本命令-set"><a href="#3-5-6-redis基本命令-set" class="headerlink" title="3.5.6 redis基本命令 set"></a>3.5.6 redis基本命令 set</h4><ol>
<li>sadd方法：新增一个集合的功能</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># name对应的集合中添加元素</span>
sadd<span class="token punctuation">(</span>name<span class="token punctuation">,</span>values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>示例：</p>
<pre class="line-numbers language-bash"><code class="language-bash">r.sadd<span class="token punctuation">(</span><span class="token string">"set1"</span>, 33, 44, 55, 66<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 往集合中添加元素</span>
print<span class="token punctuation">(</span>r.scard<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 集合的长度是4</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合中所有的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>scard方法：获取元素个数，类似于len</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取name对应的集合中元素个数</span>
scard<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p> 示例：</p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.scard<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 集合的长度是4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>smembers：获取集合中所有的成员</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python">获取name对应的集合的所有成员
smembers<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p> 示例：</p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合中所有的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取集合中所有的成员--元组形式</span>
sscan<span class="token punctuation">(</span>name<span class="token punctuation">,</span> cursor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> match<span class="token operator">=</span>None<span class="token punctuation">,</span> count<span class="token operator">=</span>None<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>示例：</p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sscan<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">sscan_iter<span class="token punctuation">(</span>name<span class="token punctuation">,</span> match<span class="token operator">=</span>None<span class="token punctuation">,</span> count<span class="token operator">=</span>None<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> i <span class="token keyword">in</span> r.sscan_iter<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="4">
<li>差集<br>  sdiff(keys, *args)<br>  在第一个name对应的集合中且不在其他name对应的集合的元素集合</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.sadd<span class="token punctuation">(</span><span class="token string">"set2"</span>, 11, 22, 33<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合中所有的成员</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.sdiff<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 在集合set1但是不在集合set2中</span>
print<span class="token punctuation">(</span>r.sdiff<span class="token punctuation">(</span><span class="token string">"set2"</span>, <span class="token string">"set1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 在集合set2但是不在集合set1中</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="5">
<li>差集–差集存在一个新的集合中<br>  sdiffstore(dest, keys, *args)<br>  获取第一个name对应的集合中且不在其他name对应的集合，再将其新加入到dest对应的集合中</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.sdiffstore<span class="token punctuation">(</span><span class="token string">"set3"</span>, <span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 在集合set1但是不在集合set2中</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取集合3中所有的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="6">
<li>交集<br>  sinter(keys, *args)<br>  获取多一个name对应集合的交集</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sinter<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的交集</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="7">
<li>交集–交集存在一个新的集合中<br>  sinterstore(dest, keys, *args)<br>  获取多一个name对应集合的并集，再将其加入到dest对应的集合中</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sinterstore<span class="token punctuation">(</span><span class="token string">"set3"</span>, <span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的交集</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>并集<br> sunion(keys, *args)<br> 获取多个name对应的集合的并集</p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sunion<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的并集</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>并集–并集存在一个新的集合<br> sunionstore(dest,keys, *args)<br> 获取多一个name对应的集合的并集，并将结果保存到dest对应的集合中</p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sunionstore<span class="token punctuation">(</span><span class="token string">"set3"</span>, <span class="token string">"set1"</span>, <span class="token string">"set2"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 取2个集合的并集</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="8">
<li>判断是否是集合的成员 类似in<br>  sismember(name, value)<br>  检查value是否是name对应的集合的成员，结果为True和False</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.sismember<span class="token punctuation">(</span><span class="token string">"set1"</span>, 33<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 33是集合的成员</span>
print<span class="token punctuation">(</span>r.sismember<span class="token punctuation">(</span><span class="token string">"set1"</span>, 23<span class="token punctuation">))</span>  <span class="token comment" spellcheck="true"># 23不是集合的成员</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="9">
<li>移动<br>  smove(src, dst, value)<br>  将某个成员从一个集合中移动到另外一个集合</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.smove<span class="token punctuation">(</span><span class="token string">"set1"</span>, <span class="token string">"set2"</span>, 44<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="10">
<li>删除–随机删除并且返回被删除值<br> spop(name)<br> 从集合移除一个成员，并将其返回,说明一下，集合是无序的，所有是随机删除的</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.spop<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 这个删除的值是随机删除的，集合是无序的</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="11">
<li>删除–指定值删除<br> srem(name, values)<br> 在name对应的集合中删除某些值</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.srem<span class="token punctuation">(</span><span class="token string">"set2"</span>, 11<span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 从集合中删除指定值 11</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set2"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="3-5-7-redis基本命令-有序set"><a href="#3-5-7-redis基本命令-有序set" class="headerlink" title="3.5.7 redis基本命令 有序set"></a>3.5.7 redis基本命令 有序set</h4><p>Set操作，Set集合就是不允许重复的列表，本身是无序的<br> 有序集合，在集合的基础上，为每元素排序；元素的排序需要根据另外一个值来进行比较，<br> 所以，对于有序集合，每一个元素有两个值，即：值和分数，分数专门用来做排序。</p>
<ol>
<li>新增<br>  zadd(name, *args, **kwargs)<br>  在name对应的有序集合中添加元素<br>  如：</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>

r<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> n1<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> n2<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">,</span> <span class="token string">'m1'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'m2'</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 集合长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 集合长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zrange<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 获取有序集合中所有元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zrange<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 获取有序集合中所有元素和分数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>获取有序集合元素个数 类似于len<br>  zcard(name)<br>  获取name对应的有序集合元素的数量</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zcard<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 集合长度</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>获取有序集合的所有元素<br>  r.zrange( name, start, end, desc=False, withscores=False, score_cast_func=float)<br>  按照索引范围获取name对应的有序集合的元素<br>  参数：<br>  name，redis的name<br>  start，有序集合索引起始位置（非分数）<br>  end，有序集合索引结束位置（非分数）<br>  desc，排序规则，默认按照分数从小到大排序<br>  withscores，是否获取元素的分数，默认只获取元素的值<br>  score_cast_func，对分数进行数据转换的函数</li>
</ol>
<p>3-1 从大到小排序(同zrange，集合是从大到小排序的)<br> zrevrange(name, start, end, withscores=False, score_cast_func=float)</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 只获取元素，不显示分数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># 获取有序集合中所有元素和分数,分数倒序</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3-2 按照分数范围获取name对应的有序集合的元素<br> zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   element <span class="token operator">=</span> <span class="token string">'n'</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
   r<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrangebyscore</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># # 在分数是15-25之间，取出符合条件的元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrangebyscore</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 在分数是12-22之间，取出符合条件的元素（带分数）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3-3 按照分数范围获取有序集合的元素并排序（默认从大到小排序）<br> zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrangebyscore</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># 在分数是22-11之间，取出符合条件的元素 按照分数倒序</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3-4 获取所有元素–默认按照分数顺序排序<br> zscan(name, cursor=0, match=None, count=None, score_cast_func=float)</p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zscan<span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3-5 获取所有元素–迭代器<br> zscan_iter(name, match=None, count=None,score_cast_func=float)</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> i <span class="token keyword">in</span> r.zscan_iter<span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">)</span>: <span class="token comment" spellcheck="true"># 遍历迭代器</span>
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="4">
<li>zcount(name, min, max)<br>  获取name对应的有序集合中分数 在 [min,max] 之间的个数</li>
</ol>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zcount</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="5">
<li>自增<br>  zincrby(name, value, amount)<br>  自增name对应的有序集合的 name 对应的分数</li>
</ol>
<pre class="line-numbers language-php"><code class="language-php">r<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token string">"n2"</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 每次将n2的分数自增2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="6">
<li>获取值的索引号<br>  zrank(name, value)<br>  获取某个值在 name对应的有序集合中的索引（从 0 开始）<br>  更多：<br>  zrevrank(name, value)，从大到小排序</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n1"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># n1的索引号是0 这里按照分数顺序（从小到大）</span>
print<span class="token punctuation">(</span>r.zrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n6"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># n6的索引号是1</span>

print<span class="token punctuation">(</span>r.zrevrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n1"</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># n1的索引号是29 这里安照分数倒序（从大到小）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="7">
<li>删除–指定值删除<br>  zrem(name, values)<br>  删除name对应的有序集合中值是values的成员</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.zrem<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n3"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 删除有序集合中的元素n3 删除单个</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="8">
<li>删除–根据排行范围删除，按照索引号来删除<br>  zremrangebyrank(name, min, max)<br>  根据排行范围删除</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.zremrangebyrank<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, 1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 删除有序集合中的索引号是0, 1的元素</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="9">
<li>删除–根据分数范围删除<br>  zremrangebyscore(name, min, max)<br>  根据分数范围删除</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.zremrangebyscore<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 11, 22<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 删除有序集合中的分数是11-22的元素</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="10">
<li>获取值对应的分数<br> zscore(name, value)<br> 获取name对应有序集合中 value 对应的分数</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.zscore<span class="token punctuation">(</span><span class="token string">"zset3"</span>, <span class="token string">"n27"</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 获取元素n27对应的分数27</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="3-5-8-其他常用操作"><a href="#3-5-8-其他常用操作" class="headerlink" title="3.5.8 其他常用操作"></a>3.5.8 其他常用操作</h4><ol>
<li>删除<br>  delete(*names)<br>  根据删除redis中的任意数据类型（string、hash、list、set、有序set）</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.delete<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 删除key为gender的键值对</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>检查名字是否存在<br>  exists(name)<br>  检测redis的name是否存在，存在就是True，False 不存在</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.exists<span class="token punctuation">(</span><span class="token string">"zset1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>模糊匹配<br>  keys(pattern=’<em>‘)<br>  根据模型获取redis的name<br>  更多：<br>  KEYS \</em> 匹配数据库中所有 key 。<br>  KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。<br>  KEYS h*llo 匹配 hllo 和 heeeeello 等。<br>  KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.keys<span class="token punctuation">(</span><span class="token string">"foo*"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="4">
<li>设置超时时间<br>  expire(name ,time)<br>  为某个redis的某个name设置超时时间</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.lpush<span class="token punctuation">(</span><span class="token string">"list5"</span>, 11, 22<span class="token punctuation">)</span>
r.expire<span class="token punctuation">(</span><span class="token string">"list5"</span>, time<span class="token operator">=</span>3<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list5"</span>, 0, -1<span class="token punctuation">))</span>
time.sleep<span class="token punctuation">(</span>3<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list5"</span>, 0, -1<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="5">
<li>重命名<br>  rename(src, dst)<br>  对redis的name重命名</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">r.lpush<span class="token punctuation">(</span><span class="token string">"list5"</span>, 11, 22<span class="token punctuation">)</span>
r.rename<span class="token punctuation">(</span><span class="token string">"list5"</span>, <span class="token string">"list5-1"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="6">
<li>随机获取name<br>  randomkey()<br>  随机获取一个redis的name（不删除）</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.randomkey<span class="token punctuation">(</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="7">
<li>获取类型<br>  type(name)<br>  获取name对应值的类型</li>
</ol>
<pre class="line-numbers language-go"><code class="language-go"><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">(</span><span class="token string">"set1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">(</span><span class="token string">"hash2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="8">
<li>查看所有元素<br>  scan(cursor=0, match=None, count=None)</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.hscan<span class="token punctuation">(</span><span class="token string">"hash2"</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.sscan<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.zscan<span class="token punctuation">(</span><span class="token string">"zset2"</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">"foo1"</span>, 0, -1<span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">"list2"</span>, 0, -1<span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">"zset3"</span>, 0, -1<span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="9">
<li>查看所有元素–迭代器<br>  scan_iter(match=None, count=None)</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">for</span> i <span class="token keyword">in</span> r.hscan_iter<span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> r.sscan_iter<span class="token punctuation">(</span><span class="token string">"set3"</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> r.zscan_iter<span class="token punctuation">(</span><span class="token string">"zset3"</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>other 方法</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">))</span>    <span class="token comment" spellcheck="true"># 查询key为name的值</span>
r.delete<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 删除key为gender的键值对</span>
print<span class="token punctuation">(</span>r.keys<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token comment" spellcheck="true"># 查询所有的Key</span>
print<span class="token punctuation">(</span>r.dbsize<span class="token punctuation">(</span><span class="token punctuation">))</span>   <span class="token comment" spellcheck="true"># 当前redis包含多少条数据</span>
r.save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 执行"检查点"操作，将数据写回磁盘。保存时阻塞</span>
<span class="token comment" spellcheck="true"># r.flushdb()        # 清空r中的所有数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>管道（pipeline）</strong><br> redis默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，<br> 如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline 是原子性操作。</p>
<p>管道（pipeline）是redis在提供单个请求中缓冲多条服务器命令的基类的子类。它通过减少服务器-客户端之间反复的TCP数据库包，从而大大提高了执行批量命令的功能。</p>
<pre class="line-numbers language-dart"><code class="language-dart"><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>

# pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>False<span class="token punctuation">)</span>    # 默认的情况下，管道里执行的命令可以保证执行的原子性，执行pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>False<span class="token punctuation">)</span>可以禁用这一特性。
# pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>True<span class="token punctuation">)</span>
pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> # 创建一个管道

pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'jack'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'sb'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'faz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">)</span>    # 如果num不存在则vaule为<span class="token number">1</span>，如果存在，则value自增<span class="token number">1</span>
pipe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>管道的命令可以写在一起，如：</p>
<pre class="line-numbers language-dart"><code class="language-dart">pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'faz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>参考：<a target="_blank" href="https://www.jianshu.com/p/2639549bedc8" rel="external nofollow noreferrer noopener">https://www.jianshu.com/p/2639549bedc8</a></p>
<h2 id="四、1天学会反爬虫"><a href="#四、1天学会反爬虫" class="headerlink" title="四、1天学会反爬虫"></a>四、1天学会反爬虫</h2><h3 id="4-1-cookie"><a href="#4-1-cookie" class="headerlink" title="4.1 cookie"></a>4.1 cookie</h3><p><strong>cookie的概念</strong></p>
<p>在浏览网站的过程中，我们经常会遇到需要登录的情况，有些页面只有登录之后才可以访问，而且登录之后可以连续访问很多次网站，但是有时候过一段时间就需要重新登录。还有一些网站，在打开浏览器时就自动登录了，而且很长时间都不会失效。这都是Cookie在起作用。</p>
<p>Cookie 是由 Web 服务器保存在用户浏览器（客户端）上的小文本文件，它可以包含有关用户的信息。</p>
<p>无论何时，用户链接到服务器，Web 站点都可以访问 Cookie 信息。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123553.jpg" alt="cookie运行原理"> </p>
<p>也就是说，当我们输入用户名和密码，提交给网站服务器后，网站服务器验证信息正确后会把对应的“身份信息”返回给浏览器，浏览器保存于本地，之后对该网站发送的其他HTTP请求都会带上这个“身份信息”，服务器通过这个“身份信息”识别用户，将相应页面发送给浏览器，而无需再次登录。</p>
<p><strong>获取Cookie</strong></p>
<p>要是我们能获取到登录后的“身份信息”，那所有问题不都解决了吗？因为如果获取了“身份信息”，就可以通过爬虫发送给网站服务器，这样网站服务器不就可以确认身份，就能获取到相应需要登录的页面了吗？</p>
<p>如何获取保存于Cookie中的“身份信息”呢？以登录豆瓣网，获取个人信息为例，获取Cookie信息的步骤如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123611.jpg" alt="豆瓣cookie获取流程"></p>
<h3 id="4-2-网站模拟登录"><a href="#4-2-网站模拟登录" class="headerlink" title="4.2 网站模拟登录"></a>4.2 网站模拟登录</h3><h4 id="4-2-1-获取网站cookie"><a href="#4-2-1-获取网站cookie" class="headerlink" title="4.2.1 获取网站cookie"></a>4.2.1 获取网站cookie</h4><p>用python做网络爬虫时，有时需要登录某些网站。例如使用requests请求登录豆瓣网的时候需要输入用户密码，可能还需要输入验证码，比较麻烦。那有没有办法能够自动登录呢？</p>
<p>当然是可以的，先请求豆瓣网<a target="_blank" href="http://www.douban.com的时候,使用post加上cookies,可以不用输入账号和密码就可以直接登录了./" rel="external nofollow noreferrer noopener">www.douban.com的时候，使用post加上cookies，可以不用输入账号和密码就可以直接登录了。</a></p>
<p>怎么获取cookie呢？有一个简单的方式，通过打开浏览器，再输入豆瓣主页，按下键盘上的F12键（打开浏览器的开发者工具），此时输入账号和密码登录豆瓣网。查看开发者工具中请求登录时的cookies信息，如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210417205117.png" alt="网站cookie信息获取"></p>
<h4 id="4-2-2-使用cookie模拟登录"><a href="#4-2-2-使用cookie模拟登录" class="headerlink" title="4.2.2 使用cookie模拟登录"></a>4.2.2 使用cookie模拟登录</h4><p>通过以上保存的cooike，然后通过执行以下的代码完成模拟登录吧。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests

headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.128 Safari/537.36'</span><span class="token punctuation">}</span>
cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">'通过浏览器获取到的cookie'</span><span class="token punctuation">}</span>
url <span class="token operator">=</span> <span class="token string">'https://www.douban.com/'</span>
<span class="token comment" spellcheck="true"># 使用cookie登录</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies <span class="token operator">=</span> cookies<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 上面已经登录了,下面继续登录首页,看看我们是否登录了</span>
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
html <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies <span class="token operator">=</span> cookies<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
<span class="token comment" spellcheck="true"># L的账号是我的豆瓣昵称,登录之后会显示出来</span>
<span class="token keyword">if</span> <span class="token string">"L的帐号"</span> <span class="token keyword">in</span> html<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"已经登录"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"未登录"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#把登陆主页后返回的数据保存到文件中</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'douban.txt'</span><span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>r.content是登录后的网页信息，保存后打开douban.txt文件，查找是否能看到自己的用户名，可以的话就代表模拟登录成功了。</p>
<p>联网有困难，或者豆瓣登录地址后期变化导致以上代码失效后，本地也可以验证，可以通过启动jupyter Notebook服务后，通过cookie模拟localhost:8888进入主界面，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests

headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'</span><span class="token punctuation">}</span>
cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">'在网页中找到对应的cookie访问记录，粘贴进来'</span><span class="token punctuation">}</span>
url <span class="token operator">=</span> <span class="token string">'http://localhost:8888/tree'</span>
<span class="token comment" spellcheck="true"># 使用cookie登录</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies <span class="token operator">=</span> cookies<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#把登陆主页后返回的数据保存到文件中</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'jupyter_home.html'</span><span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上访问后网址后，会保存网页到jupyter_home.html中，打开网页查看是否已经登录，去掉cookie之后看看网页发生了什么变化。</p>
<h3 id="4-3-Ajax动态网页"><a href="#4-3-Ajax动态网页" class="headerlink" title="4.3 Ajax动态网页"></a>4.3 Ajax动态网页</h3><p>前几章，我们成功爬取了一些网站的信息，但很快你会发现，在爬取诸如：QQ音乐、今日头条、知乎、美团网时，即使浏览器中能完美展现页面，代码也毫无漏洞，怎么都获取不到想要的数据。这是因为我们获取的仅仅是原始的HTML文档，而浏览器中的页面则是经过JavaScript处理数据后生成的结果，这些数据的来源有多种，可能是通过Ajax加载的，可能是包含在HTML文档中的，也可能是经过JavaScript和特定算法计算后生成的，这种页面就叫做动态页面。</p>
<p>本章将会实现Ajax数据的爬取。主要内容包括：</p>
<ol>
<li>Ajax介绍</li>
</ol>
<p>介绍Ajax的概念，用法。</p>
<ol start="2">
<li>Ajax分析方法</li>
</ol>
<p>使用Chrome浏览器查看Ajax请求，获取Ajax请求等。</p>
<ol start="3">
<li>Selenium实现动态页面的爬取</li>
</ol>
<p>使用Web应用程序测试的工具实现动态页面的爬取。</p>
<ol start="4">
<li>Selenium案例实现</li>
</ol>
<p>实现一个Selenium综合案例。</p>
<p>本章的学习路径如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123754.jpg" alt="Ajax数据爬虫分析路径"></p>
<p><strong>问题</strong></p>
<p>学到这里，很多人可能会跃跃欲试，到各大网站爬取自己想要的数据了。但是，现实是你可能会乘兴而来败兴而归。因为更大的难题还在等着我们，例如，看下面的例子。</p>
<p>下图是豆瓣电影的影视页，网址为：<a target="_blank" href="https://movie.douban.com/tag/#/%E3%80%82" rel="external nofollow noreferrer noopener">https://movie.douban.com/tag/#/。</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123900.jpg" alt="img"> </p>
<p>现要获取该页面的影视信息。方法步骤如下：</p>
<p>通过Chrome浏览器的“开发者工具”获取HTML页面并解析代码，然后使用XPath获取电影的各个字段，最后保存起来。</p>
<p>但得到的结果却是：什么数据都没有，不要怀疑你的代码，因为你获取的HTML代码就是没有数据，来看一下证据，如下图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123854.jpg" alt="img"> </p>
<p>但事实是我们看到的页面确实有数据，这些数据从哪来的，又到哪去了呢?如何获取这些数据呢？我们接着往下看。</p>
<p><strong>Ajax引入</strong></p>
<p>传统的网页，如果想要更新内容，必须刷新整个页面，重新加载所有内容。有了Ajax，便可以在页面不被全部刷新的情况下，只更新局部内容。相对传统页面，使用Ajax的好处显而易见。</p>
<p>（1） 更好的用户体验</p>
<p>无需频繁手动重新刷新整个页面，，减少了页面加载的等待时间，大大提升了用户体验，增加用户粘性。</p>
<p>（2） 节省流量</p>
<p>由于只更新了局部页面的数据，相对加载整个页面来说，大大节省了流量，减轻了服务器的负担。</p>
<p>现在绝大部分的网站，其实都用到了Ajax技术。</p>
<p>例如，豆瓣电影的影视页面，如下图所示，通过筛选栏筛选影视内容，我们会发现，页面并未重新刷新，仅仅是更新了影视内容。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123928.jpg" alt="img"> </p>
<p>再例如，我们访问京东首页时（如下图所示），内容只加载了部分，当鼠标往下滑动时，就会出现一个京东的吉祥物正在奔跑的图标，说明内容正在加载，不一会下方就会显示新的内容了。如果鼠标继续下滑，就会不断加载新内容。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329123928.jpg" alt="img"> </p>
<p>我们注意到页面其实并没有整个刷新，也就意味着页面的链接没有变化，但是网页中却多了新内容，也就是后面刷出来的内容。这就是通过Ajax获取新数据并呈现的过程。</p>
<p>对爬虫来说，当我们爬取数据失败时，就需要考虑网站可能是通过Ajax获取数据，再经过页面的解析和渲染显示在浏览器中，因此，分析了Ajax获取的数据的来源，爬虫也就能获取到这些数据了。</p>
<h4 id="4-3-1-Ajax介绍"><a href="#4-3-1-Ajax介绍" class="headerlink" title="4.3.1 Ajax介绍"></a>4.3.1 Ajax介绍</h4><ol>
<li><strong>Ajax概念</strong></li>
</ol>
<p>Ajax，全称<strong>A</strong>synchronous <strong>J</strong>avaScript <strong>a</strong>nd <strong>X</strong>ML，即异步的JavaScript和XML。它不是新的编程语言，而是利用JavaScript在不重新加载整个页面的情况下，与服务器交换数据并更新部分网页内容的技术。</p>
<ol start="2">
<li><strong>基本原理</strong></li>
</ol>
<p>来看一下Ajax实现的基本原理，发送Ajax请求到网页更新的过程简单分为三个步骤：</p>
<p>（1） 发送请求</p>
<p>当页面的某个地方需要更新数据时，会向服务器发送Ajax请求，请求的最底层是通过JavaScript实现的。</p>
<p>（2） 解析内容</p>
<p>服务器发送响应内容，可能是HTML代码或者JSON数据。使用JavaScript处理响应数据。</p>
<p>（3） 渲染网页</p>
<p>JavaScript有改变网页内容的能力，解析完响应内容之后，就可以调用JavaScript来针对解析完的内容对网页进行下一步处理了。</p>
<p>我们观察到，这3个步骤其实都是由JavaScript完成的，它完成了整个请求、解析和渲染的过程。</p>
<p>对于爬虫开发者来说，在爬取网页时，只要能够分析页面使用的是Ajax技术，对Ajax原理有个初步的认识即可。下面我们通过Chrome浏览器的“开发者工具”，来分析一下Ajax。</p>
<h4 id="4-3-2-Ajax分析方法"><a href="#4-3-2-Ajax分析方法" class="headerlink" title="4.3.2 Ajax分析方法"></a>4.3.2 Ajax分析方法</h4><p>对爬虫来说，我们不关心Ajax的实现原理，只要获取到通过Ajax请求的数据就大功告成了。那么，如何获取通过Ajax获取的数据呢？答案是：使用Chrome浏览器的“开发者工具”。</p>
<p>还是豆瓣电影的影视页面为例（<a target="_blank" href="https://movie.douban.com/tag/#/%EF%BC%89%E3%80%82%E6%89%93%E5%BC%80%E9%A1%B5%E9%9D%A2%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8%E2%80%9C%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7%E2%80%9D%EF%BC%8C%E6%8C%89%E7%85%A7%E4%B8%8B%E5%9B%BE%E7%9A%84%E9%A1%BA%E5%BA%8F%E7%82%B9%E5%87%BB%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BC%9A%E5%8F%91%E7%8E%B0%EF%BC%8C%E5%BD%B1%E8%A7%86%E4%BF%A1%E6%81%AF%E7%9A%84%E6%95%B0%E6%8D%AE%E9%83%BD%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%AC%AC5%E6%AD%A5%E4%B8%AD%E4%BA%86%E3%80%82" rel="external nofollow noreferrer noopener">https://movie.douban.com/tag/#/）。打开页面后，使用“开发者工具”，按照下图的顺序点击，我们会发现，影视信息的数据都显示在第5步中了。</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329124035.jpg" alt="img"></p>
<p>原来，”开发者工具”将通过Ajax请求响应的数据保存于“XHR”栏中了（下图第2步），在“Name”栏中（第3步），罗列了所有通过Ajax请求的响应接口，接口地址为：<a target="_blank" href="https://movie.douban.com/j/new_search_subjects?sort=U&amp;range=0,10&amp;tags=&amp;start=0" rel="external nofollow noreferrer noopener">https://movie.douban.com/j/new_search_subjects?sort=U&amp;range=0,10&amp;tags=&amp;start=0</a></p>
<p>对爬虫来说，要想获取Ajax请求的数据，只要得到接口地址，通过接口地址向服务器发送请求，数据不就能获取到了吗？</p>
<p>下面一起来看一下实现过程：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">import</span> csv

 <span class="token comment" spellcheck="true"># 创建CSV文件</span>
fp <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'ajax_douban_movies.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'电影名'</span><span class="token punctuation">,</span> <span class="token string">'得分'</span><span class="token punctuation">,</span> <span class="token string">'演员'</span><span class="token punctuation">,</span> <span class="token string">'链接地址'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 访问前三页，每页显示20</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.157 Safari/537.36'</span><span class="token punctuation">}</span>
    url <span class="token operator">=</span> <span class="token string">'https://movie.douban.com/j/new_search_subjects?sort=T&amp;range=0,10&amp;tags=&amp;start={}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>a<span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    file <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#这里跟之前的不一样，因为返回的是 json 文件</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 显示20行的电影名，得分，演员，链接地址</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dict<span class="token operator">=</span>file<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>   <span class="token comment" spellcheck="true">#取出字典中 'data' 下第 [i] 部电影的信息</span>
        urlname<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>
        title<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
        rate<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span>
        cast<span class="token operator">=</span>dict<span class="token punctuation">[</span><span class="token string">'casts'</span><span class="token punctuation">]</span>

        result <span class="token operator">=</span> <span class="token string">'{},{},{},{}\n'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>title<span class="token punctuation">,</span>rate<span class="token punctuation">,</span><span class="token string">'  '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">,</span>urlname<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 写入CSV文件,  使用' '.json(cast)把多名演员名字用空格分开</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> rate<span class="token punctuation">,</span> <span class="token string">'  '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">,</span> urlname<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行之后，打开ajax_douban_movies.csv文件，获得的内容部分信息如下：</p>
<table>
<thead>
<tr>
<th>标题</th>
<th>得分</th>
<th>演员</th>
<th>链接地址</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>我不是药神</td>
<td>9</td>
<td>徐峥 王传君 周一围 谭卓 章宇</td>
<td><a target="_blank" href="https://movie.douban.com/subject/26752088/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/26752088/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>肖申克的救赎</td>
<td>9.7</td>
<td>蒂姆·罗宾斯 摩根·弗里曼 鲍勃·冈顿 威廉姆·赛德勒 克兰西·布朗</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1292052/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1292052/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>这个杀手不太冷</td>
<td>9.4</td>
<td>让·雷诺 娜塔莉·波特曼 加里·奥德曼 丹尼·爱罗 彼得·阿佩尔</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1295644/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1295644/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>流浪地球</td>
<td>7.9</td>
<td>屈楚萧 吴京 李光洁 吴孟达 赵今麦</td>
<td><a target="_blank" href="https://movie.douban.com/subject/26266893/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/26266893/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>千与千寻</td>
<td>9.4</td>
<td>柊瑠美 入野自由 夏木真理 菅原文太 中村彰男</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1291561/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1291561/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>泰坦尼克号</td>
<td>9.4</td>
<td>莱昂纳多·迪卡普里奥 凯特·温丝莱特 比利·赞恩 凯西·贝茨 弗兰西丝·费舍</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1292722/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1292722/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>阿甘正传</td>
<td>9.5</td>
<td>汤姆·汉克斯 罗宾·怀特 加里·西尼斯 麦凯尔泰·威廉逊 莎莉·菲尔德</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1292720/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1292720/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>盗梦空间</td>
<td>9.3</td>
<td>莱昂纳多·迪卡普里奥 约瑟夫·高登-莱维特 艾利奥特·佩吉 汤姆·哈迪 渡边谦</td>
<td><a target="_blank" href="https://movie.douban.com/subject/3541415/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/3541415/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>霸王别姬</td>
<td>9.6</td>
<td>张国荣 张丰毅 巩俐 葛优 英达</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1291546/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1291546/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>疯狂动物城</td>
<td>9.2</td>
<td>金妮弗·古德温 杰森·贝特曼 伊德里斯·艾尔巴 珍妮·斯蕾特 内特·托伦斯</td>
<td><a target="_blank" href="https://movie.douban.com/subject/25662329/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/25662329/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>摔跤吧！爸爸</td>
<td>9</td>
<td>阿米尔·汗 法缇玛·萨那·纱卡 桑亚·玛荷塔 阿帕尔夏克提·库拉那 沙克希·坦沃</td>
<td><a target="_blank" href="https://movie.douban.com/subject/26387939/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/26387939/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>西虹市首富</td>
<td>6.6</td>
<td>沈腾 宋芸桦 张一鸣 张晨光 常远</td>
<td><a target="_blank" href="https://movie.douban.com/subject/27605698/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/27605698/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>哪吒之魔童降世</td>
<td>8.4</td>
<td>吕艳婷 囧森瑟夫 瀚墨 陈浩 绿绮</td>
<td><a target="_blank" href="https://movie.douban.com/subject/26794435/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/26794435/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>三傻大闹宝莱坞</td>
<td>9.2</td>
<td>阿米尔·汗 卡琳娜·卡普尔 马达范 沙尔曼·乔希 奥米·瓦依达</td>
<td><a target="_blank" href="https://movie.douban.com/subject/3793023/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/3793023/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>怦然心动</td>
<td>9.1</td>
<td>玛德琳·卡罗尔 卡兰·麦克奥利菲 瑞贝卡·德·莫妮 安东尼·爱德华兹 约翰·马奥尼</td>
<td><a target="_blank" href="https://movie.douban.com/subject/3319755/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/3319755/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>让子弹飞</td>
<td>8.9</td>
<td>姜文 葛优 周润发 刘嘉玲 陈坤</td>
<td><a target="_blank" href="https://movie.douban.com/subject/3742360/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/3742360/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>复仇者联盟3：无限战争</td>
<td>8.1</td>
<td>小罗伯特·唐尼 克里斯·海姆斯沃斯 克里斯·埃文斯 马克·鲁弗洛 乔什·布洛林</td>
<td><a target="_blank" href="https://movie.douban.com/subject/24773958/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/24773958/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>海上钢琴师</td>
<td>9.3</td>
<td>蒂姆·罗斯 普路特·泰勒·文斯 比尔·努恩 克兰伦斯·威廉姆斯三世 梅兰尼·蒂埃里</td>
<td><a target="_blank" href="https://movie.douban.com/subject/1292001/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/1292001/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>寻梦环游记</td>
<td>9.1</td>
<td>安东尼·冈萨雷斯 盖尔·加西亚·贝纳尔 本杰明·布拉特 阿兰娜·乌巴赫 芮妮·维克托</td>
<td><a target="_blank" href="https://movie.douban.com/subject/20495023/" rel="external nofollow noreferrer noopener">https://movie.douban.com/subject/20495023/</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>问题</strong></p>
<p>上一节，我们通过分析Ajax，获取数据的接口地址，使用爬虫，实现了数据的获取。</p>
<p>但是，我们很快发现，为了防止网络爬虫，加大网络爬虫的难度。很多网站将接口地址做了处理，它们更多的具有这些特点：</p>
<p>既冗长又复杂</p>
<p>经过加密</p>
<p>具有时效性</p>
<p>毫无规律可言</p>
<p>以今日头条为例，如下图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329124207.jpg" alt="img"> </p>
<p>其新闻信息的接口地址为：<a target="_blank" href="https://www.toutiao.com/api/pc/feed/?category=news_hot&amp;utm_source=toutiao&amp;widen=1&amp;max_behot_time=0&amp;max_behot_time_tmp=0&amp;tadrequire=true&amp;as=A195DBDC06ADC25&amp;cp=5BC65DAC62854E1&amp;_signature=ZtN.cQAAPRnM.D.xF5yhvGbTf2%E3%80%82%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E5%8F%88%E9%95%BF%E5%8F%88%E5%A4%8D%E6%9D%82%EF%BC%8C%E7%BB%8F%E8%BF%87%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E5%B0%B1%E4%BC%9A%E5%A4%B1%E6%95%88%E3%80%82%E4%BB%8E%E4%B8%AD%E6%88%91%E4%BB%AC%E5%BE%88%E9%9A%BE%E6%89%BE%E5%87%BA%E8%A7%84%E5%BE%8B%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%97%A0%E6%B3%95%E7%88%AC%E5%8F%96%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%96%B0%E9%97%BB%E4%BF%A1%E6%81%AF%E3%80%82" rel="external nofollow noreferrer noopener">https://www.toutiao.com/api/pc/feed/?category=news_hot&amp;utm_source=toutiao&amp;widen=1&amp;max_behot_time=0&amp;max_behot_time_tmp=0&amp;tadrequire=true&amp;as=A195DBDC06ADC25&amp;cp=5BC65DAC62854E1&amp;_signature=ZtN.cQAAPRnM.D.xF5yhvGbTf2。这个接口地址又长又复杂，经过加密处理，一段时间后就会失效。从中我们很难找出规律，也就无法爬取更多的新闻信息。</a></p>
<p>难道我们就束手无策了吗？继续往下看，Selenium能帮我们解决这个难题。</p>
<h4 id="4-3-3-Selenium介绍"><a href="#4-3-3-Selenium介绍" class="headerlink" title="4.3.3 Selenium介绍"></a>4.3.3 Selenium介绍</h4><p>要解决上节的问题，我们的思路是：可以使用模拟浏览器运行的方式，它可以做到在浏览器中看到的是什么样，抓取的源码就是什么样，即可见即可爬。再也不用管网页内容是使用了JavaScrapt还是Ajax，也不用管接口有多复杂了（其实连接口是什么都不用管）。</p>
<p>Selenium /sə’liniəm/是一个用于Web应用程序测试的工具，它直接运行在浏览器中，就像真正的用户在操作一样。通俗点讲，它能直接驱动浏览器，模拟人的各种操作行为，如下拉、鼠标点击、键盘输入、拖拽等操作。最后可以获取页面渲染后的HTML代码。</p>
<p><strong>Selenium安装</strong></p>
<p>下面来看一下Selenium库和浏览器驱动程序的安装</p>
<p><strong>1.</strong>    <strong>安装Python支持的Selenium库</strong></p>
<p>安装Selenium非常简单，使用pip命令即可：</p>
<pre class="line-numbers language-python"><code class="language-python">pip install selenium<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>2.</strong>    <strong>安装浏览器驱动程序</strong></p>
<p>需要下载一个Selenium调用浏览器的驱动文件。我们以Chrome浏览器为例，看一下下载Chrome浏览器的驱动文件的步骤：</p>
<p>（1）    查看Chrome浏览器的版本。</p>
<p>首先要查看当前安装的Chrome浏览器的版本，以便下载与浏览器版本对应的驱动文件。</p>
<p>打开Chrome浏览器，点击菜单中的 “帮助”→“关于Google Chrome”，即可查看Chrome的版本号，如图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418103752.png" alt="image-20210418103752598"> </p>
<p>（2）    下载Chromedriver。</p>
<p>以下为Chromedriver的下载地址。无法打开官方下载地址的读者，可以选择第二个下载地址。笔者安装的是ChromeDriver 90.0.4430.24。该版本支持Chrome浏览器的90.0.4430范围的版本</p>
<p>官方下载地址：<a target="_blank" href="https://chromedriver.storage.googleapis.com/index.html%E3%80%82" rel="external nofollow noreferrer noopener">https://chromedriver.storage.googleapis.com/index.html。</a></p>
<p>其他下载地址：<a target="_blank" href="http://npm.taobao.org/mirrors/chromedriver/%E3%80%82" rel="external nofollow noreferrer noopener">http://npm.taobao.org/mirrors/chromedriver/。</a></p>
<p>（3）    配置环境变量。</p>
<p>最后，需要将驱动文件配置到环境变量中。在Windows下，将下载得到的chromedriver.exe文件拖到Anaconda3的Scripts目录下就可以了，如：C:\Anaconda3\Scripts下。</p>
<p><strong>Selenium语法</strong></p>
<ol>
<li><strong>声明浏览器对象</strong></li>
</ol>
<p>Selenium支持很多浏览器，如Chrome、Firefox、IE、Opera、Safari等，还有Android、BlackBerry等手机端的浏览器。selenium.webdriver 模块提供了所有浏览器的驱动（WebDriver），可以生成不同浏览器的对象。</p>
<p>下面是声明不同浏览器对象的实现代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#声明Chrome浏览器对象</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ie<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#声明ie浏览器对象</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#声明firefox浏览器对象</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>phantomjs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#声明phantomjs浏览器对象</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>safari<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#声明safari浏览器对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li><strong>访问页面</strong></li>
</ol>
<p>可以使用get方法实现页面的访问：</p>
<pre class="line-numbers language-python"><code class="language-python">driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.suning.com/"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#请求页面</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li><strong>获取页面代码</strong></li>
</ol>
<p>使用driver的page_source属性获取页面的HMTL代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取代码</span>
HTML<span class="token operator">=</span>driver<span class="token punctuation">.</span>page_source<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="4">
<li><strong>定位元素</strong></li>
</ol>
<p>当获取到HTML代码后，就需要定位到HTML的各个元素，以便提取数据或者对该元素执行诸如输入、点击操作。WebDriver 提供了大量的方法查询页面中的节点，这些方法形如：find_element_by_*。</p>
<p>以下为Selenium查找单个节点的方法。</p>
<p>find_element_by_id：通过ID查找</p>
<p>find_element_by_name：通过NAME查找</p>
<p>find_element_by_xpath：通过xpath选择器查找</p>
<p>find_element_by_link_text：通过链接的文本查找（完全匹配）</p>
<p>find_element_by_partial_link_text：通过链接的文本查找（部分匹配）</p>
<p>find_element_by_tag_name：通过标签名查找</p>
<p>find_element_by_class_name：通过CLASS查找</p>
<p>find_element_by_css_selector：通过css选择器查找</p>
<ol start="5">
<li><strong>页面交互</strong></li>
</ol>
<p>Selenium可以模拟用户对页面执行一系列操作，如输入数据、清除数据、单击按钮等。以下代码实现了定位到搜索框后，清空搜索框中的文字，输入“iphone”，回车的功能。</p>
<pre class="line-numbers language-python"><code class="language-python">input <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">"searchKeywords"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#查找节点</span>
input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#清除输入框中默认文字</span>
input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"iphone"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输入框中输入“iphone”</span>
input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>RETURN<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#回车功能</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="6">
<li><strong>执行JavaScript</strong></li>
</ol>
<p>Selenium并未提供所有的页面交互操作方法，例如爬虫中用得最多的下拉页面（用于加载更多内容）。Selenium提供了execute_script()方法，用于执行JS，这样我们就可以通过JS代码实现这些操作了。以下代码实现了将页面下拉到底部的功能。</p>
<p><code>driver.execute_script(&#39;window.scrollTo(0, document.body.scrollHeight)&#39;)</code></p>
<p>更多关于Selenium的语法，可以参考Selenium with Python的中文文档。</p>
<p>地址为：<a target="_blank" href="https://selenium-python-zh.readthedocs.io/en/latest/index.html#%E3%80%82" rel="external nofollow noreferrer noopener">https://selenium-python-zh.readthedocs.io/en/latest/index.html#。</a></p>
<h4 id="4-3-4-Selenium实现百度搜索"><a href="#4-3-4-Selenium实现百度搜索" class="headerlink" title="4.3.4 Selenium实现百度搜索"></a>4.3.4 Selenium实现百度搜索</h4><p>为了熟悉Selenium的功能，接下来利用Selenium访问百度，输入搜索关键字后，完成提取搜索页面的查询结果的一个案例作为说明。</p>
<p><strong>以headless chrome方式访问百度首页</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

<span class="token comment" spellcheck="true">#chrome选项</span>
options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#使用无头chrome</span>
options<span class="token punctuation">.</span>set_headless<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#配置并获得WebDriver对象</span>
path <span class="token operator">=</span> <span class="token string">'D:/Soft/VSCode32_Python_Portable/Python378/Scripts/chromedriver.exe'</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>path<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#发起get请求</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>百度首页用来输入搜索关键词的组件是</strong></p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>s_ipt<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wd<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>kw<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>通过查看网页源代码可以查询到相关标签信息如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418113102.png" alt="百度搜索input"></p>
<p>那怎么通过Selenium模拟人的文本输入呢？比如说咱们要查找<code>python</code>关键字，可以使用以下方法：</p>
<pre class="line-numbers language-python"><code class="language-python">input_element <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span>
input_element<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span>
input_element<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这样就通过name属性获得input标签实例<code>input_element</code>后，输入要查询的<code>python</code>关键字，并通过调用submit方法进行提交，接下来就是等待百度返回结果了。</p>
<p><strong>百度的结果页查询</strong></p>
<p>当以python作为关键字查询时，百度返回查询结果页面时会在浏览器的标题(title)中包含查询的关键字，利用这个特点，当WebDriver的标题中出现包含’python’的文字即说明百度返回了搜索结果页面。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418123222.png" alt="nums_text网页源码"></p>
<p>通过代码进行提取</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re

<span class="token comment" spellcheck="true">#chrome选项</span>
options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#使用无头chrome</span>
options<span class="token punctuation">.</span>set_headless<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#配置并获得WebDriver对象</span>
path <span class="token operator">=</span> <span class="token string">'D:/Soft/VSCode32_Python_Portable/Python378/Scripts/chromedriver.exe'</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>path<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#发起get请求</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span>

input_element <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span>
input_element<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span>
input_element<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#最多等待10秒直到浏览器标题栏中出现我希望的字样（比如查询关键字出现在浏览器的title中）</span>
    WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>
        expected_conditions<span class="token punctuation">.</span>title_contains<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
    bsobj <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span>

    num_text_element <span class="token operator">=</span> bsobj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'nums_text'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    nums <span class="token operator">=</span> filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">==</span> <span class="token string">','</span> <span class="token operator">or</span> s<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#关闭浏览器</span>
    driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>代码解析：首先是”百度为您找到相关结果约100,000,000个”，这个结果是存放在一个span中，</p>
<p><span class="nums_text">百度为您找到相关结果约100,000,000个</span>，利用class属性可以找到标签span，并提取span中的文本，再进一步只提取其中的数字100,000,000</p>
<p>利用页面的内容生成BeautifulSoup对象后，调用find方法找到class属性为nums_text的span标签，取出它的文本内容。</p>
<p>最后使用filter函数，过滤出文本内容中需要的部分（比如，数字和逗号）</p>
<p><strong>提取列表中的标题和链接</strong></p>
<p>通过网页可以看到对应的源代码通过class c-container封装在div标签中。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418124247.png" alt="搜索标题和链接信息"></p>
<p>再打开这个标签后，发现c-container标签下面的h3标签下面的a标签的href属性值就是一个搜索结果的链接地址。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210418124553.png" alt="网页搜索的链接地址"></p>
<p><strong>最终获取标题和链接的代码</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re

<span class="token comment" spellcheck="true">#chrome选项</span>
options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#使用无头chrome</span>
options<span class="token punctuation">.</span>set_headless<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#配置并获得WebDriver对象</span>
path <span class="token operator">=</span> <span class="token string">'D:/Soft/VSCode32_Python_Portable/Python378/Scripts/chromedriver.exe'</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>path<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#发起get请求</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span>

input_element <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span>
input_element<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span>
input_element<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#最多等待10秒直到浏览器标题栏中出现我希望的字样（比如查询关键字出现在浏览器的title中）</span>
    WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>
        expected_conditions<span class="token punctuation">.</span>title_contains<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
    bsobj <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span>

    num_text_element <span class="token operator">=</span> bsobj<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'nums_text'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    nums <span class="token operator">=</span> filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">==</span> <span class="token string">','</span> <span class="token operator">or</span> s<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num_text_element<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span>

    elements <span class="token operator">=</span> bsobj<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'class'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'c-container'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> element <span class="token keyword">in</span> elements<span class="token punctuation">:</span>
        <span class="token keyword">if</span> element<span class="token punctuation">.</span>h3 <span class="token keyword">is</span> <span class="token operator">not</span> None <span class="token operator">and</span> element<span class="token punctuation">.</span>h3<span class="token punctuation">.</span>a <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'标题：'</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>h3<span class="token punctuation">.</span>a<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'链接：'</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>h3<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'==============================================================='</span><span class="token punctuation">)</span>

<span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#关闭浏览器</span>
    driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-3-5-我们使用Selenium实现一个案例"><a href="#4-3-5-我们使用Selenium实现一个案例" class="headerlink" title="4.3.5 我们使用Selenium实现一个案例"></a>4.3.5 我们使用Selenium实现一个案例</h4><p>下面，我们使用Selenium实现一个案例，需求是使用爬虫获取今日头条中热点新闻的获取，保存于CSV文件中。获取的字段有：新闻标题、来源和评论数。如下图所示。</p>
<p>1，新建一个python文件，导入需要的库</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver <span class="token comment" spellcheck="true">#导入web驱动库</span>
<span class="token keyword">import</span> time <span class="token comment" spellcheck="true">#导入时间库</span>
<span class="token keyword">import</span> pymongo<span class="token comment" spellcheck="true">#monggo #导入数据库</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2，因为获取的数据需要保存到mongodb数据库中，所以可以先连接数据库</p>
<pre class="line-numbers language-python"><code class="language-python"> 链接数据库
client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#链接数据库</span>
db <span class="token operator">=</span>client<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置数据库名</span>
toutiao <span class="token operator">=</span>db<span class="token punctuation">[</span><span class="token string">'toutiao'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置集合名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3，启动webdrive</p>
<pre class="line-numbers language-python"><code class="language-python">base_url <span class="token operator">=</span><span class="token string">'https://www.toutiao.com'</span>
brower <span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base_url<span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 最大化窗口</span>
brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>find_element_by_link_text<span class="token punctuation">(</span><span class="token string">'热点'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4，用selenium自带的find_elements_by_xpath()方法获取页面需要的元素，这里我们获取新闻的标题title，详情页面的链接url,发布者source,评论总数comment</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    titles<span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> title <span class="token keyword">in</span> titles<span class="token punctuation">:</span>
        title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    urls <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
        url <span class="token operator">=</span> url<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    sources <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn source"]'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>
        sources_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>source<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    comments <span class="token operator">=</span>brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn comment"]'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> comment <span class="token keyword">in</span> comments<span class="token punctuation">:</span>
        comments_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5, 因为今日头条是用ajax动态加载的，浏览器向下拉的过程中，页面会一直在下面加载出来，可以通过execute_script(“window.scrollTo();”)功能模拟浏览器下拉页面刷新数据</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_manyinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,1000);"</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> len<span class="token punctuation">(</span>title_list<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,document.body.scrollHeight);"</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
        brower<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        brower<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>6，设计保存到数据库中，用zip()函数匹配title，url，source, comment,保存为字典格式，然后将字典保存到数据库中</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">save_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    infos <span class="token operator">=</span> zip<span class="token punctuation">(</span>title_list<span class="token punctuation">,</span> url_list<span class="token punctuation">,</span> sources_list<span class="token punctuation">,</span> comments_list<span class="token punctuation">)</span>
    <span class="token keyword">for</span> info <span class="token keyword">in</span> infos<span class="token punctuation">:</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'标题'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'url'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'来源'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'评论'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">#result =db['toutiao'].insert_one(data)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>完整代码</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time
<span class="token keyword">import</span> pymongo

<span class="token comment" spellcheck="true"># 链接数据库</span>
client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#链接数据库</span>
db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置数据库名</span>
toutiao <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'toutiao'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#设置集合名</span>

<span class="token comment" spellcheck="true">#启动webdrive</span>
base_url <span class="token operator">=</span><span class="token string">'https://www.toutiao.com'</span>
brower <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base_url<span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 最大化窗口</span>
brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>find_element_by_link_text<span class="token punctuation">(</span><span class="token string">'热点'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
brower<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

title_list<span class="token punctuation">,</span>url_list<span class="token punctuation">,</span>sources_list<span class="token punctuation">,</span>comments_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 获取页面新闻标题，详情页面链接，来源，评论，并添加到列表中</span>
<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    titles<span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> title <span class="token keyword">in</span> titles<span class="token punctuation">:</span>
        title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    urls <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
        url <span class="token operator">=</span> url<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    sources <span class="token operator">=</span> brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn source"]'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>
        sources_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>source<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    comments <span class="token operator">=</span>brower<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="lbtn comment"]'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> comment <span class="token keyword">in</span> comments<span class="token punctuation">:</span>
        comments_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 通过下拉进度条一直加载页面</span>
<span class="token keyword">def</span> <span class="token function">get_manyinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,1000);"</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> len<span class="token punctuation">(</span>title_list<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            brower<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0,document.body.scrollHeight);"</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
        brower<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        brower<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 保存获取的信息保存到mongodb中</span>
<span class="token keyword">def</span> <span class="token function">save_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    infos <span class="token operator">=</span> zip<span class="token punctuation">(</span>title_list<span class="token punctuation">,</span> url_list<span class="token punctuation">,</span> sources_list<span class="token punctuation">,</span> comments_list<span class="token punctuation">)</span>
    <span class="token keyword">for</span> info <span class="token keyword">in</span> infos<span class="token punctuation">:</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'标题'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'url'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'来源'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'评论'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        result <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'toutiao'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    get_manyinfo<span class="token punctuation">(</span><span class="token punctuation">)</span>
    save_info<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>使用Requests实现网络爬虫，简单方便，功能强大。但是如果爬取海量数据，爬虫功能又比较复杂，全靠自己设计和实现就显得复杂而麻烦了，例如，实现并行爬取、分布式爬取、破解对方的反爬虫技术等。</p>
<p>这时，可以考虑使用Scrapy爬虫框架，它就像了一个爬虫流水线，自动给我们配置好工作队列、下载器、任务的分配，解析模块、持久化模块等，我们只要在相应的模块中实现对于的功能，再复杂的爬虫都能很顺畅、高效地运行。下一章开始，我们将为大家介绍一个爬虫框架-Scrapy。</p>
<h2 id="五、2天学会Scrapy框架爬虫"><a href="#五、2天学会Scrapy框架爬虫" class="headerlink" title="五、2天学会Scrapy框架爬虫"></a>五、2天学会Scrapy框架爬虫</h2><h3 id="5-1-Scrapy框架结构"><a href="#5-1-Scrapy框架结构" class="headerlink" title="5.1 Scrapy框架结构"></a>5.1 Scrapy框架结构</h3><p>第一章网络爬虫基础中，我们学习了爬虫原理和HTTP基本原理，理解了这些，就不难理解Scrapy的框架结构了，因为Scrapy框架结构和流程设计遵循网络爬虫的基本原理。</p>
<p>下图展示了Scrapy的框架结构。包含了不同功能的组件、系统中发生的数据流以及执行流程。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329154336.jpg" alt="Scrapy框架结构"> </p>
<p>首先来看一下框架结构中的各个组件：</p>
<p><strong>引擎（ENGINE）</strong></p>
<p>引擎犹如总指挥，是整个系统的大脑，指挥其他组件协同工作。</p>
<p><strong>调度器（SCHEDULER）</strong></p>
<p>调度器接收引擎发过来的请求，压入队列中。调度器根据请求先后顺序，确定执行顺序。同时去除重复的请求。</p>
<p><strong>下载器（DOWNLOADER）</strong></p>
<p>用于下载网页内容，并将网页内容返回给爬虫（Scrapy下载器是建立在twisted这个高效的异步模型上的）</p>
<p><strong>爬虫（SPIDERS）</strong></p>
<p>最核心的组件，用于从特定的网页中提取自己需要的信息，即所谓的实体（Item）。用户也可以从中提取出链接，让Scrapy继续抓取下一个页面。</p>
<p><strong>项目管道（ITEM PIPELINES）</strong></p>
<p>负责处理爬虫从网页中抽取的实体，主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。</p>
<p><strong>下载器中间件（Downloader Middlewares）</strong></p>
<p>介于引擎和下载器之间的组件，主要是处理Scrapy引擎与下载器之间的请求及响应。</p>
<p><strong>爬虫中间件（Spider Middlewares）</strong></p>
<p>介于引擎和爬虫之间的组件，主要工作是处理爬虫的响应输入和请求输出。</p>
<h3 id="5-2-Scrapy框架结构-数据流"><a href="#5-2-Scrapy框架结构-数据流" class="headerlink" title="5.2 Scrapy框架结构-数据流"></a>5.2 Scrapy框架结构-数据流</h3><p>我们都知道，爬虫中的数据主要有两种，一是向服务器发送请求的Request请求数据，二是服务器响应返回给浏览器的Response响应数据，Scrapy中的数据流是怎样的呢？下图为Scrapy的框架结构。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329154633.jpg" alt="img"> </p>
<p>来看一下Scrapy框架结构中展示的数据流，上图中的REQUESTS和RESPONSE分别表示请求数据和响应数据流：</p>
<p>Scrapy框架结构中传递和处理的数据主要有：</p>
<p>q 向网站服务器发送的请求数据（请求的内容见第一章的HTTP请求）</p>
<p>q 网站服务器返回的响应数据（响应的内容见第一章的HTTP响应）</p>
<p>q 解析后的结构数据（类似于字典）</p>
<p>Scrapy中定义的Request和Response类用于保存请求和响应数据，Item类保存解析后的结构数据，如下图所示</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329154915.png" alt="请求流程"></p>
<h3 id="5-3-Scrapy执行流程"><a href="#5-3-Scrapy执行流程" class="headerlink" title="5.3 Scrapy执行流程"></a>5.3 Scrapy执行流程</h3><p>下面从数据流的角度揭示Scrapy框架的执行流程。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329155122.jpeg" alt="img"> </p>
<p>上图中第①②③④步执行的是HTTP请求，传递和处理的是向网站服务器发送的请求数据。</p>
<p><strong>第①步</strong>：爬虫（Spider）使用URL（要爬取页面的网址）构造一个请求（Request）对象，提交给引擎（ENGINE）。如果请求要伪装成浏览器，或者设置代理IP，可以先在爬虫中间件中设置，再发送给引擎。</p>
<p><strong>第②步</strong>：引擎将请求安排给调度器，调度器根据请求的优先级确定执行顺序。</p>
<p><strong>第③步</strong>：引擎从调度器获取即将要执行的请求。</p>
<p><strong>第④步</strong>：引擎通过下载器中间件，将请求发送给下载器下载页面。</p>
<p>上图中第⑤⑥⑦⑧步执行的是HTTP响应，传递和处理的是网站服务器返回的响应数据。</p>
<p><strong>第⑤步</strong>：页面完成下载后，下载器会生成一个响应（Response）对象并将其发送给引擎。下载后的数据就是保存于响应对象中的。</p>
<p><strong>第⑥步</strong>：引擎接收来自下载器的响应对象后，通过爬虫中间件，将其发送给爬虫（Spider）进行处理。</p>
<p><strong>第⑦步</strong>：爬虫将抽取到的一条数据实体（Item）和新的请求（如下一页的链接）发送给引擎。</p>
<p><strong>第⑧步</strong>：引擎将从爬虫获取到的Item发送给项目管道（ITEM PIPELINES），项目管道实现数据持久化等功能；将新的请求发送给调度器，再从第②步开始重复执行，直到调度器中没有更多的请求，引擎关闭该网站。</p>
<h3 id="5-4-Scrapy安装"><a href="#5-4-Scrapy安装" class="headerlink" title="5.4 Scrapy安装"></a>5.4 Scrapy安装</h3><p>Scrapy框架的安装非常简单，使用pip命令：</p>
<pre class="line-numbers language-bash"><code class="language-bash">pip <span class="token function">install</span> scrapy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>安装完后验证安装是否成功，输入如下代码，执行。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">print</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>version_info<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>执行代码，没有任何错误，说明安装成功，执行后的结果为scrapy的安装版本：</p>
<p>(1, 5, 1)</p>
<h3 id="5-5-Spider组件介绍"><a href="#5-5-Spider组件介绍" class="headerlink" title="5.5 Spider组件介绍"></a>5.5 Spider组件介绍</h3><p>Scrapy网络爬虫编程的核心就是爬虫（Spider）组件，它其实是一个继承于Spider的类，主要功能是封装一个发送给网站服务器的HTTP请求，以及解析网站返回的网页、提取数据。</p>
<p>Spider组件解决了以下问题：</p>
<p>爬虫从哪个或哪些页面开始爬取。</p>
<p>对于一个已下载的页面，提取其中的哪些数据。</p>
<p>爬取完当前页面后，接下来爬取哪个或哪些页面。</p>
<p>上面问题的答案包含了一个爬虫最重要的逻辑，回答了这些问题，一个爬虫也就开发出来了。</p>
<p>接下来，通过一个具体案例，讲解一个Spider的开发流程，实现数据的爬取功能。</p>
<h3 id="5-6-Item介绍"><a href="#5-6-Item介绍" class="headerlink" title="5.6 Item介绍"></a>5.6 Item介绍</h3><p>上节通过Spider爬取到了数据，为了收集抓取到的这些数据，Scrapy提供了一个简单的容器Item。Item对象是一个简单的容器，用于收集抓取到的数据，其提供了类似于字典（dictionary-like）的API并具有用于声明可用字段的简单语法。</p>
<p>Scrapy还定义了一个类Field，用于描述自定义数据类包含的字段。</p>
<p>下面继续完成上节未完成的案例，实现使用Item封装数据。</p>
<h3 id="5-7-Pipeline介绍"><a href="#5-7-Pipeline介绍" class="headerlink" title="5.7 Pipeline介绍"></a>5.7 Pipeline介绍</h3><p>当我们通过Spider爬取数据，通过Item收集数据后，就需要对数据进行一些处理了，因为我们爬取到的数据并不一定是我们想要的最终数据，可能还需要进行数据的清洗以及验证数据的有效性。Scrapy中的Pipeline组件就用于数据的处理，一个Pipeline组件就是一个包含特定接口的类，通常只负责一种功能的数据处理，在一个项目中可以同时启用多个Pipeline。</p>
<p>以下是Pipeline的几种典型应用：</p>
<p>清洗数据</p>
<p>验证数据的有效性</p>
<p>过滤掉重复的数据</p>
<p>将数据存入数据库</p>
<h3 id="5-8-第一个Scrapy网络爬虫-豆瓣电影"><a href="#5-8-第一个Scrapy网络爬虫-豆瓣电影" class="headerlink" title="5.8 第一个Scrapy网络爬虫-豆瓣电影"></a>5.8 第一个Scrapy网络爬虫-豆瓣电影</h3><h4 id="5-8-1-Scrapy创建爬虫步骤"><a href="#5-8-1-Scrapy创建爬虫步骤" class="headerlink" title="5.8.1 Scrapy创建爬虫步骤"></a>5.8.1 Scrapy创建爬虫步骤</h4><p>新建项目 (scrapy startproject xxx)：新建一个新的爬虫项目</p>
<p>明确目标 （编写items.py）：明确你想要抓取的目标</p>
<p>制作爬虫 （spiders/xxspider.py）：制作爬虫开始爬取网页</p>
<p>存储内容 （pipelines.py）：设计管道存储爬取内容</p>
<h4 id="5-8-2-创建Scrapy项目"><a href="#5-8-2-创建Scrapy项目" class="headerlink" title="5.8.2 创建Scrapy项目"></a>5.8.2 创建Scrapy项目</h4><pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject mySpider<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中， mySpider 为项目名称，可以看到将会创建一个 mySpider 文件夹，目录结构大致如下：</p>
<p>下面来简单介绍一下各个主要文件的作用：</p>
<pre><code>doubanMovies/
    scrapy.cfg
    doubanMovies/
        __init__.py
        items.py
        pipelines.py
        settings.py
        spiders/
            __init__.py
            ...</code></pre>
<p>这些文件分别是:</p>
<ul>
<li>scrapy.cfg: 项目的配置文件。</li>
<li>doubanMovies/: 项目的Python模块，将会从这里引用代码。</li>
<li>doubanMovies/items.py: 项目的目标文件。</li>
<li>doubanMovies/pipelines.py: 项目的管道文件。</li>
<li>doubanMovies/settings.py: 项目的设置文件。</li>
<li>doubanMovies/spiders/: 存储爬虫代码目录。</li>
</ul>
<h4 id="5-8-3-确定要抓取的信息"><a href="#5-8-3-确定要抓取的信息" class="headerlink" title="5.8.3 确定要抓取的信息"></a>5.8.3 确定要抓取的信息</h4><p>豆瓣TOP250的网址信息大概是这样，如果我们想要爬取的是TOP250电影的文字信息，主要是完成一些翻页的信息的内容爬取</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420105225.png" alt="**豆瓣TOP250网页信息**"></p>
<p>为了说明一个scrapy的爬取过程，咱们本次只爬取这些电影的名称<strong>Name</strong>，产出地<strong>location</strong>，averagePrice = scrapy.Field() broker = scrapy.Field()</p>
<h4 id="5-8-4-创建爬虫的启动代码"><a href="#5-8-4-创建爬虫的启动代码" class="headerlink" title="5.8.4 创建爬虫的启动代码"></a>5.8.4 创建爬虫的启动代码</h4><p>确定了要爬取的内容，就可以创建代码了。</p>
<p>一个比较好的方式是通过命令行创建要执行的主程序。</p>
<p>在当前目录下输入命令，将在doubanMovies/spider目录下创建一个名为douban.py的爬虫，并指定爬取域的范围：</p>
<pre><code>scrapy genspider douban &quot;movie.douban.com&quot;</code></pre>
<p>执行过程：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420110848.png" alt="创建scrapy的spider模块代码"></p>
<p>douban.py生成的代码内容如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">DoubanSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'douban'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'movie.douban.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/'</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>说明如下：</strong></p>
<p>要建立一个Spider模块， 你必须用scrapy.Spider类创建一个子类，并确定了<strong>三个属性</strong>和<strong>一个方法</strong>。</p>
<p><code>name</code>这个是爬虫的识别名称，必须是唯一的，在不同的爬虫必须定义不同的名字；</p>
<p><code>allow_domains</code>是搜索的域名范围，也就是爬虫的约束区域，规定爬虫只爬取这个域名下的网页，不存在的URL会被忽略；</p>
<p><code>start_urls</code>是爬取的URL元祖/列表。爬虫从这里开始抓取数据，所以，第一次下载的数据将会从这些urls开始。其他子URL将会从这些起始URL中继承性生成；</p>
<p><code>parse(self, response)</code>是解析的方法，每个初始URL完成下载后将被调用，调用的时候传入从每一个URL传回的Response对象来作为唯一参数，主要作用如下：</p>
<p>负责解析返回的网页数据(response.body)，提取结构化数据(<strong>生成item</strong>)生成需要下一页的URL请求。</p>
<h4 id="5-8-5-代码设计思路"><a href="#5-8-5-代码设计思路" class="headerlink" title="5.8.5 代码设计思路"></a>5.8.5 代码设计思路</h4><p>由于我们要爬取的数据是需要能够自动翻页的，因此以上代码中的<code>start_urls</code>修改如下：</p>
<pre class="line-numbers language-python"><code class="language-python">start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/top250?start='</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>乘以25是由于豆瓣TOP250网页每页默认显示的显示为25个，然后再通过range(10)循环十次，就可以遍历250个电影信息了。</p>
<p>那么这250个电影信息在网页的什么位置呢？</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420112137.png" alt="某个电影信息在网页代码中的位置"></p>
<p>可以发现在content/div/div[1]/ol/存放的是其中一个信息，使用xpath代码来访问如下：</p>
<pre class="line-numbers language-python"><code class="language-python">xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="content"]/div/div[1]/ol/li'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>得到了这个之后，咱们再把其中的电影信息，比如电影名字啦、哪个导演啦、评分多少啦等保存下来就可以啦。</p>
<p>douban.py的完整代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> doubanMovies<span class="token punctuation">.</span>items <span class="token keyword">import</span> doubanMovies

<span class="token keyword">class</span> <span class="token class-name">DoubanSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span> 
    name <span class="token operator">=</span> <span class="token string">'douban'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'movie.douban.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/top250?start='</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="content"]/div/div[1]/ol/li'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 获取所有li</span>
            item <span class="token operator">=</span> doubanMovies<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 实例化</span>
            item<span class="token punctuation">[</span><span class="token string">"Ranking"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[1]/em/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取排名</span>
            item<span class="token punctuation">[</span><span class="token string">"movieName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[2]/div[1]/a/span[1]/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取电影名称</span>
            item<span class="token punctuation">[</span><span class="token string">"director"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[2]/div[2]/p[1]/text()[1]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取导演</span>
            item<span class="token punctuation">[</span><span class="token string">"rating"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[2]/div[2]/div/span[2]/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取评分</span>
            item<span class="token punctuation">[</span><span class="token string">"imageURL"</span><span class="token punctuation">]</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[1]/a/@href"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取影片海报图片 url</span>
            <span class="token keyword">yield</span> item
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的代码parse的response是URL下载后返回的内容，可以在这个方法中编写解析内容，并把信息保存到Scrapy的模块中，可以看到上面的代码在item中定义了5个元素，因此我们还需要在item文件中定义这些数据内容，item.py的代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define here the models for your scraped items</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># See documentation in:</span>
<span class="token comment" spellcheck="true"># https://docs.scrapy.org/en/latest/topics/items.html</span>

<span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">doubanMovies</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Ranking <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    movieName <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    director <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rating <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    imageURL <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DoubanmoviesItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>
    <span class="token comment" spellcheck="true"># name = scrapy.Field()</span>
    <span class="token keyword">pass</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了更好的模拟真实浏览器的请求，我们在settings.py中修改如下：</p>
<pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true">#关闭 robots 协议，否则很多页面都无法爬取</span>
LOG_LEVEL <span class="token operator">=</span> <span class="token string">"WARNING"</span> <span class="token comment" spellcheck="true">#日志为警告以上才显示</span>
USER_AGENT <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36'</span> <span class="token comment" spellcheck="true"># 模拟浏览器请求，改成自己网页最新的</span>
FEED_EXPORT_FIELDS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Ranking"</span><span class="token punctuation">,</span><span class="token string">"movieName"</span><span class="token punctuation">,</span><span class="token string">"director"</span><span class="token punctuation">,</span><span class="token string">"rating"</span><span class="token punctuation">,</span><span class="token string">"imageURL"</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#使其输出的内容有顺序</span>
DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment" spellcheck="true"># 设置爬取时间间隔，太快的爬取可能会被网页反爬虫机制检测到</span>
RANDOMIZE_DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token boolean">True</span>
COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment" spellcheck="true"># 使能cookie</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="5-8-6-启动爬虫并检测结果"><a href="#5-8-6-启动爬虫并检测结果" class="headerlink" title="5.8.6 启动爬虫并检测结果"></a>5.8.6 启动爬虫并检测结果</h4><p>以上步骤完成后，只需要通过<strong>scrapy crawl douban</strong>启动程序执行就可以了，也可以通过**-o douban.csv**，把解析的结果内容保存到douban.csv中，这样douban.py的parse最终返回的结果会存放到douban.csv中。</p>
<pre><code>scrapy crawl douban -o douban.csv</code></pre>
<p>打开douban.csv，得到如下的如下的文件内容：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210420115444.png" alt="Scrapy豆瓣TOP250s数据保存内容"></p>
<h4 id="5-8-7-电影详情图片下载"><a href="#5-8-7-电影详情图片下载" class="headerlink" title="5.8.7 电影详情图片下载"></a>5.8.7 电影详情图片下载</h4><p>通过以上的内容，咱们获取到了每一个电影的详情URL地址，下载图片的方式如下：</p>
<p>douban.py文件:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> doubanMovies<span class="token punctuation">.</span>items <span class="token keyword">import</span> doubanMovies
<span class="token keyword">class</span> <span class="token class-name">DoubanSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'douban'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'movie.douban.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://movie.douban.com/top250?start='</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="content"]/div/div[1]/ol/li'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 获取所有li</span>
            url <span class="token operator">=</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"div/div[1]/a/@href"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_detail<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse_detail</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> doubanMovies<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 实例化</span>

       <span class="token comment" spellcheck="true">#item["movieName"] = response.xpath('//*[@id="content"]/h1/span[1]/text()').get()  # 获取电影名称</span>
        <span class="token comment" spellcheck="true">#item["Screenwriter"] = response.xpath('string(//*[@id="info"]/span[2]/span[2])').get()  # 编剧</span>
        item<span class="token punctuation">[</span><span class="token string">"image"</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="mainpic"]/a/img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取影片海报图片</span>
        <span class="token keyword">yield</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>items.py文件:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define here the models for your scraped items</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># See documentation in:</span>
<span class="token comment" spellcheck="true"># https://docs.scrapy.org/en/latest/topics/items.html</span>

<span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">doubanMovies</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    image <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DoubanmoviesItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>
    <span class="token comment" spellcheck="true"># name = scrapy.Field()</span>
    <span class="token keyword">pass</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>pipelines.py文件：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define your item pipelines here</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span class="token comment" spellcheck="true"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>


<span class="token comment" spellcheck="true"># useful for handling different item types with a single interface</span>
<span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>pipelines<span class="token punctuation">.</span>images <span class="token keyword">import</span> ImagesPipeline
<span class="token keyword">from</span> scrapy <span class="token keyword">import</span> Request
<span class="token keyword">class</span> <span class="token class-name">DoubanmoviesPipeline</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> item
    <span class="token keyword">def</span> <span class="token function">get_media_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 循环每一张图片地址下载，若传过来的不是集合则无需循环直接yield</span>
        <span class="token keyword">for</span> image_url <span class="token keyword">in</span> <span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true">## meta里面的数据是从spider获取，然后通过meta传递给下面方法：file_path</span>
            <span class="token comment" spellcheck="true"># yield Request(image_url, meta={'name': item['movieName']})</span>
            <span class="token keyword">yield</span> Request<span class="token punctuation">(</span>image_url<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 重命名，若不重写这函数，图片名为哈希，就是一串乱七八糟的名字</span>
    <span class="token keyword">def</span> <span class="token function">file_path</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token operator">=</span>None<span class="token punctuation">,</span> info<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image_guid <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 提取url前面名称作为图片名。</span>
        filename <span class="token operator">=</span> u<span class="token string">'{0}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>image_guid<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#保存图片</span>
        <span class="token keyword">return</span> filename
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>settings.py文件：</p>
<pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true">#关闭 robots 协议，否则很多页面都无法爬取</span>
LOG_LEVEL <span class="token operator">=</span> <span class="token string">"WARNING"</span> <span class="token comment" spellcheck="true">#日志为警告以上才显示</span>
USER_AGENT <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36'</span> <span class="token comment" spellcheck="true"># 模拟浏览器请求，改成自己网页最新的</span>
FEED_EXPORT_FIELDS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Ranking"</span><span class="token punctuation">,</span><span class="token string">"movieName"</span><span class="token punctuation">,</span><span class="token string">"director"</span><span class="token punctuation">,</span><span class="token string">"rating"</span><span class="token punctuation">,</span><span class="token string">"imageURL"</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#使其输出的内容有顺序</span>
DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment" spellcheck="true"># 设置爬取时间间隔，太快的爬取可能会被网页反爬虫机制检测到</span>
RANDOMIZE_DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token boolean">True</span>
COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment" spellcheck="true"># 使能cookie</span>
ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'doubanMovies.pipelines.DoubanmoviesPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span>
<span class="token punctuation">}</span>
IMAGES_STORE <span class="token operator">=</span> <span class="token string">'./imgs'</span> <span class="token comment" spellcheck="true">#保存目录</span>
IMAGES_URLS_FIELD <span class="token operator">=</span> <span class="token string">"image"</span> <span class="token comment" spellcheck="true">#保存名为image的内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>终端执行以下命令开始运行程序：</p>
<pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl douban<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看imgs中的图片内容：</p>
<p>pipeline TODO:<a target="_blank" href="https://www.jianshu.com/p/1dddcbe8e312" rel="external nofollow noreferrer noopener">https://www.jianshu.com/p/1dddcbe8e312</a></p>
<p>出现错误No module named ‘PIL’，可以通过以下方式安装相关依赖包</p>
<pre class="line-numbers language-python"><code class="language-python">pip install Pillow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="5-9-第二个Scrapy网络爬虫-校花爬爬爬"><a href="#5-9-第二个Scrapy网络爬虫-校花爬爬爬" class="headerlink" title="5.9 第二个Scrapy网络爬虫-校花爬爬爬"></a>5.9 第二个Scrapy网络爬虫-校花爬爬爬</h3><h4 id="5-9-1-爬取网页分析"><a href="#5-9-1-爬取网页分析" class="headerlink" title="5.9.1 爬取网页分析"></a>5.9.1 爬取网页分析</h4><p>网址：<a target="_blank" href="https://nice.ruyile.com/?f=3" rel="external nofollow noreferrer noopener">https://nice.ruyile.com/?f=3</a></p>
<p>目标：获取网址中的校园美女的全部图片到本地，以便等寝室没人的时候偷偷欣赏</p>
<p>怎么获取到这些图片呢？通过源码分析如下：</p>
<p>F12打开网页源码可以发现，f=3是校园美女的分页，列出的校园美女元素在class=’m3_xhtp’的div标签下，每一个元素都是tp_list，里面存放了tp_a的图片链接和tp_mz的文字信息链接。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509103712005.png" alt="网页源码分析"></p>
<h4 id="5-9-2-校花美女实现"><a href="#5-9-2-校花美女实现" class="headerlink" title="5.9.2 校花美女实现"></a>5.9.2 校花美女实现</h4><p><strong>创建工程</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject girls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>创建爬虫程序</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> girls
scrapy genspider xh https://nice.ruyile.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>文件说明</strong></p>
<ul>
<li>scrapy.cfg  项目的配置信息，主要为Scrapy命令行工具提供一个基础的配置信息。（真正爬虫相关的配置信息在settings.py文件中）</li>
<li>items.py   设置数据存储模板，用于结构化数据，如：Django的Model</li>
<li>pipelines   数据处理行为，如：一般结构化的数据持久化</li>
<li>settings.py 配置文件，如：递归的层数、并发数，延迟下载等</li>
<li>spiders    爬虫目录，如：创建文件，编写爬虫规则</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509104816949.png" alt="工程目录结构"></p>
<p><strong>设置数据库存储模板</strong></p>
<p>Item.py文件</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">GirlsItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>
    <span class="token comment" spellcheck="true"># name = scrapy.Field()</span>
    addr <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">pass</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>编写爬虫xh.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">import</span> os
<span class="token keyword">from</span> girls<span class="token punctuation">.</span>items <span class="token keyword">import</span> GirlsItem

<span class="token keyword">class</span> <span class="token class-name">XhSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'xh'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://nice.ruyile.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://nice.ruyile.com/?f=3&amp;p='</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">358</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        allPics <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tp_a"]/a'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> pic <span class="token keyword">in</span> allPics<span class="token punctuation">:</span>
            item <span class="token operator">=</span> GirlsItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
            name <span class="token operator">=</span> pic<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./img/@alt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            addr <span class="token operator">=</span> pic<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> name
            item<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> addr
            <span class="token comment" spellcheck="true"># 返回爬取到的数据</span>
            <span class="token keyword">yield</span> item
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>设置配置文件setup.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 设置处理返回数据的类及执行优先级</span>
ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'girls.pipelines.GirlsPipeline'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true"># 设置下载延迟，以防止被检测到爬虫行为</span>
DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>编写数据库处理脚本pipeline.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">GirlsPipeline</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'</span><span class="token punctuation">}</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
        file_name <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>r<span class="token string">'E:\imgs'</span><span class="token punctuation">,</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
            fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        <span class="token keyword">return</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>执行爬虫</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> girls
scrapy crawl xh --nolog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>结果</strong></p>
<p>满屏的荷尔蒙，后宫三千佳丽般的赶脚😄</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509115359544.png" alt="满屏的荷尔蒙"></p>
<h3 id="5-10-第三个Scrapy网络爬虫-职业职场"><a href="#5-10-第三个Scrapy网络爬虫-职业职场" class="headerlink" title="5.10 第三个Scrapy网络爬虫-职业职场"></a>5.10 第三个Scrapy网络爬虫-职业职场</h3><p><a target="_blank" href="https://blog.csdn.net/diaolouan9546/article/details/101492132?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-2.vipsorttest&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-2.vipsorttest" rel="external nofollow noreferrer noopener">https://blog.csdn.net/diaolouan9546/article/details/101492132?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.vipsorttest&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.vipsorttest</a></p>
<h4 id="5-10-1-爬取页面分析"><a href="#5-10-1-爬取页面分析" class="headerlink" title="5.10.1 爬取页面分析"></a>5.10.1 爬取页面分析</h4><p>网址：<a target="_blank" href="https://www.zhipin.com/" rel="external nofollow noreferrer noopener">https://www.zhipin.com/</a></p>
<p>目标：根据查找的职业信息，找出符合条件的职位、公司、薪资、位置、经验、教育、工作内容需求、公司分类信息等；</p>
<p>怎么获取到这些内容呢？通过<strong>网址</strong>和<strong>网页源码</strong>分析如下：</p>
<p>网址<code>query=</code>表示<strong>查询内容</strong>，<code>page=</code>表示<strong>第几页</strong>，通过<code>网页源码</code>找到<strong>显示结果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210509170237939.png" alt="网页源码分析"></p>
<h4 id="5-10-2-直聘网爬取实现"><a href="#5-10-2-直聘网爬取实现" class="headerlink" title="5.10.2 直聘网爬取实现"></a>5.10.2 直聘网爬取实现</h4><p><strong>创建工程</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject boss<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>创建crawl爬虫程序</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> boss
scrapy genspider boss_spider www.zhipin.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>设置数据库存储模板</strong></p>
<p>Item.py文件</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">BossItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    job_name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    money <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    tags <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    info_desc <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>编写爬虫</strong></p>
<p>boss_spider.py</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> boss<span class="token punctuation">.</span>items <span class="token keyword">import</span> BossItem

<span class="token keyword">class</span> <span class="token class-name">BossSpiderSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'boss_spider'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'zhipin.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.zhipin.com/c101120100/?query=python&amp;page=1'</span><span class="token punctuation">]</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://www.zhipin.com'</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        job <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">"//div[@class='job-list']/ul/li"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> job<span class="token punctuation">:</span>
            job_name <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//span[@class='job-name']/a/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>job_name<span class="token punctuation">)</span>
            money <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//span[@class='red']/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>
            name <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//h3[@class='name']/a/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>
            tags <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//div[@class='tags']/span/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall <span class="token punctuation">(</span><span class="token punctuation">)</span>
            tags <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join <span class="token punctuation">(</span>tags<span class="token punctuation">)</span>
            info_desc <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath <span class="token punctuation">(</span><span class="token string">".//div[@class='info-desc']/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">yield</span> BossItem <span class="token punctuation">(</span>job_name<span class="token operator">=</span>job_name<span class="token punctuation">,</span> money<span class="token operator">=</span>money<span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">,</span> tags<span class="token operator">=</span>tags<span class="token punctuation">,</span> info_desc<span class="token operator">=</span>info_desc<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 获取下一页的地址</span>
        page <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//div[@class='page']/a[last()]/@href"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        next_url <span class="token operator">=</span> self<span class="token punctuation">.</span>base_url <span class="token operator">+</span> page
        <span class="token keyword">if</span> <span class="token operator">not</span> next_url<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"退出"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"下一页地址："</span><span class="token punctuation">,</span>next_url<span class="token punctuation">)</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request <span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>设置middlewares.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> signals
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time
<span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> is_item<span class="token punctuation">,</span> ItemAdapter
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>http<span class="token punctuation">.</span>response<span class="token punctuation">.</span>html <span class="token keyword">import</span> HtmlResponse

<span class="token keyword">class</span> <span class="token class-name">CookiesMiddlewares</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"init chrome boswer"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 我们等待5秒钟，让其加载</span>
        source <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>page_source
        <span class="token comment" spellcheck="true">#获取页面的源码</span>
        response <span class="token operator">=</span> HtmlResponse<span class="token punctuation">(</span>url<span class="token operator">=</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>current_url<span class="token punctuation">,</span>body<span class="token operator">=</span>source<span class="token punctuation">,</span>request<span class="token operator">=</span>request<span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># Response 对象用来描述一个HTTP响应</span>
        <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>设置配置文件setup.py</strong></p>
<p>打开DOWNLOADER_MIDDLEWARES</p>
<pre class="line-numbers language-python"><code class="language-python">DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'boss.middlewares.CookiesMiddlewares'</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>设置DEFAULT_REQUEST_HEADERS</p>
<pre class="line-numbers language-python"><code class="language-python">DEFAULT_REQUEST_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span><span class="token punctuation">,</span>
  <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en'</span><span class="token punctuation">,</span>
  <span class="token string">'USER_AGENT'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36'</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关闭robot</p>
<pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>下载延迟设置</p>
<pre class="line-numbers language-python"><code class="language-python">DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>设置运行文件</strong></p>
<p>在工程目录下创建main.py</p>
<pre class="line-numbers language-bash"><code class="language-bash">from scrapy <span class="token function">import</span> cmdline

cmdline.execute<span class="token punctuation">(</span><span class="token string">'scrapy crawl boss_spider -o boss.csv'</span>.split<span class="token punctuation">(</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>结果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210521174719493.png" alt="boss直聘爬虫结果"></p>
<h2 id="六、1天学会Scrapy分布式爬虫"><a href="#六、1天学会Scrapy分布式爬虫" class="headerlink" title="六、1天学会Scrapy分布式爬虫"></a>六、1天学会Scrapy分布式爬虫</h2><p>面章节，我们都是在一台机器上运行网络爬虫。单机由于受硬件和网络带宽的限制，如果爬取的数据量较大，就需要耗费很长时间。为了解决这个问题，我们可以在多台计算机上同时运行网络爬虫，以“人多力量大”的思想，共同完成一个大型爬取任务。</p>
<p>本章将学习爬虫的分布式部署及实现。主要内容包括：</p>
<p>\1. 分布式爬虫原理</p>
<p>介绍分布式爬虫的实现原理、分布式爬虫库Scrapy-Redis。建议学习时长为1.5学时。</p>
<p>\2. Scrapy分布式实现</p>
<p>在多台机器上部署分布式爬虫，实现分布式功能。建议学习时长3学时。</p>
<h3 id="6-1-分布式爬虫基本原理"><a href="#6-1-分布式爬虫基本原理" class="headerlink" title="6.1 分布式爬虫基本原理"></a>6.1 分布式爬虫基本原理</h3><p>分布式爬虫的思想是“人多力量大”，在网络中的多台计算机上同时运行爬虫程序，共同完成一个大型爬取任务。</p>
<p>Scrapy爬虫框架本身不支持分布式爬虫，要使其支持分布式爬虫，就需要对Scrapy框架做一些修改，先来看一下原始的Scrapy框架结构图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329155948.jpg" alt="img"></p>
<p>该流程简单来说，就是：Spiders生成的请求经由Scheduler调度器发送给Downloader下载器，Downloader下载器从internet下载所需要的网络数据，返回response给Spiders，Spiders接着把数据放进item容器。</p>
<h3 id="6-2-Scrapy-Redis"><a href="#6-2-Scrapy-Redis" class="headerlink" title="6.2 Scrapy-Redis"></a>6.2 Scrapy-Redis</h3><p>如何实现分布式爬虫呢？这就要用到第三方库Scrapy-Redis了。它为Scrapy框架拓展了分布式爬取的功能，两者结合便是一个分布式Scrapy爬虫框架。</p>
<p>加上Scrapy-Redis之后的架构如下图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329160010.jpg" alt="Scrapy-Redis框架"> </p>
<p>如上图所示，scrapy-redis在scrapy的架构上增加了Redis。它利用Redis对请求(Requests)进行存储和调度(Schedule)，并对爬取产生的项目(Items)存储以供后续处理使用。Scrapy-Redis为多个爬虫分配爬取任务的方式是：让所有爬虫共享一个存在于Redis数据库中的请求队列（替代各爬虫独立的请求队列），每个爬虫从请求队列中获取请求，下载并解析页面后，将解析出的新请求再添加到请求队列中，因此每个爬虫既是下载任务的生产者有时消费者。</p>
<h3 id="6-3-分布式爬虫"><a href="#6-3-分布式爬虫" class="headerlink" title="6.3 分布式爬虫"></a>6.3 分布式爬虫</h3><p>为实现多个爬虫的任务分配，Scrapy-Redis重新实现了Scrapy中的以下组件：</p>
<p>Scheduler：Scrapy不支持多个Spider共享同一个队列（每个Spider各自独立），这就是Scrapy不支持分布式爬虫的原因之一，Scrapy-Redis的解决方法是把Scrapy的队列换成Redis数据库（即Redis队列）。将要爬取的Request存放在同一个Redis数据库中，多个Spider都读取同一个Reids数据库中的Request。</p>
<p>Duplication Filter：在Scrapy-Redis中去重是由Duplication Filter组件来实现的，它通过Redis的set不重复的特性，巧妙的实现了DuplicationFilter去重。Scrapy-Redis调度器从引擎接受Request，将Request存入Redis的set检查是否重复，并将不重复的Request写入Redis的Request队列。</p>
<p>当请求Request(Spider发出的）时，调度器从Redis的Request队列里根据优先级取出⼀个Request 返回给引擎，引擎将此Request发给Spider处理。</p>
<p>Item Pipeline：在分布式爬虫框架中，各个主机爬取到的数据最终要统一汇总到同一个地方，通常是某个数据库。Scrapy-Redis提供了一个Item Pipeline（RedisPipeline），用于将各个爬虫爬取到的数据存入同一个Redis数据库中。</p>
<p>Spider：Scrapy-Redis重写了Scrapy的类Spider，重写的RedisSpider继承了Spider和RedisMixin这两个类，RedisMixin是用来从redis读取url的类。</p>
<h3 id="6-4-分布式爬虫架构"><a href="#6-4-分布式爬虫架构" class="headerlink" title="6.4 分布式爬虫架构"></a>6.4 分布式爬虫架构</h3><p>搭建分布式爬虫，一般需要一台主机和N台从机。主机用于分配任务、去重；从机负责从主机获取任务，执行数据抓取、数据处理、数据存储。如下图所示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/20210329160121.jpg" alt="分布式爬取框架"> </p>
<p>主要流程为：Slaver端从Master端获取任务（Request/url/ID），进行数据抓取，在抓取数据的同时也生成新任务，并将任务抛给Master。Master端只有一个Redis数据库，负责对Slaver提交的任务进行去重、加入待爬队列。</p>
<p>这种方式有其优缺点：</p>
<p>优点：scrapy-redis默认使用的就是这种策略，我们实现起来很简单，因为任务调度等工作scrapy-redis都已经帮我们做好了，我们只需要继承RedisSpider、指定redis_key就行了。</p>
<p>缺点：scrapy-redis调度的任务是Request对象，里面信息量比较大（不仅包含url，还有callback函数、headers等信息），导致的结果就是会降低爬虫速度、而且会占用Redis大量的存储空间。当然我们可以重写方法实现调度url。</p>
<h3 id="6-5-分布式爬虫环境搭建"><a href="#6-5-分布式爬虫环境搭建" class="headerlink" title="6.5 分布式爬虫环境搭建"></a>6.5 分布式爬虫环境搭建</h3><p>来看一下实现分布式爬虫需要的环境。</p>
<ol>
<li><p>安装Redis数据库。</p>
<p> Redis数据库是分布式爬虫必备的环境，需要在主机（Master）上安装好Redis数据库。关于Redis数据库的安装，可以参考第三章中“使用Redis持久化数据”一节，在此不再赘述。</p>
</li>
<li><p>配置Redis环境</p>
<p> Redis数据库默认只能本机访问，其他机器是无法访问的，因此需要设置一下Redis环境，使得从机（Slaver）也可以访问。</p>
<p> 在Redis目录下，找到并打开redis.windows-service.conf文件，做如下设置：</p>
</li>
</ol>
<p>（1） 将bind 127.0.0.1注释掉</p>
<p>（2） 将protected-mode由yes设置为no</p>
<ol start="3">
<li><p>安装Redis数据库可视化工具：RedisDesktopManager。</p>
<p> RedisDesktopManager是一款Redis可视化工具，使用该工具可以简单快捷地查看Redis数据库中的额数据。也可以参考第三章中“使用Redis持久化数据”一节，不再赘述。</p>
</li>
<li><p>安装Scrapy-Redis库。</p>
<p> Scrapy-Redis库是分布式爬虫的核心库，它重写了Scrapy框架中的部分功能，使得Scrapy具有分布式爬虫的功能，安装Scrapy-Redis库非常简单，使用pip命令即可：<code>pip install scrapy-redis</code></p>
</li>
</ol>
<p>下面通过具体的视频详细了解一下环境搭建和环境配置的方法。</p>
<h3 id="6-6-案例"><a href="#6-6-案例" class="headerlink" title="6.6 案例"></a>6.6 案例</h3><p>对51Jobs的<a target="_blank" href="https://jobs.51job.com/all/p1%E7%BD%91%E9%A1%B5%E6%B6%89%E5%8F%8A%E7%9A%84%E5%B2%97%E4%BD%8D%E8%AF%A6%E6%83%85%E8%BF%9B%E8%A1%8C%E7%88%AC%E5%8F%96%E3%80%82" rel="external nofollow noreferrer noopener">https://jobs.51job.com/all/p1网页涉及的岗位详情进行爬取。</a></p>
<h4 id="6-6-1-使用scrapy爬取"><a href="#6-6-1-使用scrapy爬取" class="headerlink" title="6.6.1 使用scrapy爬取"></a>6.6.1 使用scrapy爬取</h4><p><strong>创建项目</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">scrapy startproject recruit
<span class="token function">cd</span> recruit
scrapy genspider job51 <span class="token string">'jobs.51job.com'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>修改爬取的数据items.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define here the models for your scraped items</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># See documentation in:</span>
<span class="token comment" spellcheck="true"># https://docs.scrapy.org/en/latest/topics/items.html</span>

<span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">RecruitItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#职位名称</span>
    title <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#公司名称</span>
    company <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#公司的人数</span>
    companyperson <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#公司类别</span>
    companycategory <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#公司主要做什么的</span>
    companydo <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#工作地点</span>
    location <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#工作地址</span>
    address <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#薪水</span>
    salary <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#招聘人数</span>
    person <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#发布时间</span>
    data <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#学历要求</span>
    request <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#工作经验</span>
    experience <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>修改爬取文件Job51Spider.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> recruit<span class="token punctuation">.</span>items <span class="token keyword">import</span> RecruitItem
<span class="token keyword">import</span> re

<span class="token keyword">class</span> <span class="token class-name">Job51Spider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'job51'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'jobs.51job.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://jobs.51job.com/all/p1'</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        url <span class="token operator">=</span> response<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
        city <span class="token operator">=</span> url<span class="token punctuation">[</span>len<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span>
        page <span class="token operator">=</span> url<span class="token punctuation">[</span>len<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span>
        new_page <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+'</span><span class="token punctuation">,</span>page<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        urls <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//div[@class="detlist gbox"]/div/p/span/a/@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_info<span class="token punctuation">)</span>
        pages <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//div[@class="p_in"]/span[@class="td"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        pagenum <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+'</span><span class="token punctuation">,</span>pages<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> int<span class="token punctuation">(</span>new_page<span class="token punctuation">)</span> <span class="token operator">&lt;</span> int<span class="token punctuation">(</span>pagenum<span class="token punctuation">)</span><span class="token punctuation">:</span>
            new_page <span class="token operator">=</span> int<span class="token punctuation">(</span>new_page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
            new_url <span class="token operator">=</span> <span class="token string">"https://jobs.51job.com/"</span> <span class="token operator">+</span> city <span class="token operator">+</span> <span class="token string">"/p"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>new_page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>new_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">parse_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># print(response.url)</span>
        <span class="token keyword">pass</span>
        item <span class="token operator">=</span> RecruitItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#职位名称</span>
        item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="in"]/div/h1/@title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#公司名称</span>
        item<span class="token punctuation">[</span><span class="token string">'company'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="in"]/div/p/a[@class="catn"]/@title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true">#获取公司信息</span>
        company <span class="token operator">=</span> self<span class="token punctuation">.</span>getPerAndCatAndDo<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#公司类别</span>
        item<span class="token punctuation">[</span><span class="token string">'companycategory'</span><span class="token punctuation">]</span> <span class="token operator">=</span> company<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#公司的人数</span>
        item<span class="token punctuation">[</span><span class="token string">'companyperson'</span><span class="token punctuation">]</span> <span class="token operator">=</span> company<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#公司主要做什么的</span>
        item<span class="token punctuation">[</span><span class="token string">'companydo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> company<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#薪水</span>
        salary<span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tHeader tHjob"]/div/div/strong/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> salary <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">'salary'</span><span class="token punctuation">]</span> <span class="token operator">=</span> salary
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">'salary'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span>
        <span class="token comment" spellcheck="true">#工作地址</span>
        address <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tBorderTop_box"]/div[@class="bmsg inbox"]/p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> address <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span> <span class="token operator">=</span> address
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            item<span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment" spellcheck="true">#获取招聘信息</span>
        recruit <span class="token operator">=</span> self<span class="token punctuation">.</span>getRequestInfo<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#工作地点</span>
        item<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#工作经验</span>
        item<span class="token punctuation">[</span><span class="token string">'experience'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#学历要求</span>
        item<span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#招聘人数</span>
        item<span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#发布时间</span>
        item<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> recruit<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">yield</span> item
    <span class="token keyword">def</span> <span class="token function">getPerAndCatAndDo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="tBorderTop_box"]/div[@class="com_tag"]/p/@title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">:</span>
            companycategory <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            companydo <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
            companycategory <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            companyperson <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\d+'</span><span class="token punctuation">,</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            companydo <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            companycategory <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            companyperson <span class="token operator">=</span> <span class="token string">''</span>
            companydo <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>companycategory<span class="token punctuation">,</span>companyperson<span class="token punctuation">,</span>companydo<span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">getRequestInfo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="in"]/div/p[@class="msg ltype"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># result = result.replace(r'\xa0',"")</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>
            location <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            experience <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            request <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            person <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
            location <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            experience <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            request <span class="token operator">=</span> <span class="token string">''</span>
            person <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\xa0'</span><span class="token punctuation">,</span> u<span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>location<span class="token punctuation">,</span>experience<span class="token punctuation">,</span>request<span class="token punctuation">,</span>person<span class="token punctuation">,</span>data<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>修改pipelines.py文件</strong></p>
<p>把数据保存到mongodb数据库中</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Define your item pipelines here</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span class="token comment" spellcheck="true"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>


<span class="token comment" spellcheck="true"># useful for handling different item types with a single interface</span>
<span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter
<span class="token keyword">import</span> pymongo

<span class="token keyword">class</span> <span class="token class-name">RecruitPipeline</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 获取连接</span>
        client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'192.168.56.128'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 设置数据库</span>
        db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'recruit'</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true">#设置集合(表)</span>
        self<span class="token punctuation">.</span>col <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'job51'</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#写入集合(表)</span>
        self<span class="token punctuation">.</span>col<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'插入成功'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>设置配置文件settings.py</strong></p>
<pre class="line-numbers language-python"><code class="language-python">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span>
DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span>
ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'recruit.pipelines.RecruitPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>启动爬虫</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl job51<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>观察mongodb数据结果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210524151808368.png" alt="爬取最终结果"></p>
<h4 id="6-6-2-改用scrapy-redis爬取"><a href="#6-6-2-改用scrapy-redis爬取" class="headerlink" title="6.6.2 改用scrapy-redis爬取"></a>6.6.2 改用scrapy-redis爬取</h4><ul>
<li><p>将爬虫的类 scrapy.Spider 换成 scrapy_redis.spiders.RedisSpider</p>
</li>
<li><p>将 start_urls = [‘<a target="_blank" href="https://jobs.51job.com/zhongshan/p1/%E2%80%99]" rel="external nofollow noreferrer noopener">https://jobs.51job.com/zhongshan/p1/’]</a> 删掉添加一个 redis_key</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> scrapy_redis<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> RedisCrawlSpider

<span class="token keyword">class</span> <span class="token class-name">Job51Spider</span><span class="token punctuation">(</span>RedisCrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'job51'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'jobs.51job.com'</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># start_urls = ['https://jobs.51job.com/all/p1']</span>
    <span class="token comment" spellcheck="true"># 将start_url插入redis,键为fang_url(lpush job51:start_urls https://jobs.51job.com/all/p1/)</span>
    redis_key <span class="token operator">=</span> <span class="token string">"job51:start_urls"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<ul>
<li><p>在配置文件中添加配置</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用scrapy-redis里的去重组件，不使用scrapy的默认去重，用来将url去重</span>
DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">"scrapy_redis.dupefilter.RFPDupeFilter"</span>
<span class="token comment" spellcheck="true"># 使用scrapy-redis里的调度器组件，不使用scrapy的默认的调度器</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span>
<span class="token comment" spellcheck="true"># 允许暂停，Redis请求记录不丢失</span>
SCHEDULER_PERSIST <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment" spellcheck="true"># 指定要存储的redis数据库的主机IP</span>
REDIS_HOST <span class="token operator">=</span> <span class="token string">'192.168.56.128'</span>  <span class="token comment" spellcheck="true"># 远端的ip地址</span>

<span class="token comment" spellcheck="true"># 指定redis数据库主机的端口</span>
REDIS_PORT <span class="token operator">=</span> <span class="token number">6379</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<ul>
<li><p>在redis中添加url数据</p>
<pre class="line-numbers language-bash"><code class="language-bash">lpush job51:start_urls https://jobs.51job.com/all/p1/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="https://cdn.jsdelivr.net/gh/aibittek/ImageHost/img/image-20210524154126977.png" alt="redis start_urls"></p>
</li>
<li><p>启动爬虫，就可以在redis中看到爬取的数据了</p>
<pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl job51<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><ol>
<li><a target="_blank" href="https://docs.python.org/zh-cn/3/" rel="external nofollow noreferrer noopener">https://docs.python.org/zh-cn/3/</a> python官方文档</li>
<li><a target="_blank" href="https://www.runoob.com/python3/" rel="external nofollow noreferrer noopener">https://www.runoob.com/python3/</a> python入门菜鸟教程</li>
<li><a target="_blank" href="https://www.liaoxuefeng.com/wiki/1016959663602400" rel="external nofollow noreferrer noopener">https://www.liaoxuefeng.com/wiki/1016959663602400</a> 廖雪峰的python教程</li>
<li><a target="_blank" href="https://docs.scrapy.org/en/latest/" rel="external nofollow noreferrer noopener">https://docs.scrapy.org/en/latest/</a> Scrapy官方文档</li>
<li><a target="_blank" href="https://www.runoob.com/w3cnote/scrapy-detail.html" rel="external nofollow noreferrer noopener">https://www.runoob.com/w3cnote/scrapy-detail.html</a> Scrapy入门教程</li>
<li><a target="_blank" href="http://www.scrapyd.cn/doc/137.html" rel="external nofollow noreferrer noopener">http://www.scrapyd.cn/doc/137.html</a> Scrapy中文学习</li>
<li>另外参考了github上的众多开源项目，由于参考比较多，不一一列举，如有侵权请告知</li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">比特的世界</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://kui.ge/2021/03/pythonspider/">https://kui.ge/2021/03/pythonspider/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">比特的世界</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/python/">
                                    <span class="chip bg-color">python</span>
                                </a>
                            
                                <a href="/tags/scrapy/">
                                    <span class="chip bg-color">scrapy</span>
                                </a>
                            
                                <a href="/tags/%E7%88%AC%E8%99%AB/">
                                    <span class="chip bg-color">爬虫</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '8e2fa5d09cd99b02327a',
        clientSecret: '4133c74a7f787b5ed7c5174939967a35772d3153',
        proxy: 'https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token',
        repo: 'aibittek.github.io',
        owner: 'aibittek',
        admin: "aibittek",
        id: '2021-03-16T17-44-02',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/04/snowboy-hotword-detect/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="唤醒词自定义snowboy">
                        
                        <span class="card-title">唤醒词自定义snowboy</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-04-11
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/MarsRescue/" class="post-category">
                                    MarsRescue
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/snowboy/">
                        <span class="chip bg-color">snowboy</span>
                    </a>
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                    <a href="/tags/%E8%AF%AD%E9%9F%B3%E5%94%A4%E9%86%92/">
                        <span class="chip bg-color">语音唤醒</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/02/walle/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="WALLE">
                        
                        <span class="card-title">WALLE</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-02-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/MarsPlan/" class="post-category">
                                    MarsPlan
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/WALLE/">
                        <span class="chip bg-color">WALLE</span>
                    </a>
                    
                    <a href="/tags/WALL-E/">
                        <span class="chip bg-color">WALL-E</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">比特的世界</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">103.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/aibittek" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:55239610@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=群号:217197707" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 群号:217197707" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/people/yidoumi" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/yidoumi" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</body>

</html>
